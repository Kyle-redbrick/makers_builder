{"ast":null,"code":"import _objectSpread from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread\";\nimport _toConsumableArray from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";\nimport _classCallCheck from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";\nimport _assertThisInitialized from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/assertThisInitialized\";\nimport _inherits from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";\nimport _possibleConstructorReturn from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";\nvar _jsxFileName = \"/Users/jimmy/Documents/Wizschool/wizlab_web2/src/Page/Learn/Component/LearnDetail/Container.js\";\n\nfunction _createSuper(Derived) { var hasNativeReflectConstruct = _isNativeReflectConstruct(); return function _createSuperInternal() { var Super = _getPrototypeOf(Derived), result; if (hasNativeReflectConstruct) { var NewTarget = _getPrototypeOf(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return _possibleConstructorReturn(this, result); }; }\n\nfunction _isNativeReflectConstruct() { if (typeof Reflect === \"undefined\" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === \"function\") return true; try { Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {})); return true; } catch (e) { return false; } }\n\nimport React, { Component } from \"react\";\nimport { connect } from \"react-redux\";\nimport { injectIntl } from \"react-intl\";\nimport { isMobileOnly, isTablet } from \"react-device-detect\";\nimport CertificateInput from \"../../../Builder/Component/DreamBuilder/PopUp/CertificateInput\";\nimport CertificatePrint from \"../../../../Common/Component/LearnCertification\";\nimport TemporaryId from \"../../../../Common/Component/TemporaryId\";\nimport SignIn from \"../../../../Common/Component/SignIn\";\nimport View from \"./View\";\nimport * as request from \"../../../../Common/Util/HTTPRequest\";\nimport Popup, { showPopUp } from \"../../../../Common/Component/PopUp\";\nimport * as userInfoActions from \"../../../../Common/Store/Reducer/UserInfo\";\nimport { filterBlindedComments } from \"../../../../Common/Util/Comments\";\n\nvar Container = /*#__PURE__*/function (_Component) {\n  _inherits(Container, _Component);\n\n  var _super = _createSuper(Container);\n\n  function Container(props) {\n    var _this;\n\n    _classCallCheck(this, Container);\n\n    _this = _super.call(this, props);\n\n    _this.onBrowserFocus = function () {\n      _this.getProject();\n\n      _this.getComments();\n    };\n\n    _this.getProject = function () {\n      var _this$props = _this.props,\n          projectId = _this$props.projectId,\n          userId = _this$props.userId;\n      request.getLearnProject({\n        projectId: projectId\n      }).then(function (res) {\n        return res.json();\n      }).then(function (json) {\n        return _this.setState({\n          project: json\n        });\n      }).catch(function (e) {\n        return console.error(e);\n      });\n\n      if (userId) {\n        request.getLearnUserProject({\n          projectId: projectId,\n          userId: userId\n        }).then(function (res) {\n          return res.json();\n        }).then(function (json) {\n          if (json) {\n            _this.setState({\n              currentMission: json.currentMission,\n              completedAt: json.completedAt\n            });\n          }\n        }).catch(function (e) {\n          return console.error(e);\n        });\n      }\n    };\n\n    _this.getComments = function () {\n      var comments = _this.state.comments;\n      var projectId = _this.props.projectId;\n      request.getLearnComments({\n        projectId: projectId,\n        limit: _this.COMMENTS_LIMIT,\n        offset: comments.length\n      }).then(function (res) {\n        return res.json();\n      }).then(function (json) {\n        return _this.setState({\n          comments: [].concat(_toConsumableArray(comments), _toConsumableArray(filterBlindedComments(json)))\n        });\n      }).catch(function (e) {\n        return console.error(e);\n      });\n    };\n\n    _this.onChangeCommentValue = function (e) {\n      var value = e.target.value;\n\n      if (value.length >= _this.COMMENT_WRITE_MAX_LENGTH) {\n        value = value.slice(0, _this.COMMENT_WRITE_MAX_LENGTH);\n      }\n\n      _this.setState({\n        commentValue: value\n      });\n    };\n\n    _this.onClickSubmitComment = function (e) {\n      var commentValue = _this.state.commentValue;\n      var _this$props2 = _this.props,\n          userId = _this$props2.userId,\n          projectId = _this$props2.projectId;\n\n      if (!userId) {\n        showPopUp( /*#__PURE__*/React.createElement(SignIn, {\n          __self: _assertThisInitialized(_this),\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 90,\n            columnNumber: 17\n          }\n        }), {\n          darkmode: true,\n          scrollable: true,\n          mobileFullscreen: true\n        });\n        return;\n      }\n\n      if (commentValue.length < 1) {\n        return;\n      }\n\n      var params = {\n        projectId: projectId,\n        content: commentValue,\n        userId: userId\n      };\n      request.addLearnComment(params).then(function (res) {\n        return res.json();\n      }).then(function (json) {\n        var _this$props3 = _this.props,\n            userId = _this$props3.userId,\n            name = _this$props3.name,\n            icon = _this$props3.icon;\n\n        var comment = _objectSpread({}, json, {\n          user: {\n            id: userId,\n            name: name,\n            icon: icon\n          }\n        });\n\n        _this.setState({\n          commentValue: \"\",\n          comments: [comment].concat(_toConsumableArray(_this.state.comments))\n        });\n      }).catch(function (e) {\n        return console.error(e);\n      });\n    };\n\n    _this.onClickMore = function () {\n      _this.getComments();\n    };\n\n    _this.onClickReportComment = function (commentId) {\n      var intl = _this.props.intl;\n      showPopUp( /*#__PURE__*/React.createElement(Popup.OneInput, {\n        title: intl.formatMessage({\n          id: \"ID_LEARN_DETAIL_COMMENT_REPORT_TITLE\"\n        }),\n        buttonName: intl.formatMessage({\n          id: \"ID_LEARN_DETAIL_COMMENT_REPORT_OK\"\n        }),\n        buttonAction: function buttonAction(content) {\n          if (content && content.length > 0) {\n            var params = {\n              content: content,\n              commentId: commentId\n            };\n            var userId = _this.props.userId;\n\n            if (userId) {\n              params.userId = userId;\n            } //request to server\n\n\n            request.reportLearnComment(params).then(function (res) {\n              //show reported popup\n              showPopUp( /*#__PURE__*/React.createElement(Popup.OneButton, {\n                title: _this.props.intl.formatMessage({\n                  id: \"ID_LEARN_DETAIL_COMMENT_REPORT_SUCCESS\"\n                }),\n                buttonName: _this.props.intl.formatMessage({\n                  id: \"ID_LEARN_DETAIL_COMMENT_REPORT_SUCCESS_OK\"\n                }),\n                __self: _assertThisInitialized(_this),\n                __source: {\n                  fileName: _jsxFileName,\n                  lineNumber: 134,\n                  columnNumber: 19\n                }\n              }), {\n                darkmode: true,\n                mobileFullscreen: true\n              });\n            }).catch(function (e) {\n              return console.error(e);\n            });\n          }\n        },\n        __self: _assertThisInitialized(_this),\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 119,\n          columnNumber: 7\n        }\n      }), {\n        dismissOverlay: true,\n        darkmode: true,\n        mobileFullscreen: true\n      });\n    };\n\n    _this.onClickDeleteComment = function (commentId) {\n      var intl = _this.props.intl;\n      showPopUp( /*#__PURE__*/React.createElement(Popup.TwoButton, {\n        title: intl.formatMessage({\n          id: \"ID_LEARN_DETAIL_COMMENT_DELETE_CONFIRM\"\n        }),\n        cancelButtonName: intl.formatMessage({\n          id: \"ID_LEARN_DETAIL_COMMENT_DELETE_CONFIRM_NO\"\n        }),\n        confirmButtonName: intl.formatMessage({\n          id: \"ID_LEARN_DETAIL_COMMENT_DELETE_CONFIRM_YES\"\n        }),\n        confirmAction: function confirmAction() {\n          request.deleteLearnComment({\n            id: commentId\n          }).then(function (res) {\n            _this.setState({\n              comments: _this.state.comments.filter(function (comment) {\n                return comment.id !== commentId;\n              })\n            });\n          }).catch(function (e) {\n            return console.error(e);\n          });\n        },\n        __self: _assertThisInitialized(_this),\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 152,\n          columnNumber: 7\n        }\n      }), {\n        dismissButton: false,\n        darkmode: true\n      });\n    };\n\n    _this.onClickClose = function () {\n      _this.props.onClose();\n    };\n\n    _this.onClickStart = function (missionNum) {\n      var _this$props4 = _this.props,\n          projectId = _this$props4.projectId,\n          userId = _this$props4.userId;\n      var currentMission = _this.state.currentMission;\n\n      if (isTablet) {\n        showPopUp( /*#__PURE__*/React.createElement(Popup.OneButton, {\n          title: _this.props.intl.formatMessage({\n            id: \"ID_LEARN_DETAIL_MOBILE_POPUP_MESSAGE03\"\n          }),\n          buttonName: _this.props.intl.formatMessage({\n            id: \"ID_LEARN_DETAIL_MOBILE_POPUP_CONFIRM_BUTTON\"\n          }),\n          __self: _assertThisInitialized(_this),\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 180,\n            columnNumber: 9\n          }\n        }), {\n          darkmode: true,\n          dismissButton: false,\n          dismissOverlay: true\n        });\n        return;\n      }\n\n      if (isMobileOnly) {\n        showPopUp( /*#__PURE__*/React.createElement(Popup.OneButton, {\n          title: _this.props.intl.formatMessage({\n            id: \"ID_LEARN_DETAIL_MOBILE_POPUP_MESSAGE03\"\n          }),\n          buttonName: _this.props.intl.formatMessage({\n            id: \"ID_LEARN_DETAIL_MOBILE_POPUP_CONFIRM_BUTTON\"\n          }),\n          __self: _assertThisInitialized(_this),\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 199,\n            columnNumber: 9\n          }\n        }), {\n          darkmode: true,\n          dismissButton: false,\n          dismissOverlay: true\n        });\n        return;\n      }\n\n      if (!userId) {\n        showPopUp( /*#__PURE__*/React.createElement(TemporaryId, {\n          __self: _assertThisInitialized(_this),\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 218,\n            columnNumber: 9\n          }\n        }), {\n          darkmode: true,\n          defaultPadding: false,\n          dismissButton: false\n        });\n        return;\n      }\n\n      if (missionNum) {\n        if (missionNum > currentMission) {\n          showPopUp( /*#__PURE__*/React.createElement(Popup.OneButton, {\n            title: _this.props.intl.formatMessage({\n              id: \"ID_LEARN_POPUP_STEP_CHECK_TITLE\"\n            }),\n            buttonName: _this.props.intl.formatMessage({\n              id: \"ID_LEARN_POPUP_STEP_CHECK_TITLE_BUTTON\"\n            }),\n            __self: _assertThisInitialized(_this),\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 226,\n              columnNumber: 11\n            }\n          }), {\n            darkmode: true,\n            mobileFullscreen: true\n          });\n          return;\n        }\n      }\n\n      request.addLearnUserProject({\n        projectId: projectId,\n        userId: userId\n      }).then(function (res) {\n        return res.json();\n      }).then(function (json) {\n        var mission;\n\n        if (missionNum === 0) {\n          mission = 0;\n        } else {\n          mission = missionNum ? missionNum : json.currentMission;\n        }\n\n        var url = \"/builder_learn/\".concat(projectId, \"?currentMission=\").concat(mission);\n        window.open(url);\n      }).catch(function (e) {\n        return console.error(e);\n      });\n    };\n\n    _this.onClickCert = function () {\n      // 인증서 출력기간 종료로 인한 비활성화\n      // reference - https://www.notion.so/wizschool/0a8e2869bedd4344a19832ecf62fe459\n      // if(isMobileOnly) {\n      //   showPopUp(\n      //     <Popup.OneButton\n      //       title={this.props.intl.formatMessage({\n      //         id: \"ID_LEARN_DETAIL_MOBILE_POPUP_MESSAGE\"\n      //       })}\n      //       buttonName={this.props.intl.formatMessage({\n      //         id: \"ID_LEARN_DETAIL_MOBILE_POPUP_CONFIRM_BUTTON\"\n      //       })}\n      //     />,\n      //     {\n      //       darkmode: true,\n      //       dismissButton: false,\n      //       dismissOverlay: true\n      //     }\n      //   );\n      //   return;\n      // }\n      // if(this.state.project.certImageURL) {\n      //   this.showCerificateInput();\n      // } else {\n      //임시 처리. 기획 필요함\n      showPopUp( /*#__PURE__*/React.createElement(Popup.OneButton, {\n        title: \"\\uC778\\uC99D\\uC11C \\uCD9C\\uB825 \\uAE30\\uAC04\\uC774 \\uC544\\uB2D9\\uB2C8\\uB2E4.\",\n        buttonName: \"\\uD655\\uC778\",\n        __self: _assertThisInitialized(_this),\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 282,\n          columnNumber: 9\n        }\n      }), {\n        darkmode: true,\n        dismissButton: false,\n        dismissOverlay: true\n      }); //   return;\n      // }\n    };\n\n    _this.COMMENTS_LIMIT = 10;\n    _this.COMMENT_WRITE_MAX_LENGTH = 500;\n    _this.state = {\n      project: undefined,\n      commentValue: \"\",\n      comments: [],\n      currentMission: 0,\n      completedAt: undefined\n    };\n    return _this;\n  }\n\n  _createClass(Container, [{\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      this.getProject();\n      this.getComments();\n      window.addEventListener(\"focus\", this.onBrowserFocus);\n    }\n  }, {\n    key: \"componentWillUnmount\",\n    value: function componentWillUnmount() {\n      window.removeEventListener(\"focus\", this.onBrowserFocus);\n    }\n  }, {\n    key: \"showCerificateInput\",\n    value: function showCerificateInput() {\n      var _this2 = this;\n\n      if (this.props.userId) {\n        if (this.state.completedAt) {\n          showPopUp( /*#__PURE__*/React.createElement(CertificateInput, {\n            defaultName: this.props.name,\n            defaultOrganization: this.props.organization,\n            onClickConfirm: function onClickConfirm(name, organization) {\n              if (_this2.props.name !== name || _this2.props.organization !== organization) {\n                _this2.props.updateUser({\n                  name: name,\n                  organization: organization\n                });\n\n                request.updateUserInfo({\n                  email: _this2.props.email,\n                  name: name,\n                  organization: organization\n                });\n              }\n\n              _this2.showCertificatePrint(name, organization);\n            },\n            __self: this,\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 300,\n              columnNumber: 11\n            }\n          }), {\n            dismissButton: false,\n            dismissOverlay: true\n          });\n        } else {\n          showPopUp( /*#__PURE__*/React.createElement(Popup.OneButton, {\n            title: this.props.intl.formatMessage({\n              id: \"ID_LEARN_POPUP_CERT_CHECK_TITLE\"\n            }),\n            buttonName: this.props.intl.formatMessage({\n              id: \"ID_LEARN_POPUP_STEP_CHECK_TITLE_BUTTON\"\n            }),\n            __self: this,\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 322,\n              columnNumber: 11\n            }\n          }), {\n            darkmode: true,\n            mobileFullscreen: true\n          });\n        }\n      } else {\n        showPopUp( /*#__PURE__*/React.createElement(TemporaryId, {\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 336,\n            columnNumber: 9\n          }\n        }), {\n          darkmode: true,\n          defaultPadding: false,\n          dismissButton: false\n        });\n      }\n    }\n  }, {\n    key: \"showCertificatePrint\",\n    value: function showCertificatePrint(name, organization) {\n      var _this$state$project = this.state.project,\n          certImageURL = _this$state$project.certImageURL,\n          title = _this$state$project.title,\n          category = _this$state$project.category;\n      showPopUp( /*#__PURE__*/React.createElement(CertificatePrint, {\n        name: name,\n        organization: organization,\n        title: \"\".concat(category.title, \" \").concat(title),\n        certImageURL: certImageURL,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 344,\n          columnNumber: 7\n        }\n      }), {\n        darkmode: true\n      });\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _this$state = this.state,\n          project = _this$state.project,\n          currentMission = _this$state.currentMission,\n          commentValue = _this$state.commentValue,\n          comments = _this$state.comments;\n      var onChangeCommentValue = this.onChangeCommentValue,\n          onClickSubmitComment = this.onClickSubmitComment,\n          onClickMore = this.onClickMore,\n          onClickReportComment = this.onClickReportComment,\n          onClickDeleteComment = this.onClickDeleteComment,\n          onClickClose = this.onClickClose,\n          onClickStart = this.onClickStart,\n          onClickCert = this.onClickCert;\n      var userId = this.props.userId;\n      return /*#__PURE__*/React.createElement(View, {\n        userId: userId,\n        project: project,\n        currentMission: currentMission,\n        commentValue: commentValue,\n        comments: comments,\n        onChangeCommentValue: onChangeCommentValue,\n        onClickSubmitComment: onClickSubmitComment,\n        onClickMore: onClickMore,\n        onClickReportComment: onClickReportComment,\n        onClickDeleteComment: onClickDeleteComment,\n        onClickClose: onClickClose,\n        onClickStart: onClickStart,\n        onClickCert: onClickCert,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 374,\n          columnNumber: 7\n        }\n      });\n    }\n  }]);\n\n  return Container;\n}(Component);\n\nexport default connect(function (state) {\n  return {\n    userId: state.userinfo.id,\n    email: state.userinfo.email,\n    name: state.userinfo.name,\n    icon: state.userinfo.icon,\n    organization: state.userinfo.organization\n  };\n}, {\n  updateUser: userInfoActions.updateUserInfo\n})(injectIntl(Container));","map":{"version":3,"sources":["/Users/jimmy/Documents/Wizschool/wizlab_web2/src/Page/Learn/Component/LearnDetail/Container.js"],"names":["React","Component","connect","injectIntl","isMobileOnly","isTablet","CertificateInput","CertificatePrint","TemporaryId","SignIn","View","request","Popup","showPopUp","userInfoActions","filterBlindedComments","Container","props","onBrowserFocus","getProject","getComments","projectId","userId","getLearnProject","then","res","json","setState","project","catch","e","console","error","getLearnUserProject","currentMission","completedAt","comments","state","getLearnComments","limit","COMMENTS_LIMIT","offset","length","onChangeCommentValue","value","target","COMMENT_WRITE_MAX_LENGTH","slice","commentValue","onClickSubmitComment","darkmode","scrollable","mobileFullscreen","params","content","addLearnComment","name","icon","comment","user","id","onClickMore","onClickReportComment","commentId","intl","formatMessage","reportLearnComment","dismissOverlay","onClickDeleteComment","deleteLearnComment","filter","dismissButton","onClickClose","onClose","onClickStart","missionNum","defaultPadding","addLearnUserProject","mission","url","window","open","onClickCert","undefined","addEventListener","removeEventListener","organization","updateUser","updateUserInfo","email","showCertificatePrint","certImageURL","title","category","userinfo"],"mappings":"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","sourcesContent":["import React, { Component } from \"react\";\nimport { connect } from \"react-redux\";\nimport { injectIntl } from \"react-intl\";\nimport { isMobileOnly, isTablet } from \"react-device-detect\";\nimport CertificateInput from \"../../../Builder/Component/DreamBuilder/PopUp/CertificateInput\";\nimport CertificatePrint from \"../../../../Common/Component/LearnCertification\";\nimport TemporaryId from \"../../../../Common/Component/TemporaryId\"\nimport SignIn from \"../../../../Common/Component/SignIn\"\nimport View from \"./View\";\nimport * as request from \"../../../../Common/Util/HTTPRequest\";\nimport Popup, { showPopUp } from \"../../../../Common/Component/PopUp\";\nimport * as userInfoActions from \"../../../../Common/Store/Reducer/UserInfo\";\nimport { filterBlindedComments } from \"../../../../Common/Util/Comments\";\n\nclass Container extends Component {\n  constructor(props) {\n    super(props);\n    this.COMMENTS_LIMIT = 10;\n    this.COMMENT_WRITE_MAX_LENGTH = 500;\n    this.state = {\n      project: undefined,\n      commentValue: \"\",\n      comments: [],\n      currentMission: 0,\n      completedAt: undefined\n    }\n  }\n\n  componentDidMount() {\n    this.getProject();\n    this.getComments();\n    window.addEventListener(\"focus\", this.onBrowserFocus);\n  }\n  componentWillUnmount() {\n    window.removeEventListener(\"focus\", this.onBrowserFocus);\n  }\n\n  onBrowserFocus = () => {\n    this.getProject();\n    this.getComments();\n  }\n\n  getProject = () => {\n    const { projectId, userId } = this.props;\n\n    request.getLearnProject({ projectId })\n      .then(res=> res.json())\n      .then(json=> this.setState({ project: json }))\n      .catch(e=> console.error(e));\n\n    if(userId) {\n      request.getLearnUserProject({ projectId, userId})\n        .then(res=> res.json())\n        .then(json=> {\n          if(json) {\n            this.setState({ currentMission: json.currentMission, completedAt: json.completedAt });\n          }\n        })\n        .catch(e=> console.error(e));\n    }\n  }\n\n  getComments = () => {\n    const { comments } = this.state;\n    const { projectId } = this.props;\n\n    request.getLearnComments({\n      projectId: projectId,\n      limit: this.COMMENTS_LIMIT,\n      offset: comments.length\n    })\n      .then(res=> res.json())\n      .then(json=> this.setState({ comments: [...comments, ...filterBlindedComments(json)] }))\n      .catch(e=> console.error(e));\n  }\n\n  onChangeCommentValue = e => {\n    let value = e.target.value;\n    if(value.length >= this.COMMENT_WRITE_MAX_LENGTH) {\n      value = value.slice(0, this.COMMENT_WRITE_MAX_LENGTH);\n    }\n    this.setState({ commentValue: value });\n  }\n\n  onClickSubmitComment = e => {\n    const { commentValue } = this.state;\n    const { userId, projectId } = this.props;\n\n    if(!userId) {\n      showPopUp(<SignIn />, {\n        darkmode: true,\n        scrollable: true,\n        mobileFullscreen: true\n      });\n      return;\n    }\n    if(commentValue.length < 1) {\n      return;\n    }\n\n    const params = { projectId:projectId, content: commentValue, userId: userId };\n    request.addLearnComment(params)\n      .then(res=> res.json())\n      .then(json=> {\n        const { userId, name, icon } = this.props;\n        const comment = { ...json, user: { id: userId, name, icon }};\n        this.setState({ commentValue:\"\", comments: [comment, ...this.state.comments]})\n      })\n      .catch(e=> console.error(e))\n  }\n\n  onClickMore = () => {\n    this.getComments();\n  }\n  \n  onClickReportComment = commentId => {\n    const { intl } = this.props;\n    showPopUp(\n      <Popup.OneInput\n        title={intl.formatMessage({ id: \"ID_LEARN_DETAIL_COMMENT_REPORT_TITLE\" })}\n        buttonName={intl.formatMessage({ id: \"ID_LEARN_DETAIL_COMMENT_REPORT_OK\" })}\n        buttonAction={content => {\n          if(content && content.length>0) {\n            const params = { content, commentId };\n            const { userId } = this.props;\n            if(userId) {\n              params.userId = userId;\n            }\n            //request to server\n            request.reportLearnComment(params)\n              .then(res=> {\n                //show reported popup\n                showPopUp(\n                  <Popup.OneButton\n                    title={this.props.intl.formatMessage({id: \"ID_LEARN_DETAIL_COMMENT_REPORT_SUCCESS\"})}\n                    buttonName={this.props.intl.formatMessage({id: \"ID_LEARN_DETAIL_COMMENT_REPORT_SUCCESS_OK\"})}\n                  />,\n                  { darkmode: true, mobileFullscreen: true }\n                );\n              })\n              .catch(e=> console.error(e));\n          }\n        }}\n      />,\n      { dismissOverlay: true, darkmode: true, mobileFullscreen: true }\n    );\n  }\n\n  onClickDeleteComment = commentId => {\n    const { intl } = this.props;\n    showPopUp(\n      <Popup.TwoButton\n        title={intl.formatMessage({ id: \"ID_LEARN_DETAIL_COMMENT_DELETE_CONFIRM\" })}\n        cancelButtonName={intl.formatMessage({ id: \"ID_LEARN_DETAIL_COMMENT_DELETE_CONFIRM_NO\" })}\n        confirmButtonName={intl.formatMessage({ id: \"ID_LEARN_DETAIL_COMMENT_DELETE_CONFIRM_YES\" })}\n        confirmAction={() => {\n          request.deleteLearnComment({id: commentId})\n            .then(res=> {\n              this.setState({\n                comments: this.state.comments.filter(comment=> comment.id !== commentId)\n              })\n            })\n            .catch(e=> console.error(e))\n        }}\n      />,\n      { dismissButton: false, darkmode: true }\n    );\n  }\n\n  onClickClose = () => {\n    this.props.onClose();\n  }\n  \n  onClickStart = missionNum => {\n    const { projectId, userId } = this.props;\n    const { currentMission } = this.state;\n\n    if(isTablet) {\n      showPopUp(\n        <Popup.OneButton\n          title={this.props.intl.formatMessage({\n            id: \"ID_LEARN_DETAIL_MOBILE_POPUP_MESSAGE03\"\n          })}\n          buttonName={this.props.intl.formatMessage({\n            id: \"ID_LEARN_DETAIL_MOBILE_POPUP_CONFIRM_BUTTON\"\n          })}\n        />,\n        {\n          darkmode: true,\n          dismissButton: false,\n          dismissOverlay: true\n        }\n      );\n      return;\n    }\n\n    if(isMobileOnly) {\n      showPopUp(\n        <Popup.OneButton\n          title={this.props.intl.formatMessage({\n            id: \"ID_LEARN_DETAIL_MOBILE_POPUP_MESSAGE03\"\n          })}\n          buttonName={this.props.intl.formatMessage({\n            id: \"ID_LEARN_DETAIL_MOBILE_POPUP_CONFIRM_BUTTON\"\n          })}\n        />,\n        {\n          darkmode: true,\n          dismissButton: false,\n          dismissOverlay: true\n        }\n      );\n      return;\n    }\n\n    if(!userId) {\n      showPopUp(\n        <TemporaryId />, { darkmode: true, defaultPadding: false, dismissButton: false }\n      )\n      return;\n    }\n\n    if(missionNum) {\n      if(missionNum > currentMission) {\n        showPopUp(\n          <Popup.OneButton\n            title={this.props.intl.formatMessage({\n              id: \"ID_LEARN_POPUP_STEP_CHECK_TITLE\"\n            })}\n            buttonName={this.props.intl.formatMessage({\n              id: \"ID_LEARN_POPUP_STEP_CHECK_TITLE_BUTTON\"\n            })}\n          />,\n          { darkmode: true, mobileFullscreen: true }\n        );\n        return;\n      }\n    }\n    \n    request.addLearnUserProject({ projectId, userId })\n      .then(res=> res.json())\n      .then(json=> {\n        let mission;\n        if(missionNum === 0) {\n          mission = 0;\n        } else {\n          mission = missionNum ? missionNum : json.currentMission;\n        }\n        const url = `/builder_learn/${projectId}?currentMission=${mission}`;\n        window.open(url);\n      })\n      .catch(e=> console.error(e));\n  }\n\n  onClickCert = () => {\n    // 인증서 출력기간 종료로 인한 비활성화\n    // reference - https://www.notion.so/wizschool/0a8e2869bedd4344a19832ecf62fe459\n    // if(isMobileOnly) {\n    //   showPopUp(\n    //     <Popup.OneButton\n    //       title={this.props.intl.formatMessage({\n    //         id: \"ID_LEARN_DETAIL_MOBILE_POPUP_MESSAGE\"\n    //       })}\n    //       buttonName={this.props.intl.formatMessage({\n    //         id: \"ID_LEARN_DETAIL_MOBILE_POPUP_CONFIRM_BUTTON\"\n    //       })}\n    //     />,\n    //     {\n    //       darkmode: true,\n    //       dismissButton: false,\n    //       dismissOverlay: true\n    //     }\n    //   );\n    //   return;\n    // }\n\n    // if(this.state.project.certImageURL) {\n    //   this.showCerificateInput();\n    // } else {\n      //임시 처리. 기획 필요함\n      showPopUp(\n        <Popup.OneButton\n          title=\"인증서 출력 기간이 아닙니다.\"\n          buttonName=\"확인\"\n        />,\n        {\n          darkmode: true,\n          dismissButton: false,\n          dismissOverlay: true\n        }\n      );\n    //   return;\n    // }\n  }\n\n  showCerificateInput() {\n    if(this.props.userId) {\n      if(this.state.completedAt) {\n        showPopUp(\n          <CertificateInput\n            defaultName={this.props.name}\n            defaultOrganization={this.props.organization}\n            onClickConfirm={(name, organization) => {\n              if(\n                this.props.name !== name\n                || this.props.organization !== organization\n              ) {\n                this.props.updateUser({ name, organization });\n                request.updateUserInfo({\n                  email: this.props.email,\n                  name,\n                  organization\n                });\n              }\n              this.showCertificatePrint(name, organization);\n            }}\n          />,\n          { dismissButton: false, dismissOverlay: true }\n        );\n      } else {\n        showPopUp(\n          <Popup.OneButton\n            title={this.props.intl.formatMessage({\n              id: \"ID_LEARN_POPUP_CERT_CHECK_TITLE\"\n            })}\n            buttonName={this.props.intl.formatMessage({\n              id: \"ID_LEARN_POPUP_STEP_CHECK_TITLE_BUTTON\"\n            })}\n          />,\n          { darkmode: true, mobileFullscreen: true }\n        );\n      }\n     \n    } else {\n      showPopUp(\n        <TemporaryId />, { darkmode: true, defaultPadding: false, dismissButton: false }\n      )\n    }\n  }\n\n  showCertificatePrint(name, organization) {\n    const { certImageURL, title, category } = this.state.project;\n    showPopUp(\n      <CertificatePrint\n        name={name}\n        organization={organization}\n        title={`${category.title} ${title}`}\n        certImageURL={certImageURL}\n      />,\n      { darkmode: true }\n    );\n  }\n\n  render() {\n    const {\n      project,\n      currentMission,\n      commentValue,\n      comments\n    } = this.state;\n    const {\n      onChangeCommentValue,\n      onClickSubmitComment,\n      onClickMore,\n      onClickReportComment,\n      onClickDeleteComment,\n      onClickClose,\n      onClickStart,\n      onClickCert\n    } = this;\n    const { userId } = this.props;\n\n    return (\n      <View\n        userId={userId}\n        project={project}\n        currentMission={currentMission}\n        commentValue={commentValue}\n        comments={comments}\n        onChangeCommentValue={onChangeCommentValue}\n        onClickSubmitComment={onClickSubmitComment}\n        onClickMore={onClickMore}\n        onClickReportComment={onClickReportComment}\n        onClickDeleteComment={onClickDeleteComment}\n        onClickClose={onClickClose}\n        onClickStart={onClickStart}\n        onClickCert={onClickCert}\n      />\n    );\n  }\n}\n\nexport default connect(\n  state => ({ \n    userId: state.userinfo.id,\n    email: state.userinfo.email,\n    name: state.userinfo.name,\n    icon: state.userinfo.icon,\n    organization: state.userinfo.organization\n  }),\n  {\n    updateUser: userInfoActions.updateUserInfo\n  }\n)(injectIntl(Container));\n"]},"metadata":{},"sourceType":"module"}