{"ast":null,"code":"import _objectSpread from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread\";\nimport _regeneratorRuntime from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _toConsumableArray from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";\nimport _classCallCheck from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";\nimport * as request from \"../../../Common/Util/HTTPRequest\";\n\nvar AssetLibrary =\n/*#__PURE__*/\nfunction () {\n  // baseURL = \"assets\";\n  function AssetLibrary() {\n    var _this = this;\n\n    _classCallCheck(this, AssetLibrary);\n\n    this.baseURL = \"https://wizschool-assets.s3.ap-northeast-2.amazonaws.com\";\n    this.fonts = [{\n      id: \"Black And White Picture\",\n      name: \"ID_FONT_BNWP\"\n    }, {\n      id: \"Black Han Sans\",\n      name: \"ID_FONT_BHS\"\n    }, {\n      id: \"Cute Font\",\n      name: \"ID_FONT_CUTE\"\n    }, {\n      id: \"Do Hyeon\",\n      name: \"ID_FONT_DOHYEON\"\n    }, {\n      id: \"Dokdo\",\n      name: \"ID_FONT_DOKDO\"\n    }, {\n      id: \"East Sea Dokdo\",\n      name: \"ID_FONT_ESD\"\n    }, {\n      id: \"Gaegu\",\n      name: \"ID_FONT_GAEGU\"\n    }, {\n      id: \"Gamja Flower\",\n      name: \"ID_FONT_GF\"\n    }, {\n      id: \"Gothic A1\",\n      name: \"ID_FONT_GA\"\n    }, {\n      id: \"Gugi\",\n      name: \"ID_FONT_GUGI\"\n    }, {\n      id: \"Hi Melody\",\n      name: \"ID_FONT_HM\"\n    }, {\n      id: \"Jua\",\n      name: \"ID_FONT_JUA\"\n    }, {\n      id: \"Kirang Haerang\",\n      name: \"ID_FONT_KH\"\n    }, {\n      id: \"Nanum Brush Script\",\n      name: \"ID_FONT_NBS\"\n    }, {\n      id: \"Nanum Gothic\",\n      name: \"ID_FONT_NG\"\n    }, {\n      id: \"Nanum Myeongjo\",\n      name: \"ID_FONT_NM\"\n    }, {\n      id: \"Nanum Pen Script\",\n      name: \"ID_FONT_NPS\"\n    }, {\n      id: \"Noto Sans KR\",\n      name: \"ID_FONT_NSANSK\"\n    }, {\n      id: \"Noto Serif KR\",\n      name: \"ID_FONT_NSERIFK\"\n    }, {\n      id: \"Poor Story\",\n      name: \"ID_FONT_PS\"\n    }, {\n      id: \"Song Myung\",\n      name: \"ID_FONT_SM\"\n    }, {\n      id: \"Stylish\",\n      name: \"ID_FONT_STYLISH\"\n    }, {\n      id: \"Sunflower\",\n      name: \"ID_FONT_SUNFLOWER\"\n    }, {\n      id: \"Yeon Sung\",\n      name: \"ID_FONT_YEONSUNG\"\n    }];\n    this.categories = [];\n    this.sprites = {};\n    this.sounds = {};\n    this.categoryItems = {};\n    this.firstTemplateName = \"\";\n\n    this.convertSoundAsset = function (asset) {\n      asset.path = _this.baseURL + asset.path;\n      asset.id = asset.assetId;\n      return asset;\n    };\n\n    this.convertSpriteAsset = function (asset) {\n      if (asset.bodySize) {\n        asset.bodySize = JSON.parse(asset.bodySize);\n      }\n\n      if (asset.spriteAnimations) {\n        asset.spriteAnimations = JSON.parse(asset.spriteAnimations);\n      }\n\n      if (asset.spriteSize) {\n        asset.spriteSize = JSON.parse(asset.spriteSize);\n      }\n\n      asset.path = _this.baseURL + asset.path;\n      asset.thumb = _this.baseURL + asset.thumb;\n\n      if (asset.spritePath) {\n        asset.spritePath = _this.baseURL + asset.spritePath;\n      }\n\n      asset.id = asset.assetId;\n      return asset;\n    };\n\n    this.getAsset = function (id) {\n      return _this.sprites[id];\n    };\n\n    this.getSoundAsset = function (id) {\n      return _this.sounds[id];\n    };\n\n    this.addAsset = function (asset) {\n      asset = _this.convertSpriteAsset(asset);\n      _this.sprites[asset.assetId] = asset;\n    };\n\n    this.addSoundAsset = function (asset) {\n      asset = _this.convertSoundAsset(asset);\n      _this.sounds[asset.assetId] = asset;\n    };\n\n    this.getAssetByName = function (name) {\n      for (var id in _this.sprites) {\n        var sprite = _this.sprites[id];\n\n        if (sprite.defaultName === name) {\n          return sprite;\n        }\n      }\n    };\n\n    this.getSoundAssetByName = function (name) {\n      for (var id in _this.sounds) {\n        var sound = _this.sounds[id];\n\n        if (sound.defaultName === name) {\n          return sound;\n        }\n      }\n    };\n\n    //temp\n    for (var i in this.components) {\n      var component = this.components[i];\n      this.sprites[component.assetId] = component;\n    }\n\n    this.loadCategories();\n  }\n\n  _createClass(AssetLibrary, [{\n    key: \"getCategories\",\n    value: function getCategories(email) {\n      var managers = [\"selena@wizschool.io\", \"gocks0922@gmail.com\", \"chris@wizschool.io\", \"het@wizschool.io\", \"y3000y7@gmail.com\", \"rei@wizschool.io\", \"rei2@wizschool.io\", \"noah@wizschool.io\", \"sona@wizschool.io\", \"martha@wizschool.io\", \"zayden@wizschool.io\", \"afterschool01@wizschool.io\", \"4wizclass@wizschool.io\", \"globalcontent@wizschool.io\", \"crong@wizschool.io\", \"chjsuac@wizschool.io\", \"oobc@wizschool.io\", \"cc@wizschool.io\", \"oobc_afterclass@wizschool.io\", \"js_afterclass@wizschool.io\", \"gstar-admin@wizschool.io\"];\n\n      if (email && managers.indexOf(email) !== -1) {\n        return this.categories;\n      } else {\n        return this.categories.filter(function (c) {\n          return c.name !== \"illust\";\n        });\n      }\n    }\n  }, {\n    key: \"loadCategories\",\n    value: function loadCategories(callback) {\n      var _this2 = this;\n\n      request.getCategories().then(function (res) {\n        return res.json();\n      }).then(function (categories) {\n        _this2.categories = categories.filter(function (c) {\n          return c.name !== \"wizlive\" && c.name !== \"template\";\n        });\n        if (callback) callback();\n      }).catch(function (err) {\n        return console.error(err);\n      });\n    }\n  }, {\n    key: \"loadAllSounds\",\n    value: function loadAllSounds(callback) {\n      var _this3 = this;\n\n      this.loadCategories(function () {\n        var soundCategories = _this3.categories.filter(function (c) {\n          return c.name === \"sfx\" || c.name === \"bgm\";\n        });\n\n        var i = 0;\n\n        var load = function load(name) {\n          _this3.loadAssetsByCategory(name, function () {\n            i++;\n\n            if (soundCategories.length > i) {\n              load(soundCategories[i].name);\n            } else {\n              callback();\n            }\n          });\n        };\n\n        load(soundCategories[i].name);\n      });\n    }\n  }, {\n    key: \"loadAssetsByCategory\",\n    value: function loadAssetsByCategory(category, callback) {\n      var _this4 = this;\n\n      if (this.categoryItems[category]) {\n        callback(this.categoryItems[category]);\n        return;\n      }\n\n      request.assetsByCategory({\n        categoryId: category\n      }).then(function (res) {\n        return res.json();\n      }).then(function (json) {\n        if (!_this4.categoryItems[category]) {\n          _this4.categoryItems[category] = [];\n        }\n\n        json.forEach(function (subItem) {\n          var assets = subItem.assets;\n          _this4.categoryItems[subItem.name] = [];\n\n          for (var i in assets) {\n            var asset = assets[i].asset;\n            var assetBundle = void 0;\n\n            if (asset.type === \"sound\") {\n              asset = _this4.convertSoundAsset(asset);\n              assetBundle = _this4.sounds;\n            } else {\n              asset = _this4.convertSpriteAsset(asset);\n              assetBundle = _this4.sprites;\n            }\n\n            _this4.categoryItems[subItem.name].push({\n              assetId: asset.assetId,\n              type: asset.type,\n              subtype: asset.subtype\n            });\n\n            if (!assetBundle[asset.assetId]) {\n              assetBundle[asset.assetId] = asset;\n            }\n\n            if (category === \"new\") {\n              assetBundle[asset.assetId].isNew = true;\n            }\n          }\n\n          _this4.categoryItems[category] = [].concat(_toConsumableArray(_this4.categoryItems[category]), _toConsumableArray(_this4.categoryItems[subItem.name]));\n        });\n\n        if (category === \"template\" || category === \"illust\") {\n          _this4.firstTemplateName = json[0].name;\n          _this4.categoryItems[category] = _this4.categoryItems[_this4.firstTemplateName];\n        }\n\n        callback(_this4.categoryItems[category]);\n      });\n    }\n  }, {\n    key: \"loadAssetsFromScene\",\n    value: function loadAssetsFromScene(state, callback) {\n      var _this5 = this;\n\n      var spriteAssetIds = [];\n\n      for (var i in state.sceneIds) {\n        var spriteIds = state.scenes[state.sceneIds[i]].spriteIds;\n        var sprites = state.scenes[state.sceneIds[i]].sprites;\n\n        for (var j in spriteIds) {\n          if (spriteAssetIds.indexOf(sprites[spriteIds[j]].assetId) === -1) {\n            spriteAssetIds.push(sprites[spriteIds[j]].assetId);\n          }\n        }\n      }\n\n      var params = {\n        spriteIds: spriteAssetIds,\n        soundIds: state.soundIds\n      };\n      request.assetsById(params).then(function (res) {\n        return res.json();\n      }).then(function (json) {\n        var sprites = json.sprites;\n        var i = 0;\n        var asset = undefined;\n\n        for (i in sprites) {\n          asset = sprites[i];\n          asset = _this5.convertSpriteAsset(asset);\n          _this5.sprites[asset.assetId] = asset;\n        }\n\n        var sounds = json.sounds;\n\n        for (i in sounds) {\n          asset = sounds[i];\n          asset = _this5.convertSoundAsset(asset);\n          _this5.sounds[asset.assetId] = asset;\n        }\n\n        callback();\n      });\n    }\n  }, {\n    key: \"loadAssetsForGame\",\n    value: function () {\n      var _loadAssetsForGame = _asyncToGenerator(\n      /*#__PURE__*/\n      _regeneratorRuntime.mark(function _callee(state) {\n        var shouldLoad, data, spriteAssetIds, i, spriteIds, sprites, j, params, response, json, _sprites, asset, sounds;\n\n        return _regeneratorRuntime.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                shouldLoad = false;\n                data = {\n                  sprites: {},\n                  sounds: {}\n                }; // make ids array except for text sprites\n\n                spriteAssetIds = [];\n                i = 0;\n\n                for (i in state.sceneIds) {\n                  spriteIds = state.scenes[state.sceneIds[i]].spriteIds;\n                  sprites = state.scenes[state.sceneIds[i]].sprites;\n\n                  for (j in spriteIds) {\n                    if (sprites[spriteIds[j]].type !== \"text\") {\n                      if (spriteAssetIds.indexOf(sprites[spriteIds[j]].assetId) === -1) {\n                        spriteAssetIds.push(sprites[spriteIds[j]].assetId);\n                      }\n                    }\n                  }\n                } // check if sprites loaded\n\n\n                _context.t0 = _regeneratorRuntime.keys(spriteAssetIds);\n\n              case 6:\n                if ((_context.t1 = _context.t0()).done) {\n                  _context.next = 16;\n                  break;\n                }\n\n                i = _context.t1.value;\n\n                if (!this.sprites[spriteAssetIds[i]]) {\n                  _context.next = 12;\n                  break;\n                }\n\n                data.sprites[spriteAssetIds[i]] = this.sprites[spriteAssetIds[i]];\n                _context.next = 14;\n                break;\n\n              case 12:\n                shouldLoad = true;\n                return _context.abrupt(\"break\", 16);\n\n              case 14:\n                _context.next = 6;\n                break;\n\n              case 16:\n                if (shouldLoad) {\n                  _context.next = 28;\n                  break;\n                }\n\n                _context.t2 = _regeneratorRuntime.keys(state.soundIds);\n\n              case 18:\n                if ((_context.t3 = _context.t2()).done) {\n                  _context.next = 28;\n                  break;\n                }\n\n                i = _context.t3.value;\n\n                if (!this.sounds[state.soundIds[i]]) {\n                  _context.next = 24;\n                  break;\n                }\n\n                data.sounds[state.soundIds[i]] = this.sounds[state.soundIds[i]];\n                _context.next = 26;\n                break;\n\n              case 24:\n                shouldLoad = true;\n                return _context.abrupt(\"break\", 28);\n\n              case 26:\n                _context.next = 18;\n                break;\n\n              case 28:\n                if (!shouldLoad) {\n                  _context.next = 43;\n                  break;\n                }\n\n                data = {\n                  sprites: {},\n                  sounds: {}\n                };\n                params = {\n                  spriteIds: spriteAssetIds,\n                  soundIds: state.soundIds\n                };\n                _context.next = 33;\n                return request.assetsById(params);\n\n              case 33:\n                response = _context.sent;\n                _context.next = 36;\n                return response.json();\n\n              case 36:\n                json = _context.sent;\n                _sprites = json.sprites;\n                i = 0;\n                asset = undefined;\n\n                for (i in _sprites) {\n                  asset = _sprites[i];\n                  asset = this.convertSpriteAsset(asset);\n                  data.sprites[asset.assetId] = asset;\n                }\n\n                sounds = json.sounds;\n\n                for (i in sounds) {\n                  asset = sounds[i];\n                  asset = this.convertSoundAsset(asset);\n                  data.sounds[asset.assetId] = asset;\n                }\n\n              case 43:\n                return _context.abrupt(\"return\", new Promise(function (resolve) {\n                  resolve(data);\n                }));\n\n              case 44:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee, this);\n      }));\n\n      function loadAssetsForGame(_x) {\n        return _loadAssetsForGame.apply(this, arguments);\n      }\n\n      return loadAssetsForGame;\n    }()\n  }, {\n    key: \"getAll\",\n    value: function getAll() {\n      var sprites = this.sprites,\n          sounds = this.sounds;\n      return {\n        sprites: sprites,\n        sounds: sounds\n      };\n    }\n  }, {\n    key: \"setAll\",\n    value: function setAll(assets) {\n      var sprites = assets.sprites,\n          sounds = assets.sounds;\n      this.sprites = _objectSpread({}, this.sprites, sprites);\n      this.sounds = _objectSpread({}, this.sounds, sounds);\n    }\n  }, {\n    key: \"textboxThumb\",\n    get: function get() {\n      return this.baseURL + \"/sprite/sprite-text.svg\";\n    }\n  }]);\n\n  return AssetLibrary;\n}();\n\nexport default new AssetLibrary();","map":{"version":3,"sources":["/Users/jimmy/Documents/Wizschool/wizlab_web2/src/Page/Builder/utils/assetLibrary.js"],"names":["request","AssetLibrary","baseURL","fonts","id","name","categories","sprites","sounds","categoryItems","firstTemplateName","convertSoundAsset","asset","path","assetId","convertSpriteAsset","bodySize","JSON","parse","spriteAnimations","spriteSize","thumb","spritePath","getAsset","getSoundAsset","addAsset","addSoundAsset","getAssetByName","sprite","defaultName","getSoundAssetByName","sound","i","components","component","loadCategories","email","managers","indexOf","filter","c","callback","getCategories","then","res","json","catch","err","console","error","soundCategories","load","loadAssetsByCategory","length","category","assetsByCategory","categoryId","forEach","subItem","assets","assetBundle","type","push","subtype","isNew","state","spriteAssetIds","sceneIds","spriteIds","scenes","j","params","soundIds","assetsById","undefined","shouldLoad","data","response","Promise","resolve"],"mappings":"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","sourcesContent":["import * as request from \"../../../Common/Util/HTTPRequest\";\n\nclass AssetLibrary {\n  baseURL = \"https://wizschool-assets.s3.ap-northeast-2.amazonaws.com\";\n  // baseURL = \"assets\";\n  fonts = [\n    { id: \"Black And White Picture\", name: \"ID_FONT_BNWP\" },\n    { id: \"Black Han Sans\", name: \"ID_FONT_BHS\" },\n    { id: \"Cute Font\", name: \"ID_FONT_CUTE\" },\n    { id: \"Do Hyeon\", name: \"ID_FONT_DOHYEON\" },\n    { id: \"Dokdo\", name: \"ID_FONT_DOKDO\" },\n    { id: \"East Sea Dokdo\", name: \"ID_FONT_ESD\" },\n    { id: \"Gaegu\", name: \"ID_FONT_GAEGU\" },\n    { id: \"Gamja Flower\", name: \"ID_FONT_GF\" },\n    { id: \"Gothic A1\", name: \"ID_FONT_GA\" },\n    { id: \"Gugi\", name: \"ID_FONT_GUGI\" },\n    { id: \"Hi Melody\", name: \"ID_FONT_HM\" },\n    { id: \"Jua\", name: \"ID_FONT_JUA\" },\n    { id: \"Kirang Haerang\", name: \"ID_FONT_KH\" },\n    { id: \"Nanum Brush Script\", name: \"ID_FONT_NBS\" },\n    { id: \"Nanum Gothic\", name: \"ID_FONT_NG\" },\n    { id: \"Nanum Myeongjo\", name: \"ID_FONT_NM\" },\n    { id: \"Nanum Pen Script\", name: \"ID_FONT_NPS\" },\n    { id: \"Noto Sans KR\", name: \"ID_FONT_NSANSK\" },\n    { id: \"Noto Serif KR\", name: \"ID_FONT_NSERIFK\" },\n    { id: \"Poor Story\", name: \"ID_FONT_PS\" },\n    { id: \"Song Myung\", name: \"ID_FONT_SM\" },\n    { id: \"Stylish\", name: \"ID_FONT_STYLISH\" },\n    { id: \"Sunflower\", name: \"ID_FONT_SUNFLOWER\" },\n    { id: \"Yeon Sung\", name: \"ID_FONT_YEONSUNG\" }\n  ];\n  categories = [];\n  sprites = {};\n  sounds = {};\n  categoryItems = {};\n  firstTemplateName = \"\";\n\n  constructor() {\n    //temp\n    for (var i in this.components) {\n      var component = this.components[i];\n      this.sprites[component.assetId] = component;\n    }\n    this.loadCategories();\n  }\n\n  getCategories(email) {\n    const managers = [\n      \"selena@wizschool.io\",\n      \"gocks0922@gmail.com\",\n      \"chris@wizschool.io\",\n      \"het@wizschool.io\",\n      \"y3000y7@gmail.com\",\n      \"rei@wizschool.io\",\n      \"rei2@wizschool.io\",\n      \"noah@wizschool.io\",\n      \"sona@wizschool.io\",\n      \"martha@wizschool.io\",\n      \"zayden@wizschool.io\",\n      \"afterschool01@wizschool.io\",\n      \"4wizclass@wizschool.io\",\n      \"globalcontent@wizschool.io\",\n      \"crong@wizschool.io\",\n      \"chjsuac@wizschool.io\",\n      \"oobc@wizschool.io\",\n      \"cc@wizschool.io\",\n      \"oobc_afterclass@wizschool.io\",\n      \"js_afterclass@wizschool.io\",\n      \"gstar-admin@wizschool.io\"\n    ];\n    if (email && managers.indexOf(email) !== -1) {\n      return this.categories;\n    } else {\n      return this.categories.filter(c => c.name !== \"illust\");\n    }\n  }\n\n  loadCategories(callback) {\n    request\n      .getCategories()\n      .then(res => res.json())\n      .then(categories => {\n        this.categories = categories.filter(\n          c => c.name !== \"wizlive\" && c.name !== \"template\"\n        );\n        if (callback) callback();\n      })\n      .catch(err => console.error(err));\n  }\n\n  loadAllSounds(callback) {\n    this.loadCategories(() => {\n      const soundCategories = this.categories.filter(\n        c => c.name === \"sfx\" || c.name === \"bgm\"\n      );\n      let i = 0;\n      const load = name => {\n        this.loadAssetsByCategory(name, () => {\n          i++;\n          if (soundCategories.length > i) {\n            load(soundCategories[i].name);\n          } else {\n            callback();\n          }\n        });\n      };\n      load(soundCategories[i].name);\n    });\n  }\n\n  loadAssetsByCategory(category, callback) {\n    if (this.categoryItems[category]) {\n      callback(this.categoryItems[category]);\n      return;\n    }\n\n    request\n      .assetsByCategory({ categoryId: category })\n      .then(res => res.json())\n      .then(json => {\n        if (!this.categoryItems[category]) {\n          this.categoryItems[category] = [];\n        }\n        json.forEach(subItem => {\n          const assets = subItem.assets;\n          this.categoryItems[subItem.name] = [];\n          for (var i in assets) {\n            let asset = assets[i].asset;\n            let assetBundle;\n\n            if (asset.type === \"sound\") {\n              asset = this.convertSoundAsset(asset);\n              assetBundle = this.sounds;\n            } else {\n              asset = this.convertSpriteAsset(asset);\n              assetBundle = this.sprites;\n            }\n\n            this.categoryItems[subItem.name].push({\n              assetId: asset.assetId,\n              type: asset.type,\n              subtype: asset.subtype\n            });\n\n            if (!assetBundle[asset.assetId]) {\n              assetBundle[asset.assetId] = asset;\n            }\n            if (category === \"new\") {\n              assetBundle[asset.assetId].isNew = true;\n            }\n          }\n\n          this.categoryItems[category] = [\n            ...this.categoryItems[category],\n            ...this.categoryItems[subItem.name]\n          ];\n        });\n\n        if (category === \"template\" || category === \"illust\") {\n          this.firstTemplateName = json[0].name;\n          this.categoryItems[category] = this.categoryItems[\n            this.firstTemplateName\n          ];\n        }\n\n        callback(this.categoryItems[category]);\n      });\n  }\n\n  loadAssetsFromScene(state, callback) {\n    const spriteAssetIds = [];\n    for (var i in state.sceneIds) {\n      const spriteIds = state.scenes[state.sceneIds[i]].spriteIds;\n      const sprites = state.scenes[state.sceneIds[i]].sprites;\n      for (var j in spriteIds) {\n        if (spriteAssetIds.indexOf(sprites[spriteIds[j]].assetId) === -1) {\n          spriteAssetIds.push(sprites[spriteIds[j]].assetId);\n        }\n      }\n    }\n\n    const params = {\n      spriteIds: spriteAssetIds,\n      soundIds: state.soundIds\n    };\n\n    request\n      .assetsById(params)\n      .then(res => res.json())\n      .then(json => {\n        const sprites = json.sprites;\n        let i = 0;\n        let asset = undefined;\n        for (i in sprites) {\n          asset = sprites[i];\n          asset = this.convertSpriteAsset(asset);\n          this.sprites[asset.assetId] = asset;\n        }\n\n        const sounds = json.sounds;\n        for (i in sounds) {\n          asset = sounds[i];\n          asset = this.convertSoundAsset(asset);\n          this.sounds[asset.assetId] = asset;\n        }\n        callback();\n      });\n  }\n\n  async loadAssetsForGame(state) {\n    let shouldLoad = false;\n    let data = { sprites: {}, sounds: {} };\n\n    // make ids array except for text sprites\n    const spriteAssetIds = [];\n    let i = 0;\n    for (i in state.sceneIds) {\n      const spriteIds = state.scenes[state.sceneIds[i]].spriteIds;\n      const sprites = state.scenes[state.sceneIds[i]].sprites;\n      for (var j in spriteIds) {\n        if (sprites[spriteIds[j]].type !== \"text\") {\n          if (spriteAssetIds.indexOf(sprites[spriteIds[j]].assetId) === -1) {\n            spriteAssetIds.push(sprites[spriteIds[j]].assetId);\n          }\n        }\n      }\n    }\n    // check if sprites loaded\n    for (i in spriteAssetIds) {\n      if (this.sprites[spriteAssetIds[i]]) {\n        data.sprites[spriteAssetIds[i]] = this.sprites[spriteAssetIds[i]];\n      } else {\n        shouldLoad = true;\n        break;\n      }\n    }\n    // check if sounds loaded\n    if (!shouldLoad) {\n      for (i in state.soundIds) {\n        if (this.sounds[state.soundIds[i]]) {\n          data.sounds[state.soundIds[i]] = this.sounds[state.soundIds[i]];\n        } else {\n          shouldLoad = true;\n          break;\n        }\n      }\n    }\n\n    if (shouldLoad) {\n      data = { sprites: {}, sounds: {} };\n      const params = {\n        spriteIds: spriteAssetIds,\n        soundIds: state.soundIds\n      };\n      const response = await request.assetsById(params);\n      const json = await response.json();\n      const sprites = json.sprites;\n      i = 0;\n      let asset = undefined;\n      for (i in sprites) {\n        asset = sprites[i];\n        asset = this.convertSpriteAsset(asset);\n        data.sprites[asset.assetId] = asset;\n      }\n\n      const sounds = json.sounds;\n      for (i in sounds) {\n        asset = sounds[i];\n        asset = this.convertSoundAsset(asset);\n        data.sounds[asset.assetId] = asset;\n      }\n    }\n\n    return new Promise(function(resolve) {\n      resolve(data);\n    });\n  }\n\n  convertSoundAsset = asset => {\n    asset.path = this.baseURL + asset.path;\n    asset.id = asset.assetId;\n    return asset;\n  };\n  convertSpriteAsset = asset => {\n    if (asset.bodySize) {\n      asset.bodySize = JSON.parse(asset.bodySize);\n    }\n    if (asset.spriteAnimations) {\n      asset.spriteAnimations = JSON.parse(asset.spriteAnimations);\n    }\n    if (asset.spriteSize) {\n      asset.spriteSize = JSON.parse(asset.spriteSize);\n    }\n\n    asset.path = this.baseURL + asset.path;\n    asset.thumb = this.baseURL + asset.thumb;\n    if (asset.spritePath) {\n      asset.spritePath = this.baseURL + asset.spritePath;\n    }\n\n    asset.id = asset.assetId;\n    return asset;\n  };\n\n  get textboxThumb() {\n    return this.baseURL + \"/sprite/sprite-text.svg\";\n  }\n\n  getAsset = id => {\n    return this.sprites[id];\n  };\n\n  getSoundAsset = id => {\n    return this.sounds[id];\n  };\n\n  addAsset = asset => {\n    asset = this.convertSpriteAsset(asset);\n    this.sprites[asset.assetId] = asset;\n  };\n\n  addSoundAsset = asset => {\n    asset = this.convertSoundAsset(asset);\n    this.sounds[asset.assetId] = asset;\n  }\n\n  getAll() {\n    const { sprites, sounds } = this;\n    return { sprites, sounds };\n  }\n  setAll(assets) {\n    const { sprites, sounds } = assets;\n    this.sprites = { ...this.sprites, ...sprites };\n    this.sounds = { ...this.sounds, ...sounds };\n  }\n\n  getAssetByName = name => {\n    for (let id in this.sprites) {\n      let sprite = this.sprites[id];\n      if (sprite.defaultName === name) {\n        return sprite;\n      }\n    }\n  };\n\n  getSoundAssetByName = name => {\n    for (let id in this.sounds) {\n      let sound = this.sounds[id];\n      if (sound.defaultName === name) {\n        return sound;\n      }\n    }\n  };\n}\n\nexport default new AssetLibrary();\n"]},"metadata":{},"sourceType":"module"}