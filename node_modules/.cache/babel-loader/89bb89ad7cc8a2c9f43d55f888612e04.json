{"ast":null,"code":"import _regeneratorRuntime from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _objectSpread from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread\";\nimport _classCallCheck from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";\nimport _assertThisInitialized from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/assertThisInitialized\";\nimport _inherits from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";\nimport _possibleConstructorReturn from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";\nvar _jsxFileName = \"/Users/jimmy/Documents/Wizschool/wizlab_web2/src/Common/Component/DraftEditor/index.js\";\n\nfunction _createSuper(Derived) { var hasNativeReflectConstruct = _isNativeReflectConstruct(); return function _createSuperInternal() { var Super = _getPrototypeOf(Derived), result; if (hasNativeReflectConstruct) { var NewTarget = _getPrototypeOf(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return _possibleConstructorReturn(this, result); }; }\n\nfunction _isNativeReflectConstruct() { if (typeof Reflect === \"undefined\" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === \"function\") return true; try { Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {})); return true; } catch (e) { return false; } }\n\nimport React, { Component } from \"react\";\nimport { Editor, EditorState, AtomicBlockUtils, convertToRaw, convertFromRaw } from \"draft-js\";\nimport { ImageCompressor } from \"../../Util/FileCompressor\";\nimport * as request from \"../../Util/HTTPRequest\";\nimport PopUp, { showPopUp } from \"../PopUp\";\nimport CustomBlockRenderer from \"./CustomBlockRenderer\";\nimport GamePopUp from \"./GamePopUp\";\nimport \"./index.scss\";\nimport { FormattedMessage } from \"react-intl\";\n\nvar DraftEditor = /*#__PURE__*/function (_Component) {\n  _inherits(DraftEditor, _Component);\n\n  var _super = _createSuper(DraftEditor);\n\n  function DraftEditor(props) {\n    var _this;\n\n    _classCallCheck(this, DraftEditor);\n\n    _this = _super.call(this, props);\n\n    _this.setEditorRef = function (editor) {\n      _this.editor = editor;\n    };\n\n    _this.focusEditor = function () {\n      if (_this.editor) _this.editor.focus();\n    };\n\n    _this.setContents = function (contents) {\n      try {\n        var _assertThisInitialize = _assertThisInitialized(_this),\n            onChangeMedia = _assertThisInitialize.onChangeMedia,\n            onChangeAceFouced = _assertThisInitialize.onChangeAceFouced;\n\n        var _this$props$readonly = _this.props.readonly,\n            readonly = _this$props$readonly === void 0 ? false : _this$props$readonly;\n\n        for (var key in contents.entityMap) {\n          var entity = contents.entityMap[key];\n          entity.data[\"readonly\"] = readonly;\n          entity.data[\"onChangeMedia\"] = onChangeMedia;\n          entity.data[\"onChangeAceFouced\"] = onChangeAceFouced;\n        }\n\n        var contentState = convertFromRaw(contents);\n        var editorState = EditorState.createWithContent(contentState);\n\n        _this.setState({\n          editorState: editorState\n        });\n      } catch (err) {\n        console.warn(err);\n      }\n    };\n\n    _this.getContents = function () {\n      var editorState = _this.state.editorState;\n      var contentState = editorState.getCurrentContent();\n      var rawContent = JSON.parse(JSON.stringify(convertToRaw(contentState))); // remove empty end blocks\n\n      var i = rawContent.blocks.length;\n\n      while (i--) {\n        var block = rawContent.blocks[i];\n\n        if (block.type !== \"atomic\" && block.text.replace(/\\s/g, \"\").length < 1) {\n          rawContent.blocks.splice(i, 1);\n        } else {\n          break;\n        }\n      } // check contents text is valid\n\n\n      var hasValidText = false;\n\n      for (var _i = 0; _i < rawContent.blocks.length; _i++) {\n        var _block = rawContent.blocks[_i];\n\n        if (_block.type === \"atomic\" || _block.text.replace(/\\s/g, \"\").length > 0) {\n          hasValidText = true;\n          break;\n        }\n      }\n\n      if (!hasValidText) {\n        return null;\n      } // remove datas for rendering\n\n\n      for (var key in rawContent.entityMap) {\n        var entity = rawContent.entityMap[key];\n        delete entity.data[\"readonly\"];\n        delete entity.data[\"onChangeMedia\"];\n        delete entity.data[\"onChangeAceFouced\"];\n      }\n\n      return rawContent;\n    };\n\n    _this.getText = function () {\n      var _this$getContents = _this.getContents(),\n          blocks = _this$getContents.blocks;\n\n      return blocks.reduce(function (prev, block) {\n        return prev + \" \" + (block.type !== \"atomic\" ? block.text : \"\");\n      }, \"\");\n    };\n\n    _this.emptyContents = function () {\n      var _this$props = _this.props,\n          _this$props$readonly2 = _this$props.readonly,\n          readonly = _this$props$readonly2 === void 0 ? false : _this$props$readonly2,\n          onChangeContents = _this$props.onChangeContents;\n      if (readonly) return;\n      onChangeContents(null);\n\n      _this.setState({\n        editorState: EditorState.createEmpty()\n      });\n    };\n\n    _this.onChangeEditorState = function (editorState) {\n      var _this$props2 = _this.props,\n          _this$props2$readonly = _this$props2.readonly,\n          readonly = _this$props2$readonly === void 0 ? false : _this$props2$readonly,\n          onChangeContents = _this$props2.onChangeContents;\n      if (readonly) return;\n\n      _this.setState({\n        editorState: editorState\n      }, function () {\n        if (!onChangeContents) return;\n        onChangeContents(_this.getContents());\n      });\n    };\n\n    _this.onChangeMedia = function () {\n      _this.onChangeEditorState(_this.state.editorState);\n    };\n\n    _this.onChangeAceFouced = function (aceFouced) {\n      _this.setState({\n        aceFouced: aceFouced\n      });\n    };\n\n    _this.addMedia = function (type, data) {\n      var _assertThisInitialize2 = _assertThisInitialized(_this),\n          onChangeMedia = _assertThisInitialize2.onChangeMedia,\n          onChangeAceFouced = _assertThisInitialize2.onChangeAceFouced;\n\n      var _this$props$readonly3 = _this.props.readonly,\n          readonly = _this$props$readonly3 === void 0 ? false : _this$props$readonly3;\n      var editorState = _this.state.editorState;\n      var contentState = editorState.getCurrentContent();\n      var contentStateWithNewEntity = contentState.createEntity(type, \"IMMUTABLE\", _objectSpread({}, data, {\n        readonly: readonly,\n        onChangeMedia: onChangeMedia,\n        onChangeAceFouced: onChangeAceFouced\n      }));\n      var entityKey = contentStateWithNewEntity.getLastCreatedEntityKey();\n      var newEditorState = AtomicBlockUtils.insertAtomicBlock(EditorState.set(editorState, {\n        currentContent: contentStateWithNewEntity\n      }), entityKey, \" \");\n\n      _this.setState({\n        editorState: newEditorState\n      }, function () {\n        _this.onChangeEditorState(newEditorState);\n      });\n    };\n\n    _this.handleFileInput = /*#__PURE__*/function () {\n      var _ref = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(e) {\n        var files, i, file, types, media, data, compressed, json;\n        return _regeneratorRuntime.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                files = e.target.files;\n                i = 0;\n\n              case 2:\n                if (!(i < files.length)) {\n                  _context.next = 23;\n                  break;\n                }\n\n                file = files[i];\n                types = file.type.split(\"/\");\n                media = types[0]; //   const ext = types[1];\n\n                _context.t0 = media;\n                _context.next = _context.t0 === \"image\" ? 9 : 19;\n                break;\n\n              case 9:\n                data = new FormData();\n                _context.next = 12;\n                return ImageCompressor(file);\n\n              case 12:\n                compressed = _context.sent;\n                data.append(\"file\", compressed);\n                _context.next = 16;\n                return request.uploadSocial(data).then(function (res) {\n                  return res.json();\n                });\n\n              case 16:\n                json = _context.sent;\n\n                if (json.url) {\n                  _this.addMedia(\"image\", {\n                    src: json.url\n                  });\n                } else if (json.error.name === \"notPurify\") {\n                  showPopUp( /*#__PURE__*/React.createElement(PopUp.OneButton, {\n                    title: /*#__PURE__*/React.createElement(FormattedMessage, {\n                      id: \"ID_SOCIAL_UNPURIFY\",\n                      __self: _assertThisInitialized(_this),\n                      __source: {\n                        fileName: _jsxFileName,\n                        lineNumber: 160,\n                        columnNumber: 24\n                      }\n                    }),\n                    buttonName: /*#__PURE__*/React.createElement(FormattedMessage, {\n                      id: \"ID_SOCIAL_WRITE_EMPTY_CONFIRM\",\n                      __self: _assertThisInitialized(_this),\n                      __source: {\n                        fileName: _jsxFileName,\n                        lineNumber: 161,\n                        columnNumber: 29\n                      }\n                    }),\n                    __self: _assertThisInitialized(_this),\n                    __source: {\n                      fileName: _jsxFileName,\n                      lineNumber: 159,\n                      columnNumber: 15\n                    }\n                  }), {\n                    darkmode: true,\n                    dismissButton: false,\n                    dismissOverlay: true\n                  });\n                }\n\n                return _context.abrupt(\"break\", 20);\n\n              case 19:\n                return _context.abrupt(\"break\", 20);\n\n              case 20:\n                i++;\n                _context.next = 2;\n                break;\n\n              case 23:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee);\n      }));\n\n      return function (_x) {\n        return _ref.apply(this, arguments);\n      };\n    }();\n\n    _this.onClickFile = function () {\n      var fileInput = document.getElementById(\"draftEditor_fileInput-\".concat(_this.editorId));\n      if (fileInput) fileInput.click();\n    };\n\n    _this.onClickCode = function () {\n      _this.addMedia(\"code\", {\n        code: \"\"\n      });\n    };\n\n    _this.onClickGame = function () {\n      showPopUp( /*#__PURE__*/React.createElement(GamePopUp, {\n        onChangeGame: function onChangeGame(pId) {\n          _this.addMedia(\"game\", {\n            pId: pId\n          });\n        },\n        __self: _assertThisInitialized(_this),\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 189,\n          columnNumber: 7\n        }\n      }), {\n        darkmode: true\n      });\n    };\n\n    _this.editorId = _this.randomString();\n    _this.state = {\n      editorState: EditorState.createEmpty(),\n      aceFouced: false\n    };\n    return _this;\n  } // draft\n\n\n  _createClass(DraftEditor, [{\n    key: \"randomString\",\n    value: // util\n    function randomString() {\n      var charSet = \"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789\";\n      var randomString = \"\";\n\n      for (var i = 0; i < 6; i++) {\n        var randomPoz = Math.floor(Math.random() * charSet.length);\n        randomString += charSet.substring(randomPoz, randomPoz + 1);\n      }\n\n      return randomString;\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _this$props3 = this.props,\n          _this$props3$readonly = _this$props3.readonly,\n          readonly = _this$props3$readonly === void 0 ? false : _this$props3$readonly,\n          _this$props3$placehol = _this$props3.placeholder,\n          placeholder = _this$props3$placehol === void 0 ? \"내용을 입력하세요\" : _this$props3$placehol;\n      var _this$state = this.state,\n          editorState = _this$state.editorState,\n          aceFouced = _this$state.aceFouced;\n      var editorId = this.editorId,\n          setEditorRef = this.setEditorRef,\n          onChangeEditorState = this.onChangeEditorState,\n          handleFileInput = this.handleFileInput;\n      return /*#__PURE__*/React.createElement(\"div\", {\n        className: \"draftEditor\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 220,\n          columnNumber: 7\n        }\n      }, /*#__PURE__*/React.createElement(Editor, {\n        ref: setEditorRef,\n        editorState: editorState,\n        onChange: onChangeEditorState,\n        blockRendererFn: CustomBlockRenderer,\n        placeholder: readonly ? \"\" : placeholder,\n        readOnly: readonly || aceFouced,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 221,\n          columnNumber: 9\n        }\n      }), /*#__PURE__*/React.createElement(\"input\", {\n        id: \"draftEditor_fileInput-\".concat(editorId),\n        type: \"file\" // accept=\".jpg,.jpeg,.png,.mp4,.wmv\"\n        ,\n        accept: \".jpg,.jpeg,.png\",\n        onChange: handleFileInput,\n        multiple: true,\n        hidden: true,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 229,\n          columnNumber: 9\n        }\n      }));\n    }\n  }]);\n\n  return DraftEditor;\n}(Component);\n\nexport default DraftEditor;","map":{"version":3,"sources":["/Users/jimmy/Documents/Wizschool/wizlab_web2/src/Common/Component/DraftEditor/index.js"],"names":["React","Component","Editor","EditorState","AtomicBlockUtils","convertToRaw","convertFromRaw","ImageCompressor","request","PopUp","showPopUp","CustomBlockRenderer","GamePopUp","FormattedMessage","DraftEditor","props","setEditorRef","editor","focusEditor","focus","setContents","contents","onChangeMedia","onChangeAceFouced","readonly","key","entityMap","entity","data","contentState","editorState","createWithContent","setState","err","console","warn","getContents","state","getCurrentContent","rawContent","JSON","parse","stringify","i","blocks","length","block","type","text","replace","splice","hasValidText","getText","reduce","prev","emptyContents","onChangeContents","createEmpty","onChangeEditorState","aceFouced","addMedia","contentStateWithNewEntity","createEntity","entityKey","getLastCreatedEntityKey","newEditorState","insertAtomicBlock","set","currentContent","handleFileInput","e","files","target","file","types","split","media","FormData","compressed","append","uploadSocial","then","res","json","url","src","error","name","darkmode","dismissButton","dismissOverlay","onClickFile","fileInput","document","getElementById","editorId","click","onClickCode","code","onClickGame","pId","randomString","charSet","randomPoz","Math","floor","random","substring","placeholder"],"mappings":"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","sourcesContent":["import React, { Component } from \"react\";\nimport {\n  Editor,\n  EditorState,\n  AtomicBlockUtils,\n  convertToRaw,\n  convertFromRaw\n} from \"draft-js\";\nimport { ImageCompressor } from \"../../Util/FileCompressor\";\nimport * as request from \"../../Util/HTTPRequest\";\nimport PopUp, { showPopUp } from \"../PopUp\";\nimport CustomBlockRenderer from \"./CustomBlockRenderer\";\nimport GamePopUp from \"./GamePopUp\";\nimport \"./index.scss\";\nimport { FormattedMessage } from \"react-intl\";\nclass DraftEditor extends Component {\n  constructor(props) {\n    super(props);\n    this.editorId = this.randomString();\n    this.state = {\n      editorState: EditorState.createEmpty(),\n      aceFouced: false\n    };\n  }\n\n  // draft\n  setEditorRef = editor => {\n    this.editor = editor;\n  };\n  focusEditor = () => {\n    if (this.editor) this.editor.focus();\n  };\n  setContents = contents => {\n    try {\n      const { onChangeMedia, onChangeAceFouced } = this;\n      const { readonly = false } = this.props;\n      for (let key in contents.entityMap) {\n        const entity = contents.entityMap[key];\n        entity.data[\"readonly\"] = readonly;\n        entity.data[\"onChangeMedia\"] = onChangeMedia;\n        entity.data[\"onChangeAceFouced\"] = onChangeAceFouced;\n      }\n      const contentState = convertFromRaw(contents);\n      const editorState = EditorState.createWithContent(contentState);\n      this.setState({ editorState });\n    } catch (err) {\n      console.warn(err);\n    }\n  };\n  getContents = () => {\n    const { editorState } = this.state;\n    const contentState = editorState.getCurrentContent();\n    const rawContent = JSON.parse(JSON.stringify(convertToRaw(contentState)));\n\n    // remove empty end blocks\n    let i = rawContent.blocks.length;\n    while (i--) {\n      const block = rawContent.blocks[i];\n      if (block.type !== \"atomic\" && block.text.replace(/\\s/g, \"\").length < 1) {\n        rawContent.blocks.splice(i, 1);\n      } else {\n        break;\n      }\n    }\n\n    // check contents text is valid\n    let hasValidText = false;\n    for (let i = 0; i < rawContent.blocks.length; i++) {\n      const block = rawContent.blocks[i];\n      if (block.type === \"atomic\" || block.text.replace(/\\s/g, \"\").length > 0) {\n        hasValidText = true;\n        break;\n      }\n    }\n    if (!hasValidText) {\n      return null;\n    }\n\n    // remove datas for rendering\n    for (let key in rawContent.entityMap) {\n      const entity = rawContent.entityMap[key];\n      delete entity.data[\"readonly\"];\n      delete entity.data[\"onChangeMedia\"];\n      delete entity.data[\"onChangeAceFouced\"];\n    }\n\n    return rawContent;\n  };\n  getText = () => {\n    const { blocks } = this.getContents();\n    return blocks.reduce(\n      (prev, block) => prev + \" \" + (block.type !== \"atomic\" ? block.text : \"\"),\n      \"\"\n    );\n  };\n  emptyContents = () => {\n    const { readonly = false, onChangeContents } = this.props;\n    if (readonly) return;\n    onChangeContents(null);\n    this.setState({ editorState: EditorState.createEmpty() });\n  };\n  onChangeEditorState = editorState => {\n    const { readonly = false, onChangeContents } = this.props;\n    if (readonly) return;\n    this.setState({ editorState }, () => {\n      if (!onChangeContents) return;\n      onChangeContents(this.getContents());\n    });\n  };\n\n  // media component\n  onChangeMedia = () => {\n    this.onChangeEditorState(this.state.editorState);\n  };\n  onChangeAceFouced = aceFouced => {\n    this.setState({ aceFouced });\n  };\n\n  // media add\n  addMedia = (type, data) => {\n    const { onChangeMedia, onChangeAceFouced } = this;\n    const { readonly = false } = this.props;\n    const { editorState } = this.state;\n    const contentState = editorState.getCurrentContent();\n    const contentStateWithNewEntity = contentState.createEntity(\n      type,\n      \"IMMUTABLE\",\n      { ...data, readonly, onChangeMedia, onChangeAceFouced }\n    );\n    const entityKey = contentStateWithNewEntity.getLastCreatedEntityKey();\n    const newEditorState = AtomicBlockUtils.insertAtomicBlock(\n      EditorState.set(editorState, {\n        currentContent: contentStateWithNewEntity\n      }),\n      entityKey,\n      \" \"\n    );\n    this.setState({ editorState: newEditorState }, () => {\n      this.onChangeEditorState(newEditorState);\n    });\n  };\n  handleFileInput = async e => {\n    const { files } = e.target;\n    for (let i = 0; i < files.length; i++) {\n      const file = files[i];\n      const types = file.type.split(\"/\");\n      const media = types[0];\n      //   const ext = types[1];\n      switch (media) {\n        case \"image\":\n          const data = new FormData();\n          const compressed = await ImageCompressor(file);\n          data.append(\"file\", compressed);\n          const json = await request.uploadSocial(data).then(res => res.json());\n          if(json.url) {\n            this.addMedia(\"image\", { src: json.url });\n          } else if(json.error.name === \"notPurify\") {\n            showPopUp(\n              <PopUp.OneButton\n                title={<FormattedMessage id={\"ID_SOCIAL_UNPURIFY\"} />}\n                buttonName={<FormattedMessage id={\"ID_SOCIAL_WRITE_EMPTY_CONFIRM\"} />}\n              />,\n              {\n                darkmode: true,\n                dismissButton: false,\n                dismissOverlay: true\n              }\n            );\n          }\n          break;\n        // case \"video\":\n        //   break;\n        default:\n          break;\n      }\n    }\n  };\n  onClickFile = () => {\n    const fileInput = document.getElementById(\n      `draftEditor_fileInput-${this.editorId}`\n    );\n    if (fileInput) fileInput.click();\n  };\n  onClickCode = () => {\n    this.addMedia(\"code\", { code: \"\" });\n  };\n  onClickGame = () => {\n    showPopUp(\n      <GamePopUp\n        onChangeGame={pId => {\n          this.addMedia(\"game\", { pId });\n        }}\n      />,\n      { darkmode: true }\n    );\n  };\n\n  // util\n  randomString() {\n    const charSet =\n      \"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789\";\n    let randomString = \"\";\n    for (let i = 0; i < 6; i++) {\n      const randomPoz = Math.floor(Math.random() * charSet.length);\n      randomString += charSet.substring(randomPoz, randomPoz + 1);\n    }\n    return randomString;\n  }\n\n  render() {\n    const { readonly = false, placeholder = \"내용을 입력하세요\" } = this.props;\n    const { editorState, aceFouced } = this.state;\n    const {\n      editorId,\n      setEditorRef,\n      onChangeEditorState,\n      handleFileInput\n    } = this;\n    return (\n      <div className=\"draftEditor\">\n        <Editor\n          ref={setEditorRef}\n          editorState={editorState}\n          onChange={onChangeEditorState}\n          blockRendererFn={CustomBlockRenderer}\n          placeholder={readonly ? \"\" : placeholder}\n          readOnly={readonly || aceFouced}\n        />\n        <input\n          id={`draftEditor_fileInput-${editorId}`}\n          type=\"file\"\n          // accept=\".jpg,.jpeg,.png,.mp4,.wmv\"\n          accept=\".jpg,.jpeg,.png\"\n          onChange={handleFileInput}\n          multiple\n          hidden\n        />\n      </div>\n    );\n  }\n}\n\nexport default DraftEditor;\n"]},"metadata":{},"sourceType":"module"}