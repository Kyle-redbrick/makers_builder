{"ast":null,"code":"import _regeneratorRuntime from \"/Users/jimmy/Documents/Wizschool/astroboy/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"/Users/jimmy/Documents/Wizschool/astroboy/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _classCallCheck from \"/Users/jimmy/Documents/Wizschool/astroboy/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"/Users/jimmy/Documents/Wizschool/astroboy/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";\nimport _inherits from \"/Users/jimmy/Documents/Wizschool/astroboy/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";\nimport _possibleConstructorReturn from \"/Users/jimmy/Documents/Wizschool/astroboy/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"/Users/jimmy/Documents/Wizschool/astroboy/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";\nvar _jsxFileName = \"/Users/jimmy/Documents/Wizschool/astroboy/src/Page/Builder/Component/Home/Component/MyProject/Container.js\";\n\nfunction _createSuper(Derived) { var hasNativeReflectConstruct = _isNativeReflectConstruct(); return function _createSuperInternal() { var Super = _getPrototypeOf(Derived), result; if (hasNativeReflectConstruct) { var NewTarget = _getPrototypeOf(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return _possibleConstructorReturn(this, result); }; }\n\nfunction _isNativeReflectConstruct() { if (typeof Reflect === \"undefined\" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === \"function\") return true; try { Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {})); return true; } catch (e) { return false; } }\n\nimport React, { Component } from \"react\";\nimport { injectIntl } from \"react-intl\";\nimport { withRouter } from \"react-router-dom\";\nimport { connect } from \"react-redux\";\nimport View from \"./View\";\nimport { PAGETYPE } from \"../../../../../../Common/Util/Constant\";\nimport * as request from \"../../../../../../Common/Util/HTTPRequest\";\n\nvar Container = /*#__PURE__*/function (_Component) {\n  _inherits(Container, _Component);\n\n  var _super = _createSuper(Container);\n\n  function Container(props) {\n    var _this;\n\n    _classCallCheck(this, Container);\n\n    _this = _super.call(this, props);\n\n    _this.componentDidMount = function () {\n      if (!_this.props.email) return;\n    };\n\n    _this.fetchMyProjects = /*#__PURE__*/_asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee() {\n      var _this$state, currentPage, dataType, keyword, pageOffset, params, res, myProjects;\n\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              _this$state = _this.state, currentPage = _this$state.currentPage, dataType = _this$state.dataType, keyword = _this$state.keyword;\n              pageOffset = Math.ceil((currentPage - 1) * _this.pageSize);\n              params = {\n                type: dataType,\n                email: _this.props.email,\n                offset: pageOffset,\n                limit: _this.isFirstFetchData ? 60 : _this.pageSize,\n                keyword: keyword\n              };\n              _context.prev = 3;\n              _context.next = 6;\n              return request.getDevelopingProjectsByType(params);\n\n            case 6:\n              res = _context.sent;\n              _context.next = 9;\n              return res.json();\n\n            case 9:\n              myProjects = _context.sent;\n              return _context.abrupt(\"return\", myProjects.rows);\n\n            case 13:\n              _context.prev = 13;\n              _context.t0 = _context[\"catch\"](3);\n              console.log(_context.t0);\n              return _context.abrupt(\"return\", []);\n\n            case 17:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee, null, [[3, 13]]);\n    }));\n\n    _this.isFirstFetchData = function () {\n      var currentPage = _this.state.currentPage;\n      return currentPage === 1;\n    };\n\n    _this.setFilteringData = function () {\n      var filteredType = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : [\"js3d\", \"js\", \"wizlabOOBC\"];\n      var keyword = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : \"\";\n\n      _this.setState({\n        currentPage: 1,\n        dataType: filteredType,\n        keyword: keyword\n      }, /*#__PURE__*/_asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2() {\n        var data;\n        return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n          while (1) {\n            switch (_context2.prev = _context2.next) {\n              case 0:\n                _context2.next = 2;\n                return _this.fetchMyProjects();\n\n              case 2:\n                data = _context2.sent;\n\n                _this.setState({\n                  myProjects: data\n                });\n\n              case 4:\n              case \"end\":\n                return _context2.stop();\n            }\n          }\n        }, _callee2);\n      })));\n    };\n\n    _this.onClickProject = function (pId, type) {\n      _this.props.history.replace({\n        pathname: \"/\".concat(type === \"js3d\" ? PAGETYPE.BUILDER3D : PAGETYPE.BUILDER, \"/\").concat(pId)\n      });\n\n      type !== \"js3d\" && window.location.reload();\n    };\n\n    _this.handleOnScroll = function () {\n      var container = _this.projectsRef.current;\n\n      if (container.offsetHeight + container.scrollTop >= container.scrollHeight) {\n        _this.setState(function (prev) {\n          return {\n            currentPage: prev.currentPage + 1\n          };\n        }, /*#__PURE__*/_asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee3() {\n          var data;\n          return _regeneratorRuntime.wrap(function _callee3$(_context3) {\n            while (1) {\n              switch (_context3.prev = _context3.next) {\n                case 0:\n                  _context3.next = 2;\n                  return _this.fetchMyProjects();\n\n                case 2:\n                  data = _context3.sent;\n\n                  _this.setState(function (prev) {\n                    return {\n                      myProjects: prev.myProjects.concat(data)\n                    };\n                  });\n\n                case 4:\n                case \"end\":\n                  return _context3.stop();\n              }\n            }\n          }, _callee3);\n        })));\n      }\n    };\n\n    _this.setProjectName = function (pId, newName) {\n      _this.setState(function (prev) {\n        return {\n          myProjects: prev.myProjects.map(function (item, index) {\n            if (item.pId === pId) {\n              item.name = newName;\n            }\n\n            return item;\n          })\n        };\n      });\n    };\n\n    _this.state = {\n      myProjects: [],\n      currentPage: 1,\n      dataType: [],\n      keyword: \"\"\n    };\n    _this.pageSize = 10;\n    _this.projectsRef = React.createRef();\n    return _this;\n  }\n\n  _createClass(Container, [{\n    key: \"render\",\n    value: function render() {\n      var _this$props = this.props,\n          handleEdit = _this$props.handleEdit,\n          onClickDetailBtn = _this$props.onClickDetailBtn,\n          selectProject = _this$props.selectProject,\n          handleDelete = _this$props.handleDelete,\n          handleCopy = _this$props.handleCopy;\n      var myProjects = this.state.myProjects;\n      var onClickProject = this.onClickProject,\n          handleOnScroll = this.handleOnScroll,\n          projectsRef = this.projectsRef,\n          setFilteringData = this.setFilteringData,\n          setProjectName = this.setProjectName;\n      return React.createElement(View, {\n        myProjects: myProjects,\n        onClickProject: onClickProject,\n        handleOnScroll: handleOnScroll,\n        projectsRef: projectsRef,\n        setFilteringData: setFilteringData,\n        onClickDetailBtn: onClickDetailBtn,\n        handleEdit: handleEdit,\n        selectProject: selectProject,\n        handleDelete: handleDelete,\n        handleCopy: handleCopy,\n        setProjectName: setProjectName,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 118\n        },\n        __self: this\n      });\n    }\n  }]);\n\n  return Container;\n}(Component);\n\nexport default connect(function (state) {\n  return {\n    email: state.userinfo.email\n  };\n}, {})(injectIntl(withRouter(Container)));","map":{"version":3,"sources":["/Users/jimmy/Documents/Wizschool/astroboy/src/Page/Builder/Component/Home/Component/MyProject/Container.js"],"names":["React","Component","injectIntl","withRouter","connect","View","PAGETYPE","request","Container","props","componentDidMount","email","fetchMyProjects","state","currentPage","dataType","keyword","pageOffset","Math","ceil","pageSize","params","type","offset","limit","isFirstFetchData","getDevelopingProjectsByType","res","json","myProjects","rows","console","log","setFilteringData","filteredType","setState","data","onClickProject","pId","history","replace","pathname","BUILDER3D","BUILDER","window","location","reload","handleOnScroll","container","projectsRef","current","offsetHeight","scrollTop","scrollHeight","prev","concat","setProjectName","newName","map","item","index","name","createRef","handleEdit","onClickDetailBtn","selectProject","handleDelete","handleCopy","userinfo"],"mappings":"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","sourcesContent":["import React, { Component } from \"react\";\nimport { injectIntl } from \"react-intl\";\nimport { withRouter } from \"react-router-dom\";\nimport { connect } from \"react-redux\";\nimport View from \"./View\";\nimport { PAGETYPE } from \"../../../../../../Common/Util/Constant\";\nimport * as request from \"../../../../../../Common/Util/HTTPRequest\";\n\nclass Container extends Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      myProjects: [],\n      currentPage: 1,\n      dataType: [],\n      keyword: \"\"\n    };\n    this.pageSize = 10;\n    this.projectsRef = React.createRef();\n  }\n  componentDidMount = () => {\n    if (!this.props.email) return;\n  };\n\n  fetchMyProjects = async () => {\n    let { currentPage, dataType, keyword } = this.state;\n    let pageOffset = Math.ceil((currentPage - 1) * this.pageSize);\n    let params = {\n      type: dataType,\n      email: this.props.email,\n      offset: pageOffset,\n      limit: this.isFirstFetchData ? 60 : this.pageSize,\n      keyword\n    };\n    try {\n      let res = await request.getDevelopingProjectsByType(params);\n      let myProjects = await res.json();\n      return myProjects.rows;\n    } catch (error) {\n      console.log(error);\n      return [];\n    }\n  };\n  isFirstFetchData = () => {\n    let { currentPage } = this.state;\n    return currentPage === 1;\n  };\n  //TODO : have to refactoring\n  setFilteringData = (\n    filteredType = [\"js3d\", \"js\", \"wizlabOOBC\"],\n    keyword = \"\"\n  ) => {\n    this.setState(\n      { currentPage: 1, dataType: filteredType, keyword },\n      async () => {\n        let data = await this.fetchMyProjects();\n        this.setState({ myProjects: data });\n      }\n    );\n  };\n  onClickProject = (pId, type) => {\n    this.props.history.replace({\n      pathname: `/${\n        type === \"js3d\" ? PAGETYPE.BUILDER3D : PAGETYPE.BUILDER\n      }/${pId}`\n    });\n    type !== \"js3d\" && window.location.reload();\n  };\n\n  //TODO : have to refactoring\n  handleOnScroll = () => {\n    const container = this.projectsRef.current;\n    if (\n      container.offsetHeight + container.scrollTop >=\n      container.scrollHeight\n    ) {\n      this.setState(\n        prev => ({\n          currentPage: prev.currentPage + 1\n        }),\n        async () => {\n          let data = await this.fetchMyProjects();\n          this.setState(prev => ({\n            myProjects: prev.myProjects.concat(data)\n          }));\n        }\n      );\n    }\n  };\n\n  setProjectName = (pId, newName) => {\n    this.setState(prev => ({\n      myProjects: prev.myProjects.map((item, index) => {\n        if (item.pId === pId) {\n          item.name = newName;\n        }\n        return item;\n      })\n    }));\n  };\n  render() {\n    const {\n      handleEdit,\n      onClickDetailBtn,\n      selectProject,\n      handleDelete,\n      handleCopy\n    } = this.props;\n    const { myProjects } = this.state;\n    const {\n      onClickProject,\n      handleOnScroll,\n      projectsRef,\n      setFilteringData,\n      setProjectName\n    } = this;\n    return (\n      <View\n        myProjects={myProjects}\n        onClickProject={onClickProject}\n        handleOnScroll={handleOnScroll}\n        projectsRef={projectsRef}\n        setFilteringData={setFilteringData}\n        onClickDetailBtn={onClickDetailBtn}\n        handleEdit={handleEdit}\n        selectProject={selectProject}\n        handleDelete={handleDelete}\n        handleCopy={handleCopy}\n        setProjectName={setProjectName}\n      />\n    );\n  }\n}\nexport default connect(\n  state => ({ email: state.userinfo.email }),\n  {}\n)(injectIntl(withRouter(Container)));\n"]},"metadata":{},"sourceType":"module"}