{"ast":null,"code":"import _defineProperty from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/defineProperty\";\nimport _objectSpread from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread\";\nimport _regeneratorRuntime from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _classCallCheck from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";\nimport _possibleConstructorReturn from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";\nimport _inherits from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";\nvar _jsxFileName = \"/Users/jimmy/Documents/Wizschool/wizlab_web2/src/Page/Payment/Container.js\";\nimport React, { Component } from \"react\";\nimport { connect } from \"react-redux\";\nimport { withRouter } from \"react-router-dom\";\nimport { injectIntl } from \"react-intl\";\nimport * as userInfoActions from \"../../Common/Store/Reducer/UserInfo\";\nimport * as request from \"../../Common/Util/HTTPRequest\";\nimport { URL } from \"../../Common/Util/Constant\";\nimport View from \"./View\";\nimport PopUp, { showPopUp } from \"../../Common/Component/PopUp\";\n\nvar Container =\n/*#__PURE__*/\nfunction (_Component) {\n  _inherits(Container, _Component);\n\n  function Container(props) {\n    var _this;\n\n    _classCallCheck(this, Container);\n\n    _this = _possibleConstructorReturn(this, _getPrototypeOf(Container).call(this, props));\n    _this.componentDidMount =\n    /*#__PURE__*/\n    _asyncToGenerator(\n    /*#__PURE__*/\n    _regeneratorRuntime.mark(function _callee() {\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              if (_this.props.email) {\n                _context.next = 3;\n                break;\n              }\n\n              _this.props.history.push(\"/\");\n\n              return _context.abrupt(\"return\");\n\n            case 3:\n              _context.next = 5;\n              return _this.fetchApkproduct();\n\n            case 5:\n              _this.setState({\n                finalPrice: _this.calculatePrice()\n              });\n\n            case 6:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee, this);\n    }));\n\n    _this.componentDidUpdate = function (prevProps) {\n      if (_this.props.email && !prevProps.email) {\n        _this.onLogin();\n      }\n\n      if (!_this.props.email) {\n        _this.onLogout();\n      }\n    };\n\n    _this.onLogin = function () {\n      _this.setState({\n        phone: _this.props.userinfo.phone,\n        email: _this.props.email\n      });\n    };\n\n    _this.onLogout = function () {\n      _this.props.history.push(\"/\");\n    };\n\n    _this.fetchApkproduct =\n    /*#__PURE__*/\n    _asyncToGenerator(\n    /*#__PURE__*/\n    _regeneratorRuntime.mark(function _callee2() {\n      var res, fetchedData;\n      return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n        while (1) {\n          switch (_context2.prev = _context2.next) {\n            case 0:\n              _context2.next = 2;\n              return request.getProducts({\n                type: \"apk\"\n              });\n\n            case 2:\n              res = _context2.sent;\n              _context2.next = 5;\n              return res.json();\n\n            case 5:\n              fetchedData = _context2.sent;\n\n              _this.setState({\n                product: fetchedData[0]\n              });\n\n            case 7:\n            case \"end\":\n              return _context2.stop();\n          }\n        }\n      }, _callee2, this);\n    }));\n    _this.onClickPayment =\n    /*#__PURE__*/\n    _asyncToGenerator(\n    /*#__PURE__*/\n    _regeneratorRuntime.mark(function _callee3() {\n      var _this$state, name, phone, email, product, productCnt, finalPrice, payMethod, promotionCodeId, agreement01, agreement02, params, warning;\n\n      return _regeneratorRuntime.wrap(function _callee3$(_context3) {\n        while (1) {\n          switch (_context3.prev = _context3.next) {\n            case 0:\n              _this$state = _this.state, name = _this$state.name, phone = _this$state.phone, email = _this$state.email, product = _this$state.product, productCnt = _this$state.productCnt, finalPrice = _this$state.finalPrice, payMethod = _this$state.payMethod, promotionCodeId = _this$state.promotionCodeId, agreement01 = _this$state.agreement01, agreement02 = _this$state.agreement02;\n              params = {\n                type: product.type,\n                pay_method: payMethod,\n                productId: product.id,\n                amount: finalPrice,\n                merchant_uid: email + \"_\" + new Date().getTime(),\n                information: JSON.stringify({\n                  tickets: productCnt\n                }),\n                isMarketingAgreement: false,\n                email: email,\n                buyerName: name,\n                buyerPhone: phone,\n                promotionCodeId: promotionCodeId\n              };\n\n              if (_this.confirmOfRequired()) {\n                _context3.next = 12;\n                break;\n              }\n\n              warning = {};\n\n              if (!name) {\n                warning.name_warning = \"두글자 이상 입력하세요.\";\n              }\n\n              if (!email) {\n                warning.email_warning = \"이메일 형식을 확인하세요.\";\n              }\n\n              if (!phone) {\n                warning.phone_warning = \"휴대폰 번호를 확인하세요.\";\n              }\n\n              if (!agreement01) {\n                warning.agreement01_warning = \"이용 약관에 동의해주세요.\";\n              }\n\n              if (!agreement02) {\n                warning.agreement02_warning = \"이용 약관에 동의해주세요.\";\n              }\n\n              _this.setState(warning);\n\n              showPopUp(React.createElement(PopUp.OneButton, {\n                title: \"필수입력사항을 확인해주세요\",\n                buttonName: \"확인\",\n                __source: {\n                  fileName: _jsxFileName,\n                  lineNumber: 125\n                },\n                __self: this\n              }));\n              return _context3.abrupt(\"return\");\n\n            case 12:\n              _this.onSubmitPayment(_objectSpread({}, params, {\n                pg: _this.getPgByPayMethod()\n              }));\n\n            case 13:\n            case \"end\":\n              return _context3.stop();\n          }\n        }\n      }, _callee3, this);\n    }));\n\n    _this.confirmOfRequired = function () {\n      var _this$state2 = _this.state,\n          name_warning = _this$state2.name_warning,\n          email_warning = _this$state2.email_warning,\n          phone_warning = _this$state2.phone_warning,\n          agreement01_warning = _this$state2.agreement01_warning,\n          agreement02_warning = _this$state2.agreement02_warning,\n          name = _this$state2.name,\n          phone = _this$state2.phone,\n          email = _this$state2.email,\n          agreement01 = _this$state2.agreement01,\n          agreement02 = _this$state2.agreement02;\n\n      if (!name_warning && !email_warning && !phone_warning && !agreement01_warning && !agreement02_warning && name && phone && email && agreement01 && agreement02) {\n        _this.setState({\n          submit_warning: \"\"\n        });\n\n        return true;\n      } else {\n        return false;\n      }\n    };\n\n    _this.getPgByPayMethod = function () {\n      return _this.state.payMethod === \"card\" ? \"html5_inicis.MOIwizscho\" : \"kakaopay\";\n    };\n\n    _this.onSubmitPayment =\n    /*#__PURE__*/\n    function () {\n      var _ref4 = _asyncToGenerator(\n      /*#__PURE__*/\n      _regeneratorRuntime.mark(function _callee4(params) {\n        var response, payment;\n        return _regeneratorRuntime.wrap(function _callee4$(_context4) {\n          while (1) {\n            switch (_context4.prev = _context4.next) {\n              case 0:\n                _context4.next = 2;\n                return request.addPayment(params);\n\n              case 2:\n                response = _context4.sent;\n                _context4.next = 5;\n                return response.json();\n\n              case 5:\n                payment = _context4.sent;\n\n                if (payment) {\n                  _context4.next = 8;\n                  break;\n                }\n\n                return _context4.abrupt(\"return\");\n\n              case 8:\n                _this.requestIamport(payment, params);\n\n              case 9:\n              case \"end\":\n                return _context4.stop();\n            }\n          }\n        }, _callee4, this);\n      }));\n\n      return function (_x) {\n        return _ref4.apply(this, arguments);\n      };\n    }();\n\n    _this.fetchPromotionCode =\n    /*#__PURE__*/\n    _asyncToGenerator(\n    /*#__PURE__*/\n    _regeneratorRuntime.mark(function _callee5() {\n      var _this$state3, promotionCode, product, res, fetchedData;\n\n      return _regeneratorRuntime.wrap(function _callee5$(_context5) {\n        while (1) {\n          switch (_context5.prev = _context5.next) {\n            case 0:\n              _this$state3 = _this.state, promotionCode = _this$state3.promotionCode, product = _this$state3.product;\n              _context5.next = 3;\n              return request.checkPromotionCodeValid({\n                code: promotionCode,\n                productId: product.id\n              });\n\n            case 3:\n              res = _context5.sent;\n              _context5.next = 6;\n              return res.json();\n\n            case 6:\n              fetchedData = _context5.sent;\n              return _context5.abrupt(\"return\", fetchedData);\n\n            case 8:\n            case \"end\":\n              return _context5.stop();\n          }\n        }\n      }, _callee5, this);\n    }));\n    _this.onClickPromotionCode =\n    /*#__PURE__*/\n    _asyncToGenerator(\n    /*#__PURE__*/\n    _regeneratorRuntime.mark(function _callee6() {\n      var data, message;\n      return _regeneratorRuntime.wrap(function _callee6$(_context6) {\n        while (1) {\n          switch (_context6.prev = _context6.next) {\n            case 0:\n              if (!_this.state.promotionCodeId) {\n                _context6.next = 3;\n                break;\n              }\n\n              _this.setState({\n                promotionCodeId: undefined,\n                discountAmount: 0,\n                discountRate: 0,\n                promotionCode: \"\"\n              }, function () {\n                _this.setState({\n                  finalPrice: _this.calculatePrice()\n                });\n              });\n\n              return _context6.abrupt(\"return\");\n\n            case 3:\n              _context6.next = 5;\n              return _this.fetchPromotionCode();\n\n            case 5:\n              data = _context6.sent;\n\n              if (data.success) {\n                _context6.next = 21;\n                break;\n              }\n\n              message = \"\";\n              _context6.t0 = data.message;\n              _context6.next = _context6.t0 === \"notExist\" ? 11 : _context6.t0 === \"rangeError\" ? 13 : _context6.t0 === \"alreadyUsed\" ? 15 : 17;\n              break;\n\n            case 11:\n              message = \"존재하지 않는 프로모션 코드 입니다.\";\n              return _context6.abrupt(\"break\", 18);\n\n            case 13:\n              message = \"현재 상품에서 사용할 수 없는 프로모션 코드 입니다.\";\n              return _context6.abrupt(\"break\", 18);\n\n            case 15:\n              message = \"이미 사용한 프로모션 코드 입니다.\";\n              return _context6.abrupt(\"break\", 18);\n\n            case 17:\n              return _context6.abrupt(\"break\", 18);\n\n            case 18:\n              _this.setState({\n                promotionCode_warning: message\n              });\n\n              _context6.next = 23;\n              break;\n\n            case 21:\n              if (data.promotionCode.discountRate) {\n                _this.setState({\n                  discountRate: data.promotionCode.discountRate / 100\n                });\n              } else {\n                _this.setState({\n                  discountAmount: data.promotionCode.discountAmount\n                });\n              }\n\n              _this.setState({\n                promotionCode_warning: \"\",\n                promotionCodeId: data.promotionCode.code,\n                finalPrice: _this.calculatePrice()\n              });\n\n            case 23:\n            case \"end\":\n              return _context6.stop();\n          }\n        }\n      }, _callee6, this);\n    }));\n\n    _this.calculatePrice = function () {\n      var _this$state4 = _this.state,\n          product = _this$state4.product,\n          productCnt = _this$state4.productCnt,\n          discountRate = _this$state4.discountRate,\n          discountAmount = _this$state4.discountAmount;\n\n      _this.setState({\n        discountPrice: _this.discountPrice()\n      });\n\n      if (discountRate > 0 || discountAmount > 0) {\n        return product.price * productCnt - _this.discountPrice();\n      } else {\n        return product.price * productCnt;\n      }\n    };\n\n    _this.discountPrice = function () {\n      var _this$state5 = _this.state,\n          product = _this$state5.product,\n          productCnt = _this$state5.productCnt,\n          discountRate = _this$state5.discountRate,\n          discountAmount = _this$state5.discountAmount;\n\n      if (discountRate > 0 || discountAmount > 0) {\n        return discountRate > 0 ? product.price * discountRate * productCnt : discountAmount;\n      } else {\n        return 0;\n      }\n    };\n\n    _this.requestIamport = function (payment, params) {\n      var _this$state6 = _this.state,\n          name = _this$state6.name,\n          phone = _this$state6.phone,\n          email = _this$state6.email,\n          product = _this$state6.product;\n      params = _objectSpread({}, params, {\n        name: product.name,\n        buyer_tel: phone,\n        buyer_email: email,\n        buyer_name: name,\n        m_redirect_url: URL.ORIGIN + \"payment/result\",\n        notice_url: URL.API_SERVER + \"payment/iamportNotification\"\n      });\n      var IMP = window.IMP;\n      IMP.init(\"imp90978512\");\n      IMP.request_pay(params,\n      /*#__PURE__*/\n      function () {\n        var _ref7 = _asyncToGenerator(\n        /*#__PURE__*/\n        _regeneratorRuntime.mark(function _callee7(rsp) {\n          return _regeneratorRuntime.wrap(function _callee7$(_context7) {\n            while (1) {\n              switch (_context7.prev = _context7.next) {\n                case 0:\n                  if (!rsp.success) {\n                    _context7.next = 5;\n                    break;\n                  }\n\n                  _this.props.updateUserInfo({\n                    apkTicket: _this.props.userinfo.apkTicket + _this.state.productCnt\n                  });\n\n                  setTimeout(function () {\n                    _this.props.history.replace(\"/payment/result\");\n                  }, 1000);\n                  _context7.next = 7;\n                  break;\n\n                case 5:\n                  _context7.next = 7;\n                  return request.cancelPayment({\n                    id: payment.id\n                  }, function () {\n                    setTimeout(function () {\n                      _this.props.history.replace(\"/payment/result\");\n                    }, 1000);\n                  });\n\n                case 7:\n                case \"end\":\n                  return _context7.stop();\n              }\n            }\n          }, _callee7, this);\n        }));\n\n        return function (_x2) {\n          return _ref7.apply(this, arguments);\n        };\n      }());\n    };\n\n    _this.onClickPayMethod = function (e) {\n      _this.setState({\n        payMethod: e.target.value\n      });\n    };\n\n    _this.onClickProductCnt = function (number) {\n      if (number > 0) {\n        _this.setState({\n          productCnt: number\n        }, function () {\n          _this.setState({\n            finalPrice: _this.calculatePrice()\n          });\n        });\n      }\n    };\n\n    _this.onChangeInput = function (e) {\n      var _e$target = e.target,\n          id = _e$target.id,\n          value = _e$target.value,\n          checked = _e$target.checked;\n      value = value.replace(\" \", \"\");\n\n      if (id === \"agreement01\" || id === \"agreement02\") {\n        _this.setState(_defineProperty({}, id, checked), function () {\n          _this.checkInputValid(id, checked);\n        });\n      } else {\n        _this.setState(_defineProperty({}, id, value), function () {\n          _this.checkInputValid(id, value);\n        });\n      }\n    };\n\n    _this.checkInputValid = function (id, value) {\n      switch (id) {\n        case \"name\":\n          if (_this.isNameValid() || value === \"\") {\n            _this.setState({\n              name_warning: \"\"\n            });\n          } else {\n            _this.setState({\n              name_warning: \"두글자 이상 입력하세요.\"\n            });\n          }\n\n          break;\n\n        case \"email\":\n          if (_this.isEmailValid() || value === \"\") {\n            _this.setState({\n              email_warning: \"\"\n            });\n          } else {\n            _this.setState({\n              email_warning: \"이메일 형식을 확인하세요.\"\n            });\n          }\n\n          break;\n\n        case \"phone\":\n          if (_this.isPhoneValid() || value === \"\") {\n            _this.setState({\n              phone_warning: \"\"\n            });\n          } else {\n            _this.setState({\n              phone_warning: \"휴대폰 번호를 확인하세요.\"\n            });\n          }\n\n          break;\n\n        case \"agreement01\":\n          if (value) {\n            _this.setState({\n              agreement01_warning: \"\"\n            });\n          } else {\n            _this.setState({\n              agreement01_warning: \"이용 약관에 동의해주세요.\"\n            });\n          }\n\n          break;\n\n        case \"agreement02\":\n          if (value) {\n            _this.setState({\n              agreement02_warning: \"\"\n            });\n          } else {\n            _this.setState({\n              agreement02_warning: \"이용 약관에 동의해주세요.\"\n            });\n          }\n\n          break;\n\n        case \"promotionCode\":\n          if (!value) {\n            _this.setState({\n              promotionCode_warning: \"\"\n            });\n          }\n\n          break;\n\n        default:\n          break;\n      }\n    };\n\n    _this.isEmailValid = function () {\n      var regex = /^(([^<>()[\\]\\\\.,;:\\s@\"]+(\\.[^<>()[\\]\\\\.,;:\\s@\"]+)*)|(\".+\"))@((\\[[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\])|(([a-zA-Z\\-0-9]+\\.)+[a-zA-Z]{2,}))$/;\n      return regex.test(_this.state.email);\n    };\n\n    _this.isNameValid = function () {\n      return _this.state.name.length >= 2;\n    };\n\n    _this.isPhoneValid = function () {\n      return _this.state.phone.length >= 8;\n    };\n\n    _this.inputValid = {\n      name_warning: \"\",\n      email_warning: \"\",\n      phone_warning: \"\",\n      agreement01_warning: \"\",\n      agreement02_warning: \"\",\n      promotionCode_warning: \"\",\n      submit_warning: \"\"\n    };\n    _this.state = _objectSpread({}, _this.inputValid, {\n      name: \"\",\n      phone: _this.props.userinfo.phone,\n      email: _this.props.email,\n      agreement01: false,\n      agreement02: false,\n      payMethod: \"card\",\n      promotionCode: \"\",\n      promotionCodeId: undefined,\n      productCnt: 1,\n      product: {},\n      discountAmount: 0,\n      discountRate: 0,\n      finalPrice: 0,\n      discountPrice: 0\n    });\n    return _this;\n  }\n\n  _createClass(Container, [{\n    key: \"render\",\n    value: function render() {\n      var onClickPayment = this.onClickPayment,\n          onClickPayMethod = this.onClickPayMethod,\n          onClickProductCnt = this.onClickProductCnt,\n          onChangeInput = this.onChangeInput,\n          onClickPromotionCode = this.onClickPromotionCode;\n      var _this$state7 = this.state,\n          payMethod = _this$state7.payMethod,\n          name = _this$state7.name,\n          phone = _this$state7.phone,\n          email = _this$state7.email,\n          promotionCode = _this$state7.promotionCode,\n          productCnt = _this$state7.productCnt,\n          product = _this$state7.product,\n          name_warning = _this$state7.name_warning,\n          email_warning = _this$state7.email_warning,\n          phone_warning = _this$state7.phone_warning,\n          agreement01_warning = _this$state7.agreement01_warning,\n          agreement02_warning = _this$state7.agreement02_warning,\n          promotionCode_warning = _this$state7.promotionCode_warning,\n          submit_warning = _this$state7.submit_warning,\n          discountAmount = _this$state7.discountAmount,\n          discountRate = _this$state7.discountRate,\n          finalPrice = _this$state7.finalPrice,\n          promotionCodeId = _this$state7.promotionCodeId,\n          discountPrice = _this$state7.discountPrice;\n      return React.createElement(View, {\n        onClickPayment: onClickPayment,\n        onClickPayMethod: onClickPayMethod,\n        payMethod: payMethod,\n        name: name,\n        phone: phone,\n        email: email,\n        promotionCode: promotionCode,\n        productCnt: productCnt,\n        product: product,\n        onClickProductCnt: onClickProductCnt,\n        onChangeInput: onChangeInput,\n        name_warning: name_warning,\n        email_warning: email_warning,\n        phone_warning: phone_warning,\n        agreement01_warning: agreement01_warning,\n        agreement02_warning: agreement02_warning,\n        promotionCode_warning: promotionCode_warning,\n        submit_warning: submit_warning,\n        discountAmount: discountAmount,\n        discountRate: discountRate,\n        finalPrice: finalPrice,\n        onClickPromotionCode: onClickPromotionCode,\n        promotionCodeId: promotionCodeId,\n        discountPrice: discountPrice,\n        intl: this.props.intl,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 409\n        },\n        __self: this\n      });\n    }\n  }]);\n\n  return Container;\n}(Component);\n\nexport default connect(function (state) {\n  return {\n    email: state.userinfo.email,\n    userinfo: state.userinfo\n  };\n}, {\n  updateUserInfo: userInfoActions.updateUserInfo\n})(injectIntl(withRouter(Container)));","map":{"version":3,"sources":["/Users/jimmy/Documents/Wizschool/wizlab_web2/src/Page/Payment/Container.js"],"names":["React","Component","connect","withRouter","injectIntl","userInfoActions","request","URL","View","PopUp","showPopUp","Container","props","componentDidMount","email","history","push","fetchApkproduct","setState","finalPrice","calculatePrice","componentDidUpdate","prevProps","onLogin","onLogout","phone","userinfo","getProducts","type","res","json","fetchedData","product","onClickPayment","state","name","productCnt","payMethod","promotionCodeId","agreement01","agreement02","params","pay_method","productId","id","amount","merchant_uid","Date","getTime","information","JSON","stringify","tickets","isMarketingAgreement","buyerName","buyerPhone","confirmOfRequired","warning","name_warning","email_warning","phone_warning","agreement01_warning","agreement02_warning","onSubmitPayment","pg","getPgByPayMethod","submit_warning","addPayment","response","payment","requestIamport","fetchPromotionCode","promotionCode","checkPromotionCodeValid","code","onClickPromotionCode","undefined","discountAmount","discountRate","data","success","message","promotionCode_warning","discountPrice","price","buyer_tel","buyer_email","buyer_name","m_redirect_url","ORIGIN","notice_url","API_SERVER","IMP","window","init","request_pay","rsp","updateUserInfo","apkTicket","setTimeout","replace","cancelPayment","onClickPayMethod","e","target","value","onClickProductCnt","number","onChangeInput","checked","checkInputValid","isNameValid","isEmailValid","isPhoneValid","regex","test","length","inputValid","intl"],"mappings":"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","sourcesContent":["import React, { Component } from \"react\";\nimport { connect } from \"react-redux\";\nimport { withRouter } from \"react-router-dom\";\nimport { injectIntl } from \"react-intl\";\nimport * as userInfoActions from \"../../Common/Store/Reducer/UserInfo\";\nimport * as request from \"../../Common/Util/HTTPRequest\";\nimport { URL } from \"../../Common/Util/Constant\";\nimport View from \"./View\";\nimport PopUp, { showPopUp } from \"../../Common/Component/PopUp\";\n\nclass Container extends Component {\n  constructor(props) {\n    super(props);\n\n    this.inputValid = {\n      name_warning: \"\",\n      email_warning: \"\",\n      phone_warning: \"\",\n      agreement01_warning: \"\",\n      agreement02_warning: \"\",\n      promotionCode_warning: \"\",\n      submit_warning: \"\"\n    };\n    this.state = {\n      ...this.inputValid,\n      name: \"\",\n      phone: this.props.userinfo.phone,\n      email: this.props.email,\n      agreement01: false,\n      agreement02: false,\n      payMethod: \"card\",\n      promotionCode: \"\",\n      promotionCodeId: undefined,\n      productCnt: 1,\n      product: {},\n      discountAmount: 0,\n      discountRate: 0,\n      finalPrice: 0,\n      discountPrice: 0\n    };\n  }\n  componentDidMount = async () => {\n    if (!this.props.email) {\n      this.props.history.push(\"/\");\n      return;\n    }\n    await this.fetchApkproduct();\n    this.setState({\n      finalPrice: this.calculatePrice()\n    });\n  };\n\n  componentDidUpdate = prevProps => {\n    if (this.props.email && !prevProps.email) {\n      this.onLogin();\n    }\n    if (!this.props.email) {\n      this.onLogout();\n    }\n  };\n  onLogin = () => {\n    this.setState({\n      phone: this.props.userinfo.phone,\n      email: this.props.email\n    });\n  };\n\n  onLogout = () => {\n    this.props.history.push(\"/\");\n  };\n  fetchApkproduct = async () => {\n    let res = await request.getProducts({ type: \"apk\" });\n    let fetchedData = await res.json();\n    this.setState({ product: fetchedData[0] });\n  };\n  onClickPayment = async () => {\n    const {\n      name,\n      phone,\n      email,\n      product,\n      productCnt,\n      finalPrice,\n      payMethod,\n      promotionCodeId,\n      agreement01,\n      agreement02\n    } = this.state;\n\n    let params = {\n      type: product.type,\n      pay_method: payMethod,\n      productId: product.id,\n      amount: finalPrice,\n      merchant_uid: email + \"_\" + new Date().getTime(),\n      information: JSON.stringify({ tickets: productCnt }),\n      isMarketingAgreement: false,\n      email,\n      buyerName: name,\n      buyerPhone: phone,\n      promotionCodeId\n    };\n\n    if (!this.confirmOfRequired()) {\n      let warning = {};\n      if (!name) {\n        warning.name_warning = \"두글자 이상 입력하세요.\";\n      }\n      if (!email) {\n        warning.email_warning = \"이메일 형식을 확인하세요.\";\n      }\n      if (!phone) {\n        warning.phone_warning = \"휴대폰 번호를 확인하세요.\";\n      }\n\n      if (!agreement01) {\n        warning.agreement01_warning = \"이용 약관에 동의해주세요.\";\n      }\n\n      if (!agreement02) {\n        warning.agreement02_warning = \"이용 약관에 동의해주세요.\";\n      }\n      this.setState(warning);\n      showPopUp(\n        <PopUp.OneButton\n          title={\"필수입력사항을 확인해주세요\"}\n          buttonName={\"확인\"}\n        />\n      );\n      return;\n    }\n\n    this.onSubmitPayment({ ...params, pg: this.getPgByPayMethod() });\n  };\n  confirmOfRequired = () => {\n    const {\n      name_warning,\n      email_warning,\n      phone_warning,\n      agreement01_warning,\n      agreement02_warning,\n      name,\n      phone,\n      email,\n      agreement01,\n      agreement02\n    } = this.state;\n\n    if (\n      !name_warning &&\n      !email_warning &&\n      !phone_warning &&\n      !agreement01_warning &&\n      !agreement02_warning &&\n      name &&\n      phone &&\n      email &&\n      agreement01 &&\n      agreement02\n    ) {\n      this.setState({ submit_warning: \"\" });\n      return true;\n    } else {\n      return false;\n    }\n  };\n  getPgByPayMethod = () => {\n    return this.state.payMethod === \"card\"\n      ? \"html5_inicis.MOIwizscho\"\n      : \"kakaopay\";\n  };\n  onSubmitPayment = async params => {\n    const response = await request.addPayment(params);\n    const payment = await response.json();\n    /* TODO : try catch */\n    if (!payment) return;\n    this.requestIamport(payment, params);\n  };\n  fetchPromotionCode = async () => {\n    const { promotionCode, product } = this.state;\n    const res = await request.checkPromotionCodeValid({\n      code: promotionCode,\n      productId: product.id\n    });\n    const fetchedData = await res.json();\n    return fetchedData;\n  };\n  onClickPromotionCode = async () => {\n    if (this.state.promotionCodeId) {\n      this.setState(\n        {\n          promotionCodeId: undefined,\n          discountAmount: 0,\n          discountRate: 0,\n          promotionCode: \"\"\n        },\n        () => {\n          this.setState({ finalPrice: this.calculatePrice() });\n        }\n      );\n      return;\n    }\n    const data = await this.fetchPromotionCode();\n    if (!data.success) {\n      let message = \"\";\n      switch (data.message) {\n        case \"notExist\":\n          message = \"존재하지 않는 프로모션 코드 입니다.\";\n          break;\n        case \"rangeError\":\n          message = \"현재 상품에서 사용할 수 없는 프로모션 코드 입니다.\";\n          break;\n        case \"alreadyUsed\":\n          message = \"이미 사용한 프로모션 코드 입니다.\";\n          break;\n        default:\n          break;\n      }\n      this.setState({ promotionCode_warning: message });\n    } else {\n      if (data.promotionCode.discountRate) {\n        this.setState({\n          discountRate: data.promotionCode.discountRate / 100\n        });\n      } else {\n        this.setState({\n          discountAmount: data.promotionCode.discountAmount\n        });\n      }\n      this.setState({\n        promotionCode_warning: \"\",\n        promotionCodeId: data.promotionCode.code,\n        finalPrice: this.calculatePrice()\n      });\n    }\n  };\n  calculatePrice = () => {\n    const { product, productCnt, discountRate, discountAmount } = this.state;\n\n    this.setState({\n      discountPrice: this.discountPrice()\n    });\n    if (discountRate > 0 || discountAmount > 0) {\n      return product.price * productCnt - this.discountPrice();\n    } else {\n      return product.price * productCnt;\n    }\n  };\n\n  discountPrice = () => {\n    const { product, productCnt, discountRate, discountAmount } = this.state;\n    if (discountRate > 0 || discountAmount > 0) {\n      return discountRate > 0\n        ? product.price * discountRate * productCnt\n        : discountAmount;\n    } else {\n      return 0;\n    }\n  };\n  requestIamport = (payment, params) => {\n    const { name, phone, email, product } = this.state;\n    params = {\n      ...params,\n      name: product.name,\n      buyer_tel: phone,\n      buyer_email: email,\n      buyer_name: name,\n      m_redirect_url: URL.ORIGIN + `payment/result`,\n      notice_url: URL.API_SERVER + `payment/iamportNotification`\n    };\n\n    const IMP = window.IMP;\n    IMP.init(\"imp90978512\");\n    IMP.request_pay(params, async rsp => {\n      if (rsp.success) {\n        this.props.updateUserInfo({\n          apkTicket: this.props.userinfo.apkTicket + this.state.productCnt\n        });\n        setTimeout(() => {\n          this.props.history.replace(\"/payment/result\");\n        }, 1000);\n      } else {\n        await request.cancelPayment({ id: payment.id }, () => {\n          setTimeout(() => {\n            this.props.history.replace(\"/payment/result\");\n          }, 1000);\n        });\n      }\n    });\n  };\n  onClickPayMethod = e => {\n    this.setState({ payMethod: e.target.value });\n  };\n  onClickProductCnt = number => {\n    if (number > 0) {\n      this.setState(\n        {\n          productCnt: number\n        },\n        () => {\n          this.setState({ finalPrice: this.calculatePrice() });\n        }\n      );\n    }\n  };\n  onChangeInput = e => {\n    let { id, value, checked } = e.target;\n    value = value.replace(\" \", \"\");\n    if (id === \"agreement01\" || id === \"agreement02\") {\n      this.setState({ [id]: checked }, () => {\n        this.checkInputValid(id, checked);\n      });\n    } else {\n      this.setState({ [id]: value }, () => {\n        this.checkInputValid(id, value);\n      });\n    }\n  };\n  /* input valid check */\n  checkInputValid = (id, value) => {\n    switch (id) {\n      case \"name\":\n        if (this.isNameValid() || value === \"\") {\n          this.setState({ name_warning: \"\" });\n        } else {\n          this.setState({ name_warning: \"두글자 이상 입력하세요.\" });\n        }\n\n        break;\n      case \"email\":\n        if (this.isEmailValid() || value === \"\") {\n          this.setState({ email_warning: \"\" });\n        } else {\n          this.setState({ email_warning: \"이메일 형식을 확인하세요.\" });\n        }\n        break;\n      case \"phone\":\n        if (this.isPhoneValid() || value === \"\") {\n          this.setState({ phone_warning: \"\" });\n        } else {\n          this.setState({ phone_warning: \"휴대폰 번호를 확인하세요.\" });\n        }\n\n        break;\n      case \"agreement01\":\n        if (value) {\n          this.setState({ agreement01_warning: \"\" });\n        } else {\n          this.setState({ agreement01_warning: \"이용 약관에 동의해주세요.\" });\n        }\n        break;\n      case \"agreement02\":\n        if (value) {\n          this.setState({ agreement02_warning: \"\" });\n        } else {\n          this.setState({ agreement02_warning: \"이용 약관에 동의해주세요.\" });\n        }\n        break;\n      case \"promotionCode\":\n        if (!value) {\n          this.setState({ promotionCode_warning: \"\" });\n        }\n        break;\n      default:\n        break;\n    }\n  };\n  isEmailValid = () => {\n    const regex = /^(([^<>()[\\]\\\\.,;:\\s@\"]+(\\.[^<>()[\\]\\\\.,;:\\s@\"]+)*)|(\".+\"))@((\\[[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\])|(([a-zA-Z\\-0-9]+\\.)+[a-zA-Z]{2,}))$/;\n    return regex.test(this.state.email);\n  };\n  isNameValid = () => {\n    return this.state.name.length >= 2;\n  };\n  isPhoneValid = () => {\n    return this.state.phone.length >= 8;\n  };\n\n  render() {\n    const {\n      onClickPayment,\n      onClickPayMethod,\n      onClickProductCnt,\n      onChangeInput,\n      onClickPromotionCode\n    } = this;\n    const {\n      payMethod,\n      name,\n      phone,\n      email,\n      promotionCode,\n      productCnt,\n      product,\n      name_warning,\n      email_warning,\n      phone_warning,\n      agreement01_warning,\n      agreement02_warning,\n      promotionCode_warning,\n      submit_warning,\n      discountAmount,\n      discountRate,\n      finalPrice,\n      promotionCodeId,\n      discountPrice\n    } = this.state;\n    return (\n      <View\n        onClickPayment={onClickPayment}\n        onClickPayMethod={onClickPayMethod}\n        payMethod={payMethod}\n        name={name}\n        phone={phone}\n        email={email}\n        promotionCode={promotionCode}\n        productCnt={productCnt}\n        product={product}\n        onClickProductCnt={onClickProductCnt}\n        onChangeInput={onChangeInput}\n        name_warning={name_warning}\n        email_warning={email_warning}\n        phone_warning={phone_warning}\n        agreement01_warning={agreement01_warning}\n        agreement02_warning={agreement02_warning}\n        promotionCode_warning={promotionCode_warning}\n        submit_warning={submit_warning}\n        discountAmount={discountAmount}\n        discountRate={discountRate}\n        finalPrice={finalPrice}\n        onClickPromotionCode={onClickPromotionCode}\n        promotionCodeId={promotionCodeId}\n        discountPrice={discountPrice}\n        intl={this.props.intl}\n      />\n    );\n  }\n}\n\nexport default connect(\n  state => ({ email: state.userinfo.email, userinfo: state.userinfo }),\n  {\n    updateUserInfo: userInfoActions.updateUserInfo\n  }\n)(injectIntl(withRouter(Container)));\n"]},"metadata":{},"sourceType":"module"}