{"ast":null,"code":"import _toConsumableArray from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";\nimport _defineProperty from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/defineProperty\";\nimport _regeneratorRuntime from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _classCallCheck from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";\nimport _inherits from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";\nimport _possibleConstructorReturn from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";\nvar _jsxFileName = \"/Users/jimmy/Documents/Wizschool/wizlab_web2/src/Common/Component/Publish/Container.js\";\n\nfunction _createSuper(Derived) { var hasNativeReflectConstruct = _isNativeReflectConstruct(); return function _createSuperInternal() { var Super = _getPrototypeOf(Derived), result; if (hasNativeReflectConstruct) { var NewTarget = _getPrototypeOf(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return _possibleConstructorReturn(this, result); }; }\n\nfunction _isNativeReflectConstruct() { if (typeof Reflect === \"undefined\" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === \"function\") return true; try { Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {})); return true; } catch (e) { return false; } }\n\nimport React, { Component } from \"react\";\nimport { connect } from \"react-redux\";\nimport ReactToolTip from \"react-tooltip\";\nimport { injectIntl } from \"react-intl\";\nimport * as request from \"../../Util/HTTPRequest\";\nimport * as projectActions from \"../../../Page/Builder/Store/Reducer/project\";\nimport * as webrtcActions from \"../../../Page/Builder/Store/Reducer/webrtc\";\nimport generateGamePage from \"../../../Page/Builder/utils/gamePageGenerator\";\nimport { getColorTheme } from \"../../../Page/Builder/utils/colorThemeUtil\";\nimport { generatePIDForTutorial } from \"../../Util/PIDGenerator\";\nimport { ImageCompressor } from \"../../Util/FileCompressor\";\nimport stringify from \"json-stringify-safe\";\nimport PopUp, { showPopUp } from \"../PopUp\";\nimport View from \"./View\";\nimport \"./index.scss\"; // import { showBingoPopup } from \"../PopUp/BingoPopup\";\n\nvar Container = /*#__PURE__*/function (_Component) {\n  _inherits(Container, _Component);\n\n  var _super = _createSuper(Container);\n\n  function Container(props) {\n    var _this;\n\n    _classCallCheck(this, Container);\n\n    _this = _super.call(this, props);\n    _this.componentDidMount = /*#__PURE__*/_asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee() {\n      var pId, popup, dismissBtn;\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              pId = _this.getPID();\n              request.getPublishedProject({\n                pId: pId\n              }).then(function (res) {\n                return res.json();\n              }).then(function (json) {\n                if (json) {\n                  var name = json.name,\n                      description = json.description,\n                      category = json.category,\n                      icon = json.icon,\n                      isCopyAllowed = json.isCopyAllowed;\n                  var tag = json.tag.map(function (item) {\n                    return item.gameTag.name;\n                  });\n\n                  _this.setState({\n                    name: name,\n                    description: description,\n                    category: category,\n                    icon: icon,\n                    isCopyAllowed: isCopyAllowed,\n                    tags: tag\n                  });\n\n                  if (_this.props.isDeveloping) {\n                    _this.props.setScreenshotURL(icon, _this.props.project.useCustomIcon);\n                  }\n                } else {\n                  _this.setState({\n                    isCopyAllowed: true\n                  });\n                }\n              }).catch(function (e) {\n                return console.error(e);\n              });\n              request.getPopularTag().then(function (res) {\n                return res.json();\n              }).then(function (json) {\n                var popular = json.map(function (item) {\n                  return item.name;\n                });\n\n                _this.setState({\n                  popularTags: popular.slice(0, 5)\n                });\n              });\n              request.checkAttendEventChallenge({\n                pId: pId\n              }).then(function (res) {\n                return res.json();\n              }).then(function (json) {\n                if (json) _this.setState({\n                  challengeEventAttend: true\n                });\n              });\n              request.getDevelopingProject({\n                pId: pId\n              }).then(function (res) {\n                return res.json();\n              }).then(function (json) {\n                _this.setState({\n                  projectType: json.type\n                });\n              });\n              /*for css */\n\n              popup = document.querySelector(\".publishpopup\").closest(\".popup_contents\");\n              dismissBtn = popup.querySelector(\"#popup_dismissbtn\");\n              dismissBtn.style.display = \"none\";\n\n            case 8:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee);\n    }));\n\n    _this.handleCheckValidation = function (target) {\n      var stateName = \"\".concat(target.name, \"Validation\");\n\n      _this.setState(_defineProperty({}, stateName, target.value ? true : false));\n    };\n\n    _this.handleInputChange = function (e) {\n      var target = e.target;\n\n      _this.setState(_defineProperty({}, target.name, target.value));\n\n      if (target.name !== \"tag\") {\n        _this.handleCheckValidation(target);\n      }\n    };\n\n    _this.handleIsCopyAllowedChange = function (e) {\n      _this.setState(function (state) {\n        return {\n          isCopyAllowed: !state.isCopyAllowed\n        };\n      });\n    };\n\n    _this.handleImgClick = function () {\n      document.getElementById(\"PublishForm__icon__input\").click();\n    };\n\n    _this.handleAddClick = function () {\n      document.getElementById(\"PublishForm__icon__input\").click();\n    };\n\n    _this.handleSubmit = /*#__PURE__*/function () {\n      var _ref2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2(e) {\n        var _this$state, name, description, isCopyAllowed, _this$state$category, category, tags, challengeEventAttend, pId, icon, _this$props, email, tutorialLevel, _name, state, useCustomIcon, params, publishedURL, _state, gameMeta, doc, url;\n\n        return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n          while (1) {\n            switch (_context2.prev = _context2.next) {\n              case 0:\n                e.preventDefault();\n                _this$state = _this.state, name = _this$state.name, description = _this$state.description, isCopyAllowed = _this$state.isCopyAllowed, _this$state$category = _this$state.category, category = _this$state$category === void 0 ? \"Game\" : _this$state$category, tags = _this$state.tags, challengeEventAttend = _this$state.challengeEventAttend; // input validation\n\n                if (name) {\n                  _context2.next = 7;\n                  break;\n                }\n\n                _this.setState({\n                  nameValidation: false\n                });\n\n                return _context2.abrupt(\"return\");\n\n              case 7:\n                if (description) {\n                  _context2.next = 10;\n                  break;\n                }\n\n                _this.setState({\n                  descriptionValidation: false\n                });\n\n                return _context2.abrupt(\"return\");\n\n              case 10:\n                pId = _this.getPID();\n                icon = _this.getIcon(); // create tutorial developingProject\n\n                _this$props = _this.props, email = _this$props.email, tutorialLevel = _this$props.tutorialLevel;\n\n                if (!tutorialLevel) {\n                  _context2.next = 20;\n                  break;\n                }\n\n                icon = _this.props.project.screenshotURL;\n                _name = _this.props.intl.formatMessage({\n                  id: \"ID_PUBLISH_TUTORIAL\"\n                });\n                state = stringify({\n                  scene: _this.props.scene,\n                  preview: _this.props.preview,\n                  interaction: _this.props.interaction\n                });\n                useCustomIcon = _this.props.project.useCustomIcon;\n                _context2.next = 20;\n                return request.postDevelopingProject({\n                  pId: pId,\n                  icon: icon,\n                  email: email,\n                  name: _name,\n                  state: state,\n                  useCustomIcon: useCustomIcon\n                });\n\n              case 20:\n                if (!(!_this.props.isDeveloping & _this.state.iconUpdated)) {\n                  _context2.next = 23;\n                  break;\n                }\n\n                _context2.next = 23;\n                return request.postDevelopingProject({\n                  pId: pId,\n                  icon: icon,\n                  useCustomIcon: true\n                });\n\n              case 23:\n                // create/update publishedProject\n                params = {\n                  pId: pId,\n                  email: email,\n                  icon: icon,\n                  name: name,\n                  description: description,\n                  category: category,\n                  isCopyAllowed: isCopyAllowed,\n                  tags: tags,\n                  live: true\n                };\n\n                if (_this.props.organization) {\n                  params.isSsafy = _this.props.organization.toLowerCase() === \"ssafy\";\n                }\n\n                if (_this.props.organization) {\n                  params.isJJ = _this.props.organization.includes(\"전주\");\n                }\n\n                publishedURL = undefined;\n\n                if (!_this.props.scene) {\n                  _context2.next = 41;\n                  break;\n                }\n\n                _state = {\n                  editorMode: _this.props.scene.editorMode,\n                  scene: {\n                    scenes: _this.props.scene.scenes,\n                    sceneIds: _this.props.scene.sceneIds,\n                    soundIds: _this.props.scene.soundIds\n                  },\n                  preview: {\n                    screenMode: _this.props.preview.screenMode\n                  }\n                };\n                gameMeta = {\n                  pId: pId,\n                  gameTitle: name\n                };\n                _context2.next = 32;\n                return generateGamePage(_state, gameMeta);\n\n              case 32:\n                doc = _context2.sent;\n                _context2.next = 35;\n                return request.uploadPublished({\n                  doc: doc\n                });\n\n              case 35:\n                url = _context2.sent;\n                _context2.next = 38;\n                return url.json();\n\n              case 38:\n                url = _context2.sent;\n                url = url.url;\n                publishedURL = url;\n\n              case 41:\n                if (publishedURL) {\n                  params[\"url\"] = publishedURL;\n                  params[\"copyStateFromDev\"] = true;\n                }\n\n                try {\n                  request.postPublishedProject(params).then(function (res) {\n                    return res.json();\n                  }).then(function (json) {\n                    _this.handleCloseBtn();\n\n                    if (_this.props.publishProject) {\n                      _this.props.publishProject();\n                    }\n\n                    if (_this.props.publishCallback) {\n                      _this.props.publishCallback({\n                        pId: pId,\n                        icon: icon,\n                        name: name,\n                        description: description,\n                        category: category,\n                        isCopyAllowed: isCopyAllowed\n                      });\n                    }\n\n                    showPopUp(React.createElement(PopUp.OneButton, {\n                      title: _this.props.intl.formatMessage({\n                        id: \"ID_BUILDER_ALERT_MSG_SUCC\"\n                      }),\n                      buttonName: _this.props.intl.formatMessage({\n                        id: \"ID_BUILDER_ALERT_CONFIRMBTN\"\n                      }),\n                      buttonAction: _this.props.buttonAction,\n                      __source: {\n                        fileName: _jsxFileName,\n                        lineNumber: 237\n                      },\n                      __self: this\n                    }), {\n                      dismissButton: false,\n                      darkmode: getColorTheme() === \"darkMode\"\n                    });\n\n                    if (challengeEventAttend) {\n                      request.postCreateChallenge({\n                        pId: pId\n                      });\n                    } else {\n                      request.deleteCreateChallenge({\n                        pId: pId\n                      });\n                    }\n                  });\n                } catch (e) {\n                  console.error(e);\n                  showPopUp(React.createElement(PopUp.OneButton, {\n                    title: _this.props.intl.formatMessage({\n                      id: \"ID_BUILDER_ALERT_MSG_RETRY\"\n                    }),\n                    buttonName: \"\\uD655\\uC778\",\n                    __source: {\n                      fileName: _jsxFileName,\n                      lineNumber: 261\n                    },\n                    __self: this\n                  }), {\n                    dismissButton: false,\n                    darkmode: getColorTheme() === \"darkMode\"\n                  });\n                }\n\n              case 43:\n              case \"end\":\n                return _context2.stop();\n            }\n          }\n        }, _callee2, this);\n      }));\n\n      return function (_x) {\n        return _ref2.apply(this, arguments);\n      };\n    }();\n\n    _this.handleCloseBtn = function () {\n      // 퍼블리싱 팝업 종료\n      _this.props.setLog({\n        publish: false\n      });\n\n      _this.props.dismiss();\n    };\n\n    _this.handleFileInput = /*#__PURE__*/function () {\n      var _ref3 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee3(e) {\n        var selectedFile, data, compressed, isDeveloping, response, json, icon, pId, params, _response, _json, _icon;\n\n        return _regeneratorRuntime.wrap(function _callee3$(_context3) {\n          while (1) {\n            switch (_context3.prev = _context3.next) {\n              case 0:\n                selectedFile = e.target.files[0];\n\n                if (selectedFile) {\n                  _context3.next = 3;\n                  break;\n                }\n\n                return _context3.abrupt(\"return\");\n\n              case 3:\n                data = new FormData();\n                _context3.next = 6;\n                return ImageCompressor(selectedFile);\n\n              case 6:\n                compressed = _context3.sent;\n                data.append(\"file\", compressed);\n                isDeveloping = _this.props.isDeveloping;\n\n                if (!isDeveloping) {\n                  _context3.next = 29;\n                  break;\n                }\n\n                _context3.prev = 10;\n                _context3.next = 13;\n                return request.upload(data);\n\n              case 13:\n                response = _context3.sent;\n                _context3.next = 16;\n                return response.json();\n\n              case 16:\n                json = _context3.sent;\n                icon = json.url;\n                pId = _this.props.project.pId;\n                params = {\n                  pId: pId,\n                  icon: icon,\n                  useCustomIcon: true\n                };\n                request.updateDevelopingProject(params);\n\n                _this.props.setScreenshotURL(icon, true);\n\n                _context3.next = 27;\n                break;\n\n              case 24:\n                _context3.prev = 24;\n                _context3.t0 = _context3[\"catch\"](10);\n                console.error(_context3.t0);\n\n              case 27:\n                _context3.next = 37;\n                break;\n\n              case 29:\n                _context3.next = 31;\n                return request.upload(data);\n\n              case 31:\n                _response = _context3.sent;\n                _context3.next = 34;\n                return _response.json();\n\n              case 34:\n                _json = _context3.sent;\n                _icon = _json.url;\n\n                _this.setState({\n                  icon: _icon,\n                  iconUpdated: true\n                });\n\n              case 37:\n              case \"end\":\n                return _context3.stop();\n            }\n          }\n        }, _callee3, null, [[10, 24]]);\n      }));\n\n      return function (_x2) {\n        return _ref3.apply(this, arguments);\n      };\n    }();\n\n    _this.handleFileDelete = function () {\n      var isDeveloping = _this.props.isDeveloping;\n\n      if (isDeveloping) {\n        document.getElementById(\"PublishForm__icon__input\").value = \"\";\n\n        _this.props.setScreenshotURL(null, false);\n      }\n    };\n\n    _this.getIcon = function () {\n      var isDeveloping = _this.props.isDeveloping;\n\n      if (isDeveloping) {\n        var _this$props$project = _this.props.project,\n            screenshotURL = _this$props$project.screenshotURL,\n            icon = _this$props$project.icon;\n\n        if (screenshotURL) {\n          return screenshotURL;\n        } else if (icon) {\n          return icon;\n        }\n      } else {\n        return _this.state.icon;\n      }\n    };\n\n    _this.getPID = function () {\n      var _this$props2 = _this.props,\n          email = _this$props2.email,\n          isDeveloping = _this$props2.isDeveloping,\n          tutorialLevel = _this$props2.tutorialLevel;\n\n      if (isDeveloping) {\n        if (tutorialLevel) {\n          return generatePIDForTutorial(email, tutorialLevel);\n        } else {\n          return _this.props.project.pId;\n        }\n      } else {\n        return _this.props.pId;\n      }\n    };\n\n    _this.onAddTag = function (tag) {\n      var tags = _this.state.tags;\n\n      if (tags.indexOf(tag) < 0 && tags.length <= 10) {\n        if (tag.length > 10) {\n          tag = tag.substring(0, 10);\n        }\n\n        _this.setState({\n          tags: [].concat(tags, tag)\n        });\n      }\n    };\n\n    _this.onDeleteTag = function (index) {\n      var tags = _toConsumableArray(_this.state.tags);\n\n      tags.splice(index, 1);\n\n      _this.setState({\n        tags: tags\n      });\n    };\n\n    _this.handleChallengeEvent = function (e) {\n      _this.setState({\n        challengeEventAttend: !_this.state.challengeEventAttend\n      });\n    };\n\n    _this.state = {\n      name: \"\",\n      description: \"\",\n      icon: \"\",\n      iconUpdated: false,\n      isCopyAllowed: undefined,\n      tags: [],\n      popularTags: [],\n      challengeEventAttend: true,\n      // challenge 처리 : 챌린지 참여 기간이 아닌 경우 false, 참여기간이면 true\n      nameValidation: true,\n      descriptionValidation: true,\n      projectType: undefined\n    };\n\n    if (_this.props.isBuilder) {\n      require(\"./index_builder.scss\");\n    }\n\n    return _this;\n  }\n\n  _createClass(Container, [{\n    key: \"render\",\n    value: function render() {\n      var _this$state2 = this.state,\n          name = _this$state2.name,\n          description = _this$state2.description,\n          isCopyAllowed = _this$state2.isCopyAllowed,\n          tags = _this$state2.tags,\n          popularTags = _this$state2.popularTags,\n          challengeEventAttend = _this$state2.challengeEventAttend,\n          nameValidation = _this$state2.nameValidation,\n          descriptionValidation = _this$state2.descriptionValidation,\n          projectType = _this$state2.projectType;\n      var icon = this.getIcon();\n      var _this$props3 = this.props,\n          isDeveloping = _this$props3.isDeveloping,\n          isTutorial = _this$props3.isTutorial,\n          project = _this$props3.project;\n      return React.createElement(\"div\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 372\n        },\n        __self: this\n      }, React.createElement(View, {\n        name: name,\n        description: description,\n        isCopyAllowed: isCopyAllowed,\n        icon: icon,\n        tags: tags,\n        isDeveloping: isDeveloping,\n        isTutorial: isTutorial,\n        useCustomIcon: project ? project.useCustomIcon : false,\n        handleInputChange: this.handleInputChange,\n        handleIsCopyAllowedChange: this.handleIsCopyAllowedChange,\n        handleImgClick: this.handleImgClick,\n        handleAddClick: this.handleAddClick,\n        handleSubmit: this.handleSubmit,\n        handleCloseBtn: this.handleCloseBtn,\n        handleFileInput: this.handleFileInput,\n        handleFileDelete: this.handleFileDelete,\n        onDeleteTag: this.onDeleteTag,\n        onAddTag: this.onAddTag,\n        popularTags: popularTags,\n        handleChallengeEvent: this.handleChallengeEvent,\n        challengeEventAttend: challengeEventAttend,\n        nameValidation: nameValidation,\n        descriptionValidation: descriptionValidation,\n        projectType: projectType,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 373\n        },\n        __self: this\n      }), React.createElement(ReactToolTip, {\n        multiline: true,\n        className: \"publish__tooltip\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 400\n        },\n        __self: this\n      }));\n    }\n  }]);\n\n  return Container;\n}(Component);\n\nexport default connect(function (state) {\n  return {\n    email: state.userinfo.email,\n    organization: state.userinfo.organization,\n    project: state.project,\n    scene: state.scene,\n    preview: state.preview,\n    interaction: state.interaction\n  };\n}, {\n  setScreenshotURL: projectActions.setScreenshotURL,\n  publishProject: projectActions.publishProject,\n  setLog: webrtcActions.setLog\n})(injectIntl(Container));","map":{"version":3,"sources":["/Users/jimmy/Documents/Wizschool/wizlab_web2/src/Common/Component/Publish/Container.js"],"names":["React","Component","connect","ReactToolTip","injectIntl","request","projectActions","webrtcActions","generateGamePage","getColorTheme","generatePIDForTutorial","ImageCompressor","stringify","PopUp","showPopUp","View","Container","props","componentDidMount","pId","getPID","getPublishedProject","then","res","json","name","description","category","icon","isCopyAllowed","tag","map","item","gameTag","setState","tags","isDeveloping","setScreenshotURL","project","useCustomIcon","catch","e","console","error","getPopularTag","popular","popularTags","slice","checkAttendEventChallenge","challengeEventAttend","getDevelopingProject","projectType","type","popup","document","querySelector","closest","dismissBtn","style","display","handleCheckValidation","target","stateName","value","handleInputChange","handleIsCopyAllowedChange","state","handleImgClick","getElementById","click","handleAddClick","handleSubmit","preventDefault","nameValidation","descriptionValidation","getIcon","email","tutorialLevel","screenshotURL","intl","formatMessage","id","scene","preview","interaction","postDevelopingProject","iconUpdated","params","live","organization","isSsafy","toLowerCase","isJJ","includes","publishedURL","undefined","editorMode","scenes","sceneIds","soundIds","screenMode","gameMeta","gameTitle","doc","uploadPublished","url","postPublishedProject","handleCloseBtn","publishProject","publishCallback","buttonAction","dismissButton","darkmode","postCreateChallenge","deleteCreateChallenge","setLog","publish","dismiss","handleFileInput","selectedFile","files","data","FormData","compressed","append","upload","response","updateDevelopingProject","handleFileDelete","onAddTag","indexOf","length","substring","concat","onDeleteTag","index","splice","handleChallengeEvent","isBuilder","require","isTutorial","userinfo"],"mappings":"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","sourcesContent":["import React, { Component } from \"react\";\nimport { connect } from \"react-redux\";\nimport ReactToolTip from \"react-tooltip\";\nimport { injectIntl } from \"react-intl\";\nimport * as request from \"../../Util/HTTPRequest\";\nimport * as projectActions from \"../../../Page/Builder/Store/Reducer/project\";\nimport * as webrtcActions from \"../../../Page/Builder/Store/Reducer/webrtc\";\nimport generateGamePage from \"../../../Page/Builder/utils/gamePageGenerator\";\nimport { getColorTheme } from \"../../../Page/Builder/utils/colorThemeUtil\";\nimport { generatePIDForTutorial } from \"../../Util/PIDGenerator\";\nimport { ImageCompressor } from \"../../Util/FileCompressor\";\nimport stringify from \"json-stringify-safe\";\nimport PopUp, { showPopUp } from \"../PopUp\";\nimport View from \"./View\";\nimport \"./index.scss\";\n\n// import { showBingoPopup } from \"../PopUp/BingoPopup\";\nclass Container extends Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      name: \"\",\n      description: \"\",\n      icon: \"\",\n      iconUpdated: false,\n      isCopyAllowed: undefined,\n      tags: [],\n      popularTags: [],\n      challengeEventAttend: true, // challenge 처리 : 챌린지 참여 기간이 아닌 경우 false, 참여기간이면 true\n      nameValidation: true,\n      descriptionValidation: true,\n      projectType : undefined\n    };\n    if (this.props.isBuilder) {\n      require(\"./index_builder.scss\");\n    }\n  }\n  componentDidMount = async () => {\n    const pId = this.getPID();\n    request\n      .getPublishedProject({ pId })\n      .then(res => res.json())\n      .then(json => {\n        if (json) {\n          const { name, description, category, icon, isCopyAllowed } = json;\n          let tag = json.tag.map(item => {\n            return item.gameTag.name;\n          });\n          this.setState({\n            name,\n            description,\n            category,\n            icon,\n            isCopyAllowed,\n            tags: tag\n          });\n          if (this.props.isDeveloping) {\n            this.props.setScreenshotURL(icon, this.props.project.useCustomIcon);\n          }\n        } else {\n          this.setState({ isCopyAllowed: true });\n        }\n      })\n      .catch(e => console.error(e));\n\n    request\n      .getPopularTag()\n      .then(res => res.json())\n      .then(json => {\n        let popular = json.map(item => {\n          return item.name;\n        });\n        this.setState({ popularTags: popular.slice(0, 5) });\n      });\n\n    request\n      .checkAttendEventChallenge({ pId })\n      .then(res => res.json())\n      .then(json => {\n        if (json) this.setState({ challengeEventAttend: true });\n      });\n\n\n    request\n      .getDevelopingProject({ pId })\n      .then(res => res.json())\n      .then(json => {\n        this.setState({ projectType : json.type})\n      });\n\n    /*for css */\n    const popup = document\n      .querySelector(\".publishpopup\")\n      .closest(\".popup_contents\");\n    const dismissBtn = popup.querySelector(\"#popup_dismissbtn\");\n    dismissBtn.style.display = \"none\";\n  };\n  handleCheckValidation = target => {\n    const stateName = `${target.name}Validation`;\n    this.setState({ [stateName]: target.value ? true : false });\n  };\n  handleInputChange = e => {\n    const target = e.target;\n    this.setState({ [target.name]: target.value });\n    if (target.name !== \"tag\") {\n      this.handleCheckValidation(target);\n    }\n  };\n  handleIsCopyAllowedChange = e => {\n    this.setState(state => ({\n      isCopyAllowed: !state.isCopyAllowed\n    }));\n  };\n  handleImgClick = () => {\n    document.getElementById(\"PublishForm__icon__input\").click();\n  };\n  handleAddClick = () => {\n    document.getElementById(\"PublishForm__icon__input\").click();\n  };\n  handleSubmit = async e => {\n    e.preventDefault();\n    const {\n      name,\n      description,\n      isCopyAllowed,\n      category = \"Game\",\n      tags,\n      challengeEventAttend\n    } = this.state;\n\n    // input validation\n    if (!name) {\n      this.setState({ nameValidation: false });\n      return;\n    } else if (!description) {\n      this.setState({ descriptionValidation: false });\n      return;\n    }\n\n    const pId = this.getPID();\n    let icon = this.getIcon();\n\n    // create tutorial developingProject\n    const { email, tutorialLevel } = this.props;\n    if (tutorialLevel) {\n      icon = this.props.project.screenshotURL;\n      const name = this.props.intl.formatMessage({ id: \"ID_PUBLISH_TUTORIAL\" });\n      const state = stringify({\n        scene: this.props.scene,\n        preview: this.props.preview,\n        interaction: this.props.interaction\n      });\n      const useCustomIcon = this.props.project.useCustomIcon;\n      await request.postDevelopingProject({\n        pId,\n        icon,\n        email,\n        name,\n        state,\n        useCustomIcon\n      });\n    }\n\n    // update custom icon\n    if (!this.props.isDeveloping & this.state.iconUpdated) {\n      await request.postDevelopingProject({\n        pId,\n        icon,\n        useCustomIcon: true\n      });\n    }\n\n    // create/update publishedProject\n    let params = {\n      pId,\n      email,\n      icon,\n      name,\n      description,\n      category,\n      isCopyAllowed,\n      tags,\n      live: true\n    };\n    if (this.props.organization) {\n      params.isSsafy = this.props.organization.toLowerCase() === \"ssafy\";\n    }\n    if (this.props.organization) {\n      params.isJJ = this.props.organization.includes(\"전주\");\n    }\n\n    let publishedURL = undefined;\n    if (this.props.scene) {\n      const state = {\n        editorMode: this.props.scene.editorMode,\n        scene: {\n          scenes: this.props.scene.scenes,\n          sceneIds: this.props.scene.sceneIds,\n          soundIds: this.props.scene.soundIds\n        },\n        preview: {\n          screenMode: this.props.preview.screenMode\n        }\n      };\n      const gameMeta = { pId, gameTitle: name };\n      const doc = await generateGamePage(state, gameMeta);\n      let url = await request.uploadPublished({ doc });\n      url = await url.json();\n      url = url.url;\n      publishedURL = url;\n    }\n    if (publishedURL) {\n      params[\"url\"] = publishedURL;\n      params[\"copyStateFromDev\"] = true;\n    }\n\n    try {\n      request\n        .postPublishedProject(params)\n        .then(res => res.json())\n        .then(json => {\n          this.handleCloseBtn();\n          if (this.props.publishProject) {\n            this.props.publishProject();\n          }\n          if (this.props.publishCallback) {\n            this.props.publishCallback({\n              pId,\n              icon,\n              name,\n              description,\n              category,\n              isCopyAllowed\n            });\n          }\n          showPopUp(\n            <PopUp.OneButton\n              title={this.props.intl.formatMessage({\n                id: \"ID_BUILDER_ALERT_MSG_SUCC\"\n              })}\n              buttonName={this.props.intl.formatMessage({\n                id: \"ID_BUILDER_ALERT_CONFIRMBTN\"\n              })}\n              buttonAction={this.props.buttonAction}\n            />,\n            {\n              dismissButton: false,\n              darkmode: getColorTheme() === \"darkMode\"\n            }\n          );\n\n          if (challengeEventAttend) {\n            request.postCreateChallenge({ pId });\n          } else {\n            request.deleteCreateChallenge({ pId });\n          }\n        });\n    } catch (e) {\n      console.error(e);\n      showPopUp(\n        <PopUp.OneButton\n          title={this.props.intl.formatMessage({\n            id: \"ID_BUILDER_ALERT_MSG_RETRY\"\n          })}\n          buttonName=\"확인\"\n        />,\n        {\n          dismissButton: false,\n          darkmode: getColorTheme() === \"darkMode\"\n        }\n      );\n    }\n  };\n  handleCloseBtn = () => {\n    // 퍼블리싱 팝업 종료\n    this.props.setLog({ publish: false });\n    this.props.dismiss();\n  };\n  handleFileInput = async e => {\n    const selectedFile = e.target.files[0];\n    if (!selectedFile) return;\n    const data = new FormData();\n    let compressed = await ImageCompressor(selectedFile);\n    data.append(\"file\", compressed);\n    const { isDeveloping } = this.props;\n    if (isDeveloping) {\n      try {\n        const response = await request.upload(data);\n        const json = await response.json();\n        const icon = json.url;\n        const { pId } = this.props.project;\n        const params = { pId, icon, useCustomIcon: true };\n        request.updateDevelopingProject(params);\n        this.props.setScreenshotURL(icon, true);\n      } catch (e) {\n        console.error(e);\n      }\n    } else {\n      const response = await request.upload(data);\n      const json = await response.json();\n      const icon = json.url;\n      this.setState({ icon, iconUpdated: true });\n    }\n  };\n  handleFileDelete = () => {\n    const { isDeveloping } = this.props;\n    if (isDeveloping) {\n      document.getElementById(\"PublishForm__icon__input\").value = \"\";\n      this.props.setScreenshotURL(null, false);\n    }\n  };\n\n  getIcon = () => {\n    const { isDeveloping } = this.props;\n    if (isDeveloping) {\n      const {screenshotURL , icon} = this.props.project\n      if(screenshotURL){\n        return screenshotURL;\n      } else if(icon){\n        return icon;\n      }\n    } else {\n      return this.state.icon;\n    }\n  };\n  getPID = () => {\n    const { email, isDeveloping, tutorialLevel } = this.props;\n    if (isDeveloping) {\n      if (tutorialLevel) {\n        return generatePIDForTutorial(email, tutorialLevel);\n      } else {\n        return this.props.project.pId;\n      }\n    } else {\n      return this.props.pId;\n    }\n  };\n\n  onAddTag = tag => {\n    const { tags } = this.state;\n    if (tags.indexOf(tag) < 0 && tags.length <= 10) {\n      if (tag.length > 10) {\n        tag = tag.substring(0, 10);\n      }\n      this.setState({ tags: [].concat(tags, tag) });\n    }\n  };\n  onDeleteTag = index => {\n    const tags = [...this.state.tags];\n    tags.splice(index, 1);\n    this.setState({ tags });\n  };\n\n  handleChallengeEvent = e => {\n    this.setState({ challengeEventAttend: !this.state.challengeEventAttend });\n  };\n  render() {\n    const {\n      name,\n      description,\n      isCopyAllowed,\n      tags,\n      popularTags,\n      challengeEventAttend,\n      nameValidation,\n      descriptionValidation,\n      projectType\n    } = this.state;\n    const icon = this.getIcon();\n    const { isDeveloping, isTutorial, project } = this.props;\n    return (\n      <div>\n        <View\n          name={name}\n          description={description}\n          isCopyAllowed={isCopyAllowed}\n          icon={icon}\n          tags={tags}\n          isDeveloping={isDeveloping}\n          isTutorial={isTutorial}\n          useCustomIcon={project ? project.useCustomIcon : false}\n          handleInputChange={this.handleInputChange}\n          handleIsCopyAllowedChange={this.handleIsCopyAllowedChange}\n          handleImgClick={this.handleImgClick}\n          handleAddClick={this.handleAddClick}\n          handleSubmit={this.handleSubmit}\n          handleCloseBtn={this.handleCloseBtn}\n          handleFileInput={this.handleFileInput}\n          handleFileDelete={this.handleFileDelete}\n          onDeleteTag={this.onDeleteTag}\n          onAddTag={this.onAddTag}\n          popularTags={popularTags}\n          handleChallengeEvent={this.handleChallengeEvent}\n          challengeEventAttend={challengeEventAttend}\n          nameValidation={nameValidation}\n          descriptionValidation={descriptionValidation}\n          projectType={projectType}\n        />\n\n        <ReactToolTip multiline={true} className=\"publish__tooltip\" />\n      </div>\n    );\n  }\n}\n\nexport default connect(\n  state => ({\n    email: state.userinfo.email,\n    organization: state.userinfo.organization,\n    project: state.project,\n    scene: state.scene,\n    preview: state.preview,\n    interaction: state.interaction\n  }),\n  {\n    setScreenshotURL: projectActions.setScreenshotURL,\n    publishProject: projectActions.publishProject,\n    setLog: webrtcActions.setLog\n  }\n)(injectIntl(Container));\n"]},"metadata":{},"sourceType":"module"}