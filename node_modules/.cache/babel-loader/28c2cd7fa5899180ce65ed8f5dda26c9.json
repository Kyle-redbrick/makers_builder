{"ast":null,"code":"import _regeneratorRuntime from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _objectSpread from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread\";\nimport _classCallCheck from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";\nimport _inherits from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";\nimport _possibleConstructorReturn from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";\nvar _jsxFileName = \"/Users/jimmy/Documents/Wizschool/wizlab_web2/src/Page/Builder3D/Component/Game/Container.js\";\n\nfunction _createSuper(Derived) { var hasNativeReflectConstruct = _isNativeReflectConstruct(); return function _createSuperInternal() { var Super = _getPrototypeOf(Derived), result; if (hasNativeReflectConstruct) { var NewTarget = _getPrototypeOf(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return _possibleConstructorReturn(this, result); }; }\n\nfunction _isNativeReflectConstruct() { if (typeof Reflect === \"undefined\" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === \"function\") return true; try { Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {})); return true; } catch (e) { return false; } }\n\nimport React, { Component } from \"react\";\nimport { injectIntl } from \"react-intl\";\nimport { connect } from \"react-redux\";\nimport * as builderAction from \"../../Store/Reducer/builder\";\nimport { generateBabylonPage } from \"../../../Builder/utils/gamePageGenerator\";\nimport Popup, { showPopUp } from \"../../../../Common/Component/PopUp\";\nimport WizError from \"../../../../Common/Util/WizError\";\nimport View from \"./View\";\n\nvar Container = /*#__PURE__*/function (_Component) {\n  _inherits(Container, _Component);\n\n  var _super = _createSuper(Container);\n\n  function Container(props) {\n    var _this;\n\n    _classCallCheck(this, Container);\n\n    _this = _super.call(this, props);\n\n    _this.onGameMessage = function (message) {\n      if (message.data.type === \"error\") {\n        var _message$data = message.data,\n            error = _message$data.error,\n            payload = _message$data.payload;\n\n        _this.handleError(error, payload);\n      }\n    };\n\n    _this.handleError = function (error, payload) {\n      _this.props.setIsPlaying(false);\n\n      var wizError = WizError.create({\n        error: error,\n        payload: _this.getPayloadWithNames(payload),\n        intl: _this.props.intl\n      });\n\n      _this.showWizError(wizError);\n    };\n\n    _this.getPayloadWithNames = function (payload) {\n      if (!payload) return payload;\n\n      var payloadWithNames = _objectSpread({}, payload);\n\n      if (payload.sceneId) {\n        var scene = _this.props.game.scenes[payload.sceneId];\n        payloadWithNames.sceneName = scene.name;\n        delete payloadWithNames.sceneId;\n\n        if (payload.spriteId) {\n          payloadWithNames.gameObjectName = scene.gameObjects[payload.spriteId].name;\n          delete payloadWithNames.spriteId;\n        }\n      }\n\n      return payloadWithNames;\n    };\n\n    _this.showWizError = function (wizError) {\n      var formatMessage = _this.props.intl.formatMessage;\n      showPopUp(React.createElement(Popup.OneButton, {\n        title: wizError.getTitle(),\n        subtitle: wizError.getMessage(),\n        buttonName: formatMessage({\n          id: \"ID_BUILDER_ALERT_CONFIRMBTN\"\n        }),\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 116\n        },\n        __self: this\n      }));\n    };\n\n    _this.onresize = function (e) {\n      _this.updateGameContainerStyle();\n    };\n\n    _this.onClickClose = function () {\n      _this.props.setIsPlaying(false);\n    };\n\n    _this.state = {\n      gameSrc: null,\n      gameContainerStyle: {}\n    };\n    return _this;\n  }\n\n  _createClass(Container, [{\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      this.updateGameContainerStyle();\n      window.addEventListener(\"message\", this.onGameMessage, false);\n      window.addEventListener(\"resize\", this.onresize);\n    }\n  }, {\n    key: \"componentWillUnmount\",\n    value: function componentWillUnmount() {\n      window.removeEventListener(\"message\", this.onGameMessage);\n      window.removeEventListener(\"resize\", this.onresize);\n    }\n  }, {\n    key: \"componentDidUpdate\",\n    value: function componentDidUpdate(prevProps) {\n      if (prevProps.isPlaying !== this.props.isPlaying) {\n        this.onChangeIsPlaying();\n      }\n    }\n  }, {\n    key: \"onChangeIsPlaying\",\n    value: function onChangeIsPlaying() {\n      if (this.props.isPlaying) {\n        if (this.checkGameDataValidAndWarn()) {\n          this.playGame();\n        } else {\n          this.props.setIsPlaying(false);\n        }\n      } else {\n        this.stopGame();\n      }\n    }\n  }, {\n    key: \"checkGameDataValidAndWarn\",\n    value: function checkGameDataValidAndWarn() {\n      if (!this.checkAllSceneHasCamera()) {\n        alert(\"모든 씬에 적어도 하나의 카메라가 필요해요!\");\n        return false;\n      }\n\n      return true;\n    }\n  }, {\n    key: \"checkAllSceneHasCamera\",\n    value: function checkAllSceneHasCamera() {\n      var _this$props$game = this.props.game,\n          sceneIds = _this$props$game.sceneIds,\n          scenes = _this$props$game.scenes;\n\n      for (var i in sceneIds) {\n        var hasCamera = false;\n        var sceneId = sceneIds[i];\n        var scene = scenes[sceneId];\n        var gameObjectIds = scene.gameObjectIds,\n            gameObjects = scene.gameObjects;\n\n        for (var j in gameObjectIds) {\n          var gameObjectId = gameObjectIds[j];\n          var gameObject = gameObjects[gameObjectId];\n\n          if (gameObject.type === \"camera\") {\n            hasCamera = true;\n            break;\n          }\n        }\n\n        if (!hasCamera) {\n          return false;\n        }\n      }\n\n      return true;\n    }\n  }, {\n    key: \"playGame\",\n    value: function () {\n      var _playGame = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee() {\n        var gameSrc;\n        return _regeneratorRuntime.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                _context.next = 2;\n                return generateBabylonPage({\n                  gameData: this.props.game,\n                  onParseError: this.handleError,\n                  isBuilderPlay: true\n                });\n\n              case 2:\n                gameSrc = _context.sent;\n                this.setState({\n                  gameSrc: gameSrc\n                });\n\n              case 4:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee, this);\n      }));\n\n      function playGame() {\n        return _playGame.apply(this, arguments);\n      }\n\n      return playGame;\n    }()\n  }, {\n    key: \"stopGame\",\n    value: function stopGame() {\n      this.setState({\n        gameSrc: null\n      });\n    }\n  }, {\n    key: \"updateGameContainerStyle\",\n    value: function updateGameContainerStyle() {\n      var top, left, width, height;\n      var gameElement = document.getElementById(\"game\");\n      var parentWidth = gameElement.clientWidth;\n      var parentHeight = gameElement.clientHeight;\n\n      if (parentHeight / parentWidth > 9 / 16) {\n        width = parentWidth;\n        height = parentWidth * 9 / 16;\n      } else {\n        width = parentHeight * 16 / 9;\n        height = parentHeight;\n      }\n\n      width = width * 0.9;\n      height = height * 0.9;\n      top = (parentHeight - height) / 2;\n      left = (parentWidth - width) / 2;\n      this.setState({\n        gameContainerStyle: {\n          top: top,\n          left: left,\n          width: width,\n          height: height\n        }\n      });\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var isPlaying = this.props.isPlaying;\n      var _this$state = this.state,\n          gameSrc = _this$state.gameSrc,\n          gameContainerStyle = _this$state.gameContainerStyle;\n      return React.createElement(View, {\n        isPlaying: isPlaying,\n        gameSrc: gameSrc,\n        gameContainerStyle: gameContainerStyle,\n        onClickClose: this.onClickClose,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 157\n        },\n        __self: this\n      });\n    }\n  }]);\n\n  return Container;\n}(Component);\n\nexport default connect(function (state) {\n  var game = state.game,\n      builder = state.builder;\n  var isPlaying = builder.isPlaying;\n  return {\n    game: game,\n    isPlaying: isPlaying\n  };\n}, {\n  setIsPlaying: builderAction.setIsPlaying\n})(injectIntl(Container));","map":{"version":3,"sources":["/Users/jimmy/Documents/Wizschool/wizlab_web2/src/Page/Builder3D/Component/Game/Container.js"],"names":["React","Component","injectIntl","connect","builderAction","generateBabylonPage","Popup","showPopUp","WizError","View","Container","props","onGameMessage","message","data","type","error","payload","handleError","setIsPlaying","wizError","create","getPayloadWithNames","intl","showWizError","payloadWithNames","sceneId","scene","game","scenes","sceneName","name","spriteId","gameObjectName","gameObjects","formatMessage","getTitle","getMessage","id","onresize","e","updateGameContainerStyle","onClickClose","state","gameSrc","gameContainerStyle","window","addEventListener","removeEventListener","prevProps","isPlaying","onChangeIsPlaying","checkGameDataValidAndWarn","playGame","stopGame","checkAllSceneHasCamera","alert","sceneIds","i","hasCamera","gameObjectIds","j","gameObjectId","gameObject","gameData","onParseError","isBuilderPlay","setState","top","left","width","height","gameElement","document","getElementById","parentWidth","clientWidth","parentHeight","clientHeight","builder"],"mappings":"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","sourcesContent":["import React, { Component } from \"react\";\nimport { injectIntl } from \"react-intl\";\nimport { connect } from \"react-redux\";\nimport * as builderAction from \"../../Store/Reducer/builder\";\nimport { generateBabylonPage } from \"../../../Builder/utils/gamePageGenerator\";\nimport Popup, { showPopUp } from \"../../../../Common/Component/PopUp\";\nimport WizError from \"../../../../Common/Util/WizError\";\nimport View from \"./View\";\n\nclass Container extends Component {\n  constructor(props) {\n    super(props);\n    this.state = { gameSrc: null, gameContainerStyle: {} };\n  }\n  componentDidMount() {\n    this.updateGameContainerStyle();\n    window.addEventListener(\"message\", this.onGameMessage, false);\n    window.addEventListener(\"resize\", this.onresize);\n  }\n  componentWillUnmount() {\n    window.removeEventListener(\"message\", this.onGameMessage);\n    window.removeEventListener(\"resize\", this.onresize);\n  }\n  componentDidUpdate(prevProps) {\n    if (prevProps.isPlaying !== this.props.isPlaying) {\n      this.onChangeIsPlaying();\n    }\n  }\n\n  onChangeIsPlaying() {\n    if (this.props.isPlaying) {\n      if (this.checkGameDataValidAndWarn()) {\n        this.playGame();\n      } else {\n        this.props.setIsPlaying(false);\n      }\n    } else {\n      this.stopGame();\n    }\n  }\n  checkGameDataValidAndWarn() {\n    if (!this.checkAllSceneHasCamera()) {\n      alert(\"모든 씬에 적어도 하나의 카메라가 필요해요!\");\n      return false;\n    }\n    return true;\n  }\n  checkAllSceneHasCamera() {\n    const { sceneIds, scenes } = this.props.game;\n    for (let i in sceneIds) {\n      let hasCamera = false;\n\n      const sceneId = sceneIds[i];\n      const scene = scenes[sceneId];\n      const { gameObjectIds, gameObjects } = scene;\n      for (let j in gameObjectIds) {\n        const gameObjectId = gameObjectIds[j];\n        const gameObject = gameObjects[gameObjectId];\n        if (gameObject.type === \"camera\") {\n          hasCamera = true;\n          break;\n        }\n      }\n\n      if (!hasCamera) {\n        return false;\n      }\n    }\n    return true;\n  }\n  async playGame() {\n    const gameSrc = await generateBabylonPage({\n      gameData: this.props.game,\n      onParseError: this.handleError,\n      isBuilderPlay: true\n    });\n    this.setState({ gameSrc });\n  }\n  stopGame() {\n    this.setState({ gameSrc: null });\n  }\n\n  onGameMessage = message => {\n    if (message.data.type === \"error\") {\n      const { error, payload } = message.data;\n      this.handleError(error, payload);\n    }\n  };\n  handleError = (error, payload) => {\n    this.props.setIsPlaying(false);\n    const wizError = WizError.create({\n      error,\n      payload: this.getPayloadWithNames(payload),\n      intl: this.props.intl\n    });\n    this.showWizError(wizError);\n  };\n  getPayloadWithNames = payload => {\n    if (!payload) return payload;\n    const payloadWithNames = { ...payload };\n    if (payload.sceneId) {\n      const scene = this.props.game.scenes[payload.sceneId];\n      payloadWithNames.sceneName = scene.name;\n      delete payloadWithNames.sceneId;\n      if (payload.spriteId) {\n        payloadWithNames.gameObjectName =\n          scene.gameObjects[payload.spriteId].name;\n        delete payloadWithNames.spriteId;\n      }\n    }\n    return payloadWithNames;\n  };\n  showWizError = wizError => {\n    const { formatMessage } = this.props.intl;\n    showPopUp(\n      <Popup.OneButton\n        title={wizError.getTitle()}\n        subtitle={wizError.getMessage()}\n        buttonName={formatMessage({ id: \"ID_BUILDER_ALERT_CONFIRMBTN\" })}\n      />\n    );\n  };\n\n  onresize = e => {\n    this.updateGameContainerStyle();\n  };\n  updateGameContainerStyle() {\n    let top, left, width, height;\n\n    const gameElement = document.getElementById(\"game\");\n    const parentWidth = gameElement.clientWidth;\n    const parentHeight = gameElement.clientHeight;\n    if (parentHeight / parentWidth > 9 / 16) {\n      width = parentWidth;\n      height = (parentWidth * 9) / 16;\n    } else {\n      width = (parentHeight * 16) / 9;\n      height = parentHeight;\n    }\n\n    width = width * 0.9;\n    height = height * 0.9;\n    top = (parentHeight - height) / 2;\n    left = (parentWidth - width) / 2;\n\n    this.setState({ gameContainerStyle: { top, left, width, height } });\n  }\n\n  onClickClose = () => {\n    this.props.setIsPlaying(false);\n  };\n\n  render() {\n    const { isPlaying } = this.props;\n    const { gameSrc, gameContainerStyle } = this.state;\n    return (\n      <View\n        isPlaying={isPlaying}\n        gameSrc={gameSrc}\n        gameContainerStyle={gameContainerStyle}\n        onClickClose={this.onClickClose}\n      />\n    );\n  }\n}\n\nexport default connect(\n  state => {\n    const { game, builder } = state;\n    const { isPlaying } = builder;\n    return { game, isPlaying };\n  },\n  { setIsPlaying: builderAction.setIsPlaying }\n)(injectIntl(Container));\n"]},"metadata":{},"sourceType":"module"}