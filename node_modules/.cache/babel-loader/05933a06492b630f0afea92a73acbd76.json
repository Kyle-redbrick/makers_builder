{"ast":null,"code":"import _regeneratorRuntime from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/react-scripts/node_modules/@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/react-scripts/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _classCallCheck from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/react-scripts/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/react-scripts/node_modules/@babel/runtime/helpers/esm/createClass\";\nimport _possibleConstructorReturn from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/react-scripts/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/react-scripts/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";\nimport _inherits from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/react-scripts/node_modules/@babel/runtime/helpers/esm/inherits\";\nvar _jsxFileName = \"/Users/jimmy/Documents/Wizschool/wizlab_web2/src/Page/Userpage/Container.js\";\nimport * as userInfoActions from \"../../Common/Store/Reducer/UserInfo\";\nimport { connect } from \"react-redux\";\nimport { withRouter } from \"react-router-dom\";\nimport { Redirect } from \"react-router-dom\";\nimport { injectIntl } from \"react-intl\";\nimport React, { Component } from \"react\";\nimport * as request from \"../../Common/Util/HTTPRequest\";\nimport View from \"./View\"; // import * as TrackingUtil from \"../../Common/Util/TrackingUtil\";\n\nvar Container =\n/*#__PURE__*/\nfunction (_Component) {\n  _inherits(Container, _Component);\n\n  function Container(props) {\n    var _this;\n\n    _classCallCheck(this, Container);\n\n    _this = _possibleConstructorReturn(this, _getPrototypeOf(Container).call(this, props));\n    _this.getUserProfile =\n    /*#__PURE__*/\n    _asyncToGenerator(\n    /*#__PURE__*/\n    _regeneratorRuntime.mark(function _callee() {\n      var profile;\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              _context.next = 2;\n              return request.userEmailById({\n                id: _this.props.match.params.id\n              }).then(function (res) {\n                return res.json();\n              }).then(function (json) {\n                if (json.email) {\n                  if (json.signedOut) {\n                    window.location = \"\";\n                  } else {\n                    return json.email;\n                  }\n                } else {\n                  window.location = \"\";\n                }\n              }).catch(function (e) {\n                return console.error(e);\n              });\n\n            case 2:\n              _this.email = _context.sent;\n              _context.next = 5;\n              return request.userProfile({\n                email: _this.email\n              }).then(function (res) {\n                return res.json();\n              }).catch(function (e) {\n                return console.error(e);\n              });\n\n            case 5:\n              profile = _context.sent;\n\n              _this.setState({\n                profile: profile\n              });\n\n              _this.getMyPublishedProjects();\n\n            case 8:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee, this);\n    }));\n\n    _this.getMyPublishedProjects = function () {\n      if (!_this.email) return;\n\n      _this.setState({\n        loading: true\n      }, function () {\n        var params = {\n          email: _this.email,\n          offset: _this.state.publishedOffset,\n          limit: 20,\n          isLive: _this.props.match.path.includes(\"userpage\")\n        };\n        request.getPublishedProjectsByLive(params).then(function (res) {\n          return res.json();\n        }).then(function (result) {\n          var rows = result.rows;\n          var projects = rows.filter(function (project) {\n            return project.live;\n          });\n\n          _this.setState(function (prev) {\n            return {\n              publisheds: [].concat(prev.publisheds, projects),\n              loading: false\n            };\n          }, function () {\n            if (_this.state.publisheds.length < 20) {\n              window.removeEventListener(\"scroll\", _this.onScroll);\n            }\n          });\n        }).catch(function (err) {\n          return console.error(err);\n        });\n      });\n    };\n\n    _this.onScroll = function (e) {\n      if (window.innerHeight + window.pageYOffset >= document.body.offsetHeight - 100) {\n        var _this$state = _this.state,\n            publishedOffset = _this$state.publishedOffset,\n            loading = _this$state.loading;\n\n        if (!loading) {\n          _this.setState({\n            publishedOffset: publishedOffset + 20\n          }, function () {\n            _this.getMyPublishedProjects();\n          });\n        }\n      }\n    };\n\n    _this.email = null;\n    _this.state = {\n      loading: false,\n      profile: undefined,\n      // publisheds\n      publisheds: [],\n      publishedOffset: 0\n    };\n    return _this;\n  }\n\n  _createClass(Container, [{\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      // TrackingUtil.sendPageEvent(\n      //   this.props.location.pathname,\n      //   this.props.userinfo.email\n      // );\n      this.getUserProfile();\n      this.scrollToTop();\n      window.addEventListener(\"scroll\", this.onScroll);\n    }\n  }, {\n    key: \"componentWillUnmount\",\n    value: function componentWillUnmount() {\n      window.removeEventListener(\"scroll\", this.onScroll);\n    }\n  }, {\n    key: \"scrollToTop\",\n    value: function scrollToTop() {\n      window.scrollTo({\n        top: 0\n      });\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      if (!this.props.match.params.id) {\n        return React.createElement(Redirect, {\n          to: \"/\",\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 133\n          },\n          __self: this\n        });\n      }\n\n      var _this$state2 = this.state,\n          profile = _this$state2.profile,\n          publisheds = _this$state2.publisheds;\n      return React.createElement(View, {\n        profile: profile,\n        publisheds: publisheds,\n        match: this.props.match,\n        intl: this.props.intl,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 138\n        },\n        __self: this\n      });\n    }\n  }]);\n\n  return Container;\n}(Component);\n\nexport default connect(function (state) {\n  return {\n    userinfo: state.userinfo\n  };\n}, {\n  updateUserInfo: userInfoActions.updateUserInfo\n})(injectIntl(withRouter(Container)));","map":{"version":3,"sources":["/Users/jimmy/Documents/Wizschool/wizlab_web2/src/Page/Userpage/Container.js"],"names":["userInfoActions","connect","withRouter","Redirect","injectIntl","React","Component","request","View","Container","props","getUserProfile","userEmailById","id","match","params","then","res","json","email","signedOut","window","location","catch","e","console","error","userProfile","profile","setState","getMyPublishedProjects","loading","offset","state","publishedOffset","limit","isLive","path","includes","getPublishedProjectsByLive","result","rows","projects","filter","project","live","prev","publisheds","concat","length","removeEventListener","onScroll","err","innerHeight","pageYOffset","document","body","offsetHeight","undefined","scrollToTop","addEventListener","scrollTo","top","intl","userinfo","updateUserInfo"],"mappings":"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","sourcesContent":["import * as userInfoActions from \"../../Common/Store/Reducer/UserInfo\";\nimport { connect } from \"react-redux\";\nimport { withRouter } from \"react-router-dom\";\nimport { Redirect } from \"react-router-dom\";\nimport { injectIntl } from \"react-intl\";\nimport React, { Component } from \"react\";\nimport * as request from \"../../Common/Util/HTTPRequest\";\nimport View from \"./View\";\n// import * as TrackingUtil from \"../../Common/Util/TrackingUtil\";\n\nclass Container extends Component {\n  constructor(props) {\n    super(props);\n    this.email = null;\n    this.state = {\n      loading: false,\n      profile: undefined,\n\n      // publisheds\n      publisheds: [],\n      publishedOffset: 0\n    };\n  }\n\n  componentDidMount() {\n    // TrackingUtil.sendPageEvent(\n    //   this.props.location.pathname,\n    //   this.props.userinfo.email\n    // );\n    this.getUserProfile();\n    this.scrollToTop();\n    window.addEventListener(\"scroll\", this.onScroll);\n  }\n\n  componentWillUnmount() {\n    window.removeEventListener(\"scroll\", this.onScroll);\n  }\n\n  scrollToTop() {\n    window.scrollTo({\n      top: 0\n    });\n  }\n\n  getUserProfile = async () => {\n    this.email = await request\n      .userEmailById({ id: this.props.match.params.id })\n      .then(res => res.json())\n      .then(json => {\n        if (json.email) {\n          if (json.signedOut) {\n            window.location = \"\";\n          } else {\n            return json.email;\n          }\n        } else {\n          window.location = \"\";\n        }\n      })\n      .catch(e => console.error(e));\n\n    const profile = await request\n      .userProfile({ email: this.email })\n      .then(res => res.json())\n      .catch(e => console.error(e));\n\n    this.setState({\n      profile\n    });\n\n    this.getMyPublishedProjects();\n  };\n\n  getMyPublishedProjects = () => {\n    if (!this.email) return;\n    this.setState(\n      {\n        loading: true\n      },\n      () => {\n        let params = {\n          email: this.email,\n          offset: this.state.publishedOffset,\n          limit: 20,\n          isLive: this.props.match.path.includes(\"userpage\")\n        };\n        request\n          .getPublishedProjectsByLive(params)\n          .then(res => res.json())\n          .then(result => {\n            const { rows } = result;\n            const projects = rows.filter(project => {\n              return project.live;\n            });\n            this.setState(\n              prev => ({\n                publisheds: [].concat(prev.publisheds, projects),\n                loading: false\n              }),\n              () => {\n                if (this.state.publisheds.length < 20) {\n                  window.removeEventListener(\"scroll\", this.onScroll);\n                }\n              }\n            );\n          })\n          .catch(err => console.error(err));\n      }\n    );\n  };\n\n  onScroll = e => {\n    if (\n      window.innerHeight + window.pageYOffset >=\n      document.body.offsetHeight - 100\n    ) {\n      const { publishedOffset, loading } = this.state;\n      if (!loading) {\n        this.setState(\n          {\n            publishedOffset: publishedOffset + 20\n          },\n          () => {\n            this.getMyPublishedProjects();\n          }\n        );\n      }\n    }\n  };\n\n  render() {\n    if (!this.props.match.params.id) {\n      return <Redirect to=\"/\" />;\n    }\n\n    const { profile, publisheds } = this.state;\n    return (\n      <View\n        profile={profile}\n        publisheds={publisheds}\n        match={this.props.match}\n        intl={this.props.intl}\n      />\n    );\n  }\n}\n\nexport default connect(\n  state => ({\n    userinfo: state.userinfo\n  }),\n  {\n    updateUserInfo: userInfoActions.updateUserInfo\n  }\n)(injectIntl(withRouter(Container)));\n"]},"metadata":{},"sourceType":"module"}