{"ast":null,"code":"import _toConsumableArray from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";\nimport _objectSpread from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread\";\nimport _classCallCheck from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";\nimport _assertThisInitialized from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/assertThisInitialized\";\nimport _inherits from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";\nimport _possibleConstructorReturn from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";\nvar _jsxFileName = \"/Users/jimmy/Documents/Wizschool/wizlab_web2/src/Page/Social/Container.js\";\n\nfunction _createSuper(Derived) { var hasNativeReflectConstruct = _isNativeReflectConstruct(); return function _createSuperInternal() { var Super = _getPrototypeOf(Derived), result; if (hasNativeReflectConstruct) { var NewTarget = _getPrototypeOf(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return _possibleConstructorReturn(this, result); }; }\n\nfunction _isNativeReflectConstruct() { if (typeof Reflect === \"undefined\" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === \"function\") return true; try { Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {})); return true; } catch (e) { return false; } }\n\nimport React, { Component } from \"react\";\nimport { connect } from \"react-redux\";\nimport { withRouter } from \"react-router-dom\";\nimport { injectIntl } from \"react-intl\";\nimport PopUp, { showPopUp } from \"../../Common/Component/PopUp\";\nimport * as request from \"../../Common/Util/HTTPRequest\";\nimport * as TrackingUtil from \"../../Common/Util/TrackingUtil\";\nimport { dateFormatter } from \"./Util/DateFormatter\";\nimport SignIn from \"../../Common/Component/SignIn\";\nimport View from \"./View\";\nimport checkBlockedUser from \"../../Common/Util/CheckBlockedUser\";\nimport { withSubscribe } from \"../../Common/Util/Subscribe\";\nimport { filterBlindedCommentsFromArticle } from \"../../Common/Util/Comments\";\n\nvar Container = /*#__PURE__*/function (_Component) {\n  _inherits(Container, _Component);\n\n  var _super = _createSuper(Container);\n\n  function Container(props) {\n    var _this;\n\n    _classCallCheck(this, Container);\n\n    _this = _super.call(this, props);\n\n    _this.getActivities = function () {\n      var _this$state = _this.state,\n          keywords = _this$state.keywords,\n          offset = _this$state.offset,\n          limit = _this$state.limit,\n          currentCategory = _this$state.currentCategory;\n      var param = {\n        email: _this.props.userinfo.email,\n        offset: offset,\n        limit: limit,\n        keywords: JSON.stringify(keywords),\n        type: currentCategory\n      };\n      request.getSocialArticles(param).then(function (res) {\n        return res.json();\n      }).then(function (json) {\n        _this.setState(function (prevState) {\n          var newActivities = [];\n          json.forEach(function (article) {\n            try {\n              newActivities.push({\n                type: \"socialArticle\",\n                article: _objectSpread({}, article, {\n                  comments: filterBlindedCommentsFromArticle(article.comments),\n                  contents: JSON.parse(article.contents),\n                  createdAt: dateFormatter(article.createdAt)\n                })\n              });\n            } catch (_unused) {}\n          });\n          return {\n            activities: [].concat(prevState.activities, newActivities),\n            loading: false,\n            hasMore: newActivities.length > 0\n          };\n        });\n      });\n    };\n\n    _this.onScroll = function (e) {\n      if (window.innerHeight + window.pageYOffset >= document.body.offsetHeight - 1000) {\n        var _this$state2 = _this.state,\n            offset = _this$state2.offset,\n            hasMore = _this$state2.hasMore,\n            loading = _this$state2.loading;\n\n        if (!loading && hasMore) {\n          _this.setState({\n            offset: offset + _this.pageLength,\n            loading: true\n          }, function () {\n            _this.getActivities();\n          });\n        }\n      }\n    };\n\n    _this.onClickCategory = function (category) {\n      if (category !== _this.state.currentCategory) {\n        _this.props.history.push(\"/social/\".concat(category));\n      }\n    };\n\n    _this.onClickWrite = function () {\n      var isBlocked = checkBlockedUser(_this.props.userinfo);\n\n      if (isBlocked) {\n        return;\n      }\n\n      if (_this.props.userinfo.email) {\n        _this.props.history.push(\"/socialwrite\");\n      } else {\n        showPopUp( /*#__PURE__*/React.createElement(SignIn, {\n          __self: _assertThisInitialized(_this),\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 144,\n            columnNumber: 17\n          }\n        }), {\n          darkmode: true,\n          mobileFullscreen: true\n        });\n      }\n    };\n\n    _this.onSearchKeyDown = function (e) {\n      var keywords = _this.state.keywords;\n      var keyword = e.target.value;\n\n      if (e.keyCode === 13 && keyword !== \"\") {\n        e.target.value = \"\";\n\n        _this.onAddKeyword(keyword);\n\n        TrackingUtil.sendGTMEvent(\"SocialSearch\", \"Social - Search Terms\", keyword);\n      } else if (e.keyCode === 8 && keyword === \"\" && keywords.length > 0) {\n        _this.onDeleteKeyword(keywords.length - 1);\n      }\n    };\n\n    _this.onAddKeyword = function (keyword) {\n      var keywords = _this.state.keywords;\n\n      if (keywords.length <= 10 && keywords.indexOf(keyword) < 0) {\n        _this.setState({\n          keywords: [].concat(keywords, keyword)\n        }, function () {\n          _this.onChangeKeyword();\n        });\n      }\n    };\n\n    _this.onDeleteKeyword = function (index) {\n      var keywords = _toConsumableArray(_this.state.keywords);\n\n      keywords.splice(index, 1);\n\n      _this.setState({\n        keywords: keywords\n      }, function () {\n        _this.onChangeKeyword();\n      });\n    };\n\n    _this.onResetKeyword = function () {\n      _this.setState({\n        keywords: []\n      }, function () {\n        _this.onChangeKeyword();\n      });\n    };\n\n    _this.onChangeKeyword = function () {\n      _this.setState({\n        activities: [],\n        offset: 0,\n        limit: _this.pageLength,\n        total: 0,\n        loading: true\n      }, function () {\n        _this.getActivities();\n      });\n    };\n\n    _this.onClickArticleTag = function (tag) {\n      _this.onAddKeyword(tag);\n    };\n\n    _this.onClickArticleDelete = function (index) {\n      var activities = _toConsumableArray(_this.state.activities);\n\n      activities.splice(index, 1);\n\n      _this.setState({\n        activities: activities\n      });\n    };\n\n    _this.onClickArticleSubscribe = function (user) {\n      if (_this.lastLikeTime) {\n        if (new Date().getTime() - _this.lastLikeTime < 1200) {\n          _this.lastLikeTime = new Date().getTime();\n          showPopUp( /*#__PURE__*/React.createElement(PopUp.OneButton, {\n            title: _this.props.intl.formatMessage({\n              id: \"ID_POPUP_WARNING_REPEAT_CLICK_TITLE\"\n            }),\n            buttonName: _this.props.intl.formatMessage({\n              id: \"ID_POPUP_WARNING_REPEAT_CLICK_BTN\"\n            }),\n            __self: _assertThisInitialized(_this),\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 215,\n              columnNumber: 11\n            }\n          }), {\n            darkmode: true\n          });\n          return;\n        }\n      }\n\n      _this.lastLikeTime = new Date().getTime();\n      var email = _this.props.userinfo.email;\n\n      if (email) {\n        var subscribeInfo = _this.props.subscribeInfo;\n        var isSubscribed = subscribeInfo.emails.includes(user.email);\n\n        if (isSubscribed) {\n          _this.props.unsubscribe(user.email);\n        } else {\n          _this.props.subscribe(user.email);\n        }\n      } else {\n        showPopUp( /*#__PURE__*/React.createElement(SignIn, {\n          __self: _assertThisInitialized(_this),\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 240,\n            columnNumber: 17\n          }\n        }), {\n          darkmode: true,\n          mobileFullscreen: true\n        });\n      }\n    };\n\n    _this.categories = [\"recent\", \"trend\"];\n    _this.pageLength = 5;\n    _this.state = {\n      currentCategory: props.match.params.category || _this.categories[0],\n      keywords: [],\n      activities: [],\n      offset: 0,\n      limit: _this.pageLength,\n      loading: false,\n      hasMore: true\n    };\n    return _this;\n  }\n\n  _createClass(Container, [{\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      window.addEventListener(\"scroll\", this.onScroll);\n\n      if (this.props.match.params.category) {\n        // TrackingUtil.sendPageEvent(\n        //   this.props.location.pathname,\n        //   this.props.email\n        // );\n        this.getActivities();\n      } else {\n        this.props.history.replace(\"/social/\".concat(this.categories[0]));\n        this.getActivities();\n      }\n    }\n  }, {\n    key: \"componentWillUnmount\",\n    value: function componentWillUnmount() {\n      window.removeEventListener(\"scroll\", this.onScroll);\n    }\n  }, {\n    key: \"componentDidUpdate\",\n    value: function componentDidUpdate() {\n      var _this2 = this;\n\n      var currentCategory = this.props.match.params.category;\n\n      if (currentCategory !== this.state.currentCategory) {\n        // TrackingUtil.sendPageEvent(\n        //   this.props.location.pathname,\n        //   this.props.email\n        // );\n        this.setState({\n          currentCategory: currentCategory,\n          keywords: [],\n          activities: [],\n          offset: 0,\n          limit: this.pageLength,\n          loading: false\n        }, function () {\n          _this2.getActivities();\n        });\n      }\n    } // request\n\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _this$props = this.props,\n          intl = _this$props.intl,\n          userinfo = _this$props.userinfo,\n          subscribeInfo = _this$props.subscribeInfo;\n      var _this$state3 = this.state,\n          currentCategory = _this$state3.currentCategory,\n          keywords = _this$state3.keywords,\n          activities = _this$state3.activities;\n      return /*#__PURE__*/React.createElement(View, {\n        intl: intl,\n        userinfo: userinfo,\n        currentCategory: currentCategory,\n        keywords: keywords,\n        activities: activities,\n        subscribeInfo: subscribeInfo,\n        categories: this.categories,\n        onClickCategory: this.onClickCategory,\n        onClickWrite: this.onClickWrite,\n        onSearchKeyDown: this.onSearchKeyDown,\n        onDeleteKeyword: this.onDeleteKeyword,\n        onResetKeyword: this.onResetKeyword,\n        onClickArticleTag: this.onClickArticleTag,\n        onClickArticleDelete: this.onClickArticleDelete,\n        onClickArticleSubscribe: this.onClickArticleSubscribe,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 249,\n          columnNumber: 7\n        }\n      });\n    }\n  }]);\n\n  return Container;\n}(Component);\n\nexport default connect(function (state) {\n  return {\n    userinfo: state.userinfo\n  };\n})(withRouter(injectIntl(withSubscribe(Container))));","map":{"version":3,"sources":["/Users/jimmy/Documents/Wizschool/wizlab_web2/src/Page/Social/Container.js"],"names":["React","Component","connect","withRouter","injectIntl","PopUp","showPopUp","request","TrackingUtil","dateFormatter","SignIn","View","checkBlockedUser","withSubscribe","filterBlindedCommentsFromArticle","Container","props","getActivities","state","keywords","offset","limit","currentCategory","param","email","userinfo","JSON","stringify","type","getSocialArticles","then","res","json","setState","prevState","newActivities","forEach","article","push","comments","contents","parse","createdAt","activities","concat","loading","hasMore","length","onScroll","e","window","innerHeight","pageYOffset","document","body","offsetHeight","pageLength","onClickCategory","category","history","onClickWrite","isBlocked","darkmode","mobileFullscreen","onSearchKeyDown","keyword","target","value","keyCode","onAddKeyword","sendGTMEvent","onDeleteKeyword","indexOf","onChangeKeyword","index","splice","onResetKeyword","total","onClickArticleTag","tag","onClickArticleDelete","onClickArticleSubscribe","user","lastLikeTime","Date","getTime","intl","formatMessage","id","subscribeInfo","isSubscribed","emails","includes","unsubscribe","subscribe","categories","match","params","addEventListener","replace","removeEventListener"],"mappings":"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","sourcesContent":["import React, { Component } from \"react\";\nimport { connect } from \"react-redux\";\nimport { withRouter } from \"react-router-dom\";\nimport { injectIntl } from \"react-intl\";\nimport PopUp, { showPopUp } from \"../../Common/Component/PopUp\";\nimport * as request from \"../../Common/Util/HTTPRequest\";\nimport * as TrackingUtil from \"../../Common/Util/TrackingUtil\";\nimport { dateFormatter } from \"./Util/DateFormatter\";\nimport SignIn from \"../../Common/Component/SignIn\";\nimport View from \"./View\";\nimport checkBlockedUser from \"../../Common/Util/CheckBlockedUser\";\nimport { withSubscribe } from \"../../Common/Util/Subscribe\";\nimport { filterBlindedCommentsFromArticle } from \"../../Common/Util/Comments\";\n\nclass Container extends Component {\n  constructor(props) {\n    super(props);\n    this.categories = [\"recent\", \"trend\"];\n    this.pageLength = 5;\n    this.state = {\n      currentCategory: props.match.params.category || this.categories[0],\n      keywords: [],\n      activities: [],\n      offset: 0,\n      limit: this.pageLength,\n      loading: false,\n      hasMore: true\n    };\n  }\n  componentDidMount() {\n    window.addEventListener(\"scroll\", this.onScroll);\n    if (this.props.match.params.category) {\n      // TrackingUtil.sendPageEvent(\n      //   this.props.location.pathname,\n      //   this.props.email\n      // );\n      this.getActivities();\n    } else {\n      this.props.history.replace(`/social/${this.categories[0]}`);\n      this.getActivities();\n    }\n  }\n  componentWillUnmount() {\n    window.removeEventListener(\"scroll\", this.onScroll);\n  }\n  componentDidUpdate() {\n    const currentCategory = this.props.match.params.category;\n    if (currentCategory !== this.state.currentCategory) {\n      // TrackingUtil.sendPageEvent(\n      //   this.props.location.pathname,\n      //   this.props.email\n      // );\n      this.setState(\n        {\n          currentCategory,\n          keywords: [],\n          activities: [],\n          offset: 0,\n          limit: this.pageLength,\n          loading: false\n        },\n        () => {\n          this.getActivities();\n        }\n      );\n    }\n  }\n\n  // request\n  getActivities = () => {\n    const { keywords, offset, limit, currentCategory } = this.state;\n    const param = {\n      email: this.props.userinfo.email,\n      offset,\n      limit,\n      keywords: JSON.stringify(keywords),\n      type: currentCategory\n    };\n    request\n      .getSocialArticles(param)\n      .then(res => res.json())\n      .then(json => {\n        this.setState(prevState => {\n          const newActivities = [];\n          json.forEach(article => {\n            try {\n              newActivities.push({\n                type: \"socialArticle\",\n                article: {\n                  ...article,\n                  comments: filterBlindedCommentsFromArticle(article.comments),\n                  contents: JSON.parse(article.contents),\n                  createdAt: dateFormatter(article.createdAt)\n                }\n              });\n            } catch {}\n          });\n          return {\n            activities: [].concat(prevState.activities, newActivities),\n            loading: false,\n            hasMore: newActivities.length > 0\n          };\n        });\n      });\n  };\n\n  // scroll\n  onScroll = e => {\n    if (\n      window.innerHeight + window.pageYOffset >=\n      document.body.offsetHeight - 1000\n    ) {\n      const { offset, hasMore, loading } = this.state;\n      if (!loading && hasMore) {\n        this.setState(\n          {\n            offset: offset + this.pageLength,\n            loading: true\n          },\n          () => {\n            this.getActivities();\n          }\n        );\n      }\n    }\n  };\n\n  // category\n  onClickCategory = category => {\n    if (category !== this.state.currentCategory) {\n      this.props.history.push(`/social/${category}`);\n    }\n  };\n\n  // write\n  onClickWrite = () => {\n    const isBlocked = checkBlockedUser(this.props.userinfo);\n    if (isBlocked) {\n      return;\n    }\n    if (this.props.userinfo.email) {\n      this.props.history.push(`/socialwrite`);\n    } else {\n      showPopUp(<SignIn />, { darkmode: true, mobileFullscreen: true });\n    }\n  };\n\n  // search\n  onSearchKeyDown = e => {\n    const { keywords } = this.state;\n    const keyword = e.target.value;\n    if (e.keyCode === 13 && keyword !== \"\") {\n      e.target.value = \"\";\n      this.onAddKeyword(keyword);\n      TrackingUtil.sendGTMEvent(\n        \"SocialSearch\",\n        \"Social - Search Terms\",\n        keyword\n      );\n    } else if (e.keyCode === 8 && keyword === \"\" && keywords.length > 0) {\n      this.onDeleteKeyword(keywords.length - 1);\n    }\n  };\n\n  // keyword\n  onAddKeyword = keyword => {\n    const { keywords } = this.state;\n    if (keywords.length <= 10 && keywords.indexOf(keyword) < 0) {\n      this.setState({ keywords: [].concat(keywords, keyword) }, () => {\n        this.onChangeKeyword();\n      });\n    }\n  };\n  onDeleteKeyword = index => {\n    const keywords = [...this.state.keywords];\n    keywords.splice(index, 1);\n    this.setState({ keywords }, () => {\n      this.onChangeKeyword();\n    });\n  };\n  onResetKeyword = () => {\n    this.setState({ keywords: [] }, () => {\n      this.onChangeKeyword();\n    });\n  };\n  onChangeKeyword = () => {\n    this.setState(\n      {\n        activities: [],\n        offset: 0,\n        limit: this.pageLength,\n        total: 0,\n        loading: true\n      },\n      () => {\n        this.getActivities();\n      }\n    );\n  };\n\n  // article\n  onClickArticleTag = tag => {\n    this.onAddKeyword(tag);\n  };\n  onClickArticleDelete = index => {\n    const activities = [...this.state.activities];\n    activities.splice(index, 1);\n    this.setState({ activities });\n  };\n  onClickArticleSubscribe = user => {\n    if (this.lastLikeTime) {\n      if (new Date().getTime() - this.lastLikeTime < 1200) {\n        this.lastLikeTime = new Date().getTime();\n        showPopUp(\n          <PopUp.OneButton\n            title={this.props.intl.formatMessage({\n              id: \"ID_POPUP_WARNING_REPEAT_CLICK_TITLE\"\n            })}\n            buttonName={this.props.intl.formatMessage({\n              id: \"ID_POPUP_WARNING_REPEAT_CLICK_BTN\"\n            })}\n          />,\n          { darkmode: true }\n        );\n        return;\n      }\n    }\n    this.lastLikeTime = new Date().getTime();\n\n    const { email } = this.props.userinfo;\n    if (email) {\n      const { subscribeInfo } = this.props;\n      const isSubscribed = subscribeInfo.emails.includes(user.email);\n      if (isSubscribed) {\n        this.props.unsubscribe(user.email);\n      } else {\n        this.props.subscribe(user.email);\n      }\n    } else {\n      showPopUp(<SignIn />, { darkmode: true, mobileFullscreen: true });\n    }\n  };\n\n  render() {\n    const { intl, userinfo, subscribeInfo } = this.props;\n    const { currentCategory, keywords, activities } = this.state;\n\n    return (\n      <View\n        intl={intl}\n        userinfo={userinfo}\n        currentCategory={currentCategory}\n        keywords={keywords}\n        activities={activities}\n        subscribeInfo={subscribeInfo}\n        categories={this.categories}\n        onClickCategory={this.onClickCategory}\n        onClickWrite={this.onClickWrite}\n        onSearchKeyDown={this.onSearchKeyDown}\n        onDeleteKeyword={this.onDeleteKeyword}\n        onResetKeyword={this.onResetKeyword}\n        onClickArticleTag={this.onClickArticleTag}\n        onClickArticleDelete={this.onClickArticleDelete}\n        onClickArticleSubscribe={this.onClickArticleSubscribe}\n      />\n    );\n  }\n}\n\nexport default connect(state => ({ userinfo: state.userinfo }))(\n  withRouter(injectIntl(withSubscribe(Container)))\n);\n"]},"metadata":{},"sourceType":"module"}