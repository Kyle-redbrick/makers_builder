{"ast":null,"code":"import _toConsumableArray from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";\nimport _slicedToArray from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";\nvar _jsxFileName = \"/Users/jimmy/Documents/Wizschool/wizlab_web2/src/Page/DreamEditor/Editor/TemplateEditor/index.js\";\nimport React, { useEffect, useState } from \"react\";\nimport { Provider, connect } from \"react-redux\";\nimport * as request from \"../../../../Common/Util/HTTPRequest\";\nimport AssetLibrary from \"../../../Builder/utils/assetLibrary\";\nimport * as projectActions from \"../../../Builder/Store/Reducer/project\";\nimport store from \"../../../Builder/Store\";\nimport Field from \"../Field\";\nimport ConditionsField from \"./ConditionsField\";\nimport SlideField from \"./SlideField\";\nimport OOBCHelper from \"./OOBCHelper\";\nimport \"./index.scss\";\n\nfunction TemplateEditor(props) {\n  useEffect(function () {\n    var parsed;\n\n    try {\n      parsed = JSON.parse(props.defaultTemplate) || createEmptyTemplate();\n    } catch (err) {\n      parsed = createEmptyTemplate();\n    }\n\n    setMissions(parsed.missions || []);\n  }, [props.defaultTemplate]);\n\n  var _useState = useState([]),\n      _useState2 = _slicedToArray(_useState, 2),\n      missions = _useState2[0],\n      setMissions = _useState2[1];\n\n  var _useState3 = useState(-1),\n      _useState4 = _slicedToArray(_useState3, 2),\n      currentMissionIndex = _useState4[0],\n      setCurrentMissionIndex = _useState4[1];\n\n  var currentMission = missions[currentMissionIndex];\n  var currentMissionNum = currentMissionIndex + 1;\n  var maxMissionIndex = missions.length - 1;\n  var maxMissionNum = maxMissionIndex + 1;\n  useEffect(function () {\n    if (missions.length > 0) {\n      if (currentMissionIndex < 0) {\n        setCurrentMissionIndex(0);\n      }\n    } else {\n      setCurrentMissionIndex(-1);\n    }\n\n    if (props.onChangeTotalMissionNum) {\n      props.onChangeTotalMissionNum(missions.length);\n    }\n  }, [missions]);\n  var isPrevEnabled = currentMissionNum > 1;\n  var isNextEnabled = currentMissionNum < maxMissionNum;\n  var isDeleteEnabled = !!currentMission;\n\n  var onClickPrev = function onClickPrev() {\n    var prevMissionIndex = currentMissionIndex - 1;\n\n    if (prevMissionIndex >= 0) {\n      setCurrentMissionIndex(prevMissionIndex);\n    }\n  };\n\n  var onClickNext = function onClickNext() {\n    var nextMissionIndex = currentMissionIndex + 1;\n\n    if (nextMissionIndex <= maxMissionIndex) {\n      setCurrentMissionIndex(nextMissionIndex);\n    }\n  };\n\n  var onClickDelete = function onClickDelete() {\n    var confirmed = window.confirm(\"미션을 삭제할까요? (저장하기 전까지 복구할 수 있어요)\");\n\n    if (confirmed) {\n      var _missions = _toConsumableArray(missions);\n\n      _missions.splice(currentMissionIndex, 1);\n\n      if (currentMissionIndex > 0) {\n        setCurrentMissionIndex(currentMissionIndex - 1);\n      } else {\n        if (_missions.length <= 0) {\n          setCurrentMissionIndex(-1);\n        }\n      }\n\n      setMissions(_missions);\n    }\n  };\n\n  var onClickAdd = function onClickAdd() {\n    var _missions = _toConsumableArray(missions);\n\n    _missions.splice(currentMissionIndex + 1, 0, createEmptyMission());\n\n    setMissions(_missions);\n    setCurrentMissionIndex(currentMissionIndex + 1);\n  };\n\n  var _useState5 = useState(\"\"),\n      _useState6 = _slicedToArray(_useState5, 2),\n      title = _useState6[0],\n      setTitle = _useState6[1];\n\n  var _useState7 = useState(\"\"),\n      _useState8 = _slicedToArray(_useState7, 2),\n      pId = _useState8[0],\n      setPId = _useState8[1];\n\n  var _useState9 = useState(\"\"),\n      _useState10 = _slicedToArray(_useState9, 2),\n      state = _useState10[0],\n      setState = _useState10[1];\n\n  var _useState11 = useState(\"\"),\n      _useState12 = _slicedToArray(_useState11, 2),\n      mediaURL = _useState12[0],\n      setMediaURL = _useState12[1];\n\n  var _useState13 = useState(\"\"),\n      _useState14 = _slicedToArray(_useState13, 2),\n      slide = _useState14[0],\n      setSlide = _useState14[1];\n\n  var _useState15 = useState([]),\n      _useState16 = _slicedToArray(_useState15, 2),\n      conditions = _useState16[0],\n      setConditions = _useState16[1];\n\n  useEffect(function () {\n    if (currentMission) {\n      setTitle(currentMission.title || \"\");\n      setPId(currentMission.pId || \"\");\n      setState(currentMission.state || \"\");\n      setSlide(currentMission.slide || \"\");\n      setConditions(currentMission.conditions || []);\n    } else {\n      setTitle(\"\");\n      setPId(\"\");\n      setState(\"\");\n      setSlide(\"\");\n      setConditions([]);\n    }\n\n    setMediaURL(\"\");\n  }, [currentMission]);\n  useEffect(function () {\n    if (currentMission) {\n      currentMission.title = title;\n      currentMission.pId = pId;\n      currentMission.state = state;\n      currentMission.slide = slide;\n      currentMission.conditions = conditions;\n    }\n  }, [title, pId, state, slide, conditions]);\n  useEffect(function () {\n    if (state) {\n      try {\n        var parsedState = JSON.parse(state);\n        AssetLibrary.loadAssetsFromScene(parsedState.scene, function () {\n          props.setProject({\n            state: parsedState\n          });\n        });\n      } catch (err) {}\n    }\n  }, [state]);\n\n  var onClickLoadDevelopingProject = function onClickLoadDevelopingProject() {\n    request.getDevelopingProject({\n      pId: pId\n    }).then(function (res) {\n      return res.json();\n    }).then(function (developingProject) {\n      setState(developingProject.state);\n    });\n  };\n\n  if (props.onChangeTemplate) {\n    useEffect(function () {\n      var parsed = {\n        missions: missions\n      };\n      var template = JSON.stringify(parsed);\n      props.onChangeTemplate(template);\n    }, [missions, title, pId, state, slide, conditions]);\n  }\n\n  return /*#__PURE__*/React.createElement(\"div\", {\n    className: \"dreamEditor_editor dreamEditor_editor-template\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 159,\n      columnNumber: 5\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"dreamEditor_editor-template_header\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 160,\n      columnNumber: 7\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"dreamEditor_editor-template_header_mission\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 161,\n      columnNumber: 9\n    }\n  }, currentMission ? /*#__PURE__*/React.createElement(React.Fragment, null, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"dreamEditor_editor-template_header_mission_title\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 164,\n      columnNumber: 15\n    }\n  }, currentMissionNum, \"\\uB2E8\\uACC4 \", title), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"dreamEditor_editor-template_header_mission_number\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 167,\n      columnNumber: 15\n    }\n  }, \"(\\uCD1D \", maxMissionNum, \"\\uB2E8\\uACC4)\")) : /*#__PURE__*/React.createElement(\"div\", {\n    className: \"dreamEditor_editor-template_header_mission_placeholder\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 172,\n      columnNumber: 13\n    }\n  }, \"\\uBBF8\\uC158\\uC744 \\uCD94\\uAC00\\uD574\\uC8FC\\uC138\\uC694\")), /*#__PURE__*/React.createElement(\"button\", {\n    className: \"dreamEditor_editor-template_header_menu dreamEditor_editor-template_header_menu-delete\",\n    disabled: !isDeleteEnabled,\n    onClick: onClickDelete,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 177,\n      columnNumber: 9\n    }\n  }, \"\\uC0AD\\uC81C\"), /*#__PURE__*/React.createElement(\"button\", {\n    className: \"dreamEditor_editor-template_header_menu dreamEditor_editor-template_header_menu-add\",\n    onClick: onClickAdd,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 184,\n      columnNumber: 9\n    }\n  }, \"\\uCD94\\uAC00\"), /*#__PURE__*/React.createElement(\"button\", {\n    className: \"dreamEditor_editor-template_header_menu dreamEditor_editor-template_header_menu-prev\",\n    disabled: !isPrevEnabled,\n    onClick: onClickPrev,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 190,\n      columnNumber: 9\n    }\n  }, \"< 이전\"), /*#__PURE__*/React.createElement(\"button\", {\n    className: \"dreamEditor_editor-template_header_menu dreamEditor_editor-template_header_menu-next\",\n    disabled: !isNextEnabled,\n    onClick: onClickNext,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 197,\n      columnNumber: 9\n    }\n  }, \"다음 >\")), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"dreamEditor_editor-template_body\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 205,\n      columnNumber: 7\n    }\n  }, currentMission && /*#__PURE__*/React.createElement(React.Fragment, null, /*#__PURE__*/React.createElement(Field.Input, {\n    id: \"title\",\n    title: \"\\uBBF8\\uC158 \\uC81C\\uBAA9\",\n    value: title,\n    onChange: setTitle,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 208,\n      columnNumber: 13\n    }\n  }), /*#__PURE__*/React.createElement(Field.Input, {\n    id: \"pId\",\n    title: \"\\uD15C\\uD50C\\uB9BF pId\",\n    value: pId,\n    onChange: setPId,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 214,\n      columnNumber: 13\n    }\n  }, /*#__PURE__*/React.createElement(\"button\", {\n    onClick: onClickLoadDevelopingProject,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 220,\n      columnNumber: 15\n    }\n  }, \"\\uD504\\uB85C\\uC81D\\uD2B8 \\uBD88\\uB7EC\\uC624\\uAE30\")), /*#__PURE__*/React.createElement(Field.Textarea, {\n    id: \"state\",\n    title: \"\\uD15C\\uD50C\\uB9BF state\",\n    value: state,\n    onChange: setState,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 224,\n      columnNumber: 13\n    }\n  }), /*#__PURE__*/React.createElement(Field.File, {\n    id: \"mediaURL\",\n    title: \"\\uC5C5\\uB85C\\uB4DC\\uD558\\uAE30\",\n    value: mediaURL,\n    comment: \"* \\uC5C5\\uB85C\\uB4DC\\uD574\\uC11C \\uB098\\uC624\\uB294 URL\\uC744 \\uBCF5\\uC0AC\\uD574\\uC11C \\uB9C8\\uD06C\\uB2E4\\uC6B4\\uC5D0 \\uC785\\uB825\\uD574\\uC8FC\\uC138\\uC694\",\n    onChange: setMediaURL,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 230,\n      columnNumber: 13\n    }\n  }), /*#__PURE__*/React.createElement(SlideField, {\n    id: \"slide\",\n    title: \"\\uC2AC\\uB77C\\uC774\\uB4DC\",\n    value: slide,\n    onChange: setSlide,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 237,\n      columnNumber: 13\n    }\n  }), /*#__PURE__*/React.createElement(OOBCHelper, {\n    id: \"oobc\",\n    title: \"OOBC \\uCEE8\\uD14D\\uC2A4\\uD2B8 \\uC791\\uC131 \\uB3C4\\uC6B0\\uBBF8\",\n    comment: \"OOBC\\uB85C \\uCF54\\uB529\\uD55C \\uD6C4\\uC5D0 \\uCEE8\\uD14D\\uC2A4\\uD2B8\\uB97C \\uBCF5\\uC0AC\\uD574\\uC11C \\uC2AC\\uB77C\\uC774\\uB4DC \\uB9C8\\uD06C\\uB2E4\\uC6B4\\uC5D0 \\uBD99\\uC5EC\\uB123\\uC5B4\\uC8FC\\uC138\\uC694\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 243,\n      columnNumber: 13\n    }\n  }), /*#__PURE__*/React.createElement(ConditionsField, {\n    id: \"conditions\",\n    title: \"\\uC131\\uACF5\\uC870\\uAC74\",\n    value: conditions,\n    onChange: setConditions,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 248,\n      columnNumber: 13\n    }\n  }))));\n}\n\nfunction withProvider(Component) {\n  return function (props) {\n    return /*#__PURE__*/React.createElement(Provider, {\n      store: store,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 264,\n        columnNumber: 7\n      }\n    }, /*#__PURE__*/React.createElement(Component, Object.assign({}, props, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 265,\n        columnNumber: 9\n      }\n    })));\n  };\n}\n\nexport default withProvider(connect(function (state) {\n  return {\n    scene: state.scene\n  };\n}, {\n  setProject: projectActions.setProject\n})(TemplateEditor));\n\nfunction createEmptyMission() {\n  return {\n    title: \"\",\n    slide: \"\",\n    pId: \"\",\n    state: \"\",\n    conditions: []\n  };\n}\n\nfunction createEmptyTemplate() {\n  return {\n    missions: [createEmptyMission()]\n  };\n}","map":{"version":3,"sources":["/Users/jimmy/Documents/Wizschool/wizlab_web2/src/Page/DreamEditor/Editor/TemplateEditor/index.js"],"names":["React","useEffect","useState","Provider","connect","request","AssetLibrary","projectActions","store","Field","ConditionsField","SlideField","OOBCHelper","TemplateEditor","props","parsed","JSON","parse","defaultTemplate","createEmptyTemplate","err","setMissions","missions","currentMissionIndex","setCurrentMissionIndex","currentMission","currentMissionNum","maxMissionIndex","length","maxMissionNum","onChangeTotalMissionNum","isPrevEnabled","isNextEnabled","isDeleteEnabled","onClickPrev","prevMissionIndex","onClickNext","nextMissionIndex","onClickDelete","confirmed","window","confirm","_missions","splice","onClickAdd","createEmptyMission","title","setTitle","pId","setPId","state","setState","mediaURL","setMediaURL","slide","setSlide","conditions","setConditions","parsedState","loadAssetsFromScene","scene","setProject","onClickLoadDevelopingProject","getDevelopingProject","then","res","json","developingProject","onChangeTemplate","template","stringify","withProvider","Component"],"mappings":"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","sourcesContent":["import React, { useEffect, useState } from \"react\";\nimport { Provider, connect } from \"react-redux\";\nimport * as request from \"../../../../Common/Util/HTTPRequest\";\nimport AssetLibrary from \"../../../Builder/utils/assetLibrary\";\nimport * as projectActions from \"../../../Builder/Store/Reducer/project\";\nimport store from \"../../../Builder/Store\";\nimport Field from \"../Field\";\nimport ConditionsField from \"./ConditionsField\";\nimport SlideField from \"./SlideField\";\nimport OOBCHelper from \"./OOBCHelper\"\nimport \"./index.scss\";\n\nfunction TemplateEditor(props) {\n  useEffect(\n    () => {\n      let parsed;\n      try {\n        parsed = JSON.parse(props.defaultTemplate) || createEmptyTemplate();\n      } catch (err) {\n        parsed = createEmptyTemplate();\n      }\n      setMissions(parsed.missions || []);\n    },\n    [props.defaultTemplate]\n  );\n\n  const [missions, setMissions] = useState([]);\n  const [currentMissionIndex, setCurrentMissionIndex] = useState(-1);\n  const currentMission = missions[currentMissionIndex];\n  const currentMissionNum = currentMissionIndex + 1;\n  const maxMissionIndex = missions.length - 1;\n  const maxMissionNum = maxMissionIndex + 1;\n  useEffect(\n    () => {\n      if (missions.length > 0) {\n        if (currentMissionIndex < 0) {\n          setCurrentMissionIndex(0);\n        }\n      } else {\n        setCurrentMissionIndex(-1);\n      }\n      if (props.onChangeTotalMissionNum) {\n        props.onChangeTotalMissionNum(missions.length);\n      }\n    },\n    [missions]\n  );\n\n  const isPrevEnabled = currentMissionNum > 1;\n  const isNextEnabled = currentMissionNum < maxMissionNum;\n  const isDeleteEnabled = !!currentMission;\n  const onClickPrev = () => {\n    const prevMissionIndex = currentMissionIndex - 1;\n    if (prevMissionIndex >= 0) {\n      setCurrentMissionIndex(prevMissionIndex);\n    }\n  };\n  const onClickNext = () => {\n    const nextMissionIndex = currentMissionIndex + 1;\n    if (nextMissionIndex <= maxMissionIndex) {\n      setCurrentMissionIndex(nextMissionIndex);\n    }\n  };\n  const onClickDelete = () => {\n    const confirmed = window.confirm(\n      \"미션을 삭제할까요? (저장하기 전까지 복구할 수 있어요)\"\n    );\n    if (confirmed) {\n      const _missions = [...missions];\n      _missions.splice(currentMissionIndex, 1);\n      if (currentMissionIndex > 0) {\n        setCurrentMissionIndex(currentMissionIndex - 1);\n      } else {\n        if (_missions.length <= 0) {\n          setCurrentMissionIndex(-1);\n        }\n      }\n      setMissions(_missions);\n    }\n  };\n  const onClickAdd = () => {\n    const _missions = [...missions];\n    _missions.splice(currentMissionIndex + 1, 0, createEmptyMission());\n    setMissions(_missions);\n    setCurrentMissionIndex(currentMissionIndex + 1);\n  };\n\n  const [title, setTitle] = useState(\"\");\n  const [pId, setPId] = useState(\"\");\n  const [state, setState] = useState(\"\");\n  const [mediaURL, setMediaURL] = useState(\"\");\n  const [slide, setSlide] = useState(\"\");\n  const [conditions, setConditions] = useState([]);\n  useEffect(\n    () => {\n      if (currentMission) {\n        setTitle(currentMission.title || \"\");\n        setPId(currentMission.pId || \"\");\n        setState(currentMission.state || \"\");\n        setSlide(currentMission.slide || \"\");\n        setConditions(currentMission.conditions || []);\n      } else {\n        setTitle(\"\");\n        setPId(\"\");\n        setState(\"\");\n        setSlide(\"\");\n        setConditions([]);\n      }\n      setMediaURL(\"\");\n    },\n    [currentMission]\n  );\n  useEffect(\n    () => {\n      if (currentMission) {\n        currentMission.title = title;\n        currentMission.pId = pId;\n        currentMission.state = state;\n        currentMission.slide = slide;\n        currentMission.conditions = conditions;\n      }\n    },\n    [title, pId, state, slide, conditions]\n  );\n  useEffect(\n    () => {\n      if (state) {\n        try {\n          const parsedState = JSON.parse(state);\n          AssetLibrary.loadAssetsFromScene(parsedState.scene, () => {\n            props.setProject({ state: parsedState });\n          });\n        } catch (err) {}\n      }\n    },\n    [state]\n  );\n  const onClickLoadDevelopingProject = () => {\n    request\n      .getDevelopingProject({ pId })\n      .then(res => res.json())\n      .then(developingProject => {\n        setState(developingProject.state);\n      });\n  };\n\n  if (props.onChangeTemplate) {\n    useEffect(\n      () => {\n        const parsed = { missions };\n        const template = JSON.stringify(parsed);\n        props.onChangeTemplate(template);\n      },\n      [missions, title, pId, state, slide, conditions]\n    );\n  }\n\n  return (\n    <div className=\"dreamEditor_editor dreamEditor_editor-template\">\n      <div className=\"dreamEditor_editor-template_header\">\n        <div className=\"dreamEditor_editor-template_header_mission\">\n          {currentMission ? (\n            <>\n              <div className=\"dreamEditor_editor-template_header_mission_title\">\n                {currentMissionNum}단계 {title}\n              </div>\n              <div className=\"dreamEditor_editor-template_header_mission_number\">\n                (총 {maxMissionNum}단계)\n              </div>\n            </>\n          ) : (\n            <div className=\"dreamEditor_editor-template_header_mission_placeholder\">\n              미션을 추가해주세요\n            </div>\n          )}\n        </div>\n        <button\n          className=\"dreamEditor_editor-template_header_menu dreamEditor_editor-template_header_menu-delete\"\n          disabled={!isDeleteEnabled}\n          onClick={onClickDelete}\n        >\n          삭제\n        </button>\n        <button\n          className=\"dreamEditor_editor-template_header_menu dreamEditor_editor-template_header_menu-add\"\n          onClick={onClickAdd}\n        >\n          추가\n        </button>\n        <button\n          className=\"dreamEditor_editor-template_header_menu dreamEditor_editor-template_header_menu-prev\"\n          disabled={!isPrevEnabled}\n          onClick={onClickPrev}\n        >\n          {\"< 이전\"}\n        </button>\n        <button\n          className=\"dreamEditor_editor-template_header_menu dreamEditor_editor-template_header_menu-next\"\n          disabled={!isNextEnabled}\n          onClick={onClickNext}\n        >\n          {\"다음 >\"}\n        </button>\n      </div>\n      <div className=\"dreamEditor_editor-template_body\">\n        {currentMission && (\n          <>\n            <Field.Input\n              id=\"title\"\n              title=\"미션 제목\"\n              value={title}\n              onChange={setTitle}\n            />\n            <Field.Input\n              id=\"pId\"\n              title=\"템플릿 pId\"\n              value={pId}\n              onChange={setPId}\n            >\n              <button onClick={onClickLoadDevelopingProject}>\n                프로젝트 불러오기\n              </button>\n            </Field.Input>\n            <Field.Textarea\n              id=\"state\"\n              title=\"템플릿 state\"\n              value={state}\n              onChange={setState}\n            />\n            <Field.File\n              id=\"mediaURL\"\n              title=\"업로드하기\"\n              value={mediaURL}\n              comment=\"* 업로드해서 나오는 URL을 복사해서 마크다운에 입력해주세요\"\n              onChange={setMediaURL}\n            />\n            <SlideField\n              id=\"slide\"\n              title=\"슬라이드\"\n              value={slide}\n              onChange={setSlide}\n            />\n            <OOBCHelper \n              id=\"oobc\"\n              title=\"OOBC 컨텍스트 작성 도우미\"\n              comment=\"OOBC로 코딩한 후에 컨텍스트를 복사해서 슬라이드 마크다운에 붙여넣어주세요\"\n            />\n            <ConditionsField\n              id=\"conditions\"\n              title=\"성공조건\"\n              value={conditions}\n              onChange={setConditions}\n            />\n          </>\n        )}\n      </div>\n    </div>\n  );\n}\n\nfunction withProvider(Component) {\n  return function(props) {\n    return (\n      <Provider store={store}>\n        <Component {...props} />\n      </Provider>\n    );\n  };\n}\nexport default withProvider(\n  connect(\n    state => ({ scene: state.scene }),\n    { setProject: projectActions.setProject }\n  )(TemplateEditor)\n);\n\nfunction createEmptyMission() {\n  return {\n    title: \"\",\n    slide: \"\",\n    pId: \"\",\n    state: \"\",\n    conditions: []\n  };\n}\nfunction createEmptyTemplate() {\n  return {\n    missions: [createEmptyMission()]\n  };\n}\n"]},"metadata":{},"sourceType":"module"}