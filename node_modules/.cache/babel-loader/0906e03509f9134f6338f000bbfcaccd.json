{"ast":null,"code":"import _regeneratorRuntime from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _defineProperty from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/defineProperty\";\nimport _classCallCheck from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";\nimport _assertThisInitialized from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/assertThisInitialized\";\nimport _inherits from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";\nimport _possibleConstructorReturn from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";\nvar _jsxFileName = \"/Users/jimmy/Documents/Wizschool/wizlab_web2/src/Page/Mypage/Components/NameSetting/index.js\";\n\nfunction _createSuper(Derived) { var hasNativeReflectConstruct = _isNativeReflectConstruct(); return function _createSuperInternal() { var Super = _getPrototypeOf(Derived), result; if (hasNativeReflectConstruct) { var NewTarget = _getPrototypeOf(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return _possibleConstructorReturn(this, result); }; }\n\nfunction _isNativeReflectConstruct() { if (typeof Reflect === \"undefined\" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === \"function\") return true; try { Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {})); return true; } catch (e) { return false; } }\n\nimport React from \"react\";\nimport { connect } from \"react-redux\";\nimport { injectIntl } from \"react-intl\";\nimport { ImageCompressor } from \"../../../../Common/Util/FileCompressor\";\nimport Popup, { showPopUp } from \"../../../../Common/Component/PopUp\";\nimport * as userInfoActions from \"../../../../Common/Store/Reducer/UserInfo\";\nimport * as request from \"../../../../Common/Util/HTTPRequest\";\nimport View from \"./View\";\n\nvar Container = /*#__PURE__*/function (_React$Component) {\n  _inherits(Container, _React$Component);\n\n  var _super = _createSuper(Container);\n\n  function Container(props) {\n    var _this;\n\n    _classCallCheck(this, Container);\n\n    _this = _super.call(this, props);\n\n    _this.handleOnChange = function (e) {\n      _this.setState(_defineProperty({}, e.target.name, e.target.value));\n    };\n\n    _this.isValid = function (value) {\n      if (value && value.length > 0) {\n        return true;\n      } else {\n        return false;\n      }\n    };\n\n    _this.getChangedData = function () {\n      var _this$state = _this.state,\n          name = _this$state.name,\n          icon = _this$state.icon,\n          statusMessage = _this$state.statusMessage;\n      var userinfo = _this.props.userinfo;\n      var changedData = {};\n      if (name !== userinfo.name) changedData.name = name;\n      if (icon !== userinfo.icon) changedData.icon = icon;\n      if (statusMessage !== userinfo.statusMessage) changedData.statusMessage = statusMessage;\n      return changedData;\n    };\n\n    _this.handleOnClickFileUpload = function () {\n      _this.fileInputRef.current.click();\n    };\n\n    _this.handleOnFileChange = /*#__PURE__*/function () {\n      var _ref = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(e) {\n        var selectedFile, compressed, data, response, json, icon;\n        return _regeneratorRuntime.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                selectedFile = e.target.files[0];\n\n                if (selectedFile) {\n                  _context.next = 3;\n                  break;\n                }\n\n                return _context.abrupt(\"return\");\n\n              case 3:\n                _context.next = 5;\n                return ImageCompressor(selectedFile);\n\n              case 5:\n                compressed = _context.sent;\n                data = new FormData();\n                data.append(\"file\", compressed);\n                _context.prev = 8;\n                _context.next = 11;\n                return request.upload(data);\n\n              case 11:\n                response = _context.sent;\n                _context.next = 14;\n                return response.json();\n\n              case 14:\n                json = _context.sent;\n                icon = json.url;\n\n                _this.setState({\n                  icon: icon\n                });\n\n                _context.next = 22;\n                break;\n\n              case 19:\n                _context.prev = 19;\n                _context.t0 = _context[\"catch\"](8);\n                console.error(_context.t0);\n\n              case 22:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee, null, [[8, 19]]);\n      }));\n\n      return function (_x) {\n        return _ref.apply(this, arguments);\n      };\n    }();\n\n    _this.handleSubmit = function (e) {\n      var changedData = _this.getChangedData();\n\n      request.updateUserInfo(changedData).then(function () {\n        _this.props.updateUserInfo(changedData);\n\n        showPopUp( /*#__PURE__*/React.createElement(Popup.OneButton, {\n          titleId: \"ID_SETTING_ALERT_TITLE_SUCC\",\n          subtitleId: \"ID_SETTING_ALERT_PROFILE_SUCC\",\n          buttonNameId: \"ID_SETTING_ALERT_CLOSEBTN\",\n          intl: _this.props.intl,\n          __self: _assertThisInitialized(_this),\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 72,\n            columnNumber: 11\n          }\n        }), {\n          darkmode: true,\n          defaultPadding: true\n        });\n      }).catch(function (e) {\n        return console.error(e);\n      });\n    };\n\n    _this.state = {\n      name: props.userinfo.name,\n      icon: props.userinfo.icon,\n      statusMessage: props.userinfo.statusMessage\n    };\n    _this.fileInputRef = React.createRef();\n    return _this;\n  }\n\n  _createClass(Container, [{\n    key: \"render\",\n    value: function render() {\n      var _this$state2 = this.state,\n          name = _this$state2.name,\n          icon = _this$state2.icon,\n          statusMessage = _this$state2.statusMessage;\n      var handleOnChange = this.handleOnChange,\n          handleSubmit = this.handleSubmit,\n          handleOnFileChange = this.handleOnFileChange,\n          handleOnClickFileUpload = this.handleOnClickFileUpload,\n          isValid = this.isValid,\n          getChangedData = this.getChangedData,\n          fileInputRef = this.fileInputRef;\n      var _this$props = this.props,\n          dismiss = _this$props.dismiss,\n          intl = _this$props.intl;\n      var isValidate = isValid(name); //현재는 validation check가 필요한 항목이 name이 유일함\n\n      var isDataChanged = Object.keys(getChangedData()).length > 0; //변경된 데이터가 있는지 확인\n\n      return /*#__PURE__*/React.createElement(View, {\n        intl: intl,\n        isValidate: isValidate,\n        isDataChanged: isDataChanged,\n        name: name,\n        icon: icon,\n        statusMessage: statusMessage,\n        handleOnChange: handleOnChange,\n        handleSubmit: handleSubmit,\n        handleOnFileChange: handleOnFileChange,\n        handleOnClickFileUpload: handleOnClickFileUpload,\n        dismiss: dismiss,\n        fileInputRef: fileInputRef,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 104,\n          columnNumber: 7\n        }\n      });\n    }\n  }]);\n\n  return Container;\n}(React.Component);\n\nexport default connect(function (state) {\n  return {\n    userinfo: state.userinfo\n  };\n}, {\n  updateUserInfo: userInfoActions.updateUserInfo\n})(injectIntl(Container));","map":{"version":3,"sources":["/Users/jimmy/Documents/Wizschool/wizlab_web2/src/Page/Mypage/Components/NameSetting/index.js"],"names":["React","connect","injectIntl","ImageCompressor","Popup","showPopUp","userInfoActions","request","View","Container","props","handleOnChange","e","setState","target","name","value","isValid","length","getChangedData","state","icon","statusMessage","userinfo","changedData","handleOnClickFileUpload","fileInputRef","current","click","handleOnFileChange","selectedFile","files","compressed","data","FormData","append","upload","response","json","url","console","error","handleSubmit","updateUserInfo","then","intl","darkmode","defaultPadding","catch","createRef","dismiss","isValidate","isDataChanged","Object","keys","Component"],"mappings":"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","sourcesContent":["import React from \"react\";\nimport { connect } from \"react-redux\";\nimport { injectIntl } from \"react-intl\";\nimport { ImageCompressor } from \"../../../../Common/Util/FileCompressor\";\nimport Popup, { showPopUp } from \"../../../../Common/Component/PopUp\";\nimport * as userInfoActions from \"../../../../Common/Store/Reducer/UserInfo\";\nimport * as request from \"../../../../Common/Util/HTTPRequest\";\nimport View from \"./View\";\n\nclass Container extends React.Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      name: props.userinfo.name,\n      icon: props.userinfo.icon,\n      statusMessage: props.userinfo.statusMessage\n    }\n    this.fileInputRef = React.createRef();\n  }\n\n  handleOnChange = e => {\n    this.setState({[e.target.name]: e.target.value });\n  }\n\n  isValid = value => {\n    if (value && value.length>0) {\n      return true;\n    } else {\n      return false;\n    }\n  }\n\n  getChangedData = () => {\n    const { name, icon, statusMessage } = this.state;\n    const { userinfo } = this.props;\n    const changedData = {};\n    if(name !== userinfo.name) changedData.name = name;\n    if(icon !== userinfo.icon) changedData.icon = icon;\n    if(statusMessage !== userinfo.statusMessage) changedData.statusMessage = statusMessage;\n\n    return changedData;\n  }\n\n  handleOnClickFileUpload = () => {\n    this.fileInputRef.current.click();\n  }\n\n  handleOnFileChange = async e => {\n    const selectedFile = e.target.files[0];\n    if (!selectedFile) return;\n    const compressed = await ImageCompressor(selectedFile);\n    \n    const data = new FormData();\n    data.append(\"file\", compressed);\n\n    try{\n      const response = await request.upload(data);\n      const json = await response.json();\n      const icon = json.url;\n      this.setState({icon: icon});\n    }catch(e){\n      console.error(e);\n    }\n  }\n\n  handleSubmit = e => {\n    const changedData = this.getChangedData();\n    request.updateUserInfo(changedData)\n      .then(()=>{\n        this.props.updateUserInfo(changedData);\n        showPopUp(\n          <Popup.OneButton\n            titleId=\"ID_SETTING_ALERT_TITLE_SUCC\"\n            subtitleId=\"ID_SETTING_ALERT_PROFILE_SUCC\"\n            buttonNameId=\"ID_SETTING_ALERT_CLOSEBTN\"\n            intl={this.props.intl}\n          />,\n          { darkmode: true, defaultPadding: true }\n        );\n      })\n      .catch(e=>console.error(e));\n  }\n\n  render() {\n    const {\n      name,\n      icon,\n      statusMessage\n    } = this.state;\n    const {\n      handleOnChange,\n      handleSubmit,\n      handleOnFileChange,\n      handleOnClickFileUpload,\n      isValid,\n      getChangedData,\n      fileInputRef\n    } = this;\n    const { dismiss, intl } = this.props;\n    const isValidate = isValid(name); //현재는 validation check가 필요한 항목이 name이 유일함\n    const isDataChanged = Object.keys(getChangedData()).length > 0; //변경된 데이터가 있는지 확인\n\n    return (\n      <View\n        intl={intl}\n        isValidate={isValidate}\n        isDataChanged={isDataChanged}\n        name={name}\n        icon={icon}\n        statusMessage={statusMessage}\n        handleOnChange={handleOnChange}\n        handleSubmit={handleSubmit}\n        handleOnFileChange={handleOnFileChange}\n        handleOnClickFileUpload={handleOnClickFileUpload}\n        dismiss={dismiss}\n        fileInputRef={fileInputRef}\n      />\n    );\n  }\n}\n\nexport default connect(\n  state => ({ userinfo: state.userinfo }),\n  { updateUserInfo: userInfoActions.updateUserInfo }\n)(injectIntl(Container));\n"]},"metadata":{},"sourceType":"module"}