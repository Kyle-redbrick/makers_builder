{"ast":null,"code":"import _regeneratorRuntime from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _classCallCheck from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";\nimport _inherits from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";\nimport _possibleConstructorReturn from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";\nvar _jsxFileName = \"/Users/jimmy/Documents/Wizschool/wizlab_web2/src/Common/Component/QuillEditor/index.js\";\n\nfunction _createSuper(Derived) { var hasNativeReflectConstruct = _isNativeReflectConstruct(); return function _createSuperInternal() { var Super = _getPrototypeOf(Derived), result; if (hasNativeReflectConstruct) { var NewTarget = _getPrototypeOf(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return _possibleConstructorReturn(this, result); }; }\n\nfunction _isNativeReflectConstruct() { if (typeof Reflect === \"undefined\" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === \"function\") return true; try { Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {})); return true; } catch (e) { return false; } }\n\nimport React from \"react\";\nimport ReactQuill from 'react-quill';\nimport { ImageCompressor } from \"../../Util/FileCompressor\";\nimport * as request from \"../../Util/HTTPRequest\";\nimport 'react-quill/dist/quill.snow.css';\nimport \"./index.scss\";\n\nvar QuillEditor = /*#__PURE__*/function (_React$Component) {\n  _inherits(QuillEditor, _React$Component);\n\n  var _super = _createSuper(QuillEditor);\n\n  function QuillEditor(props) {\n    var _this;\n\n    _classCallCheck(this, QuillEditor);\n\n    _this = _super.call(this, props);\n\n    _this.onClickAddImage = function () {\n      var imgInput = _this.createImageInput();\n\n      imgInput.onchange = /*#__PURE__*/function () {\n        var _ref = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(e) {\n          var url;\n          return _regeneratorRuntime.wrap(function _callee$(_context) {\n            while (1) {\n              switch (_context.prev = _context.next) {\n                case 0:\n                  _context.next = 2;\n                  return _this.uploadImage(e.currentTarget.files[0]);\n\n                case 2:\n                  url = _context.sent;\n\n                  _this.insertImage(url);\n\n                case 4:\n                case \"end\":\n                  return _context.stop();\n              }\n            }\n          }, _callee);\n        }));\n\n        return function (_x) {\n          return _ref.apply(this, arguments);\n        };\n      }();\n\n      imgInput.click();\n    };\n\n    _this.quillRef = React.createRef();\n    _this.modules = {\n      toolbar: {\n        container: [[{\n          header: [\"1\", \"2\", \"3\", false]\n        }], [\"bold\", \"italic\", \"underline\", \"link\"], [{\n          list: \"ordered\"\n        }, {\n          list: \"bullet\"\n        }], [\"image\"]],\n        handlers: {\n          image: _this.onClickAddImage\n        }\n      }\n    };\n    return _this;\n  }\n\n  _createClass(QuillEditor, [{\n    key: \"createImageInput\",\n    value: function createImageInput() {\n      var input = document.createElement(\"input\");\n      input.setAttribute(\"type\", \"file\");\n      input.setAttribute(\"accept\", \".jpeg, .jpg, .png\");\n      return input;\n    }\n  }, {\n    key: \"uploadImage\",\n    value: function () {\n      var _uploadImage = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2(image) {\n        var compressed, formData, url;\n        return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n          while (1) {\n            switch (_context2.prev = _context2.next) {\n              case 0:\n                _context2.next = 2;\n                return ImageCompressor(image);\n\n              case 2:\n                compressed = _context2.sent;\n                formData = new FormData();\n                formData.append(\"file\", compressed);\n                _context2.next = 7;\n                return request.upload(formData).then(function (res) {\n                  return res.json();\n                }).then(function (json) {\n                  return json.url;\n                }).catch(function (err) {\n                  console.error(err);\n                });\n\n              case 7:\n                url = _context2.sent;\n                return _context2.abrupt(\"return\", url);\n\n              case 9:\n              case \"end\":\n                return _context2.stop();\n            }\n          }\n        }, _callee2);\n      }));\n\n      function uploadImage(_x2) {\n        return _uploadImage.apply(this, arguments);\n      }\n\n      return uploadImage;\n    }()\n  }, {\n    key: \"insertImage\",\n    value: function insertImage(url) {\n      var range = this.quillEditor.getSelection(true);\n      this.quillEditor.insertEmbed(range.index, \"image\", url, \"user\");\n      this.quillEditor.setSelection(range.index + 1);\n    }\n  }, {\n    key: \"quillEditor\",\n    get: function get() {\n      return this.quillRef.current.editor;\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      return /*#__PURE__*/React.createElement(ReactQuill, {\n        ref: this.quillRef,\n        modules: this.modules,\n        name: this.props.name,\n        placeholder: this.props.placeholder,\n        value: this.props.value,\n        onChange: this.props.onChange,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 65,\n          columnNumber: 7\n        }\n      });\n    }\n  }]);\n\n  return QuillEditor;\n}(React.Component);\n\nexport default QuillEditor;","map":{"version":3,"sources":["/Users/jimmy/Documents/Wizschool/wizlab_web2/src/Common/Component/QuillEditor/index.js"],"names":["React","ReactQuill","ImageCompressor","request","QuillEditor","props","onClickAddImage","imgInput","createImageInput","onchange","e","uploadImage","currentTarget","files","url","insertImage","click","quillRef","createRef","modules","toolbar","container","header","list","handlers","image","input","document","createElement","setAttribute","compressed","formData","FormData","append","upload","then","res","json","catch","err","console","error","range","quillEditor","getSelection","insertEmbed","index","setSelection","current","editor","name","placeholder","value","onChange","Component"],"mappings":"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","sourcesContent":["import React from \"react\";\nimport ReactQuill from 'react-quill';\nimport { ImageCompressor } from \"../../Util/FileCompressor\"\nimport * as request from \"../../Util/HTTPRequest\";\nimport 'react-quill/dist/quill.snow.css';\nimport \"./index.scss\";\n\nclass QuillEditor extends React.Component {\n  constructor(props) {\n    super(props);\n    this.quillRef = React.createRef();\n    this.modules = {\n      toolbar: {\n        container: [\n          [{ header: [\"1\", \"2\", \"3\", false] }],\n          [\"bold\", \"italic\", \"underline\", \"link\"],\n          [{ list: \"ordered\" }, { list: \"bullet\" }],\n          [\"image\"]\n        ],\n        handlers: {\n          image: this.onClickAddImage\n        }\n      }\n    }\n  }\n\n  onClickAddImage = () => {\n    const imgInput = this.createImageInput();\n    imgInput.onchange = async e => {\n      const url = await this.uploadImage(e.currentTarget.files[0]);\n      this.insertImage(url);\n    };\n    imgInput.click();\n  }\n  createImageInput() {\n    const input = document.createElement(\"input\");\n    input.setAttribute(\"type\", \"file\");\n    input.setAttribute(\"accept\", \".jpeg, .jpg, .png\");\n    return input;\n  }\n  async uploadImage(image) {\n    const compressed = await ImageCompressor(image);\n    const formData = new FormData();\n    formData.append(\"file\", compressed);\n\n    const url = await request.upload(formData)\n      .then(res => res.json())\n      .then(json => json.url)\n      .catch(err => {\n        console.error(err);\n      });\n    return url;\n  }\n  insertImage(url) {\n    const range = this.quillEditor.getSelection(true);\n    this.quillEditor.insertEmbed(range.index, \"image\", url, \"user\");\n    this.quillEditor.setSelection(range.index + 1);\n  }\n  get quillEditor() {\n    return this.quillRef.current.editor;\n  }\n\n  render() {\n    return (\n      <ReactQuill\n        ref={this.quillRef}\n        modules={this.modules}\n        name={this.props.name}\n        placeholder={this.props.placeholder}\n        value={this.props.value}\n        onChange={this.props.onChange}\n      />\n    );\n  }\n}\n\nexport default QuillEditor;\n"]},"metadata":{},"sourceType":"module"}