{"ast":null,"code":"import _objectSpread from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread\";\nimport _toConsumableArray from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";\nimport _classCallCheck from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";\nimport _assertThisInitialized from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/assertThisInitialized\";\nimport _inherits from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";\nimport _possibleConstructorReturn from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";\nvar _jsxFileName = \"/Users/jimmy/Documents/Wizschool/wizlab_web2/src/Page/Builder/Component/Editor/Component/OOBCEditor/Container.js\";\n\nfunction _createSuper(Derived) { var hasNativeReflectConstruct = _isNativeReflectConstruct(); return function _createSuperInternal() { var Super = _getPrototypeOf(Derived), result; if (hasNativeReflectConstruct) { var NewTarget = _getPrototypeOf(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return _possibleConstructorReturn(this, result); }; }\n\nfunction _isNativeReflectConstruct() { if (typeof Reflect === \"undefined\" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === \"function\") return true; try { Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {})); return true; } catch (e) { return false; } }\n\nimport React, { Component } from \"react\";\nimport { connect } from \"react-redux\";\nimport { injectIntl } from \"react-intl\";\nimport * as sceneActions from \"../../../../Store/Reducer/scene\";\nimport * as blockActions from \"../../../../Store/Reducer/block\";\nimport * as previewActions from \"../../../../Store/Reducer/preview\";\nimport * as interactionActions from \"../../../../Store/Reducer/interaction\";\nimport { PAGETYPE } from \"../../../../../../Common/Util/Constant\";\nimport PopUp, { showPopUp } from \"../../../../../../Common/Component/PopUp\";\nimport AssetLibrary from \"../../../../utils/assetLibrary\";\nimport { Context, Line, Block } from \"./Class\";\nimport { BLOCK, DATA, MODE } from \"./Util/Type\";\nimport Actions from \"./Util/Action\";\nimport Properties from \"./Util/Property\";\nimport Operators from \"./Util/Operator\";\nimport Utils from \"./Util/Util\";\nimport NumberEditor from \"./Component/NumberEditor\";\nimport PositionEditor from \"./Component/PositionEditor\";\nimport StringEditor from \"./Component/StringEditor\";\nimport View from \"./View\";\n\nvar Container = /*#__PURE__*/function (_Component) {\n  _inherits(Container, _Component);\n\n  var _super = _createSuper(Container);\n\n  function Container(props) {\n    var _this;\n\n    _classCallCheck(this, Container);\n\n    _this = _super.call(this, props);\n\n    _this.updateSelectorState = function () {\n      var currentBlock = _this.state.currentBlock;\n\n      if (currentBlock) {\n        var selectorBlocks = _this.getSelectorBlocks(currentBlock);\n\n        var categories = _this.getCategoriesFrom(selectorBlocks);\n\n        _this.addVariableCategoryIfNeedFor(currentBlock, categories);\n\n        var currentCategory = _this.oobcContext.focusedCategory || categories[0];\n        selectorBlocks = selectorBlocks.filter(function (block) {\n          return block.blockType === currentCategory;\n        });\n\n        _this.setState({\n          categories: categories,\n          currentCategory: currentCategory,\n          selectorBlocks: selectorBlocks\n        });\n      } else {\n        _this.setState({\n          categories: [],\n          currentCategory: null,\n          selectorBlocks: []\n        });\n      }\n    };\n\n    _this.onClickSprite = function (sprite) {\n      var sceneId = _this.props.scene.sceneName;\n      var spriteName = sprite.preview.name;\n      var spriteType = sprite.type;\n\n      _this.props.selectSprite(sceneId, spriteName, spriteType);\n\n      _this.scrollToSprite(sprite);\n    };\n\n    _this.scrollToSprite = function (sprite) {\n      var scroller = document.getElementById(\"oobceditor_header_sprites\");\n      var element = document.getElementById(\"oobceditor_header_sprite-\".concat(sprite.preview.name));\n\n      if (scroller && element) {\n        scroller.scroll({\n          left: element.offsetLeft - (scroller.offsetWidth - element.offsetWidth * 2),\n          behavior: \"smooth\"\n        });\n      }\n    };\n\n    _this.onClickPreview = function () {\n      _this.focusBlock(null);\n\n      _this.props.onClickPreview();\n    };\n\n    _this.onClickPlay = function () {\n      _this.prevBlock = _this.state.currentBlock;\n\n      _this.setState({\n        currentBlock: undefined\n      }, function () {\n        setTimeout(function () {\n          _this.wasCurrentView = true; // this.props.removeCurrentView(VIEWTYPE.MAIN);\n          // this.props.removeCurrentView(VIEWTYPE.CODE);\n\n          _this.props.setIsPlaying(true);\n        }, _this.prevBlock ? 250 : 0);\n      });\n    };\n\n    _this.onClickContext = function () {\n      if (_this.state.currentBlock) {\n        _this.focusBlock(null);\n      }\n    };\n\n    _this.onUpdateContext = function (callback) {\n      if (_this.props.sprite) {\n        var sceneId = _this.props.scene.sceneName;\n        var spriteName = _this.props.sprite.preview.name;\n        var code = JSON.stringify(_this.oobcContext.convertToJson());\n\n        _this.props.setSpriteCode(sceneId, spriteName, code);\n      }\n\n      _this.setState({\n        lines: _this.oobcContext.getLines()\n      }, callback);\n    };\n\n    _this.onClickSelector = function () {\n      _this.scrollToBlock(_this.state.currentBlock);\n    };\n\n    _this.onClickCategory = function (category) {\n      if (category === _this.state.currentCategory) return;\n      _this.oobcContext.focusedCategory = category;\n\n      _this.onUpdateContext();\n    };\n\n    _this.onClickAddVariable = function () {\n      var formatMessage = _this.props.intl.formatMessage;\n      showPopUp( /*#__PURE__*/React.createElement(PopUp.OneInput, {\n        title: formatMessage({\n          id: \"ID_OOBC_EDITOR_ADDVAR_TITLE\"\n        }),\n        subtitle: formatMessage({\n          id: \"ID_OOBC_EDITOR_ADDVAR_SUBTITLE\"\n        }),\n        placeholder: formatMessage({\n          id: \"ID_OOBC_EDITOR_ADDVAR_PLACEHOLDER\"\n        }),\n        buttonAction: function buttonAction(value) {\n          if (!RegExp(\"^[a-zA-Z_$][a-zA-Z_$0-9]*$\").test(value)) {\n            showPopUp( /*#__PURE__*/React.createElement(PopUp.OneButton, {\n              title: formatMessage({\n                id: \"ID_OOBC_EDITOR_ADDVAR_WARN_REGEX_TITLE\"\n              }),\n              subtitle: formatMessage({\n                id: \"ID_OOBC_EDITOR_ADDVAR_WARN_REGEX_SUBTITLE\"\n              }),\n              buttonAction: _this.onClickAddVariable,\n              buttonName: formatMessage({\n                id: \"ID_BUILDER_ALERT_CONFIRMBTN\"\n              }),\n              __self: _assertThisInitialized(_this),\n              __source: {\n                fileName: _jsxFileName,\n                lineNumber: 283,\n                columnNumber: 15\n              }\n            }));\n            return;\n          }\n\n          if (_this.props.globalVariables && _this.props.globalVariables.indexOf(value) > -1) {\n            showPopUp( /*#__PURE__*/React.createElement(PopUp.OneButton, {\n              title: formatMessage({\n                id: \"ID_OOBC_EDITOR_ADDVAR_WARN_EXIST_TITLE\"\n              }),\n              subtitle: formatMessage({\n                id: \"ID_OOBC_EDITOR_ADDVAR_WARN_EXIST_SUBTITLE\"\n              }),\n              buttonAction: _this.onClickAddVariable,\n              buttonName: formatMessage({\n                id: \"ID_BUILDER_ALERT_CONFIRMBTN\"\n              }),\n              __self: _assertThisInitialized(_this),\n              __source: {\n                fileName: _jsxFileName,\n                lineNumber: 303,\n                columnNumber: 15\n              }\n            }));\n            return;\n          }\n\n          _this.props.addGlobalVariable(value);\n        },\n        __self: _assertThisInitialized(_this),\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 276,\n          columnNumber: 7\n        }\n      }));\n    };\n\n    _this.onClickSelectorClose = function () {\n      _this.focusBlock(null);\n    };\n\n    _this.showPopUpContent = function (content) {\n      _this.props.setPopupConstantOpen(true);\n\n      _this.setState({\n        popupContent: content\n      });\n    };\n\n    _this.hidePopUpContent = function () {\n      _this.props.setPopupConstantOpen(false);\n\n      _this.setState({\n        popupContent: null\n      });\n    };\n\n    _this.onClickPopupOverlay = function (e) {\n      if (e.preventDefault) e.preventDefault();\n      if (e.stopPropagation) e.stopPropagation();\n\n      _this.focusBlock(null);\n\n      _this.hidePopUpContent();\n    };\n\n    _this.onClickLine = function (line) {\n      if (_this.state.currentLine === line) {\n        _this.oobcContext.setFocusedLine(null);\n      } else {\n        _this.oobcContext.setFocusedLine(line);\n      }\n\n      _this.onUpdateContext();\n\n      _this.setState({\n        lineContextMenu: null\n      });\n    };\n\n    _this.onRightClickLine = function (line, e) {\n      var editorRect = document.getElementById(\"oobceditor\").getBoundingClientRect();\n      var contextElement = document.getElementById(\"oobceditor_context\");\n      var lineContextMenu = {\n        style: {\n          top: e.clientY - editorRect.top + contextElement.scrollTop,\n          left: e.clientX - editorRect.left + contextElement.scrollLeft\n        },\n        delete: _this.checkLineDeletable(line),\n        copy: true,\n        paste: !!_this.copiedLine,\n        add: true,\n        disable: true,\n        comment: false\n      };\n\n      _this.oobcContext.setFocusedBlock(null);\n\n      _this.oobcContext.setFocusedLine(line);\n\n      _this.onUpdateContext();\n\n      _this.setState({\n        lineContextMenu: lineContextMenu\n      });\n    };\n\n    _this.checkLineDeletable = function (line) {\n      if (line.parent instanceof Context) {\n        return line.parent.lines.length > 1;\n      } else {\n        return true;\n      }\n    };\n\n    _this.onClickFoldLine = function (line) {\n      if (line.folded) {\n        line.unfold();\n      } else {\n        line.fold();\n      }\n\n      _this.oobcContext.setFocusedLine(null);\n\n      _this.onUpdateContext();\n    };\n\n    _this.onClickDeleteLine = function (line) {\n      var formatMessage = _this.props.intl.formatMessage;\n      showPopUp( /*#__PURE__*/React.createElement(PopUp.TwoButton, {\n        title: formatMessage({\n          id: \"ID_OOBC_EDITOR_WARN_LINEDELETE_TITLE\"\n        }),\n        subtitle: formatMessage({\n          id: \"ID_OOBC_EDITOR_WARN_LINEDELETE_SUBTITLE\"\n        }),\n        cancelButtonName: formatMessage({\n          id: \"ID_OOBC_EDITOR_CANCEL\"\n        }),\n        confirmButtonName: formatMessage({\n          id: \"ID_OOBC_EDITOR_DELETE\"\n        }),\n        confirmAction: function confirmAction() {\n          _this.oobcContext.deleteLine(line);\n\n          _this.oobcContext.setFocusedLine(null);\n\n          _this.onUpdateContext();\n        },\n        __self: _assertThisInitialized(_this),\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 394,\n          columnNumber: 7\n        }\n      }));\n    };\n\n    _this.onDragLine = function (dragLine, hoverLine, dragOffset) {\n      if (_this.oobcContext.swapLine(dragLine, hoverLine)) {\n        _this.setState({\n          lines: _this.oobcContext.getLines()\n        });\n      } // const context = document.getElementById(\"oobceditor_context\");\n      // const header = document.getElementById(\"oobceditor_header\");\n      // if (dragOffset.y < header.offsetHeight + 20) {\n      //   if (!this.scrollInterval) {\n      //     this.scrollInterval = setInterval(() => {\n      //       context.scrollTo({ top: context.scrollTop - 1 });\n      //     }, 1);\n      //   }\n      // } else if (dragOffset.y > context.offsetHeight - 20) {\n      //   if (!this.scrollInterval) {\n      //     this.scrollInterval = setInterval(() => {\n      //       context.scrollTo({ top: context.scrollTop + 1 });\n      //     }, 1);\n      //   }\n      // } else {\n      //   if (this.scrollInterval) {\n      //     clearInterval(this.scrollInterval);\n      //     this.scrollInterval = undefined;\n      //   }\n      // }\n\n    };\n\n    _this.onDragBegin = function (line) {\n      _this.tempFolded = line.folded;\n      _this.tempCurrentBlock = _this.state.currentBlock;\n\n      _this.focusBlock(null);\n\n      if (!line.folded) {\n        line.folded = true;\n\n        _this.setState({\n          lines: _this.oobcContext.getLines()\n        });\n      }\n    };\n\n    _this.onDragEnd = function (line) {\n      line.folded = _this.tempFolded;\n\n      if (_this.scrollInterval) {\n        clearInterval(_this.scrollInterval);\n        _this.scrollInterval = undefined;\n      }\n\n      _this.focusBlock(_this.tempCurrentBlock);\n    };\n\n    _this.onClickLineContextMenu = function (line, contextmenu) {\n      _this.setState({\n        lineContextMenu: null\n      }, function () {\n        switch (contextmenu) {\n          case \"delete\":\n            _this.onClickDeleteLine(line);\n\n            break;\n\n          case \"copy\":\n            _this.onClickCopyLine(line);\n\n            break;\n\n          case \"paste\":\n            _this.onClickPasteLine(line);\n\n            break;\n\n          case \"add\":\n            _this.onClickAddLine(line);\n\n            break;\n\n          case \"disable\":\n            _this.onClickDisableLine(line);\n\n            break;\n\n          case \"comment\":\n            break;\n\n          default:\n            break;\n        }\n      });\n    };\n\n    _this.onClickCopyLine = function (line) {\n      _this.copiedLine = line;\n    };\n\n    _this.onClickPasteLine = function (line) {\n      if (!_this.copiedLine) return;\n      line.add(_this.copiedLine.copy());\n\n      _this.onUpdateContext();\n    };\n\n    _this.onClickAddLine = function (line) {\n      line.add(new Line());\n\n      _this.onUpdateContext();\n    };\n\n    _this.onClickDisableLine = function (line) {\n      if (line.disabled) {\n        line.enable();\n      } else {\n        line.disable();\n      }\n\n      _this.onUpdateContext();\n    };\n\n    _this.focusBlock = function (block) {\n      _this.oobcContext.setFocusedBlock(block);\n\n      _this.onUpdateContext();\n\n      _this.setState({\n        lineContextMenu: null\n      });\n    };\n\n    _this.pushBlock = function (prototypeBlock) {\n      // 현재 블록을 새로운 블록과 교체\n      var currentBlock = _this.state.currentBlock;\n      var instanceBlock = Block.createInstance({\n        prevBlock: currentBlock,\n        prototypeBlock: prototypeBlock\n      });\n      currentBlock.replaceWith(instanceBlock); // 마지막 라인의 루트 블록이면 새로운 라인을 추가\n\n      var currentLine = currentBlock.getParentLine();\n\n      if (currentLine.parent instanceof Context) {\n        if (!currentLine.getNextLine()) {\n          _this.oobcContext.addLine(new Line({\n            parent: _this.oobcContext\n          }));\n        }\n      } else {\n        if (!currentLine.getNextLine()) {\n          var newLine = new Line({\n            parent: currentLine.parent\n          });\n          currentLine.parent.data.push(newLine);\n        }\n      }\n\n      if (_this.oobcContext.checkEditableBlock(instanceBlock)) {\n        _this.oobcContext.setEditingBlock(instanceBlock);\n      } else {\n        var nextBlock = _this.findNextBlock(instanceBlock);\n\n        _this.oobcContext.setFocusedBlock(nextBlock);\n      }\n\n      _this.onUpdateContext();\n    };\n\n    _this.findNextBlock = function (block) {\n      var nextBlock = block.findEmptyBlock(); // if (!nextBlock) {\n      //   const nextLine = block.getParentLine().getNextLine();\n      //   if (nextLine) {\n      //     nextBlock = nextLine.block.findEmptyBlock();\n      //   }\n      // }\n\n      return nextBlock;\n    };\n\n    _this.scrollToBlock = function (block) {// if (!block) return;\n      // const scroller = document.getElementById(\"oobceditor_context\");\n      // const element = document.getElementById(\n      //   `oobceditor_line-${block.getParentLine().id}`\n      // );\n      // if (scroller && element) {\n      //   scroller.scroll({\n      //     top:\n      //       element.offsetTop -\n      //       (scroller.offsetHeight - element.offsetHeight) / 2 +\n      //       12,\n      //     behavior: \"smooth\"\n      //   });\n      // }\n    };\n\n    _this.onClickContextBlock = function (block) {\n      // 블록 포커싱\n      if (_this.state.currentBlock !== block) {\n        _this.focusBlock(block);\n      }\n    };\n\n    _this.onClickPrototypeBlock = function (prototypeBlock) {\n      var currentBlock = _this.state.currentBlock;\n      var formatMessage = _this.props.intl.formatMessage; // 비활성화된 블록에 대한 안내 팝업\n\n      if (prototypeBlock.disabled) {\n        var id = prototypeBlock.data.toUpperCase();\n        showPopUp( /*#__PURE__*/React.createElement(PopUp.OneButton, {\n          title: formatMessage({\n            id: \"ID_OOBC_EDITOR_WARN_TITLE\"\n          }),\n          subtitle: formatMessage({\n            id: \"ID_OOBC_EDITOR_WARN_DISABLED_BLOCK_\" + id\n          }),\n          buttonName: formatMessage({\n            id: \"ID_BUILDER_ALERT_CONFIRMBTN\"\n          }),\n          __self: _assertThisInitialized(_this),\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 574,\n            columnNumber: 9\n          }\n        }));\n        return;\n      } // 비어있지 않은 자식 블록이 있는 경우 경고 창 띄우기\n\n\n      if (currentBlock.childs && currentBlock.childs.reduce(function (prev, child) {\n        return prev || child.mode !== MODE.EMPTY;\n      }, false)) {\n        showPopUp( /*#__PURE__*/React.createElement(PopUp.TwoButton, {\n          title: formatMessage({\n            id: \"ID_OOBC_EDITOR_WARN_TITLE\"\n          }),\n          subtitle: formatMessage({\n            id: \"ID_OOBC_EDITOR_WARN_REPLACE_SUBTITLE\"\n          }),\n          cancelButtonName: formatMessage({\n            id: \"ID_OOBC_EDITOR_CANCEL\"\n          }),\n          confirmButtonName: formatMessage({\n            id: \"ID_OOBC_EDITOR_REPLACE\"\n          }),\n          confirmAction: function confirmAction() {\n            _this.pushBlock(prototypeBlock);\n          },\n          __self: _assertThisInitialized(_this),\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 595,\n            columnNumber: 9\n          }\n        }));\n        return;\n      }\n\n      _this.pushBlock(prototypeBlock);\n    };\n\n    _this.onClickConstantEdit = function (block) {\n      _this.oobcContext.setEditingBlock(block);\n\n      _this.onUpdateContext();\n    };\n\n    _this.showContantEditorFor = function (block) {\n      var editor;\n      var popupStyle = {};\n      var contextElement = document.getElementById(\"oobceditor_context\");\n      var blockElement = document.getElementById(\"oobceditor_block-\".concat(block.id));\n\n      if (contextElement && blockElement) {\n        var contextRect = contextElement.getBoundingClientRect();\n        var blockRect = blockElement.getBoundingClientRect();\n        popupStyle.top = contextElement.scrollTop + blockRect.top + blockRect.height / 2 + 12;\n        popupStyle.left = blockElement.offsetLeft - 12;\n        var maxLeft = contextRect.width - 380 - 12;\n\n        if (popupStyle.left > maxLeft && maxLeft > 12) {\n          popupStyle.left = maxLeft;\n        }\n      }\n\n      switch (block.dataType) {\n        case DATA.NUMBER:\n          editor = /*#__PURE__*/React.createElement(NumberEditor, {\n            defaultValue: block.data,\n            popupStyle: popupStyle,\n            onClickCancel: function onClickCancel() {\n              if (block.data === \"number\") {\n                block.data = 0;\n\n                _this.onUpdateContext(function () {\n                  _this.focusBlock(null);\n\n                  _this.hidePopUpContent();\n                });\n              } else {\n                _this.focusBlock(null);\n\n                _this.hidePopUpContent();\n              }\n            },\n            onClickConfirm: function onClickConfirm(num) {\n              block.data = num;\n\n              _this.onUpdateContext(function () {\n                _this.focusBlock(_this.findNextBlock(block));\n\n                _this.hidePopUpContent();\n              });\n            },\n            __self: _assertThisInitialized(_this),\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 638,\n              columnNumber: 11\n            }\n          });\n          break;\n\n        case DATA.POSITION:\n          editor = /*#__PURE__*/React.createElement(PositionEditor, {\n            defaultX: 100,\n            defaultY: 100,\n            popupStyle: popupStyle,\n            onClickCancel: function onClickCancel() {\n              _this.focusBlock(null);\n\n              _this.hidePopUpContent();\n            },\n            onClickConfirm: function onClickConfirm(x, y) {\n              block.data = {\n                x: x,\n                y: y\n              };\n\n              _this.onUpdateContext(function () {\n                _this.focusBlock(_this.findNextBlock(block));\n\n                _this.hidePopUpContent();\n              });\n            },\n            __self: _assertThisInitialized(_this),\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 665,\n              columnNumber: 11\n            }\n          });\n          break;\n\n        case DATA.STRING:\n          editor = /*#__PURE__*/React.createElement(StringEditor, {\n            defaultValue: block.data,\n            popupStyle: popupStyle,\n            onClickCancel: function onClickCancel() {\n              _this.focusBlock(null);\n\n              _this.hidePopUpContent();\n            },\n            onClickConfirm: function onClickConfirm(text) {\n              block.data = text;\n\n              _this.onUpdateContext(function () {\n                _this.focusBlock(_this.findNextBlock(block));\n\n                _this.hidePopUpContent();\n              });\n            },\n            __self: _assertThisInitialized(_this),\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 685,\n              columnNumber: 11\n            }\n          });\n          break;\n\n        default:\n          break;\n      }\n\n      if (editor) _this.showPopUpContent(editor);\n    };\n\n    _this.getPrototypeBlocks = function (block) {\n      return [].concat(_toConsumableArray(_this.getSpritePrototypes()), _toConsumableArray(_this.getVariablePrototypes()), _toConsumableArray(_this.getActionPrototypes()), _toConsumableArray(_this.getPropertyPrototypes()), _toConsumableArray(_this.getOperatorPrototypes()), _toConsumableArray(_this.getConstantPrototypes(block)), _toConsumableArray(_this.getUtilPrototypes()));\n    };\n\n    _this.getSpritePrototypes = function () {\n      var sprites = []; // 일반 스프라이트\n\n      for (var spriteId in _this.props.scene.sprites) {\n        var sprite = _this.props.scene.sprites[spriteId];\n\n        switch (sprite.type) {\n          case \"sprite\":\n          case \"text\":\n            sprites.push({\n              type: sprite.type,\n              name: spriteId\n            });\n            break;\n\n          case \"spine\":\n            sprites.push({\n              type: \"sprite\",\n              name: spriteId\n            });\n            break;\n\n          case \"component\":\n            sprites.push({\n              type: \"joystick\",\n              name: spriteId\n            });\n            break;\n\n          case \"background\":\n            sprites.push({\n              type: \"background\",\n              name: spriteId\n            });\n            break;\n\n          case \"custom\":\n            sprites.push({\n              type: \"sprite\",\n              name: spriteId\n            });\n            break;\n\n          default:\n            console.warn(\"getSpritePrototypes: unknown sprite type - \".concat(sprite.type));\n        }\n      } // 사운드\n\n\n      for (var i = 0; i < _this.props.soundIds.length; i++) {\n        var soundId = _this.props.soundIds[i];\n        var soundName = AssetLibrary.getSoundAsset(soundId).defaultName;\n        sprites.push({\n          type: \"sound\",\n          name: soundName\n        });\n      }\n\n      var sortInfor = [DATA.SCREEN, DATA.SPRITE, DATA.JOYSTICK, DATA.TEXT, DATA.SOUND];\n      sprites.sort(function (prev, next) {\n        return sortInfor.indexOf(prev.type) - sortInfor.indexOf(next.type);\n      });\n      var dataType = {\n        sprite: DATA.SPRITE,\n        text: DATA.TEXT,\n        background: DATA.SCREEN,\n        joystick: DATA.JOYSTICK,\n        sound: DATA.SOUND\n      };\n      return sprites.map(function (sprite) {\n        return Block.createPrototype({\n          blockType: BLOCK.SPRITE,\n          dataType: dataType[sprite.type],\n          data: sprite.name\n        });\n      });\n    };\n\n    _this.getVariablePrototypes = function () {\n      // 등록된 글로벌 변수의 목록 불러오기\n      return _this.props.globalVariables ? _this.props.globalVariables.map(function (variable) {\n        return Block.createPrototype({\n          blockType: BLOCK.VARIABLE,\n          dataType: DATA.ANY,\n          data: variable\n        });\n      }) : [];\n    };\n\n    _this.getActionPrototypes = function () {\n      return Actions.map(function (action) {\n        return Block.createPrototype({\n          blockType: BLOCK.ACTION,\n          parentDataTypes: action.parentDataTypes,\n          data: action.name,\n          childs: action.childs && action.childs.map(function (child) {\n            return child.blockTypes.indexOf(BLOCK.CALLBACK) > -1 ? Block.createCallback() : Block.createEmpty(_objectSpread({}, child));\n          })\n        });\n      });\n    };\n\n    _this.getPropertyPrototypes = function () {\n      return Properties.map(function (property) {\n        return Block.createPrototype({\n          blockType: BLOCK.PROPERTY,\n          parentDataTypes: property.parentDataTypes,\n          dataType: property.dataType,\n          data: property.name\n        });\n      });\n    };\n\n    _this.getOperatorPrototypes = function () {\n      return Operators.map(function (operator) {\n        return Block.createPrototype({\n          blockType: BLOCK.OPERATOR,\n          dataType: operator.dataType,\n          data: operator.name,\n          childs: operator.childs && operator.childs.map(function (child) {\n            return Block.createEmpty(_objectSpread({}, child));\n          })\n        });\n      });\n    };\n\n    _this.getConstantPrototypes = function (block) {\n      var numbers = [{\n        dataType: DATA.NUMBER,\n        data: \"number\"\n      }];\n      var strings = [{\n        dataType: DATA.STRING,\n        data: \"text\"\n      }].concat(_toConsumableArray(_this.props.customStrings.map(function (string) {\n        return {\n          dataType: DATA.STRING,\n          data: string\n        };\n      })));\n      var booleans = [{\n        dataType: DATA.BOOLEAN,\n        data: \"true\"\n      }, {\n        dataType: DATA.BOOLEAN,\n        data: \"false\"\n      }];\n      var directions = [{\n        dataType: DATA.DIRECTION,\n        data: \"up\"\n      }, {\n        dataType: DATA.DIRECTION,\n        data: \"down\"\n      }, {\n        dataType: DATA.DIRECTION,\n        data: \"left\"\n      }, {\n        dataType: DATA.DIRECTION,\n        data: \"right\"\n      }];\n      var animations = [];\n      var subjectParent = block && block.findSubjectParent();\n\n      if (subjectParent) {\n        var assets = [];\n\n        if (subjectParent.dataType === DATA.SPRITE) {\n          var spriteName = subjectParent.data;\n          var originalName = spriteName.split(\"(\")[0];\n          var asset = AssetLibrary.getAssetByName(originalName);\n          if (asset) assets.push(asset);\n        } else if (subjectParent.dataType === DATA.ANY) {\n          var sprites = _this.props.scene.sprites;\n\n          for (var spriteId in sprites) {\n            var sprite = sprites[spriteId];\n\n            if (sprite.type === \"sprite\") {\n              var _asset = AssetLibrary.getAsset(sprite.assetId);\n\n              if (_asset) assets.push(_asset);\n            }\n          }\n        }\n\n        assets.forEach(function (asset) {\n          if (asset.spriteAnimations) {\n            Object.keys(asset.spriteAnimations).forEach(function (key) {\n              return animations.push({\n                dataType: DATA.ANIMATION,\n                data: key\n              });\n            });\n          }\n        });\n      }\n\n      var screens = _this.props.sceneIds && _this.props.sceneIds.map(function (sceneId) {\n        return {\n          dataType: DATA.SCREEN,\n          data: sceneId\n        };\n      }) || [];\n      var positions = [{\n        dataType: DATA.POSITION,\n        data: {\n          x: 100,\n          y: 100\n        }\n      }];\n      var random = {\n        dataType: DATA.RANDOM,\n        data: \"random\"\n      };\n      var touch = {\n        dataType: DATA.TOUCH,\n        data: \"touch\"\n      };\n      var axises = [{\n        dataType: DATA.AXIS,\n        data: \"x\"\n      }, {\n        dataType: DATA.AXIS,\n        data: \"y\"\n      }];\n      return [].concat(numbers, _toConsumableArray(strings), booleans, directions, animations, _toConsumableArray(screens), positions, [random, touch], axises).map(function (constant) {\n        return Block.createPrototype({\n          blockType: BLOCK.CONSTANT,\n          dataType: constant.dataType,\n          data: constant.data\n        });\n      });\n    };\n\n    _this.getUtilPrototypes = function () {\n      return Utils.map(function (util) {\n        return Block.createPrototype({\n          blockType: BLOCK.UTIL,\n          parentDataTypes: util.parentDataTypes,\n          dataType: util.dataType,\n          data: util.name,\n          childs: util.childs && util.childs.map(function (child) {\n            return child.blockTypes.indexOf(BLOCK.CALLBACK) > -1 ? Block.createCallback() : Block.createEmpty(_objectSpread({}, child));\n          })\n        });\n      });\n    };\n\n    _this.getSelectorBlocks = function (block) {\n      var prototypeBlocks = _this.getPrototypeBlocks(block);\n\n      _this.props.setPrototypeBlocks(prototypeBlocks);\n\n      var selectorBlocks = prototypeBlocks; // 글로벌 필터\n\n      var prototypeFilter = _this.props.prototypeFilter;\n\n      if (prototypeFilter) {\n        var blockTypes = Object.keys(prototypeFilter);\n        selectorBlocks = selectorBlocks.filter(function (selectorBlock) {\n          var datas = prototypeFilter[selectorBlock.blockType];\n          if (!datas) return false; // 스크린 타입일 경우 필터 목록에 screen이 있으면 포함\n\n          if (selectorBlock.blockType === BLOCK.SPRITE && selectorBlock.dataType === DATA.SCREEN) {\n            return datas.indexOf(DATA.SCREEN) > -1;\n          } // 상수 타입일 경우 데이터 타입으로도 검사\n\n\n          if (selectorBlock.blockType === BLOCK.CONSTANT) {\n            return datas.indexOf(selectorBlock.dataType) > -1 || datas.indexOf(selectorBlock.data) > -1;\n          } // 데이터가 필터 목록에 있는지 검사\n\n\n          return blockTypes.indexOf(selectorBlock.blockType) > -1 && datas.indexOf(selectorBlock.data) > -1;\n        });\n      } // 선택한 블록 조건 필터\n\n\n      selectorBlocks = selectorBlocks.filter(function (selectorBlock) {\n        // 블록 타입 검사\n        var hasBlockType = block.blockTypes.indexOf(selectorBlock.blockType) > -1;\n\n        if (!hasBlockType) {\n          return false;\n        } // 부모블록의 데이터 타입 검사\n\n\n        if (block.parent instanceof Block && selectorBlock.parentDataTypes) {\n          var availableParent = selectorBlock.parentDataTypes.indexOf(block.parent.dataType) > -1 || block.parent.dataType === DATA.ANY;\n\n          if (!availableParent) {\n            return false;\n          }\n        } // 데이터 타입 검사\n\n\n        if (selectorBlock.dataType && selectorBlock.dataType !== DATA.ANY && block.dataTypes[selectorBlock.blockType].indexOf(selectorBlock.dataType) < 0 && block.dataTypes[selectorBlock.blockType].indexOf(DATA.ANY) < 0) {\n          return false;\n        } // set 블록의 목적어로 올 수 없는 데이터 타입\n\n\n        if (block.parent instanceof Block && block.parent.data === \"set\") {\n          if (selectorBlock.dataType === DATA.RANDOM || selectorBlock.dataType === DATA.TOUCH || selectorBlock.dataType === DATA.AXIS) {\n            return false;\n          }\n        } // 애니메이션이 없는 스프라이트는 애니메이트 액션을 필터\n\n\n        if (selectorBlock.blockType === BLOCK.ACTION && (selectorBlock.data === \"playAnimation\" || selectorBlock.data === \"stopAnimation\")) {\n          var subjectParent = block.findSubjectParent();\n\n          if (subjectParent && subjectParent.dataType === DATA.SPRITE) {\n            var spriteName = subjectParent.data;\n            var originalName = spriteName.split(\"(\")[0];\n            var asset = AssetLibrary.getAssetByName(originalName);\n\n            if (!asset || !asset.spriteAnimations) {\n              selectorBlock.disabled = true;\n            }\n          }\n        }\n\n        return true;\n      });\n      return selectorBlocks;\n    };\n\n    _this.reportErrorForWizLive = function (error) {\n      var _this$props = _this.props,\n          pageType = _this$props.pageType,\n          email = _this$props.email;\n      if (pageType !== PAGETYPE.WIZLIVE) return;\n      var name = error.name,\n          message = error.message;\n      var errorMsg = \"WizLive OOBC Error Report(\".concat(email, \")\\n      errorName::\").concat(name, \"\\n      message::\").concat(message);\n      console.error(errorMsg);\n    };\n\n    _this.state = {\n      lines: [],\n      currentLine: null,\n      currentBlock: null,\n      categories: [],\n      currentCategory: null,\n      selectorBlocks: [],\n      popupContent: null,\n      lineContextMenu: null\n    };\n    return _this;\n  }\n\n  _createClass(Container, [{\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      this.onChangeSpriteCode();\n    }\n  }, {\n    key: \"componentWillUnmount\",\n    value: function componentWillUnmount() {\n      if (this.scrollInterval) {\n        clearInterval(this.scrollInterval);\n        this.scrollInterval = undefined;\n      }\n    }\n  }, {\n    key: \"componentDidUpdate\",\n    value: function componentDidUpdate(prevProps) {\n      // 현재 스프라이트가 바뀌면 컨텍스트도 업데이트\n      if (this.props.sprite && this.props.sprite.preview && prevProps.sprite && prevProps.sprite.preview) {\n        if (prevProps.sprite.preview.name !== this.props.sprite.preview.name) {\n          this.onChangeSprite();\n        }\n      } // 전역변수가 바뀌면 변수 카테고리의 프로토타입도 업데이트\n\n\n      if (this.state.currentBlock && this.state.currentCategory === BLOCK.VARIABLE && JSON.stringify(prevProps.globalVariables) !== JSON.stringify(this.props.globalVariables)) {\n        var selectorBlocks = this.getSelectorBlocks(this.state.currentBlock).filter(function (block) {\n          return block.blockType === BLOCK.VARIABLE;\n        });\n        this.setState({\n          selectorBlocks: selectorBlocks\n        });\n      } // 외부에서 포커스된 블록을 바꿨다면 업데이트\n      // if (prevProps.focusedBlockId !== this.props.focusedBlockId) {\n      //   const focusedBlock = this.oobcContext.getBlockById(\n      //     this.props.focusedBlockId\n      //   );\n      //   if (this.state.currentBlock !== focusedBlock) {\n      //     this.focusBlock(focusedBlock);\n      //   }\n      // }\n\n\n      if (prevProps.sprite && this.props.sprite && prevProps.sprite.preview && this.props.sprite.preview && prevProps.sprite.preview.name === this.props.sprite.preview.name && prevProps.sprite.code !== this.props.sprite.code) {\n        this.onChangeSpriteCode();\n      }\n    }\n  }, {\n    key: \"onChangeSprite\",\n    value: function onChangeSprite() {\n      var _this2 = this;\n\n      try {\n        var oobcContextJson = JSON.parse(this.props.sprite.code);\n        this.oobcContext = Context.convertFromJson(oobcContextJson);\n        this.setState({\n          lines: this.oobcContext.getLines(),\n          currentBlock: null\n        }, function () {\n          _this2.onChangeFocusedLine();\n\n          _this2.onChangeFocusedBlock();\n\n          _this2.onChangeEditingBlock();\n        });\n      } catch (err) {\n        this.reportErrorForWizLive(err);\n        this.oobcContext = new Context();\n        this.setState({\n          lines: this.oobcContext.getLines(),\n          currentBlock: null\n        });\n      }\n    }\n  }, {\n    key: \"onChangeSpriteCode\",\n    value: function onChangeSpriteCode() {\n      var _this3 = this;\n\n      try {\n        var oobcContextJson = JSON.parse(this.props.sprite.code);\n        this.oobcContext = Context.convertFromJson(oobcContextJson);\n        this.setState({\n          lines: this.oobcContext.getLines()\n        }, function () {\n          _this3.onChangeFocusedLine();\n\n          _this3.onChangeFocusedBlock();\n\n          _this3.onChangeEditingBlock();\n        });\n      } catch (err) {\n        this.reportErrorForWizLive(err);\n        this.oobcContext = new Context();\n\n        if (this.props.sprite) {\n          var sceneId = this.props.scene.sceneName;\n          var spriteName = this.props.sprite.preview.name;\n          var code = JSON.stringify(this.oobcContext.convertToJson());\n          this.props.setSpriteCode(sceneId, spriteName, code);\n        }\n      }\n    }\n  }, {\n    key: \"onChangeFocusedLine\",\n    value: function onChangeFocusedLine() {\n      var focusedLine = this.oobcContext.getFocusedLine();\n      this.setState({\n        currentLine: focusedLine\n      });\n    }\n  }, {\n    key: \"onChangeFocusedBlock\",\n    value: function onChangeFocusedBlock() {\n      var _this4 = this;\n\n      var focusedLine = this.oobcContext.getFocusedLine();\n      var focusedBlock = this.oobcContext.getFocusedBlock();\n      this.setState({\n        currentBlock: focusedBlock,\n        currentLine: focusedLine\n      }, function () {\n        _this4.updateSelectorState();\n      });\n    }\n  }, {\n    key: \"onChangeEditingBlock\",\n    value: function onChangeEditingBlock() {\n      var editingBlock = this.oobcContext.getEditingBlock();\n\n      if (editingBlock) {\n        this.showContantEditorFor(editingBlock);\n      } else {\n        this.hidePopUpContent();\n      }\n    } // selector\n\n  }, {\n    key: \"getCategoriesFrom\",\n    value: function getCategoriesFrom(blocks) {\n      var categorySet = new Set();\n\n      for (var i in blocks) {\n        var block = blocks[i];\n        categorySet.add(block.blockType);\n      }\n\n      var categoryPriority = [BLOCK.CONSTANT, BLOCK.SPRITE, BLOCK.ACTION, BLOCK.PROPERTY, BLOCK.OPERATOR, BLOCK.UTIL, BLOCK.VARIABLE, BLOCK.FUNCTION, BLOCK.CALLBACK];\n      var categories = Array.from(categorySet).sort(function (prev, next) {\n        return categoryPriority.indexOf(prev) - categoryPriority.indexOf(next);\n      });\n      return categories;\n    }\n  }, {\n    key: \"addVariableCategoryIfNeedFor\",\n    value: function addVariableCategoryIfNeedFor(block, categories) {\n      if (block.blockTypes.includes(BLOCK.VARIABLE) && !categories.includes(BLOCK.VARIABLE)) {\n        categories.push(BLOCK.VARIABLE);\n      }\n    } // header\n\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _this$state = this.state,\n          lines = _this$state.lines,\n          currentLine = _this$state.currentLine,\n          currentBlock = _this$state.currentBlock,\n          categories = _this$state.categories,\n          currentCategory = _this$state.currentCategory,\n          selectorBlocks = _this$state.selectorBlocks,\n          popupContent = _this$state.popupContent,\n          lineContextMenu = _this$state.lineContextMenu;\n      var scene = this.props.scene;\n      var spriteFilter = this.props.prototypeFilter ? this.props.prototypeFilter.sprite : null;\n      var sprites = scene.spriteIds.map(function (spriteId) {\n        return scene.sprites[spriteId];\n      }).filter(function (sprite) {\n        if (!spriteFilter) return true;\n\n        if (sprite.type === \"background\") {\n          return spriteFilter.indexOf(\"screen\") > -1;\n        } else {\n          return spriteFilter.indexOf(sprite.preview.name) > -1;\n        }\n      });\n      var currentSprite = this.props.sprite;\n      return /*#__PURE__*/React.createElement(View, {\n        intl: this.props.intl,\n        pageType: this.props.pageType,\n        isPlaying: this.props.isPlaying,\n        lines: lines,\n        currentLine: currentLine,\n        currentBlock: currentBlock,\n        categories: categories,\n        currentCategory: currentCategory,\n        selectorBlocks: selectorBlocks,\n        popupContent: popupContent,\n        lineContextMenu: lineContextMenu,\n        sprites: sprites,\n        currentSprite: currentSprite,\n        onClickSprite: this.onClickSprite,\n        onClickPreview: this.onClickPreview,\n        onClickPlay: this.onClickPlay,\n        onClickLine: this.onClickLine,\n        onRightClickLine: this.onRightClickLine,\n        onClickFoldLine: this.onClickFoldLine,\n        onClickDeleteLine: this.onClickDeleteLine,\n        onDragLine: this.onDragLine,\n        onDragBegin: this.onDragBegin,\n        onDragEnd: this.onDragEnd,\n        onClickLineContextMenu: this.onClickLineContextMenu,\n        onClickContextBlock: this.onClickContextBlock,\n        onClickPrototypeBlock: this.onClickPrototypeBlock,\n        onClickConstantEdit: this.onClickConstantEdit,\n        onClickPopupOverlay: this.onClickPopupOverlay,\n        onClickContext: this.onClickContext,\n        onClickSelector: this.onClickSelector,\n        onClickCategory: this.onClickCategory,\n        onClickAddVariable: this.onClickAddVariable,\n        onClickSelectorClose: this.onClickSelectorClose,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1070,\n          columnNumber: 7\n        }\n      });\n    }\n  }]);\n\n  return Container;\n}(Component);\n\nexport default connect(function (state) {\n  var email = state.userinfo.email;\n  var isPlaying = state.preview.isPlaying;\n  var selected = state.interaction.selected;\n  var _state$scene = state.scene,\n      sceneIds = _state$scene.sceneIds,\n      soundIds = _state$scene.soundIds,\n      globalVariables = _state$scene.globalVariables;\n  var scene = state.scene.scenes[selected.scene];\n  var sprite = scene.sprites[selected.objects[scene.sceneName].name];\n  var _state$block = state.block,\n      prototypeBlocks = _state$block.prototypeBlocks,\n      prototypeFilter = _state$block.prototypeFilter,\n      focusedBlockId = _state$block.focusedBlockId,\n      customStrings = _state$block.customStrings;\n  return {\n    email: email,\n    isPlaying: isPlaying,\n    sceneIds: sceneIds,\n    soundIds: soundIds,\n    globalVariables: globalVariables,\n    scene: scene,\n    sprite: sprite,\n    prototypeBlocks: prototypeBlocks,\n    prototypeFilter: prototypeFilter,\n    focusedBlockId: focusedBlockId,\n    customStrings: customStrings\n  };\n}, {\n  setSpriteCode: sceneActions.setSpriteCode,\n  addGlobalVariable: sceneActions.addGlobalVariable,\n  removeGlobalVariable: sceneActions.removeGlobalVariable,\n  setFocusedBlockId: blockActions.setFocusedBlockId,\n  setPrototypeBlocks: blockActions.setPrototypeBlocks,\n  setPopupConstantOpen: blockActions.setPopupConstantOpen,\n  setIsPlaying: previewActions.setIsPlaying,\n  selectSprite: interactionActions.selectSprite,\n  setBlockCategory: interactionActions.setBlockCategory\n})(injectIntl(Container));","map":{"version":3,"sources":["/Users/jimmy/Documents/Wizschool/wizlab_web2/src/Page/Builder/Component/Editor/Component/OOBCEditor/Container.js"],"names":["React","Component","connect","injectIntl","sceneActions","blockActions","previewActions","interactionActions","PAGETYPE","PopUp","showPopUp","AssetLibrary","Context","Line","Block","BLOCK","DATA","MODE","Actions","Properties","Operators","Utils","NumberEditor","PositionEditor","StringEditor","View","Container","props","updateSelectorState","currentBlock","state","selectorBlocks","getSelectorBlocks","categories","getCategoriesFrom","addVariableCategoryIfNeedFor","currentCategory","oobcContext","focusedCategory","filter","block","blockType","setState","onClickSprite","sprite","sceneId","scene","sceneName","spriteName","preview","name","spriteType","type","selectSprite","scrollToSprite","scroller","document","getElementById","element","scroll","left","offsetLeft","offsetWidth","behavior","onClickPreview","focusBlock","onClickPlay","prevBlock","undefined","setTimeout","wasCurrentView","setIsPlaying","onClickContext","onUpdateContext","callback","code","JSON","stringify","convertToJson","setSpriteCode","lines","getLines","onClickSelector","scrollToBlock","onClickCategory","category","onClickAddVariable","formatMessage","intl","id","value","RegExp","test","globalVariables","indexOf","addGlobalVariable","onClickSelectorClose","showPopUpContent","content","setPopupConstantOpen","popupContent","hidePopUpContent","onClickPopupOverlay","e","preventDefault","stopPropagation","onClickLine","line","currentLine","setFocusedLine","lineContextMenu","onRightClickLine","editorRect","getBoundingClientRect","contextElement","style","top","clientY","scrollTop","clientX","scrollLeft","delete","checkLineDeletable","copy","paste","copiedLine","add","disable","comment","setFocusedBlock","parent","length","onClickFoldLine","folded","unfold","fold","onClickDeleteLine","deleteLine","onDragLine","dragLine","hoverLine","dragOffset","swapLine","onDragBegin","tempFolded","tempCurrentBlock","onDragEnd","scrollInterval","clearInterval","onClickLineContextMenu","contextmenu","onClickCopyLine","onClickPasteLine","onClickAddLine","onClickDisableLine","disabled","enable","pushBlock","prototypeBlock","instanceBlock","createInstance","replaceWith","getParentLine","getNextLine","addLine","newLine","data","push","checkEditableBlock","setEditingBlock","nextBlock","findNextBlock","findEmptyBlock","onClickContextBlock","onClickPrototypeBlock","toUpperCase","childs","reduce","prev","child","mode","EMPTY","onClickConstantEdit","showContantEditorFor","editor","popupStyle","blockElement","contextRect","blockRect","height","maxLeft","width","dataType","NUMBER","num","POSITION","x","y","STRING","text","getPrototypeBlocks","getSpritePrototypes","getVariablePrototypes","getActionPrototypes","getPropertyPrototypes","getOperatorPrototypes","getConstantPrototypes","getUtilPrototypes","sprites","spriteId","console","warn","i","soundIds","soundId","soundName","getSoundAsset","defaultName","sortInfor","SCREEN","SPRITE","JOYSTICK","TEXT","SOUND","sort","next","background","joystick","sound","map","createPrototype","variable","VARIABLE","ANY","action","ACTION","parentDataTypes","blockTypes","CALLBACK","createCallback","createEmpty","property","PROPERTY","operator","OPERATOR","numbers","strings","customStrings","string","booleans","BOOLEAN","directions","DIRECTION","animations","subjectParent","findSubjectParent","assets","originalName","split","asset","getAssetByName","getAsset","assetId","forEach","spriteAnimations","Object","keys","key","ANIMATION","screens","sceneIds","positions","random","RANDOM","touch","TOUCH","axises","AXIS","constant","CONSTANT","util","UTIL","prototypeBlocks","setPrototypeBlocks","prototypeFilter","selectorBlock","datas","hasBlockType","availableParent","dataTypes","reportErrorForWizLive","error","pageType","email","WIZLIVE","message","errorMsg","onChangeSpriteCode","prevProps","onChangeSprite","oobcContextJson","parse","convertFromJson","onChangeFocusedLine","onChangeFocusedBlock","onChangeEditingBlock","err","focusedLine","getFocusedLine","focusedBlock","getFocusedBlock","editingBlock","getEditingBlock","blocks","categorySet","Set","categoryPriority","FUNCTION","Array","from","includes","spriteFilter","spriteIds","currentSprite","isPlaying","userinfo","selected","interaction","scenes","objects","focusedBlockId","removeGlobalVariable","setFocusedBlockId","setBlockCategory"],"mappings":";;;;;;;;;;;;;;AAAA,OAAOA,KAAP,IAAgBC,SAAhB,QAAiC,OAAjC;AACA,SAASC,OAAT,QAAwB,aAAxB;AACA,SAASC,UAAT,QAA2B,YAA3B;AAEA,OAAO,KAAKC,YAAZ,MAA8B,iCAA9B;AACA,OAAO,KAAKC,YAAZ,MAA8B,iCAA9B;AACA,OAAO,KAAKC,cAAZ,MAAgC,mCAAhC;AACA,OAAO,KAAKC,kBAAZ,MAAoC,uCAApC;AACA,SAASC,QAAT,QAAyB,wCAAzB;AACA,OAAOC,KAAP,IAAgBC,SAAhB,QAAiC,0CAAjC;AACA,OAAOC,YAAP,MAAyB,gCAAzB;AAEA,SAASC,OAAT,EAAkBC,IAAlB,EAAwBC,KAAxB,QAAqC,SAArC;AACA,SAASC,KAAT,EAAgBC,IAAhB,EAAsBC,IAAtB,QAAkC,aAAlC;AACA,OAAOC,OAAP,MAAoB,eAApB;AACA,OAAOC,UAAP,MAAuB,iBAAvB;AACA,OAAOC,SAAP,MAAsB,iBAAtB;AACA,OAAOC,KAAP,MAAkB,aAAlB;AACA,OAAOC,YAAP,MAAyB,0BAAzB;AACA,OAAOC,cAAP,MAA2B,4BAA3B;AACA,OAAOC,YAAP,MAAyB,0BAAzB;AACA,OAAOC,IAAP,MAAiB,QAAjB;;IAEMC,S;;;;;AACJ,qBAAYC,KAAZ,EAAmB;AAAA;;AAAA;;AACjB,8BAAMA,KAAN;;AADiB,UAgInBC,mBAhImB,GAgIG,YAAM;AAAA,UAClBC,YADkB,GACD,MAAKC,KADJ,CAClBD,YADkB;;AAE1B,UAAIA,YAAJ,EAAkB;AAChB,YAAIE,cAAc,GAAG,MAAKC,iBAAL,CAAuBH,YAAvB,CAArB;;AACA,YAAMI,UAAU,GAAG,MAAKC,iBAAL,CAAuBH,cAAvB,CAAnB;;AACA,cAAKI,4BAAL,CAAkCN,YAAlC,EAAgDI,UAAhD;;AACA,YAAMG,eAAe,GAAG,MAAKC,WAAL,CAAiBC,eAAjB,IAAoCL,UAAU,CAAC,CAAD,CAAtE;AACAF,QAAAA,cAAc,GAAGA,cAAc,CAACQ,MAAf,CACf,UAAAC,KAAK;AAAA,iBAAIA,KAAK,CAACC,SAAN,KAAoBL,eAAxB;AAAA,SADU,CAAjB;;AAGA,cAAKM,QAAL,CAAc;AACZT,UAAAA,UAAU,EAAVA,UADY;AAEZG,UAAAA,eAAe,EAAfA,eAFY;AAGZL,UAAAA,cAAc,EAAdA;AAHY,SAAd;AAKD,OAbD,MAaO;AACL,cAAKW,QAAL,CAAc;AACZT,UAAAA,UAAU,EAAE,EADA;AAEZG,UAAAA,eAAe,EAAE,IAFL;AAGZL,UAAAA,cAAc,EAAE;AAHJ,SAAd;AAKD;AACF,KAtJkB;;AAAA,UAwLnBY,aAxLmB,GAwLH,UAAAC,MAAM,EAAI;AACxB,UAAMC,OAAO,GAAG,MAAKlB,KAAL,CAAWmB,KAAX,CAAiBC,SAAjC;AACA,UAAMC,UAAU,GAAGJ,MAAM,CAACK,OAAP,CAAeC,IAAlC;AACA,UAAMC,UAAU,GAAGP,MAAM,CAACQ,IAA1B;;AACA,YAAKzB,KAAL,CAAW0B,YAAX,CAAwBR,OAAxB,EAAiCG,UAAjC,EAA6CG,UAA7C;;AACA,YAAKG,cAAL,CAAoBV,MAApB;AACD,KA9LkB;;AAAA,UA+LnBU,cA/LmB,GA+LF,UAAAV,MAAM,EAAI;AACzB,UAAMW,QAAQ,GAAGC,QAAQ,CAACC,cAAT,CAAwB,2BAAxB,CAAjB;AACA,UAAMC,OAAO,GAAGF,QAAQ,CAACC,cAAT,oCACcb,MAAM,CAACK,OAAP,CAAeC,IAD7B,EAAhB;;AAGA,UAAIK,QAAQ,IAAIG,OAAhB,EAAyB;AACvBH,QAAAA,QAAQ,CAACI,MAAT,CAAgB;AACdC,UAAAA,IAAI,EACFF,OAAO,CAACG,UAAR,IAAsBN,QAAQ,CAACO,WAAT,GAAuBJ,OAAO,CAACI,WAAR,GAAsB,CAAnE,CAFY;AAGdC,UAAAA,QAAQ,EAAE;AAHI,SAAhB;AAKD;AACF,KA3MkB;;AAAA,UA4MnBC,cA5MmB,GA4MF,YAAM;AACrB,YAAKC,UAAL,CAAgB,IAAhB;;AACA,YAAKtC,KAAL,CAAWqC,cAAX;AACD,KA/MkB;;AAAA,UAgNnBE,WAhNmB,GAgNL,YAAM;AAClB,YAAKC,SAAL,GAAiB,MAAKrC,KAAL,CAAWD,YAA5B;;AACA,YAAKa,QAAL,CAAc;AAAEb,QAAAA,YAAY,EAAEuC;AAAhB,OAAd,EAA2C,YAAM;AAC/CC,QAAAA,UAAU,CACR,YAAM;AACJ,gBAAKC,cAAL,GAAsB,IAAtB,CADI,CAEJ;AACA;;AACA,gBAAK3C,KAAL,CAAW4C,YAAX,CAAwB,IAAxB;AACD,SANO,EAOR,MAAKJ,SAAL,GAAiB,GAAjB,GAAuB,CAPf,CAAV;AASD,OAVD;AAWD,KA7NkB;;AAAA,UAgOnBK,cAhOmB,GAgOF,YAAM;AACrB,UAAI,MAAK1C,KAAL,CAAWD,YAAf,EAA6B;AAC3B,cAAKoC,UAAL,CAAgB,IAAhB;AACD;AACF,KApOkB;;AAAA,UAqOnBQ,eArOmB,GAqOD,UAAAC,QAAQ,EAAI;AAC5B,UAAI,MAAK/C,KAAL,CAAWiB,MAAf,EAAuB;AACrB,YAAMC,OAAO,GAAG,MAAKlB,KAAL,CAAWmB,KAAX,CAAiBC,SAAjC;AACA,YAAMC,UAAU,GAAG,MAAKrB,KAAL,CAAWiB,MAAX,CAAkBK,OAAlB,CAA0BC,IAA7C;AACA,YAAMyB,IAAI,GAAGC,IAAI,CAACC,SAAL,CAAe,MAAKxC,WAAL,CAAiByC,aAAjB,EAAf,CAAb;;AACA,cAAKnD,KAAL,CAAWoD,aAAX,CAAyBlC,OAAzB,EAAkCG,UAAlC,EAA8C2B,IAA9C;AACD;;AACD,YAAKjC,QAAL,CAAc;AAAEsC,QAAAA,KAAK,EAAE,MAAK3C,WAAL,CAAiB4C,QAAjB;AAAT,OAAd,EAAsDP,QAAtD;AACD,KA7OkB;;AAAA,UAgPnBQ,eAhPmB,GAgPD,YAAM;AACtB,YAAKC,aAAL,CAAmB,MAAKrD,KAAL,CAAWD,YAA9B;AACD,KAlPkB;;AAAA,UAmPnBuD,eAnPmB,GAmPD,UAAAC,QAAQ,EAAI;AAC5B,UAAIA,QAAQ,KAAK,MAAKvD,KAAL,CAAWM,eAA5B,EAA6C;AAC7C,YAAKC,WAAL,CAAiBC,eAAjB,GAAmC+C,QAAnC;;AACA,YAAKZ,eAAL;AACD,KAvPkB;;AAAA,UAwPnBa,kBAxPmB,GAwPE,YAAM;AAAA,UACjBC,aADiB,GACC,MAAK5D,KAAL,CAAW6D,IADZ,CACjBD,aADiB;AAEzB7E,MAAAA,SAAS,eACP,oBAAC,KAAD,CAAO,QAAP;AACE,QAAA,KAAK,EAAE6E,aAAa,CAAC;AAAEE,UAAAA,EAAE,EAAE;AAAN,SAAD,CADtB;AAEE,QAAA,QAAQ,EAAEF,aAAa,CAAC;AAAEE,UAAAA,EAAE,EAAE;AAAN,SAAD,CAFzB;AAGE,QAAA,WAAW,EAAEF,aAAa,CAAC;AAAEE,UAAAA,EAAE,EAAE;AAAN,SAAD,CAH5B;AAIE,QAAA,YAAY,EAAE,sBAAAC,KAAK,EAAI;AACrB,cAAI,CAACC,MAAM,CAAC,4BAAD,CAAN,CAAqCC,IAArC,CAA0CF,KAA1C,CAAL,EAAuD;AACrDhF,YAAAA,SAAS,eACP,oBAAC,KAAD,CAAO,SAAP;AACE,cAAA,KAAK,EAAE6E,aAAa,CAAC;AACnBE,gBAAAA,EAAE,EAAE;AADe,eAAD,CADtB;AAIE,cAAA,QAAQ,EAAEF,aAAa,CAAC;AACtBE,gBAAAA,EAAE,EAAE;AADkB,eAAD,CAJzB;AAOE,cAAA,YAAY,EAAE,MAAKH,kBAPrB;AAQE,cAAA,UAAU,EAAEC,aAAa,CAAC;AACxBE,gBAAAA,EAAE,EAAE;AADoB,eAAD,CAR3B;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,cADO,CAAT;AAcA;AACD;;AACD,cACE,MAAK9D,KAAL,CAAWkE,eAAX,IACA,MAAKlE,KAAL,CAAWkE,eAAX,CAA2BC,OAA3B,CAAmCJ,KAAnC,IAA4C,CAAC,CAF/C,EAGE;AACAhF,YAAAA,SAAS,eACP,oBAAC,KAAD,CAAO,SAAP;AACE,cAAA,KAAK,EAAE6E,aAAa,CAAC;AACnBE,gBAAAA,EAAE,EAAE;AADe,eAAD,CADtB;AAIE,cAAA,QAAQ,EAAEF,aAAa,CAAC;AACtBE,gBAAAA,EAAE,EAAE;AADkB,eAAD,CAJzB;AAOE,cAAA,YAAY,EAAE,MAAKH,kBAPrB;AAQE,cAAA,UAAU,EAAEC,aAAa,CAAC;AACxBE,gBAAAA,EAAE,EAAE;AADoB,eAAD,CAR3B;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,cADO,CAAT;AAcA;AACD;;AACD,gBAAK9D,KAAL,CAAWoE,iBAAX,CAA6BL,KAA7B;AACD,SA3CH;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,QADO,CAAT;AA+CD,KAzSkB;;AAAA,UA0SnBM,oBA1SmB,GA0SI,YAAM;AAC3B,YAAK/B,UAAL,CAAgB,IAAhB;AACD,KA5SkB;;AAAA,UA+SnBgC,gBA/SmB,GA+SA,UAAAC,OAAO,EAAI;AAC5B,YAAKvE,KAAL,CAAWwE,oBAAX,CAAgC,IAAhC;;AACA,YAAKzD,QAAL,CAAc;AAAE0D,QAAAA,YAAY,EAAEF;AAAhB,OAAd;AACD,KAlTkB;;AAAA,UAmTnBG,gBAnTmB,GAmTA,YAAM;AACvB,YAAK1E,KAAL,CAAWwE,oBAAX,CAAgC,KAAhC;;AACA,YAAKzD,QAAL,CAAc;AAAE0D,QAAAA,YAAY,EAAE;AAAhB,OAAd;AACD,KAtTkB;;AAAA,UAuTnBE,mBAvTmB,GAuTG,UAAAC,CAAC,EAAI;AACzB,UAAIA,CAAC,CAACC,cAAN,EAAsBD,CAAC,CAACC,cAAF;AACtB,UAAID,CAAC,CAACE,eAAN,EAAuBF,CAAC,CAACE,eAAF;;AACvB,YAAKxC,UAAL,CAAgB,IAAhB;;AACA,YAAKoC,gBAAL;AACD,KA5TkB;;AAAA,UA+TnBK,WA/TmB,GA+TL,UAAAC,IAAI,EAAI;AACpB,UAAI,MAAK7E,KAAL,CAAW8E,WAAX,KAA2BD,IAA/B,EAAqC;AACnC,cAAKtE,WAAL,CAAiBwE,cAAjB,CAAgC,IAAhC;AACD,OAFD,MAEO;AACL,cAAKxE,WAAL,CAAiBwE,cAAjB,CAAgCF,IAAhC;AACD;;AACD,YAAKlC,eAAL;;AACA,YAAK/B,QAAL,CAAc;AAAEoE,QAAAA,eAAe,EAAE;AAAnB,OAAd;AACD,KAvUkB;;AAAA,UAwUnBC,gBAxUmB,GAwUA,UAACJ,IAAD,EAAOJ,CAAP,EAAa;AAC9B,UAAMS,UAAU,GAAGxD,QAAQ,CACxBC,cADgB,CACD,YADC,EAEhBwD,qBAFgB,EAAnB;AAGA,UAAMC,cAAc,GAAG1D,QAAQ,CAACC,cAAT,CAAwB,oBAAxB,CAAvB;AACA,UAAMqD,eAAe,GAAG;AACtBK,QAAAA,KAAK,EAAE;AACLC,UAAAA,GAAG,EAAEb,CAAC,CAACc,OAAF,GAAYL,UAAU,CAACI,GAAvB,GAA6BF,cAAc,CAACI,SAD5C;AAEL1D,UAAAA,IAAI,EAAE2C,CAAC,CAACgB,OAAF,GAAYP,UAAU,CAACpD,IAAvB,GAA8BsD,cAAc,CAACM;AAF9C,SADe;AAKtBC,QAAAA,MAAM,EAAE,MAAKC,kBAAL,CAAwBf,IAAxB,CALc;AAMtBgB,QAAAA,IAAI,EAAE,IANgB;AAOtBC,QAAAA,KAAK,EAAE,CAAC,CAAC,MAAKC,UAPQ;AAQtBC,QAAAA,GAAG,EAAE,IARiB;AAStBC,QAAAA,OAAO,EAAE,IATa;AAUtBC,QAAAA,OAAO,EAAE;AAVa,OAAxB;;AAYA,YAAK3F,WAAL,CAAiB4F,eAAjB,CAAiC,IAAjC;;AACA,YAAK5F,WAAL,CAAiBwE,cAAjB,CAAgCF,IAAhC;;AACA,YAAKlC,eAAL;;AACA,YAAK/B,QAAL,CAAc;AAAEoE,QAAAA,eAAe,EAAfA;AAAF,OAAd;AACD,KA7VkB;;AAAA,UA8VnBY,kBA9VmB,GA8VE,UAAAf,IAAI,EAAI;AAC3B,UAAIA,IAAI,CAACuB,MAAL,YAAuBtH,OAA3B,EAAoC;AAClC,eAAO+F,IAAI,CAACuB,MAAL,CAAYlD,KAAZ,CAAkBmD,MAAlB,GAA2B,CAAlC;AACD,OAFD,MAEO;AACL,eAAO,IAAP;AACD;AACF,KApWkB;;AAAA,UAqWnBC,eArWmB,GAqWD,UAAAzB,IAAI,EAAI;AACxB,UAAIA,IAAI,CAAC0B,MAAT,EAAiB;AACf1B,QAAAA,IAAI,CAAC2B,MAAL;AACD,OAFD,MAEO;AACL3B,QAAAA,IAAI,CAAC4B,IAAL;AACD;;AACD,YAAKlG,WAAL,CAAiBwE,cAAjB,CAAgC,IAAhC;;AACA,YAAKpC,eAAL;AACD,KA7WkB;;AAAA,UA8WnB+D,iBA9WmB,GA8WC,UAAA7B,IAAI,EAAI;AAAA,UAClBpB,aADkB,GACA,MAAK5D,KAAL,CAAW6D,IADX,CAClBD,aADkB;AAE1B7E,MAAAA,SAAS,eACP,oBAAC,KAAD,CAAO,SAAP;AACE,QAAA,KAAK,EAAE6E,aAAa,CAAC;AAAEE,UAAAA,EAAE,EAAE;AAAN,SAAD,CADtB;AAEE,QAAA,QAAQ,EAAEF,aAAa,CAAC;AACtBE,UAAAA,EAAE,EAAE;AADkB,SAAD,CAFzB;AAKE,QAAA,gBAAgB,EAAEF,aAAa,CAAC;AAAEE,UAAAA,EAAE,EAAE;AAAN,SAAD,CALjC;AAME,QAAA,iBAAiB,EAAEF,aAAa,CAAC;AAAEE,UAAAA,EAAE,EAAE;AAAN,SAAD,CANlC;AAOE,QAAA,aAAa,EAAE,yBAAM;AACnB,gBAAKpD,WAAL,CAAiBoG,UAAjB,CAA4B9B,IAA5B;;AACA,gBAAKtE,WAAL,CAAiBwE,cAAjB,CAAgC,IAAhC;;AACA,gBAAKpC,eAAL;AACD,SAXH;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,QADO,CAAT;AAeD,KA/XkB;;AAAA,UAgYnBiE,UAhYmB,GAgYN,UAACC,QAAD,EAAWC,SAAX,EAAsBC,UAAtB,EAAqC;AAChD,UAAI,MAAKxG,WAAL,CAAiByG,QAAjB,CAA0BH,QAA1B,EAAoCC,SAApC,CAAJ,EAAoD;AAClD,cAAKlG,QAAL,CAAc;AAAEsC,UAAAA,KAAK,EAAE,MAAK3C,WAAL,CAAiB4C,QAAjB;AAAT,SAAd;AACD,OAH+C,CAIhD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AACD,KAxZkB;;AAAA,UAyZnB8D,WAzZmB,GAyZL,UAAApC,IAAI,EAAI;AACpB,YAAKqC,UAAL,GAAkBrC,IAAI,CAAC0B,MAAvB;AACA,YAAKY,gBAAL,GAAwB,MAAKnH,KAAL,CAAWD,YAAnC;;AACA,YAAKoC,UAAL,CAAgB,IAAhB;;AACA,UAAI,CAAC0C,IAAI,CAAC0B,MAAV,EAAkB;AAChB1B,QAAAA,IAAI,CAAC0B,MAAL,GAAc,IAAd;;AACA,cAAK3F,QAAL,CAAc;AAAEsC,UAAAA,KAAK,EAAE,MAAK3C,WAAL,CAAiB4C,QAAjB;AAAT,SAAd;AACD;AACF,KAjakB;;AAAA,UAkanBiE,SAlamB,GAkaP,UAAAvC,IAAI,EAAI;AAClBA,MAAAA,IAAI,CAAC0B,MAAL,GAAc,MAAKW,UAAnB;;AACA,UAAI,MAAKG,cAAT,EAAyB;AACvBC,QAAAA,aAAa,CAAC,MAAKD,cAAN,CAAb;AACA,cAAKA,cAAL,GAAsB/E,SAAtB;AACD;;AACD,YAAKH,UAAL,CAAgB,MAAKgF,gBAArB;AACD,KAzakB;;AAAA,UA4anBI,sBA5amB,GA4aM,UAAC1C,IAAD,EAAO2C,WAAP,EAAuB;AAC9C,YAAK5G,QAAL,CAAc;AAAEoE,QAAAA,eAAe,EAAE;AAAnB,OAAd,EAAyC,YAAM;AAC7C,gBAAQwC,WAAR;AACE,eAAK,QAAL;AACE,kBAAKd,iBAAL,CAAuB7B,IAAvB;;AACA;;AACF,eAAK,MAAL;AACE,kBAAK4C,eAAL,CAAqB5C,IAArB;;AACA;;AACF,eAAK,OAAL;AACE,kBAAK6C,gBAAL,CAAsB7C,IAAtB;;AACA;;AACF,eAAK,KAAL;AACE,kBAAK8C,cAAL,CAAoB9C,IAApB;;AACA;;AACF,eAAK,SAAL;AACE,kBAAK+C,kBAAL,CAAwB/C,IAAxB;;AACA;;AACF,eAAK,SAAL;AACE;;AACF;AACE;AAnBJ;AAqBD,OAtBD;AAuBD,KApckB;;AAAA,UAqcnB4C,eArcmB,GAqcD,UAAA5C,IAAI,EAAI;AACxB,YAAKkB,UAAL,GAAkBlB,IAAlB;AACD,KAvckB;;AAAA,UAwcnB6C,gBAxcmB,GAwcA,UAAA7C,IAAI,EAAI;AACzB,UAAI,CAAC,MAAKkB,UAAV,EAAsB;AACtBlB,MAAAA,IAAI,CAACmB,GAAL,CAAS,MAAKD,UAAL,CAAgBF,IAAhB,EAAT;;AACA,YAAKlD,eAAL;AACD,KA5ckB;;AAAA,UA6cnBgF,cA7cmB,GA6cF,UAAA9C,IAAI,EAAI;AACvBA,MAAAA,IAAI,CAACmB,GAAL,CAAS,IAAIjH,IAAJ,EAAT;;AACA,YAAK4D,eAAL;AACD,KAhdkB;;AAAA,UAidnBiF,kBAjdmB,GAidE,UAAA/C,IAAI,EAAI;AAC3B,UAAIA,IAAI,CAACgD,QAAT,EAAmB;AACjBhD,QAAAA,IAAI,CAACiD,MAAL;AACD,OAFD,MAEO;AACLjD,QAAAA,IAAI,CAACoB,OAAL;AACD;;AACD,YAAKtD,eAAL;AACD,KAxdkB;;AAAA,UA2dnBR,UA3dmB,GA2dN,UAAAzB,KAAK,EAAI;AACpB,YAAKH,WAAL,CAAiB4F,eAAjB,CAAiCzF,KAAjC;;AACA,YAAKiC,eAAL;;AACA,YAAK/B,QAAL,CAAc;AAAEoE,QAAAA,eAAe,EAAE;AAAnB,OAAd;AACD,KA/dkB;;AAAA,UAgenB+C,SAhemB,GAgeP,UAAAC,cAAc,EAAI;AAC5B;AAD4B,UAEpBjI,YAFoB,GAEH,MAAKC,KAFF,CAEpBD,YAFoB;AAG5B,UAAMkI,aAAa,GAAGjJ,KAAK,CAACkJ,cAAN,CAAqB;AACzC7F,QAAAA,SAAS,EAAEtC,YAD8B;AAEzCiI,QAAAA,cAAc,EAAdA;AAFyC,OAArB,CAAtB;AAIAjI,MAAAA,YAAY,CAACoI,WAAb,CAAyBF,aAAzB,EAP4B,CAS5B;;AACA,UAAMnD,WAAW,GAAG/E,YAAY,CAACqI,aAAb,EAApB;;AACA,UAAItD,WAAW,CAACsB,MAAZ,YAA8BtH,OAAlC,EAA2C;AACzC,YAAI,CAACgG,WAAW,CAACuD,WAAZ,EAAL,EAAgC;AAC9B,gBAAK9H,WAAL,CAAiB+H,OAAjB,CAAyB,IAAIvJ,IAAJ,CAAS;AAAEqH,YAAAA,MAAM,EAAE,MAAK7F;AAAf,WAAT,CAAzB;AACD;AACF,OAJD,MAIO;AACL,YAAI,CAACuE,WAAW,CAACuD,WAAZ,EAAL,EAAgC;AAC9B,cAAME,OAAO,GAAG,IAAIxJ,IAAJ,CAAS;AAAEqH,YAAAA,MAAM,EAAEtB,WAAW,CAACsB;AAAtB,WAAT,CAAhB;AACAtB,UAAAA,WAAW,CAACsB,MAAZ,CAAmBoC,IAAnB,CAAwBC,IAAxB,CAA6BF,OAA7B;AACD;AACF;;AAED,UAAI,MAAKhI,WAAL,CAAiBmI,kBAAjB,CAAoCT,aAApC,CAAJ,EAAwD;AACtD,cAAK1H,WAAL,CAAiBoI,eAAjB,CAAiCV,aAAjC;AACD,OAFD,MAEO;AACL,YAAMW,SAAS,GAAG,MAAKC,aAAL,CAAmBZ,aAAnB,CAAlB;;AACA,cAAK1H,WAAL,CAAiB4F,eAAjB,CAAiCyC,SAAjC;AACD;;AACD,YAAKjG,eAAL;AACD,KA7fkB;;AAAA,UA8fnBkG,aA9fmB,GA8fH,UAAAnI,KAAK,EAAI;AACvB,UAAIkI,SAAS,GAAGlI,KAAK,CAACoI,cAAN,EAAhB,CADuB,CAEvB;AACA;AACA;AACA;AACA;AACA;;AACA,aAAOF,SAAP;AACD,KAvgBkB;;AAAA,UAwgBnBvF,aAxgBmB,GAwgBH,UAAA3C,KAAK,EAAI,CACvB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACD,KAvhBkB;;AAAA,UAwhBnBqI,mBAxhBmB,GAwhBG,UAAArI,KAAK,EAAI;AAC7B;AACA,UAAI,MAAKV,KAAL,CAAWD,YAAX,KAA4BW,KAAhC,EAAuC;AACrC,cAAKyB,UAAL,CAAgBzB,KAAhB;AACD;AACF,KA7hBkB;;AAAA,UA8hBnBsI,qBA9hBmB,GA8hBK,UAAAhB,cAAc,EAAI;AAAA,UAChCjI,YADgC,GACf,MAAKC,KADU,CAChCD,YADgC;AAAA,UAEhC0D,aAFgC,GAEd,MAAK5D,KAAL,CAAW6D,IAFG,CAEhCD,aAFgC,EAGxC;;AACA,UAAIuE,cAAc,CAACH,QAAnB,EAA6B;AAC3B,YAAMlE,EAAE,GAAGqE,cAAc,CAACQ,IAAf,CAAoBS,WAApB,EAAX;AACArK,QAAAA,SAAS,eACP,oBAAC,KAAD,CAAO,SAAP;AACE,UAAA,KAAK,EAAE6E,aAAa,CAAC;AACnBE,YAAAA,EAAE,EAAE;AADe,WAAD,CADtB;AAIE,UAAA,QAAQ,EAAEF,aAAa,CAAC;AACtBE,YAAAA,EAAE,EAAE,wCAAwCA;AADtB,WAAD,CAJzB;AAOE,UAAA,UAAU,EAAEF,aAAa,CAAC;AAAEE,YAAAA,EAAE,EAAE;AAAN,WAAD,CAP3B;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,UADO,CAAT;AAWA;AACD,OAlBuC,CAmBxC;;;AACA,UACE5D,YAAY,CAACmJ,MAAb,IACAnJ,YAAY,CAACmJ,MAAb,CAAoBC,MAApB,CACE,UAACC,IAAD,EAAOC,KAAP;AAAA,eAAiBD,IAAI,IAAIC,KAAK,CAACC,IAAN,KAAenK,IAAI,CAACoK,KAA7C;AAAA,OADF,EAEE,KAFF,CAFF,EAME;AACA3K,QAAAA,SAAS,eACP,oBAAC,KAAD,CAAO,SAAP;AACE,UAAA,KAAK,EAAE6E,aAAa,CAAC;AAAEE,YAAAA,EAAE,EAAE;AAAN,WAAD,CADtB;AAEE,UAAA,QAAQ,EAAEF,aAAa,CAAC;AACtBE,YAAAA,EAAE,EAAE;AADkB,WAAD,CAFzB;AAKE,UAAA,gBAAgB,EAAEF,aAAa,CAAC;AAAEE,YAAAA,EAAE,EAAE;AAAN,WAAD,CALjC;AAME,UAAA,iBAAiB,EAAEF,aAAa,CAAC;AAAEE,YAAAA,EAAE,EAAE;AAAN,WAAD,CANlC;AAOE,UAAA,aAAa,EAAE,yBAAM;AACnB,kBAAKoE,SAAL,CAAeC,cAAf;AACD,WATH;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,UADO,CAAT;AAaA;AACD;;AACD,YAAKD,SAAL,CAAeC,cAAf;AACD,KAzkBkB;;AAAA,UA0kBnBwB,mBA1kBmB,GA0kBG,UAAA9I,KAAK,EAAI;AAC7B,YAAKH,WAAL,CAAiBoI,eAAjB,CAAiCjI,KAAjC;;AACA,YAAKiC,eAAL;AACD,KA7kBkB;;AAAA,UA8kBnB8G,oBA9kBmB,GA8kBI,UAAA/I,KAAK,EAAI;AAC9B,UAAIgJ,MAAJ;AAEA,UAAIC,UAAU,GAAG,EAAjB;AACA,UAAMvE,cAAc,GAAG1D,QAAQ,CAACC,cAAT,CAAwB,oBAAxB,CAAvB;AACA,UAAMiI,YAAY,GAAGlI,QAAQ,CAACC,cAAT,4BACCjB,KAAK,CAACiD,EADP,EAArB;;AAGA,UAAIyB,cAAc,IAAIwE,YAAtB,EAAoC;AAClC,YAAMC,WAAW,GAAGzE,cAAc,CAACD,qBAAf,EAApB;AACA,YAAM2E,SAAS,GAAGF,YAAY,CAACzE,qBAAb,EAAlB;AACAwE,QAAAA,UAAU,CAACrE,GAAX,GACEF,cAAc,CAACI,SAAf,GAA2BsE,SAAS,CAACxE,GAArC,GAA2CwE,SAAS,CAACC,MAAV,GAAmB,CAA9D,GAAkE,EADpE;AAEAJ,QAAAA,UAAU,CAAC7H,IAAX,GAAkB8H,YAAY,CAAC7H,UAAb,GAA0B,EAA5C;AACA,YAAMiI,OAAO,GAAGH,WAAW,CAACI,KAAZ,GAAoB,GAApB,GAA0B,EAA1C;;AACA,YAAIN,UAAU,CAAC7H,IAAX,GAAkBkI,OAAlB,IAA6BA,OAAO,GAAG,EAA3C,EAA+C;AAC7CL,UAAAA,UAAU,CAAC7H,IAAX,GAAkBkI,OAAlB;AACD;AACF;;AAED,cAAQtJ,KAAK,CAACwJ,QAAd;AACE,aAAKhL,IAAI,CAACiL,MAAV;AACET,UAAAA,MAAM,gBACJ,oBAAC,YAAD;AACE,YAAA,YAAY,EAAEhJ,KAAK,CAAC8H,IADtB;AAEE,YAAA,UAAU,EAAEmB,UAFd;AAGE,YAAA,aAAa,EAAE,yBAAM;AACnB,kBAAIjJ,KAAK,CAAC8H,IAAN,KAAe,QAAnB,EAA6B;AAC3B9H,gBAAAA,KAAK,CAAC8H,IAAN,GAAa,CAAb;;AACA,sBAAK7F,eAAL,CAAqB,YAAM;AACzB,wBAAKR,UAAL,CAAgB,IAAhB;;AACA,wBAAKoC,gBAAL;AACD,iBAHD;AAID,eAND,MAMO;AACL,sBAAKpC,UAAL,CAAgB,IAAhB;;AACA,sBAAKoC,gBAAL;AACD;AACF,aAdH;AAeE,YAAA,cAAc,EAAE,wBAAA6F,GAAG,EAAI;AACrB1J,cAAAA,KAAK,CAAC8H,IAAN,GAAa4B,GAAb;;AACA,oBAAKzH,eAAL,CAAqB,YAAM;AACzB,sBAAKR,UAAL,CAAgB,MAAK0G,aAAL,CAAmBnI,KAAnB,CAAhB;;AACA,sBAAK6D,gBAAL;AACD,eAHD;AAID,aArBH;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,YADF;AAyBA;;AACF,aAAKrF,IAAI,CAACmL,QAAV;AACEX,UAAAA,MAAM,gBACJ,oBAAC,cAAD;AACE,YAAA,QAAQ,EAAE,GADZ;AAEE,YAAA,QAAQ,EAAE,GAFZ;AAGE,YAAA,UAAU,EAAEC,UAHd;AAIE,YAAA,aAAa,EAAE,yBAAM;AACnB,oBAAKxH,UAAL,CAAgB,IAAhB;;AACA,oBAAKoC,gBAAL;AACD,aAPH;AAQE,YAAA,cAAc,EAAE,wBAAC+F,CAAD,EAAIC,CAAJ,EAAU;AACxB7J,cAAAA,KAAK,CAAC8H,IAAN,GAAa;AAAE8B,gBAAAA,CAAC,EAADA,CAAF;AAAKC,gBAAAA,CAAC,EAADA;AAAL,eAAb;;AACA,oBAAK5H,eAAL,CAAqB,YAAM;AACzB,sBAAKR,UAAL,CAAgB,MAAK0G,aAAL,CAAmBnI,KAAnB,CAAhB;;AACA,sBAAK6D,gBAAL;AACD,eAHD;AAID,aAdH;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,YADF;AAkBA;;AACF,aAAKrF,IAAI,CAACsL,MAAV;AACEd,UAAAA,MAAM,gBACJ,oBAAC,YAAD;AACE,YAAA,YAAY,EAAEhJ,KAAK,CAAC8H,IADtB;AAEE,YAAA,UAAU,EAAEmB,UAFd;AAGE,YAAA,aAAa,EAAE,yBAAM;AACnB,oBAAKxH,UAAL,CAAgB,IAAhB;;AACA,oBAAKoC,gBAAL;AACD,aANH;AAOE,YAAA,cAAc,EAAE,wBAAAkG,IAAI,EAAI;AACtB/J,cAAAA,KAAK,CAAC8H,IAAN,GAAaiC,IAAb;;AACA,oBAAK9H,eAAL,CAAqB,YAAM;AACzB,sBAAKR,UAAL,CAAgB,MAAK0G,aAAL,CAAmBnI,KAAnB,CAAhB;;AACA,sBAAK6D,gBAAL;AACD,eAHD;AAID,aAbH;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,YADF;AAiBA;;AACF;AACE;AApEJ;;AAsEA,UAAImF,MAAJ,EAAY,MAAKvF,gBAAL,CAAsBuF,MAAtB;AACb,KAzqBkB;;AAAA,UA4qBnBgB,kBA5qBmB,GA4qBE,UAAAhK,KAAK,EAAI;AAC5B,0CACK,MAAKiK,mBAAL,EADL,sBAEK,MAAKC,qBAAL,EAFL,sBAGK,MAAKC,mBAAL,EAHL,sBAIK,MAAKC,qBAAL,EAJL,sBAKK,MAAKC,qBAAL,EALL,sBAMK,MAAKC,qBAAL,CAA2BtK,KAA3B,CANL,sBAOK,MAAKuK,iBAAL,EAPL;AASD,KAtrBkB;;AAAA,UAurBnBN,mBAvrBmB,GAurBG,YAAM;AAC1B,UAAMO,OAAO,GAAG,EAAhB,CAD0B,CAE1B;;AACA,WAAK,IAAIC,QAAT,IAAqB,MAAKtL,KAAL,CAAWmB,KAAX,CAAiBkK,OAAtC,EAA+C;AAC7C,YAAMpK,MAAM,GAAG,MAAKjB,KAAL,CAAWmB,KAAX,CAAiBkK,OAAjB,CAAyBC,QAAzB,CAAf;;AACA,gBAAQrK,MAAM,CAACQ,IAAf;AACE,eAAK,QAAL;AACA,eAAK,MAAL;AACE4J,YAAAA,OAAO,CAACzC,IAAR,CAAa;AAAEnH,cAAAA,IAAI,EAAER,MAAM,CAACQ,IAAf;AAAqBF,cAAAA,IAAI,EAAE+J;AAA3B,aAAb;AACA;;AACF,eAAK,OAAL;AACED,YAAAA,OAAO,CAACzC,IAAR,CAAa;AAAEnH,cAAAA,IAAI,EAAE,QAAR;AAAkBF,cAAAA,IAAI,EAAE+J;AAAxB,aAAb;AACA;;AACF,eAAK,WAAL;AACED,YAAAA,OAAO,CAACzC,IAAR,CAAa;AAAEnH,cAAAA,IAAI,EAAE,UAAR;AAAoBF,cAAAA,IAAI,EAAE+J;AAA1B,aAAb;AACA;;AACF,eAAK,YAAL;AACED,YAAAA,OAAO,CAACzC,IAAR,CAAa;AAAEnH,cAAAA,IAAI,EAAE,YAAR;AAAsBF,cAAAA,IAAI,EAAE+J;AAA5B,aAAb;AACA;;AACF,eAAK,QAAL;AACED,YAAAA,OAAO,CAACzC,IAAR,CAAa;AAAEnH,cAAAA,IAAI,EAAE,QAAR;AAAkBF,cAAAA,IAAI,EAAE+J;AAAxB,aAAb;AACA;;AACF;AACEC,YAAAA,OAAO,CAACC,IAAR,sDACgDvK,MAAM,CAACQ,IADvD;AAlBJ;AAsBD,OA3ByB,CA4B1B;;;AACA,WAAK,IAAIgK,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAG,MAAKzL,KAAL,CAAW0L,QAAX,CAAoBlF,MAAxC,EAAgDiF,CAAC,EAAjD,EAAqD;AACnD,YAAME,OAAO,GAAG,MAAK3L,KAAL,CAAW0L,QAAX,CAAoBD,CAApB,CAAhB;AACA,YAAMG,SAAS,GAAG5M,YAAY,CAAC6M,aAAb,CAA2BF,OAA3B,EAAoCG,WAAtD;AACAT,QAAAA,OAAO,CAACzC,IAAR,CAAa;AAAEnH,UAAAA,IAAI,EAAE,OAAR;AAAiBF,UAAAA,IAAI,EAAEqK;AAAvB,SAAb;AACD;;AACD,UAAMG,SAAS,GAAG,CAChB1M,IAAI,CAAC2M,MADW,EAEhB3M,IAAI,CAAC4M,MAFW,EAGhB5M,IAAI,CAAC6M,QAHW,EAIhB7M,IAAI,CAAC8M,IAJW,EAKhB9M,IAAI,CAAC+M,KALW,CAAlB;AAOAf,MAAAA,OAAO,CAACgB,IAAR,CAAa,UAAC9C,IAAD,EAAO+C,IAAP,EAAgB;AAC3B,eAAOP,SAAS,CAAC5H,OAAV,CAAkBoF,IAAI,CAAC9H,IAAvB,IAA+BsK,SAAS,CAAC5H,OAAV,CAAkBmI,IAAI,CAAC7K,IAAvB,CAAtC;AACD,OAFD;AAGA,UAAM4I,QAAQ,GAAG;AACfpJ,QAAAA,MAAM,EAAE5B,IAAI,CAAC4M,MADE;AAEfrB,QAAAA,IAAI,EAAEvL,IAAI,CAAC8M,IAFI;AAGfI,QAAAA,UAAU,EAAElN,IAAI,CAAC2M,MAHF;AAIfQ,QAAAA,QAAQ,EAAEnN,IAAI,CAAC6M,QAJA;AAKfO,QAAAA,KAAK,EAAEpN,IAAI,CAAC+M;AALG,OAAjB;AAOA,aAAOf,OAAO,CAACqB,GAAR,CAAY,UAAAzL,MAAM,EAAI;AAC3B,eAAO9B,KAAK,CAACwN,eAAN,CAAsB;AAC3B7L,UAAAA,SAAS,EAAE1B,KAAK,CAAC6M,MADU;AAE3B5B,UAAAA,QAAQ,EAAEA,QAAQ,CAACpJ,MAAM,CAACQ,IAAR,CAFS;AAG3BkH,UAAAA,IAAI,EAAE1H,MAAM,CAACM;AAHc,SAAtB,CAAP;AAKD,OANM,CAAP;AAOD,KAjvBkB;;AAAA,UAkvBnBwJ,qBAlvBmB,GAkvBK,YAAM;AAC5B;AACA,aAAO,MAAK/K,KAAL,CAAWkE,eAAX,GACH,MAAKlE,KAAL,CAAWkE,eAAX,CAA2BwI,GAA3B,CAA+B,UAAAE,QAAQ,EAAI;AACzC,eAAOzN,KAAK,CAACwN,eAAN,CAAsB;AAC3B7L,UAAAA,SAAS,EAAE1B,KAAK,CAACyN,QADU;AAE3BxC,UAAAA,QAAQ,EAAEhL,IAAI,CAACyN,GAFY;AAG3BnE,UAAAA,IAAI,EAAEiE;AAHqB,SAAtB,CAAP;AAKD,OAND,CADG,GAQH,EARJ;AASD,KA7vBkB;;AAAA,UA8vBnB5B,mBA9vBmB,GA8vBG,YAAM;AAC1B,aAAOzL,OAAO,CAACmN,GAAR,CAAY,UAAAK,MAAM,EAAI;AAC3B,eAAO5N,KAAK,CAACwN,eAAN,CAAsB;AAC3B7L,UAAAA,SAAS,EAAE1B,KAAK,CAAC4N,MADU;AAE3BC,UAAAA,eAAe,EAAEF,MAAM,CAACE,eAFG;AAG3BtE,UAAAA,IAAI,EAAEoE,MAAM,CAACxL,IAHc;AAI3B8H,UAAAA,MAAM,EACJ0D,MAAM,CAAC1D,MAAP,IACA0D,MAAM,CAAC1D,MAAP,CAAcqD,GAAd,CAAkB,UAAAlD,KAAK;AAAA,mBACrBA,KAAK,CAAC0D,UAAN,CAAiB/I,OAAjB,CAAyB/E,KAAK,CAAC+N,QAA/B,IAA2C,CAAC,CAA5C,GACIhO,KAAK,CAACiO,cAAN,EADJ,GAEIjO,KAAK,CAACkO,WAAN,mBAAuB7D,KAAvB,EAHiB;AAAA,WAAvB;AANyB,SAAtB,CAAP;AAYD,OAbM,CAAP;AAcD,KA7wBkB;;AAAA,UA8wBnByB,qBA9wBmB,GA8wBK,YAAM;AAC5B,aAAOzL,UAAU,CAACkN,GAAX,CAAe,UAAAY,QAAQ,EAAI;AAChC,eAAOnO,KAAK,CAACwN,eAAN,CAAsB;AAC3B7L,UAAAA,SAAS,EAAE1B,KAAK,CAACmO,QADU;AAE3BN,UAAAA,eAAe,EAAEK,QAAQ,CAACL,eAFC;AAG3B5C,UAAAA,QAAQ,EAAEiD,QAAQ,CAACjD,QAHQ;AAI3B1B,UAAAA,IAAI,EAAE2E,QAAQ,CAAC/L;AAJY,SAAtB,CAAP;AAMD,OAPM,CAAP;AAQD,KAvxBkB;;AAAA,UAwxBnB2J,qBAxxBmB,GAwxBK,YAAM;AAC5B,aAAOzL,SAAS,CAACiN,GAAV,CAAc,UAAAc,QAAQ,EAAI;AAC/B,eAAOrO,KAAK,CAACwN,eAAN,CAAsB;AAC3B7L,UAAAA,SAAS,EAAE1B,KAAK,CAACqO,QADU;AAE3BpD,UAAAA,QAAQ,EAAEmD,QAAQ,CAACnD,QAFQ;AAG3B1B,UAAAA,IAAI,EAAE6E,QAAQ,CAACjM,IAHY;AAI3B8H,UAAAA,MAAM,EACJmE,QAAQ,CAACnE,MAAT,IACAmE,QAAQ,CAACnE,MAAT,CAAgBqD,GAAhB,CAAoB,UAAAlD,KAAK;AAAA,mBAAIrK,KAAK,CAACkO,WAAN,mBAAuB7D,KAAvB,EAAJ;AAAA,WAAzB;AANyB,SAAtB,CAAP;AAQD,OATM,CAAP;AAUD,KAnyBkB;;AAAA,UAoyBnB2B,qBApyBmB,GAoyBK,UAAAtK,KAAK,EAAI;AAC/B,UAAM6M,OAAO,GAAG,CAAC;AAAErD,QAAAA,QAAQ,EAAEhL,IAAI,CAACiL,MAAjB;AAAyB3B,QAAAA,IAAI,EAAE;AAA/B,OAAD,CAAhB;AAEA,UAAMgF,OAAO,IACX;AAAEtD,QAAAA,QAAQ,EAAEhL,IAAI,CAACsL,MAAjB;AAAyBhC,QAAAA,IAAI,EAAE;AAA/B,OADW,4BAER,MAAK3I,KAAL,CAAW4N,aAAX,CAAyBlB,GAAzB,CAA6B,UAAAmB,MAAM;AAAA,eAAK;AACzCxD,UAAAA,QAAQ,EAAEhL,IAAI,CAACsL,MAD0B;AAEzChC,UAAAA,IAAI,EAAEkF;AAFmC,SAAL;AAAA,OAAnC,CAFQ,EAAb;AAQA,UAAMC,QAAQ,GAAG,CACf;AAAEzD,QAAAA,QAAQ,EAAEhL,IAAI,CAAC0O,OAAjB;AAA0BpF,QAAAA,IAAI,EAAE;AAAhC,OADe,EAEf;AAAE0B,QAAAA,QAAQ,EAAEhL,IAAI,CAAC0O,OAAjB;AAA0BpF,QAAAA,IAAI,EAAE;AAAhC,OAFe,CAAjB;AAKA,UAAMqF,UAAU,GAAG,CACjB;AAAE3D,QAAAA,QAAQ,EAAEhL,IAAI,CAAC4O,SAAjB;AAA4BtF,QAAAA,IAAI,EAAE;AAAlC,OADiB,EAEjB;AAAE0B,QAAAA,QAAQ,EAAEhL,IAAI,CAAC4O,SAAjB;AAA4BtF,QAAAA,IAAI,EAAE;AAAlC,OAFiB,EAGjB;AAAE0B,QAAAA,QAAQ,EAAEhL,IAAI,CAAC4O,SAAjB;AAA4BtF,QAAAA,IAAI,EAAE;AAAlC,OAHiB,EAIjB;AAAE0B,QAAAA,QAAQ,EAAEhL,IAAI,CAAC4O,SAAjB;AAA4BtF,QAAAA,IAAI,EAAE;AAAlC,OAJiB,CAAnB;AAOA,UAAMuF,UAAU,GAAG,EAAnB;AACA,UAAMC,aAAa,GAAGtN,KAAK,IAAIA,KAAK,CAACuN,iBAAN,EAA/B;;AACA,UAAID,aAAJ,EAAmB;AACjB,YAAME,MAAM,GAAG,EAAf;;AACA,YAAIF,aAAa,CAAC9D,QAAd,KAA2BhL,IAAI,CAAC4M,MAApC,EAA4C;AAC1C,cAAM5K,UAAU,GAAG8M,aAAa,CAACxF,IAAjC;AACA,cAAM2F,YAAY,GAAGjN,UAAU,CAACkN,KAAX,CAAiB,GAAjB,EAAsB,CAAtB,CAArB;AACA,cAAMC,KAAK,GAAGxP,YAAY,CAACyP,cAAb,CAA4BH,YAA5B,CAAd;AACA,cAAIE,KAAJ,EAAWH,MAAM,CAACzF,IAAP,CAAY4F,KAAZ;AACZ,SALD,MAKO,IAAIL,aAAa,CAAC9D,QAAd,KAA2BhL,IAAI,CAACyN,GAApC,EAAyC;AAAA,cACtCzB,OADsC,GAC1B,MAAKrL,KAAL,CAAWmB,KADe,CACtCkK,OADsC;;AAE9C,eAAK,IAAIC,QAAT,IAAqBD,OAArB,EAA8B;AAC5B,gBAAMpK,MAAM,GAAGoK,OAAO,CAACC,QAAD,CAAtB;;AACA,gBAAIrK,MAAM,CAACQ,IAAP,KAAgB,QAApB,EAA8B;AAC5B,kBAAM+M,MAAK,GAAGxP,YAAY,CAAC0P,QAAb,CAAsBzN,MAAM,CAAC0N,OAA7B,CAAd;;AACA,kBAAIH,MAAJ,EAAWH,MAAM,CAACzF,IAAP,CAAY4F,MAAZ;AACZ;AACF;AACF;;AACDH,QAAAA,MAAM,CAACO,OAAP,CAAe,UAAAJ,KAAK,EAAI;AACtB,cAAIA,KAAK,CAACK,gBAAV,EAA4B;AAC1BC,YAAAA,MAAM,CAACC,IAAP,CAAYP,KAAK,CAACK,gBAAlB,EAAoCD,OAApC,CAA4C,UAAAI,GAAG;AAAA,qBAC7Cd,UAAU,CAACtF,IAAX,CAAgB;AAAEyB,gBAAAA,QAAQ,EAAEhL,IAAI,CAAC4P,SAAjB;AAA4BtG,gBAAAA,IAAI,EAAEqG;AAAlC,eAAhB,CAD6C;AAAA,aAA/C;AAGD;AACF,SAND;AAOD;;AAED,UAAME,OAAO,GACV,MAAKlP,KAAL,CAAWmP,QAAX,IACC,MAAKnP,KAAL,CAAWmP,QAAX,CAAoBzC,GAApB,CAAwB,UAAAxL,OAAO;AAAA,eAAK;AAClCmJ,UAAAA,QAAQ,EAAEhL,IAAI,CAAC2M,MADmB;AAElCrD,UAAAA,IAAI,EAAEzH;AAF4B,SAAL;AAAA,OAA/B,CADF,IAKA,EANF;AAQA,UAAMkO,SAAS,GAAG,CAAC;AAAE/E,QAAAA,QAAQ,EAAEhL,IAAI,CAACmL,QAAjB;AAA2B7B,QAAAA,IAAI,EAAE;AAAE8B,UAAAA,CAAC,EAAE,GAAL;AAAUC,UAAAA,CAAC,EAAE;AAAb;AAAjC,OAAD,CAAlB;AAEA,UAAM2E,MAAM,GAAG;AAAEhF,QAAAA,QAAQ,EAAEhL,IAAI,CAACiQ,MAAjB;AAAyB3G,QAAAA,IAAI,EAAE;AAA/B,OAAf;AAEA,UAAM4G,KAAK,GAAG;AAAElF,QAAAA,QAAQ,EAAEhL,IAAI,CAACmQ,KAAjB;AAAwB7G,QAAAA,IAAI,EAAE;AAA9B,OAAd;AAEA,UAAM8G,MAAM,GAAG,CACb;AAAEpF,QAAAA,QAAQ,EAAEhL,IAAI,CAACqQ,IAAjB;AAAuB/G,QAAAA,IAAI,EAAE;AAA7B,OADa,EAEb;AAAE0B,QAAAA,QAAQ,EAAEhL,IAAI,CAACqQ,IAAjB;AAAuB/G,QAAAA,IAAI,EAAE;AAA7B,OAFa,CAAf;AAKA,aAAO,UACF+E,OADE,qBAEFC,OAFE,GAGFG,QAHE,EAIFE,UAJE,EAKFE,UALE,qBAMFgB,OANE,GAOFE,SAPE,GAQLC,MARK,EASLE,KATK,GAUFE,MAVE,EAWL/C,GAXK,CAWD,UAAAiD,QAAQ,EAAI;AAChB,eAAOxQ,KAAK,CAACwN,eAAN,CAAsB;AAC3B7L,UAAAA,SAAS,EAAE1B,KAAK,CAACwQ,QADU;AAE3BvF,UAAAA,QAAQ,EAAEsF,QAAQ,CAACtF,QAFQ;AAG3B1B,UAAAA,IAAI,EAAEgH,QAAQ,CAAChH;AAHY,SAAtB,CAAP;AAKD,OAjBM,CAAP;AAkBD,KA53BkB;;AAAA,UA63BnByC,iBA73BmB,GA63BC,YAAM;AACxB,aAAO1L,KAAK,CAACgN,GAAN,CAAU,UAAAmD,IAAI,EAAI;AACvB,eAAO1Q,KAAK,CAACwN,eAAN,CAAsB;AAC3B7L,UAAAA,SAAS,EAAE1B,KAAK,CAAC0Q,IADU;AAE3B7C,UAAAA,eAAe,EAAE4C,IAAI,CAAC5C,eAFK;AAG3B5C,UAAAA,QAAQ,EAAEwF,IAAI,CAACxF,QAHY;AAI3B1B,UAAAA,IAAI,EAAEkH,IAAI,CAACtO,IAJgB;AAK3B8H,UAAAA,MAAM,EACJwG,IAAI,CAACxG,MAAL,IACAwG,IAAI,CAACxG,MAAL,CAAYqD,GAAZ,CAAgB,UAAAlD,KAAK;AAAA,mBACnBA,KAAK,CAAC0D,UAAN,CAAiB/I,OAAjB,CAAyB/E,KAAK,CAAC+N,QAA/B,IAA2C,CAAC,CAA5C,GACIhO,KAAK,CAACiO,cAAN,EADJ,GAEIjO,KAAK,CAACkO,WAAN,mBAAuB7D,KAAvB,EAHe;AAAA,WAArB;AAPyB,SAAtB,CAAP;AAaD,OAdM,CAAP;AAeD,KA74BkB;;AAAA,UA+4BnBnJ,iBA/4BmB,GA+4BC,UAAAQ,KAAK,EAAI;AAC3B,UAAMkP,eAAe,GAAG,MAAKlF,kBAAL,CAAwBhK,KAAxB,CAAxB;;AACA,YAAKb,KAAL,CAAWgQ,kBAAX,CAA8BD,eAA9B;;AACA,UAAI3P,cAAc,GAAG2P,eAArB,CAH2B,CAK3B;;AAL2B,UAMnBE,eANmB,GAMC,MAAKjQ,KANN,CAMnBiQ,eANmB;;AAO3B,UAAIA,eAAJ,EAAqB;AACnB,YAAM/C,UAAU,GAAG4B,MAAM,CAACC,IAAP,CAAYkB,eAAZ,CAAnB;AACA7P,QAAAA,cAAc,GAAGA,cAAc,CAACQ,MAAf,CAAsB,UAAAsP,aAAa,EAAI;AACtD,cAAMC,KAAK,GAAGF,eAAe,CAACC,aAAa,CAACpP,SAAf,CAA7B;AACA,cAAI,CAACqP,KAAL,EAAY,OAAO,KAAP,CAF0C,CAItD;;AACA,cACED,aAAa,CAACpP,SAAd,KAA4B1B,KAAK,CAAC6M,MAAlC,IACAiE,aAAa,CAAC7F,QAAd,KAA2BhL,IAAI,CAAC2M,MAFlC,EAGE;AACA,mBAAOmE,KAAK,CAAChM,OAAN,CAAc9E,IAAI,CAAC2M,MAAnB,IAA6B,CAAC,CAArC;AACD,WAVqD,CAYtD;;;AACA,cAAIkE,aAAa,CAACpP,SAAd,KAA4B1B,KAAK,CAACwQ,QAAtC,EAAgD;AAC9C,mBACEO,KAAK,CAAChM,OAAN,CAAc+L,aAAa,CAAC7F,QAA5B,IAAwC,CAAC,CAAzC,IACA8F,KAAK,CAAChM,OAAN,CAAc+L,aAAa,CAACvH,IAA5B,IAAoC,CAAC,CAFvC;AAID,WAlBqD,CAoBtD;;;AACA,iBACEuE,UAAU,CAAC/I,OAAX,CAAmB+L,aAAa,CAACpP,SAAjC,IAA8C,CAAC,CAA/C,IACAqP,KAAK,CAAChM,OAAN,CAAc+L,aAAa,CAACvH,IAA5B,IAAoC,CAAC,CAFvC;AAID,SAzBgB,CAAjB;AA0BD,OAnC0B,CAqC3B;;;AACAvI,MAAAA,cAAc,GAAGA,cAAc,CAACQ,MAAf,CAAsB,UAAAsP,aAAa,EAAI;AACtD;AACA,YAAME,YAAY,GAChBvP,KAAK,CAACqM,UAAN,CAAiB/I,OAAjB,CAAyB+L,aAAa,CAACpP,SAAvC,IAAoD,CAAC,CADvD;;AAEA,YAAI,CAACsP,YAAL,EAAmB;AACjB,iBAAO,KAAP;AACD,SANqD,CAOtD;;;AACA,YAAIvP,KAAK,CAAC0F,MAAN,YAAwBpH,KAAxB,IAAiC+Q,aAAa,CAACjD,eAAnD,EAAoE;AAClE,cAAMoD,eAAe,GACnBH,aAAa,CAACjD,eAAd,CAA8B9I,OAA9B,CAAsCtD,KAAK,CAAC0F,MAAN,CAAa8D,QAAnD,IAA+D,CAAC,CAAhE,IACAxJ,KAAK,CAAC0F,MAAN,CAAa8D,QAAb,KAA0BhL,IAAI,CAACyN,GAFjC;;AAGA,cAAI,CAACuD,eAAL,EAAsB;AACpB,mBAAO,KAAP;AACD;AACF,SAfqD,CAgBtD;;;AACA,YACEH,aAAa,CAAC7F,QAAd,IACA6F,aAAa,CAAC7F,QAAd,KAA2BhL,IAAI,CAACyN,GADhC,IAEAjM,KAAK,CAACyP,SAAN,CAAgBJ,aAAa,CAACpP,SAA9B,EAAyCqD,OAAzC,CACE+L,aAAa,CAAC7F,QADhB,IAEI,CAJJ,IAKAxJ,KAAK,CAACyP,SAAN,CAAgBJ,aAAa,CAACpP,SAA9B,EAAyCqD,OAAzC,CAAiD9E,IAAI,CAACyN,GAAtD,IAA6D,CAN/D,EAOE;AACA,iBAAO,KAAP;AACD,SA1BqD,CA2BtD;;;AACA,YAAIjM,KAAK,CAAC0F,MAAN,YAAwBpH,KAAxB,IAAiC0B,KAAK,CAAC0F,MAAN,CAAaoC,IAAb,KAAsB,KAA3D,EAAkE;AAChE,cACEuH,aAAa,CAAC7F,QAAd,KAA2BhL,IAAI,CAACiQ,MAAhC,IACAY,aAAa,CAAC7F,QAAd,KAA2BhL,IAAI,CAACmQ,KADhC,IAEAU,aAAa,CAAC7F,QAAd,KAA2BhL,IAAI,CAACqQ,IAHlC,EAIE;AACA,mBAAO,KAAP;AACD;AACF,SApCqD,CAqCtD;;;AACA,YACEQ,aAAa,CAACpP,SAAd,KAA4B1B,KAAK,CAAC4N,MAAlC,KACCkD,aAAa,CAACvH,IAAd,KAAuB,eAAvB,IACCuH,aAAa,CAACvH,IAAd,KAAuB,eAFzB,CADF,EAIE;AACA,cAAMwF,aAAa,GAAGtN,KAAK,CAACuN,iBAAN,EAAtB;;AACA,cAAID,aAAa,IAAIA,aAAa,CAAC9D,QAAd,KAA2BhL,IAAI,CAAC4M,MAArD,EAA6D;AAC3D,gBAAM5K,UAAU,GAAG8M,aAAa,CAACxF,IAAjC;AACA,gBAAM2F,YAAY,GAAGjN,UAAU,CAACkN,KAAX,CAAiB,GAAjB,EAAsB,CAAtB,CAArB;AACA,gBAAMC,KAAK,GAAGxP,YAAY,CAACyP,cAAb,CAA4BH,YAA5B,CAAd;;AACA,gBAAI,CAACE,KAAD,IAAU,CAACA,KAAK,CAACK,gBAArB,EAAuC;AACrCqB,cAAAA,aAAa,CAAClI,QAAd,GAAyB,IAAzB;AACD;AACF;AACF;;AACD,eAAO,IAAP;AACD,OAtDgB,CAAjB;AAuDA,aAAO5H,cAAP;AACD,KA7+BkB;;AAAA,UA++BnBmQ,qBA/+BmB,GA++BK,UAAAC,KAAK,EAAI;AAAA,wBACH,MAAKxQ,KADF;AAAA,UACvByQ,QADuB,eACvBA,QADuB;AAAA,UACbC,KADa,eACbA,KADa;AAE/B,UAAID,QAAQ,KAAK5R,QAAQ,CAAC8R,OAA1B,EAAmC;AAFJ,UAGvBpP,IAHuB,GAGLiP,KAHK,CAGvBjP,IAHuB;AAAA,UAGjBqP,OAHiB,GAGLJ,KAHK,CAGjBI,OAHiB;AAI/B,UAAMC,QAAQ,uCAAgCH,KAAhC,iCACCnP,IADD,8BAEDqP,OAFC,CAAd;AAGArF,MAAAA,OAAO,CAACiF,KAAR,CAAcK,QAAd;AACD,KAv/BkB;;AAEjB,UAAK1Q,KAAL,GAAa;AACXkD,MAAAA,KAAK,EAAE,EADI;AAEX4B,MAAAA,WAAW,EAAE,IAFF;AAGX/E,MAAAA,YAAY,EAAE,IAHH;AAIXI,MAAAA,UAAU,EAAE,EAJD;AAKXG,MAAAA,eAAe,EAAE,IALN;AAMXL,MAAAA,cAAc,EAAE,EANL;AAOXqE,MAAAA,YAAY,EAAE,IAPH;AAQXU,MAAAA,eAAe,EAAE;AARN,KAAb;AAFiB;AAYlB;;;;WACD,6BAAoB;AAClB,WAAK2L,kBAAL;AACD;;;WACD,gCAAuB;AACrB,UAAI,KAAKtJ,cAAT,EAAyB;AACvBC,QAAAA,aAAa,CAAC,KAAKD,cAAN,CAAb;AACA,aAAKA,cAAL,GAAsB/E,SAAtB;AACD;AACF;;;WACD,4BAAmBsO,SAAnB,EAA8B;AAC5B;AACA,UACE,KAAK/Q,KAAL,CAAWiB,MAAX,IACA,KAAKjB,KAAL,CAAWiB,MAAX,CAAkBK,OADlB,IAEAyP,SAAS,CAAC9P,MAFV,IAGA8P,SAAS,CAAC9P,MAAV,CAAiBK,OAJnB,EAKE;AACA,YAAIyP,SAAS,CAAC9P,MAAV,CAAiBK,OAAjB,CAAyBC,IAAzB,KAAkC,KAAKvB,KAAL,CAAWiB,MAAX,CAAkBK,OAAlB,CAA0BC,IAAhE,EAAsE;AACpE,eAAKyP,cAAL;AACD;AACF,OAX2B,CAY5B;;;AACA,UACE,KAAK7Q,KAAL,CAAWD,YAAX,IACA,KAAKC,KAAL,CAAWM,eAAX,KAA+BrB,KAAK,CAACyN,QADrC,IAEA5J,IAAI,CAACC,SAAL,CAAe6N,SAAS,CAAC7M,eAAzB,MACEjB,IAAI,CAACC,SAAL,CAAe,KAAKlD,KAAL,CAAWkE,eAA1B,CAJJ,EAKE;AACA,YAAM9D,cAAc,GAAG,KAAKC,iBAAL,CACrB,KAAKF,KAAL,CAAWD,YADU,EAErBU,MAFqB,CAEd,UAAAC,KAAK;AAAA,iBAAIA,KAAK,CAACC,SAAN,KAAoB1B,KAAK,CAACyN,QAA9B;AAAA,SAFS,CAAvB;AAGA,aAAK9L,QAAL,CAAc;AAAEX,UAAAA,cAAc,EAAdA;AAAF,SAAd;AACD,OAvB2B,CAwB5B;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AACA,UACE2Q,SAAS,CAAC9P,MAAV,IACA,KAAKjB,KAAL,CAAWiB,MADX,IAEA8P,SAAS,CAAC9P,MAAV,CAAiBK,OAFjB,IAGA,KAAKtB,KAAL,CAAWiB,MAAX,CAAkBK,OAHlB,IAIAyP,SAAS,CAAC9P,MAAV,CAAiBK,OAAjB,CAAyBC,IAAzB,KAAkC,KAAKvB,KAAL,CAAWiB,MAAX,CAAkBK,OAAlB,CAA0BC,IAJ5D,IAKAwP,SAAS,CAAC9P,MAAV,CAAiB+B,IAAjB,KAA0B,KAAKhD,KAAL,CAAWiB,MAAX,CAAkB+B,IAN9C,EAOE;AACA,aAAK8N,kBAAL;AACD;AACF;;;WACD,0BAAiB;AAAA;;AACf,UAAI;AACF,YAAMG,eAAe,GAAGhO,IAAI,CAACiO,KAAL,CAAW,KAAKlR,KAAL,CAAWiB,MAAX,CAAkB+B,IAA7B,CAAxB;AACA,aAAKtC,WAAL,GAAmBzB,OAAO,CAACkS,eAAR,CAAwBF,eAAxB,CAAnB;AACA,aAAKlQ,QAAL,CACE;AAAEsC,UAAAA,KAAK,EAAE,KAAK3C,WAAL,CAAiB4C,QAAjB,EAAT;AAAsCpD,UAAAA,YAAY,EAAE;AAApD,SADF,EAEE,YAAM;AACJ,UAAA,MAAI,CAACkR,mBAAL;;AACA,UAAA,MAAI,CAACC,oBAAL;;AACA,UAAA,MAAI,CAACC,oBAAL;AACD,SANH;AAQD,OAXD,CAWE,OAAOC,GAAP,EAAY;AACZ,aAAKhB,qBAAL,CAA2BgB,GAA3B;AACA,aAAK7Q,WAAL,GAAmB,IAAIzB,OAAJ,EAAnB;AACA,aAAK8B,QAAL,CAAc;AAAEsC,UAAAA,KAAK,EAAE,KAAK3C,WAAL,CAAiB4C,QAAjB,EAAT;AAAsCpD,UAAAA,YAAY,EAAE;AAApD,SAAd;AACD;AACF;;;WACD,8BAAqB;AAAA;;AACnB,UAAI;AACF,YAAM+Q,eAAe,GAAGhO,IAAI,CAACiO,KAAL,CAAW,KAAKlR,KAAL,CAAWiB,MAAX,CAAkB+B,IAA7B,CAAxB;AACA,aAAKtC,WAAL,GAAmBzB,OAAO,CAACkS,eAAR,CAAwBF,eAAxB,CAAnB;AACA,aAAKlQ,QAAL,CAAc;AAAEsC,UAAAA,KAAK,EAAE,KAAK3C,WAAL,CAAiB4C,QAAjB;AAAT,SAAd,EAAsD,YAAM;AAC1D,UAAA,MAAI,CAAC8N,mBAAL;;AACA,UAAA,MAAI,CAACC,oBAAL;;AACA,UAAA,MAAI,CAACC,oBAAL;AACD,SAJD;AAKD,OARD,CAQE,OAAOC,GAAP,EAAY;AACZ,aAAKhB,qBAAL,CAA2BgB,GAA3B;AACA,aAAK7Q,WAAL,GAAmB,IAAIzB,OAAJ,EAAnB;;AACA,YAAI,KAAKe,KAAL,CAAWiB,MAAf,EAAuB;AACrB,cAAMC,OAAO,GAAG,KAAKlB,KAAL,CAAWmB,KAAX,CAAiBC,SAAjC;AACA,cAAMC,UAAU,GAAG,KAAKrB,KAAL,CAAWiB,MAAX,CAAkBK,OAAlB,CAA0BC,IAA7C;AACA,cAAMyB,IAAI,GAAGC,IAAI,CAACC,SAAL,CAAe,KAAKxC,WAAL,CAAiByC,aAAjB,EAAf,CAAb;AACA,eAAKnD,KAAL,CAAWoD,aAAX,CAAyBlC,OAAzB,EAAkCG,UAAlC,EAA8C2B,IAA9C;AACD;AACF;AACF;;;WACD,+BAAsB;AACpB,UAAMwO,WAAW,GAAG,KAAK9Q,WAAL,CAAiB+Q,cAAjB,EAApB;AACA,WAAK1Q,QAAL,CAAc;AAAEkE,QAAAA,WAAW,EAAEuM;AAAf,OAAd;AACD;;;WACD,gCAAuB;AAAA;;AACrB,UAAMA,WAAW,GAAG,KAAK9Q,WAAL,CAAiB+Q,cAAjB,EAApB;AACA,UAAMC,YAAY,GAAG,KAAKhR,WAAL,CAAiBiR,eAAjB,EAArB;AACA,WAAK5Q,QAAL,CACE;AAAEb,QAAAA,YAAY,EAAEwR,YAAhB;AAA8BzM,QAAAA,WAAW,EAAEuM;AAA3C,OADF,EAEE,YAAM;AACJ,QAAA,MAAI,CAACvR,mBAAL;AACD,OAJH;AAMD;;;WACD,gCAAuB;AACrB,UAAM2R,YAAY,GAAG,KAAKlR,WAAL,CAAiBmR,eAAjB,EAArB;;AACA,UAAID,YAAJ,EAAkB;AAChB,aAAKhI,oBAAL,CAA0BgI,YAA1B;AACD,OAFD,MAEO;AACL,aAAKlN,gBAAL;AACD;AACF,K,CAED;;;;WAwBA,2BAAkBoN,MAAlB,EAA0B;AACxB,UAAMC,WAAW,GAAG,IAAIC,GAAJ,EAApB;;AACA,WAAK,IAAIvG,CAAT,IAAcqG,MAAd,EAAsB;AACpB,YAAMjR,KAAK,GAAGiR,MAAM,CAACrG,CAAD,CAApB;AACAsG,QAAAA,WAAW,CAAC5L,GAAZ,CAAgBtF,KAAK,CAACC,SAAtB;AACD;;AACD,UAAMmR,gBAAgB,GAAG,CACvB7S,KAAK,CAACwQ,QADiB,EAEvBxQ,KAAK,CAAC6M,MAFiB,EAGvB7M,KAAK,CAAC4N,MAHiB,EAIvB5N,KAAK,CAACmO,QAJiB,EAKvBnO,KAAK,CAACqO,QALiB,EAMvBrO,KAAK,CAAC0Q,IANiB,EAOvB1Q,KAAK,CAACyN,QAPiB,EAQvBzN,KAAK,CAAC8S,QARiB,EASvB9S,KAAK,CAAC+N,QATiB,CAAzB;AAWA,UAAM7M,UAAU,GAAG6R,KAAK,CAACC,IAAN,CAAWL,WAAX,EAAwB1F,IAAxB,CACjB,UAAC9C,IAAD,EAAO+C,IAAP;AAAA,eACE2F,gBAAgB,CAAC9N,OAAjB,CAAyBoF,IAAzB,IAAiC0I,gBAAgB,CAAC9N,OAAjB,CAAyBmI,IAAzB,CADnC;AAAA,OADiB,CAAnB;AAIA,aAAOhM,UAAP;AACD;;;WACD,sCAA6BO,KAA7B,EAAoCP,UAApC,EAAgD;AAC9C,UACEO,KAAK,CAACqM,UAAN,CAAiBmF,QAAjB,CAA0BjT,KAAK,CAACyN,QAAhC,KACA,CAACvM,UAAU,CAAC+R,QAAX,CAAoBjT,KAAK,CAACyN,QAA1B,CAFH,EAGE;AACAvM,QAAAA,UAAU,CAACsI,IAAX,CAAgBxJ,KAAK,CAACyN,QAAtB;AACD;AACF,K,CAED;;;;WAk0BA,kBAAS;AAAA,wBAUH,KAAK1M,KAVF;AAAA,UAELkD,KAFK,eAELA,KAFK;AAAA,UAGL4B,WAHK,eAGLA,WAHK;AAAA,UAIL/E,YAJK,eAILA,YAJK;AAAA,UAKLI,UALK,eAKLA,UALK;AAAA,UAMLG,eANK,eAMLA,eANK;AAAA,UAOLL,cAPK,eAOLA,cAPK;AAAA,UAQLqE,YARK,eAQLA,YARK;AAAA,UASLU,eATK,eASLA,eATK;AAWP,UAAMhE,KAAK,GAAG,KAAKnB,KAAL,CAAWmB,KAAzB;AACA,UAAMmR,YAAY,GAAG,KAAKtS,KAAL,CAAWiQ,eAAX,GACjB,KAAKjQ,KAAL,CAAWiQ,eAAX,CAA2BhP,MADV,GAEjB,IAFJ;AAGA,UAAMoK,OAAO,GAAGlK,KAAK,CAACoR,SAAN,CACb7F,GADa,CACT,UAAApB,QAAQ;AAAA,eAAInK,KAAK,CAACkK,OAAN,CAAcC,QAAd,CAAJ;AAAA,OADC,EAEb1K,MAFa,CAEN,UAAAK,MAAM,EAAI;AAChB,YAAI,CAACqR,YAAL,EAAmB,OAAO,IAAP;;AACnB,YAAIrR,MAAM,CAACQ,IAAP,KAAgB,YAApB,EAAkC;AAChC,iBAAO6Q,YAAY,CAACnO,OAAb,CAAqB,QAArB,IAAiC,CAAC,CAAzC;AACD,SAFD,MAEO;AACL,iBAAOmO,YAAY,CAACnO,OAAb,CAAqBlD,MAAM,CAACK,OAAP,CAAeC,IAApC,IAA4C,CAAC,CAApD;AACD;AACF,OATa,CAAhB;AAUA,UAAMiR,aAAa,GAAG,KAAKxS,KAAL,CAAWiB,MAAjC;AAEA,0BACE,oBAAC,IAAD;AACE,QAAA,IAAI,EAAE,KAAKjB,KAAL,CAAW6D,IADnB;AAEE,QAAA,QAAQ,EAAE,KAAK7D,KAAL,CAAWyQ,QAFvB;AAGE,QAAA,SAAS,EAAE,KAAKzQ,KAAL,CAAWyS,SAHxB;AAIE,QAAA,KAAK,EAAEpP,KAJT;AAKE,QAAA,WAAW,EAAE4B,WALf;AAME,QAAA,YAAY,EAAE/E,YANhB;AAOE,QAAA,UAAU,EAAEI,UAPd;AAQE,QAAA,eAAe,EAAEG,eARnB;AASE,QAAA,cAAc,EAAEL,cATlB;AAUE,QAAA,YAAY,EAAEqE,YAVhB;AAWE,QAAA,eAAe,EAAEU,eAXnB;AAYE,QAAA,OAAO,EAAEkG,OAZX;AAaE,QAAA,aAAa,EAAEmH,aAbjB;AAcE,QAAA,aAAa,EAAE,KAAKxR,aAdtB;AAeE,QAAA,cAAc,EAAE,KAAKqB,cAfvB;AAgBE,QAAA,WAAW,EAAE,KAAKE,WAhBpB;AAiBE,QAAA,WAAW,EAAE,KAAKwC,WAjBpB;AAkBE,QAAA,gBAAgB,EAAE,KAAKK,gBAlBzB;AAmBE,QAAA,eAAe,EAAE,KAAKqB,eAnBxB;AAoBE,QAAA,iBAAiB,EAAE,KAAKI,iBApB1B;AAqBE,QAAA,UAAU,EAAE,KAAKE,UArBnB;AAsBE,QAAA,WAAW,EAAE,KAAKK,WAtBpB;AAuBE,QAAA,SAAS,EAAE,KAAKG,SAvBlB;AAwBE,QAAA,sBAAsB,EAAE,KAAKG,sBAxB/B;AAyBE,QAAA,mBAAmB,EAAE,KAAKwB,mBAzB5B;AA0BE,QAAA,qBAAqB,EAAE,KAAKC,qBA1B9B;AA2BE,QAAA,mBAAmB,EAAE,KAAKQ,mBA3B5B;AA4BE,QAAA,mBAAmB,EAAE,KAAKhF,mBA5B5B;AA6BE,QAAA,cAAc,EAAE,KAAK9B,cA7BvB;AA8BE,QAAA,eAAe,EAAE,KAAKU,eA9BxB;AA+BE,QAAA,eAAe,EAAE,KAAKE,eA/BxB;AAgCE,QAAA,kBAAkB,EAAE,KAAKE,kBAhC3B;AAiCE,QAAA,oBAAoB,EAAE,KAAKU,oBAjC7B;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,QADF;AAqCD;;;;EA1jCqB/F,S;;AA6jCxB,eAAeC,OAAO,CACpB,UAAA4B,KAAK,EAAI;AAAA,MACCuQ,KADD,GACWvQ,KAAK,CAACuS,QADjB,CACChC,KADD;AAAA,MAEC+B,SAFD,GAEetS,KAAK,CAACmB,OAFrB,CAECmR,SAFD;AAAA,MAGCE,QAHD,GAGcxS,KAAK,CAACyS,WAHpB,CAGCD,QAHD;AAAA,qBAIyCxS,KAAK,CAACgB,KAJ/C;AAAA,MAICgO,QAJD,gBAICA,QAJD;AAAA,MAIWzD,QAJX,gBAIWA,QAJX;AAAA,MAIqBxH,eAJrB,gBAIqBA,eAJrB;AAKP,MAAM/C,KAAK,GAAGhB,KAAK,CAACgB,KAAN,CAAY0R,MAAZ,CAAmBF,QAAQ,CAACxR,KAA5B,CAAd;AACA,MAAMF,MAAM,GAAGE,KAAK,CAACkK,OAAN,CAAcsH,QAAQ,CAACG,OAAT,CAAiB3R,KAAK,CAACC,SAAvB,EAAkCG,IAAhD,CAAf;AANO,qBAYHpB,KAAK,CAACU,KAZH;AAAA,MAQLkP,eARK,gBAQLA,eARK;AAAA,MASLE,eATK,gBASLA,eATK;AAAA,MAUL8C,cAVK,gBAULA,cAVK;AAAA,MAWLnF,aAXK,gBAWLA,aAXK;AAaP,SAAO;AACL8C,IAAAA,KAAK,EAALA,KADK;AAEL+B,IAAAA,SAAS,EAATA,SAFK;AAGLtD,IAAAA,QAAQ,EAARA,QAHK;AAILzD,IAAAA,QAAQ,EAARA,QAJK;AAKLxH,IAAAA,eAAe,EAAfA,eALK;AAML/C,IAAAA,KAAK,EAALA,KANK;AAOLF,IAAAA,MAAM,EAANA,MAPK;AAQL8O,IAAAA,eAAe,EAAfA,eARK;AASLE,IAAAA,eAAe,EAAfA,eATK;AAUL8C,IAAAA,cAAc,EAAdA,cAVK;AAWLnF,IAAAA,aAAa,EAAbA;AAXK,GAAP;AAaD,CA3BmB,EA4BpB;AACExK,EAAAA,aAAa,EAAE3E,YAAY,CAAC2E,aAD9B;AAEEgB,EAAAA,iBAAiB,EAAE3F,YAAY,CAAC2F,iBAFlC;AAGE4O,EAAAA,oBAAoB,EAAEvU,YAAY,CAACuU,oBAHrC;AAIEC,EAAAA,iBAAiB,EAAEvU,YAAY,CAACuU,iBAJlC;AAKEjD,EAAAA,kBAAkB,EAAEtR,YAAY,CAACsR,kBALnC;AAMExL,EAAAA,oBAAoB,EAAE9F,YAAY,CAAC8F,oBANrC;AAOE5B,EAAAA,YAAY,EAAEjE,cAAc,CAACiE,YAP/B;AAQElB,EAAAA,YAAY,EAAE9C,kBAAkB,CAAC8C,YARnC;AASEwR,EAAAA,gBAAgB,EAAEtU,kBAAkB,CAACsU;AATvC,CA5BoB,CAAP,CAuCb1U,UAAU,CAACuB,SAAD,CAvCG,CAAf","sourcesContent":["import React, { Component } from \"react\";\nimport { connect } from \"react-redux\";\nimport { injectIntl } from \"react-intl\";\n\nimport * as sceneActions from \"../../../../Store/Reducer/scene\";\nimport * as blockActions from \"../../../../Store/Reducer/block\";\nimport * as previewActions from \"../../../../Store/Reducer/preview\";\nimport * as interactionActions from \"../../../../Store/Reducer/interaction\";\nimport { PAGETYPE } from \"../../../../../../Common/Util/Constant\";\nimport PopUp, { showPopUp } from \"../../../../../../Common/Component/PopUp\";\nimport AssetLibrary from \"../../../../utils/assetLibrary\";\n\nimport { Context, Line, Block } from \"./Class\";\nimport { BLOCK, DATA, MODE } from \"./Util/Type\";\nimport Actions from \"./Util/Action\";\nimport Properties from \"./Util/Property\";\nimport Operators from \"./Util/Operator\";\nimport Utils from \"./Util/Util\";\nimport NumberEditor from \"./Component/NumberEditor\";\nimport PositionEditor from \"./Component/PositionEditor\";\nimport StringEditor from \"./Component/StringEditor\";\nimport View from \"./View\";\n\nclass Container extends Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      lines: [],\n      currentLine: null,\n      currentBlock: null,\n      categories: [],\n      currentCategory: null,\n      selectorBlocks: [],\n      popupContent: null,\n      lineContextMenu: null\n    };\n  }\n  componentDidMount() {\n    this.onChangeSpriteCode();\n  }\n  componentWillUnmount() {\n    if (this.scrollInterval) {\n      clearInterval(this.scrollInterval);\n      this.scrollInterval = undefined;\n    }\n  }\n  componentDidUpdate(prevProps) {\n    // 현재 스프라이트가 바뀌면 컨텍스트도 업데이트\n    if (\n      this.props.sprite &&\n      this.props.sprite.preview &&\n      prevProps.sprite &&\n      prevProps.sprite.preview\n    ) {\n      if (prevProps.sprite.preview.name !== this.props.sprite.preview.name) {\n        this.onChangeSprite();\n      }\n    }\n    // 전역변수가 바뀌면 변수 카테고리의 프로토타입도 업데이트\n    if (\n      this.state.currentBlock &&\n      this.state.currentCategory === BLOCK.VARIABLE &&\n      JSON.stringify(prevProps.globalVariables) !==\n        JSON.stringify(this.props.globalVariables)\n    ) {\n      const selectorBlocks = this.getSelectorBlocks(\n        this.state.currentBlock\n      ).filter(block => block.blockType === BLOCK.VARIABLE);\n      this.setState({ selectorBlocks });\n    }\n    // 외부에서 포커스된 블록을 바꿨다면 업데이트\n    // if (prevProps.focusedBlockId !== this.props.focusedBlockId) {\n    //   const focusedBlock = this.oobcContext.getBlockById(\n    //     this.props.focusedBlockId\n    //   );\n    //   if (this.state.currentBlock !== focusedBlock) {\n    //     this.focusBlock(focusedBlock);\n    //   }\n    // }\n    if (\n      prevProps.sprite &&\n      this.props.sprite &&\n      prevProps.sprite.preview &&\n      this.props.sprite.preview &&\n      prevProps.sprite.preview.name === this.props.sprite.preview.name &&\n      prevProps.sprite.code !== this.props.sprite.code\n    ) {\n      this.onChangeSpriteCode();\n    }\n  }\n  onChangeSprite() {\n    try {\n      const oobcContextJson = JSON.parse(this.props.sprite.code);\n      this.oobcContext = Context.convertFromJson(oobcContextJson);\n      this.setState(\n        { lines: this.oobcContext.getLines(), currentBlock: null },\n        () => {\n          this.onChangeFocusedLine();\n          this.onChangeFocusedBlock();\n          this.onChangeEditingBlock();\n        }\n      );\n    } catch (err) {\n      this.reportErrorForWizLive(err);\n      this.oobcContext = new Context();\n      this.setState({ lines: this.oobcContext.getLines(), currentBlock: null });\n    }\n  }\n  onChangeSpriteCode() {\n    try {\n      const oobcContextJson = JSON.parse(this.props.sprite.code);\n      this.oobcContext = Context.convertFromJson(oobcContextJson);\n      this.setState({ lines: this.oobcContext.getLines() }, () => {\n        this.onChangeFocusedLine();\n        this.onChangeFocusedBlock();\n        this.onChangeEditingBlock();\n      });\n    } catch (err) {\n      this.reportErrorForWizLive(err);\n      this.oobcContext = new Context();\n      if (this.props.sprite) {\n        const sceneId = this.props.scene.sceneName;\n        const spriteName = this.props.sprite.preview.name;\n        const code = JSON.stringify(this.oobcContext.convertToJson());\n        this.props.setSpriteCode(sceneId, spriteName, code);\n      }\n    }\n  }\n  onChangeFocusedLine() {\n    const focusedLine = this.oobcContext.getFocusedLine();\n    this.setState({ currentLine: focusedLine });\n  }\n  onChangeFocusedBlock() {\n    const focusedLine = this.oobcContext.getFocusedLine();\n    const focusedBlock = this.oobcContext.getFocusedBlock();\n    this.setState(\n      { currentBlock: focusedBlock, currentLine: focusedLine },\n      () => {\n        this.updateSelectorState();\n      }\n    );\n  }\n  onChangeEditingBlock() {\n    const editingBlock = this.oobcContext.getEditingBlock();\n    if (editingBlock) {\n      this.showContantEditorFor(editingBlock);\n    } else {\n      this.hidePopUpContent();\n    }\n  }\n\n  // selector\n  updateSelectorState = () => {\n    const { currentBlock } = this.state;\n    if (currentBlock) {\n      let selectorBlocks = this.getSelectorBlocks(currentBlock);\n      const categories = this.getCategoriesFrom(selectorBlocks);\n      this.addVariableCategoryIfNeedFor(currentBlock, categories);\n      const currentCategory = this.oobcContext.focusedCategory || categories[0];\n      selectorBlocks = selectorBlocks.filter(\n        block => block.blockType === currentCategory\n      );\n      this.setState({\n        categories,\n        currentCategory,\n        selectorBlocks\n      });\n    } else {\n      this.setState({\n        categories: [],\n        currentCategory: null,\n        selectorBlocks: []\n      });\n    }\n  };\n  getCategoriesFrom(blocks) {\n    const categorySet = new Set();\n    for (let i in blocks) {\n      const block = blocks[i];\n      categorySet.add(block.blockType);\n    }\n    const categoryPriority = [\n      BLOCK.CONSTANT,\n      BLOCK.SPRITE,\n      BLOCK.ACTION,\n      BLOCK.PROPERTY,\n      BLOCK.OPERATOR,\n      BLOCK.UTIL,\n      BLOCK.VARIABLE,\n      BLOCK.FUNCTION,\n      BLOCK.CALLBACK\n    ];\n    const categories = Array.from(categorySet).sort(\n      (prev, next) =>\n        categoryPriority.indexOf(prev) - categoryPriority.indexOf(next)\n    );\n    return categories;\n  }\n  addVariableCategoryIfNeedFor(block, categories) {\n    if (\n      block.blockTypes.includes(BLOCK.VARIABLE) &&\n      !categories.includes(BLOCK.VARIABLE)\n    ) {\n      categories.push(BLOCK.VARIABLE);\n    }\n  }\n\n  // header\n  onClickSprite = sprite => {\n    const sceneId = this.props.scene.sceneName;\n    const spriteName = sprite.preview.name;\n    const spriteType = sprite.type;\n    this.props.selectSprite(sceneId, spriteName, spriteType);\n    this.scrollToSprite(sprite);\n  };\n  scrollToSprite = sprite => {\n    const scroller = document.getElementById(\"oobceditor_header_sprites\");\n    const element = document.getElementById(\n      `oobceditor_header_sprite-${sprite.preview.name}`\n    );\n    if (scroller && element) {\n      scroller.scroll({\n        left:\n          element.offsetLeft - (scroller.offsetWidth - element.offsetWidth * 2),\n        behavior: \"smooth\"\n      });\n    }\n  };\n  onClickPreview = () => {\n    this.focusBlock(null);\n    this.props.onClickPreview();\n  };\n  onClickPlay = () => {\n    this.prevBlock = this.state.currentBlock;\n    this.setState({ currentBlock: undefined }, () => {\n      setTimeout(\n        () => {\n          this.wasCurrentView = true;\n          // this.props.removeCurrentView(VIEWTYPE.MAIN);\n          // this.props.removeCurrentView(VIEWTYPE.CODE);\n          this.props.setIsPlaying(true);\n        },\n        this.prevBlock ? 250 : 0\n      );\n    });\n  };\n\n  // context\n  onClickContext = () => {\n    if (this.state.currentBlock) {\n      this.focusBlock(null);\n    }\n  };\n  onUpdateContext = callback => {\n    if (this.props.sprite) {\n      const sceneId = this.props.scene.sceneName;\n      const spriteName = this.props.sprite.preview.name;\n      const code = JSON.stringify(this.oobcContext.convertToJson());\n      this.props.setSpriteCode(sceneId, spriteName, code);\n    }\n    this.setState({ lines: this.oobcContext.getLines() }, callback);\n  };\n\n  // selector\n  onClickSelector = () => {\n    this.scrollToBlock(this.state.currentBlock);\n  };\n  onClickCategory = category => {\n    if (category === this.state.currentCategory) return;\n    this.oobcContext.focusedCategory = category;\n    this.onUpdateContext();\n  };\n  onClickAddVariable = () => {\n    const { formatMessage } = this.props.intl;\n    showPopUp(\n      <PopUp.OneInput\n        title={formatMessage({ id: \"ID_OOBC_EDITOR_ADDVAR_TITLE\" })}\n        subtitle={formatMessage({ id: \"ID_OOBC_EDITOR_ADDVAR_SUBTITLE\" })}\n        placeholder={formatMessage({ id: \"ID_OOBC_EDITOR_ADDVAR_PLACEHOLDER\" })}\n        buttonAction={value => {\n          if (!RegExp(\"^[a-zA-Z_$][a-zA-Z_$0-9]*$\").test(value)) {\n            showPopUp(\n              <PopUp.OneButton\n                title={formatMessage({\n                  id: \"ID_OOBC_EDITOR_ADDVAR_WARN_REGEX_TITLE\"\n                })}\n                subtitle={formatMessage({\n                  id: \"ID_OOBC_EDITOR_ADDVAR_WARN_REGEX_SUBTITLE\"\n                })}\n                buttonAction={this.onClickAddVariable}\n                buttonName={formatMessage({\n                  id: \"ID_BUILDER_ALERT_CONFIRMBTN\"\n                })}\n              />\n            );\n            return;\n          }\n          if (\n            this.props.globalVariables &&\n            this.props.globalVariables.indexOf(value) > -1\n          ) {\n            showPopUp(\n              <PopUp.OneButton\n                title={formatMessage({\n                  id: \"ID_OOBC_EDITOR_ADDVAR_WARN_EXIST_TITLE\"\n                })}\n                subtitle={formatMessage({\n                  id: \"ID_OOBC_EDITOR_ADDVAR_WARN_EXIST_SUBTITLE\"\n                })}\n                buttonAction={this.onClickAddVariable}\n                buttonName={formatMessage({\n                  id: \"ID_BUILDER_ALERT_CONFIRMBTN\"\n                })}\n              />\n            );\n            return;\n          }\n          this.props.addGlobalVariable(value);\n        }}\n      />\n    );\n  };\n  onClickSelectorClose = () => {\n    this.focusBlock(null);\n  };\n\n  // popup\n  showPopUpContent = content => {\n    this.props.setPopupConstantOpen(true);\n    this.setState({ popupContent: content });\n  };\n  hidePopUpContent = () => {\n    this.props.setPopupConstantOpen(false);\n    this.setState({ popupContent: null });\n  };\n  onClickPopupOverlay = e => {\n    if (e.preventDefault) e.preventDefault();\n    if (e.stopPropagation) e.stopPropagation();\n    this.focusBlock(null);\n    this.hidePopUpContent();\n  };\n\n  // line\n  onClickLine = line => {\n    if (this.state.currentLine === line) {\n      this.oobcContext.setFocusedLine(null);\n    } else {\n      this.oobcContext.setFocusedLine(line);\n    }\n    this.onUpdateContext();\n    this.setState({ lineContextMenu: null });\n  };\n  onRightClickLine = (line, e) => {\n    const editorRect = document\n      .getElementById(\"oobceditor\")\n      .getBoundingClientRect();\n    const contextElement = document.getElementById(\"oobceditor_context\");\n    const lineContextMenu = {\n      style: {\n        top: e.clientY - editorRect.top + contextElement.scrollTop,\n        left: e.clientX - editorRect.left + contextElement.scrollLeft\n      },\n      delete: this.checkLineDeletable(line),\n      copy: true,\n      paste: !!this.copiedLine,\n      add: true,\n      disable: true,\n      comment: false\n    };\n    this.oobcContext.setFocusedBlock(null);\n    this.oobcContext.setFocusedLine(line);\n    this.onUpdateContext();\n    this.setState({ lineContextMenu });\n  };\n  checkLineDeletable = line => {\n    if (line.parent instanceof Context) {\n      return line.parent.lines.length > 1;\n    } else {\n      return true;\n    }\n  };\n  onClickFoldLine = line => {\n    if (line.folded) {\n      line.unfold();\n    } else {\n      line.fold();\n    }\n    this.oobcContext.setFocusedLine(null);\n    this.onUpdateContext();\n  };\n  onClickDeleteLine = line => {\n    const { formatMessage } = this.props.intl;\n    showPopUp(\n      <PopUp.TwoButton\n        title={formatMessage({ id: \"ID_OOBC_EDITOR_WARN_LINEDELETE_TITLE\" })}\n        subtitle={formatMessage({\n          id: \"ID_OOBC_EDITOR_WARN_LINEDELETE_SUBTITLE\"\n        })}\n        cancelButtonName={formatMessage({ id: \"ID_OOBC_EDITOR_CANCEL\" })}\n        confirmButtonName={formatMessage({ id: \"ID_OOBC_EDITOR_DELETE\" })}\n        confirmAction={() => {\n          this.oobcContext.deleteLine(line);\n          this.oobcContext.setFocusedLine(null);\n          this.onUpdateContext();\n        }}\n      />\n    );\n  };\n  onDragLine = (dragLine, hoverLine, dragOffset) => {\n    if (this.oobcContext.swapLine(dragLine, hoverLine)) {\n      this.setState({ lines: this.oobcContext.getLines() });\n    }\n    // const context = document.getElementById(\"oobceditor_context\");\n    // const header = document.getElementById(\"oobceditor_header\");\n    // if (dragOffset.y < header.offsetHeight + 20) {\n    //   if (!this.scrollInterval) {\n    //     this.scrollInterval = setInterval(() => {\n    //       context.scrollTo({ top: context.scrollTop - 1 });\n    //     }, 1);\n    //   }\n    // } else if (dragOffset.y > context.offsetHeight - 20) {\n    //   if (!this.scrollInterval) {\n    //     this.scrollInterval = setInterval(() => {\n    //       context.scrollTo({ top: context.scrollTop + 1 });\n    //     }, 1);\n    //   }\n    // } else {\n    //   if (this.scrollInterval) {\n    //     clearInterval(this.scrollInterval);\n    //     this.scrollInterval = undefined;\n    //   }\n    // }\n  };\n  onDragBegin = line => {\n    this.tempFolded = line.folded;\n    this.tempCurrentBlock = this.state.currentBlock;\n    this.focusBlock(null);\n    if (!line.folded) {\n      line.folded = true;\n      this.setState({ lines: this.oobcContext.getLines() });\n    }\n  };\n  onDragEnd = line => {\n    line.folded = this.tempFolded;\n    if (this.scrollInterval) {\n      clearInterval(this.scrollInterval);\n      this.scrollInterval = undefined;\n    }\n    this.focusBlock(this.tempCurrentBlock);\n  };\n\n  // line contextmenu\n  onClickLineContextMenu = (line, contextmenu) => {\n    this.setState({ lineContextMenu: null }, () => {\n      switch (contextmenu) {\n        case \"delete\":\n          this.onClickDeleteLine(line);\n          break;\n        case \"copy\":\n          this.onClickCopyLine(line);\n          break;\n        case \"paste\":\n          this.onClickPasteLine(line);\n          break;\n        case \"add\":\n          this.onClickAddLine(line);\n          break;\n        case \"disable\":\n          this.onClickDisableLine(line);\n          break;\n        case \"comment\":\n          break;\n        default:\n          break;\n      }\n    });\n  };\n  onClickCopyLine = line => {\n    this.copiedLine = line;\n  };\n  onClickPasteLine = line => {\n    if (!this.copiedLine) return;\n    line.add(this.copiedLine.copy());\n    this.onUpdateContext();\n  };\n  onClickAddLine = line => {\n    line.add(new Line());\n    this.onUpdateContext();\n  };\n  onClickDisableLine = line => {\n    if (line.disabled) {\n      line.enable();\n    } else {\n      line.disable();\n    }\n    this.onUpdateContext();\n  };\n\n  // block\n  focusBlock = block => {\n    this.oobcContext.setFocusedBlock(block);\n    this.onUpdateContext();\n    this.setState({ lineContextMenu: null });\n  };\n  pushBlock = prototypeBlock => {\n    // 현재 블록을 새로운 블록과 교체\n    const { currentBlock } = this.state;\n    const instanceBlock = Block.createInstance({\n      prevBlock: currentBlock,\n      prototypeBlock\n    });\n    currentBlock.replaceWith(instanceBlock);\n\n    // 마지막 라인의 루트 블록이면 새로운 라인을 추가\n    const currentLine = currentBlock.getParentLine();\n    if (currentLine.parent instanceof Context) {\n      if (!currentLine.getNextLine()) {\n        this.oobcContext.addLine(new Line({ parent: this.oobcContext }));\n      }\n    } else {\n      if (!currentLine.getNextLine()) {\n        const newLine = new Line({ parent: currentLine.parent });\n        currentLine.parent.data.push(newLine);\n      }\n    }\n\n    if (this.oobcContext.checkEditableBlock(instanceBlock)) {\n      this.oobcContext.setEditingBlock(instanceBlock);\n    } else {\n      const nextBlock = this.findNextBlock(instanceBlock);\n      this.oobcContext.setFocusedBlock(nextBlock);\n    }\n    this.onUpdateContext();\n  };\n  findNextBlock = block => {\n    let nextBlock = block.findEmptyBlock();\n    // if (!nextBlock) {\n    //   const nextLine = block.getParentLine().getNextLine();\n    //   if (nextLine) {\n    //     nextBlock = nextLine.block.findEmptyBlock();\n    //   }\n    // }\n    return nextBlock;\n  };\n  scrollToBlock = block => {\n    // if (!block) return;\n    // const scroller = document.getElementById(\"oobceditor_context\");\n    // const element = document.getElementById(\n    //   `oobceditor_line-${block.getParentLine().id}`\n    // );\n    // if (scroller && element) {\n    //   scroller.scroll({\n    //     top:\n    //       element.offsetTop -\n    //       (scroller.offsetHeight - element.offsetHeight) / 2 +\n    //       12,\n    //     behavior: \"smooth\"\n    //   });\n    // }\n  };\n  onClickContextBlock = block => {\n    // 블록 포커싱\n    if (this.state.currentBlock !== block) {\n      this.focusBlock(block);\n    }\n  };\n  onClickPrototypeBlock = prototypeBlock => {\n    const { currentBlock } = this.state;\n    const { formatMessage } = this.props.intl;\n    // 비활성화된 블록에 대한 안내 팝업\n    if (prototypeBlock.disabled) {\n      const id = prototypeBlock.data.toUpperCase();\n      showPopUp(\n        <PopUp.OneButton\n          title={formatMessage({\n            id: \"ID_OOBC_EDITOR_WARN_TITLE\"\n          })}\n          subtitle={formatMessage({\n            id: \"ID_OOBC_EDITOR_WARN_DISABLED_BLOCK_\" + id\n          })}\n          buttonName={formatMessage({ id: \"ID_BUILDER_ALERT_CONFIRMBTN\" })}\n        />\n      );\n      return;\n    }\n    // 비어있지 않은 자식 블록이 있는 경우 경고 창 띄우기\n    if (\n      currentBlock.childs &&\n      currentBlock.childs.reduce(\n        (prev, child) => prev || child.mode !== MODE.EMPTY,\n        false\n      )\n    ) {\n      showPopUp(\n        <PopUp.TwoButton\n          title={formatMessage({ id: \"ID_OOBC_EDITOR_WARN_TITLE\" })}\n          subtitle={formatMessage({\n            id: \"ID_OOBC_EDITOR_WARN_REPLACE_SUBTITLE\"\n          })}\n          cancelButtonName={formatMessage({ id: \"ID_OOBC_EDITOR_CANCEL\" })}\n          confirmButtonName={formatMessage({ id: \"ID_OOBC_EDITOR_REPLACE\" })}\n          confirmAction={() => {\n            this.pushBlock(prototypeBlock);\n          }}\n        />\n      );\n      return;\n    }\n    this.pushBlock(prototypeBlock);\n  };\n  onClickConstantEdit = block => {\n    this.oobcContext.setEditingBlock(block);\n    this.onUpdateContext();\n  };\n  showContantEditorFor = block => {\n    let editor;\n\n    let popupStyle = {};\n    const contextElement = document.getElementById(\"oobceditor_context\");\n    const blockElement = document.getElementById(\n      `oobceditor_block-${block.id}`\n    );\n    if (contextElement && blockElement) {\n      const contextRect = contextElement.getBoundingClientRect();\n      const blockRect = blockElement.getBoundingClientRect();\n      popupStyle.top =\n        contextElement.scrollTop + blockRect.top + blockRect.height / 2 + 12;\n      popupStyle.left = blockElement.offsetLeft - 12;\n      const maxLeft = contextRect.width - 380 - 12;\n      if (popupStyle.left > maxLeft && maxLeft > 12) {\n        popupStyle.left = maxLeft;\n      }\n    }\n\n    switch (block.dataType) {\n      case DATA.NUMBER:\n        editor = (\n          <NumberEditor\n            defaultValue={block.data}\n            popupStyle={popupStyle}\n            onClickCancel={() => {\n              if (block.data === \"number\") {\n                block.data = 0;\n                this.onUpdateContext(() => {\n                  this.focusBlock(null);\n                  this.hidePopUpContent();\n                });\n              } else {\n                this.focusBlock(null);\n                this.hidePopUpContent();\n              }\n            }}\n            onClickConfirm={num => {\n              block.data = num;\n              this.onUpdateContext(() => {\n                this.focusBlock(this.findNextBlock(block));\n                this.hidePopUpContent();\n              });\n            }}\n          />\n        );\n        break;\n      case DATA.POSITION:\n        editor = (\n          <PositionEditor\n            defaultX={100}\n            defaultY={100}\n            popupStyle={popupStyle}\n            onClickCancel={() => {\n              this.focusBlock(null);\n              this.hidePopUpContent();\n            }}\n            onClickConfirm={(x, y) => {\n              block.data = { x, y };\n              this.onUpdateContext(() => {\n                this.focusBlock(this.findNextBlock(block));\n                this.hidePopUpContent();\n              });\n            }}\n          />\n        );\n        break;\n      case DATA.STRING:\n        editor = (\n          <StringEditor\n            defaultValue={block.data}\n            popupStyle={popupStyle}\n            onClickCancel={() => {\n              this.focusBlock(null);\n              this.hidePopUpContent();\n            }}\n            onClickConfirm={text => {\n              block.data = text;\n              this.onUpdateContext(() => {\n                this.focusBlock(this.findNextBlock(block));\n                this.hidePopUpContent();\n              });\n            }}\n          />\n        );\n        break;\n      default:\n        break;\n    }\n    if (editor) this.showPopUpContent(editor);\n  };\n\n  // get prototype blocks\n  getPrototypeBlocks = block => {\n    return [\n      ...this.getSpritePrototypes(),\n      ...this.getVariablePrototypes(),\n      ...this.getActionPrototypes(),\n      ...this.getPropertyPrototypes(),\n      ...this.getOperatorPrototypes(),\n      ...this.getConstantPrototypes(block),\n      ...this.getUtilPrototypes()\n    ];\n  };\n  getSpritePrototypes = () => {\n    const sprites = [];\n    // 일반 스프라이트\n    for (let spriteId in this.props.scene.sprites) {\n      const sprite = this.props.scene.sprites[spriteId];\n      switch (sprite.type) {\n        case \"sprite\":\n        case \"text\":\n          sprites.push({ type: sprite.type, name: spriteId });\n          break;\n        case \"spine\":\n          sprites.push({ type: \"sprite\", name: spriteId });\n          break;\n        case \"component\":\n          sprites.push({ type: \"joystick\", name: spriteId });\n          break;\n        case \"background\":\n          sprites.push({ type: \"background\", name: spriteId });\n          break;\n        case \"custom\":\n          sprites.push({ type: \"sprite\", name: spriteId });\n          break;\n        default:\n          console.warn(\n            `getSpritePrototypes: unknown sprite type - ${sprite.type}`\n          );\n      }\n    }\n    // 사운드\n    for (let i = 0; i < this.props.soundIds.length; i++) {\n      const soundId = this.props.soundIds[i];\n      const soundName = AssetLibrary.getSoundAsset(soundId).defaultName;\n      sprites.push({ type: \"sound\", name: soundName });\n    }\n    const sortInfor = [\n      DATA.SCREEN,\n      DATA.SPRITE,\n      DATA.JOYSTICK,\n      DATA.TEXT,\n      DATA.SOUND\n    ];\n    sprites.sort((prev, next) => {\n      return sortInfor.indexOf(prev.type) - sortInfor.indexOf(next.type);\n    });\n    const dataType = {\n      sprite: DATA.SPRITE,\n      text: DATA.TEXT,\n      background: DATA.SCREEN,\n      joystick: DATA.JOYSTICK,\n      sound: DATA.SOUND\n    };\n    return sprites.map(sprite => {\n      return Block.createPrototype({\n        blockType: BLOCK.SPRITE,\n        dataType: dataType[sprite.type],\n        data: sprite.name\n      });\n    });\n  };\n  getVariablePrototypes = () => {\n    // 등록된 글로벌 변수의 목록 불러오기\n    return this.props.globalVariables\n      ? this.props.globalVariables.map(variable => {\n          return Block.createPrototype({\n            blockType: BLOCK.VARIABLE,\n            dataType: DATA.ANY,\n            data: variable\n          });\n        })\n      : [];\n  };\n  getActionPrototypes = () => {\n    return Actions.map(action => {\n      return Block.createPrototype({\n        blockType: BLOCK.ACTION,\n        parentDataTypes: action.parentDataTypes,\n        data: action.name,\n        childs:\n          action.childs &&\n          action.childs.map(child =>\n            child.blockTypes.indexOf(BLOCK.CALLBACK) > -1\n              ? Block.createCallback()\n              : Block.createEmpty({ ...child })\n          )\n      });\n    });\n  };\n  getPropertyPrototypes = () => {\n    return Properties.map(property => {\n      return Block.createPrototype({\n        blockType: BLOCK.PROPERTY,\n        parentDataTypes: property.parentDataTypes,\n        dataType: property.dataType,\n        data: property.name\n      });\n    });\n  };\n  getOperatorPrototypes = () => {\n    return Operators.map(operator => {\n      return Block.createPrototype({\n        blockType: BLOCK.OPERATOR,\n        dataType: operator.dataType,\n        data: operator.name,\n        childs:\n          operator.childs &&\n          operator.childs.map(child => Block.createEmpty({ ...child }))\n      });\n    });\n  };\n  getConstantPrototypes = block => {\n    const numbers = [{ dataType: DATA.NUMBER, data: \"number\" }];\n\n    const strings = [\n      { dataType: DATA.STRING, data: \"text\" },\n      ...this.props.customStrings.map(string => ({\n        dataType: DATA.STRING,\n        data: string\n      }))\n    ];\n\n    const booleans = [\n      { dataType: DATA.BOOLEAN, data: \"true\" },\n      { dataType: DATA.BOOLEAN, data: \"false\" }\n    ];\n\n    const directions = [\n      { dataType: DATA.DIRECTION, data: \"up\" },\n      { dataType: DATA.DIRECTION, data: \"down\" },\n      { dataType: DATA.DIRECTION, data: \"left\" },\n      { dataType: DATA.DIRECTION, data: \"right\" }\n    ];\n\n    const animations = [];\n    const subjectParent = block && block.findSubjectParent();\n    if (subjectParent) {\n      const assets = [];\n      if (subjectParent.dataType === DATA.SPRITE) {\n        const spriteName = subjectParent.data;\n        const originalName = spriteName.split(\"(\")[0];\n        const asset = AssetLibrary.getAssetByName(originalName);\n        if (asset) assets.push(asset);\n      } else if (subjectParent.dataType === DATA.ANY) {\n        const { sprites } = this.props.scene;\n        for (let spriteId in sprites) {\n          const sprite = sprites[spriteId];\n          if (sprite.type === \"sprite\") {\n            const asset = AssetLibrary.getAsset(sprite.assetId);\n            if (asset) assets.push(asset);\n          }\n        }\n      }\n      assets.forEach(asset => {\n        if (asset.spriteAnimations) {\n          Object.keys(asset.spriteAnimations).forEach(key =>\n            animations.push({ dataType: DATA.ANIMATION, data: key })\n          );\n        }\n      });\n    }\n\n    const screens =\n      (this.props.sceneIds &&\n        this.props.sceneIds.map(sceneId => ({\n          dataType: DATA.SCREEN,\n          data: sceneId\n        }))) ||\n      [];\n\n    const positions = [{ dataType: DATA.POSITION, data: { x: 100, y: 100 } }];\n\n    const random = { dataType: DATA.RANDOM, data: \"random\" };\n\n    const touch = { dataType: DATA.TOUCH, data: \"touch\" };\n\n    const axises = [\n      { dataType: DATA.AXIS, data: \"x\" },\n      { dataType: DATA.AXIS, data: \"y\" }\n    ];\n\n    return [\n      ...numbers,\n      ...strings,\n      ...booleans,\n      ...directions,\n      ...animations,\n      ...screens,\n      ...positions,\n      random,\n      touch,\n      ...axises\n    ].map(constant => {\n      return Block.createPrototype({\n        blockType: BLOCK.CONSTANT,\n        dataType: constant.dataType,\n        data: constant.data\n      });\n    });\n  };\n  getUtilPrototypes = () => {\n    return Utils.map(util => {\n      return Block.createPrototype({\n        blockType: BLOCK.UTIL,\n        parentDataTypes: util.parentDataTypes,\n        dataType: util.dataType,\n        data: util.name,\n        childs:\n          util.childs &&\n          util.childs.map(child =>\n            child.blockTypes.indexOf(BLOCK.CALLBACK) > -1\n              ? Block.createCallback()\n              : Block.createEmpty({ ...child })\n          )\n      });\n    });\n  };\n  // get selector blocks (filter prototype blocks by current block)\n  getSelectorBlocks = block => {\n    const prototypeBlocks = this.getPrototypeBlocks(block);\n    this.props.setPrototypeBlocks(prototypeBlocks);\n    let selectorBlocks = prototypeBlocks;\n\n    // 글로벌 필터\n    const { prototypeFilter } = this.props;\n    if (prototypeFilter) {\n      const blockTypes = Object.keys(prototypeFilter);\n      selectorBlocks = selectorBlocks.filter(selectorBlock => {\n        const datas = prototypeFilter[selectorBlock.blockType];\n        if (!datas) return false;\n\n        // 스크린 타입일 경우 필터 목록에 screen이 있으면 포함\n        if (\n          selectorBlock.blockType === BLOCK.SPRITE &&\n          selectorBlock.dataType === DATA.SCREEN\n        ) {\n          return datas.indexOf(DATA.SCREEN) > -1;\n        }\n\n        // 상수 타입일 경우 데이터 타입으로도 검사\n        if (selectorBlock.blockType === BLOCK.CONSTANT) {\n          return (\n            datas.indexOf(selectorBlock.dataType) > -1 ||\n            datas.indexOf(selectorBlock.data) > -1\n          );\n        }\n\n        // 데이터가 필터 목록에 있는지 검사\n        return (\n          blockTypes.indexOf(selectorBlock.blockType) > -1 &&\n          datas.indexOf(selectorBlock.data) > -1\n        );\n      });\n    }\n\n    // 선택한 블록 조건 필터\n    selectorBlocks = selectorBlocks.filter(selectorBlock => {\n      // 블록 타입 검사\n      const hasBlockType =\n        block.blockTypes.indexOf(selectorBlock.blockType) > -1;\n      if (!hasBlockType) {\n        return false;\n      }\n      // 부모블록의 데이터 타입 검사\n      if (block.parent instanceof Block && selectorBlock.parentDataTypes) {\n        const availableParent =\n          selectorBlock.parentDataTypes.indexOf(block.parent.dataType) > -1 ||\n          block.parent.dataType === DATA.ANY;\n        if (!availableParent) {\n          return false;\n        }\n      }\n      // 데이터 타입 검사\n      if (\n        selectorBlock.dataType &&\n        selectorBlock.dataType !== DATA.ANY &&\n        block.dataTypes[selectorBlock.blockType].indexOf(\n          selectorBlock.dataType\n        ) < 0 &&\n        block.dataTypes[selectorBlock.blockType].indexOf(DATA.ANY) < 0\n      ) {\n        return false;\n      }\n      // set 블록의 목적어로 올 수 없는 데이터 타입\n      if (block.parent instanceof Block && block.parent.data === \"set\") {\n        if (\n          selectorBlock.dataType === DATA.RANDOM ||\n          selectorBlock.dataType === DATA.TOUCH ||\n          selectorBlock.dataType === DATA.AXIS\n        ) {\n          return false;\n        }\n      }\n      // 애니메이션이 없는 스프라이트는 애니메이트 액션을 필터\n      if (\n        selectorBlock.blockType === BLOCK.ACTION &&\n        (selectorBlock.data === \"playAnimation\" ||\n          selectorBlock.data === \"stopAnimation\")\n      ) {\n        const subjectParent = block.findSubjectParent();\n        if (subjectParent && subjectParent.dataType === DATA.SPRITE) {\n          const spriteName = subjectParent.data;\n          const originalName = spriteName.split(\"(\")[0];\n          const asset = AssetLibrary.getAssetByName(originalName);\n          if (!asset || !asset.spriteAnimations) {\n            selectorBlock.disabled = true;\n          }\n        }\n      }\n      return true;\n    });\n    return selectorBlocks;\n  };\n\n  reportErrorForWizLive = error => {\n    const { pageType, email } = this.props;\n    if (pageType !== PAGETYPE.WIZLIVE) return;\n    const { name, message } = error;\n    const errorMsg = `WizLive OOBC Error Report(${email})\n      errorName::${name}\n      message::${message}`;\n    console.error(errorMsg);\n  };\n\n  render() {\n    const {\n      lines,\n      currentLine,\n      currentBlock,\n      categories,\n      currentCategory,\n      selectorBlocks,\n      popupContent,\n      lineContextMenu\n    } = this.state;\n    const scene = this.props.scene;\n    const spriteFilter = this.props.prototypeFilter\n      ? this.props.prototypeFilter.sprite\n      : null;\n    const sprites = scene.spriteIds\n      .map(spriteId => scene.sprites[spriteId])\n      .filter(sprite => {\n        if (!spriteFilter) return true;\n        if (sprite.type === \"background\") {\n          return spriteFilter.indexOf(\"screen\") > -1;\n        } else {\n          return spriteFilter.indexOf(sprite.preview.name) > -1;\n        }\n      });\n    const currentSprite = this.props.sprite;\n\n    return (\n      <View\n        intl={this.props.intl}\n        pageType={this.props.pageType}\n        isPlaying={this.props.isPlaying}\n        lines={lines}\n        currentLine={currentLine}\n        currentBlock={currentBlock}\n        categories={categories}\n        currentCategory={currentCategory}\n        selectorBlocks={selectorBlocks}\n        popupContent={popupContent}\n        lineContextMenu={lineContextMenu}\n        sprites={sprites}\n        currentSprite={currentSprite}\n        onClickSprite={this.onClickSprite}\n        onClickPreview={this.onClickPreview}\n        onClickPlay={this.onClickPlay}\n        onClickLine={this.onClickLine}\n        onRightClickLine={this.onRightClickLine}\n        onClickFoldLine={this.onClickFoldLine}\n        onClickDeleteLine={this.onClickDeleteLine}\n        onDragLine={this.onDragLine}\n        onDragBegin={this.onDragBegin}\n        onDragEnd={this.onDragEnd}\n        onClickLineContextMenu={this.onClickLineContextMenu}\n        onClickContextBlock={this.onClickContextBlock}\n        onClickPrototypeBlock={this.onClickPrototypeBlock}\n        onClickConstantEdit={this.onClickConstantEdit}\n        onClickPopupOverlay={this.onClickPopupOverlay}\n        onClickContext={this.onClickContext}\n        onClickSelector={this.onClickSelector}\n        onClickCategory={this.onClickCategory}\n        onClickAddVariable={this.onClickAddVariable}\n        onClickSelectorClose={this.onClickSelectorClose}\n      />\n    );\n  }\n}\n\nexport default connect(\n  state => {\n    const { email } = state.userinfo;\n    const { isPlaying } = state.preview;\n    const { selected } = state.interaction;\n    const { sceneIds, soundIds, globalVariables } = state.scene;\n    const scene = state.scene.scenes[selected.scene];\n    const sprite = scene.sprites[selected.objects[scene.sceneName].name];\n    const {\n      prototypeBlocks,\n      prototypeFilter,\n      focusedBlockId,\n      customStrings\n    } = state.block;\n    return {\n      email,\n      isPlaying,\n      sceneIds,\n      soundIds,\n      globalVariables,\n      scene,\n      sprite,\n      prototypeBlocks,\n      prototypeFilter,\n      focusedBlockId,\n      customStrings\n    };\n  },\n  {\n    setSpriteCode: sceneActions.setSpriteCode,\n    addGlobalVariable: sceneActions.addGlobalVariable,\n    removeGlobalVariable: sceneActions.removeGlobalVariable,\n    setFocusedBlockId: blockActions.setFocusedBlockId,\n    setPrototypeBlocks: blockActions.setPrototypeBlocks,\n    setPopupConstantOpen: blockActions.setPopupConstantOpen,\n    setIsPlaying: previewActions.setIsPlaying,\n    selectSprite: interactionActions.selectSprite,\n    setBlockCategory: interactionActions.setBlockCategory\n  }\n)(injectIntl(Container));\n"]},"metadata":{},"sourceType":"module"}