{"ast":null,"code":"import _regeneratorRuntime from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";\nimport _objectSpread from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread\";\nimport _asyncToGenerator from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _classCallCheck from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";\nimport _inherits from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";\nimport _possibleConstructorReturn from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";\n\nfunction _createSuper(Derived) { var hasNativeReflectConstruct = _isNativeReflectConstruct(); return function _createSuperInternal() { var Super = _getPrototypeOf(Derived), result; if (hasNativeReflectConstruct) { var NewTarget = _getPrototypeOf(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return _possibleConstructorReturn(this, result); }; }\n\nfunction _isNativeReflectConstruct() { if (typeof Reflect === \"undefined\" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === \"function\") return true; try { Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {})); return true; } catch (e) { return false; } }\n\nimport React, { Component } from \"react\";\nimport { withMsal } from \"@azure/msal-react\";\nimport { connect } from \"react-redux\";\nimport { loginRequest, graphConfig } from \"../../../../Util/MsalConfig\";\nimport { getRandomName, getRandomUserIcon } from \"../../../../Util/RandomGenerator\";\nimport * as userInfoActions from \"../../../../Store/Reducer/UserInfo\";\nimport * as request from \"../../../../Util/HTTPRequest\";\n\nvar MsalSignIn = /*#__PURE__*/function (_Component) {\n  _inherits(MsalSignIn, _Component);\n\n  var _super = _createSuper(MsalSignIn);\n\n  function MsalSignIn() {\n    var _this;\n\n    _classCallCheck(this, MsalSignIn);\n\n    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n\n    _this = _super.call.apply(_super, [this].concat(args));\n    _this.loginToMsal = /*#__PURE__*/_asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee() {\n      var _this$props, msalContext, onError, loginResponse, tokenResponse, graphResponse;\n\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              _this$props = _this.props, msalContext = _this$props.msalContext, onError = _this$props.onError;\n              _context.prev = 1;\n              _context.next = 4;\n              return msalContext.instance.loginPopup(loginRequest);\n\n            case 4:\n              loginResponse = _context.sent;\n              _context.next = 7;\n              return msalContext.instance.acquireTokenSilent(_objectSpread({}, loginRequest, {\n                account: loginResponse.account\n              }));\n\n            case 7:\n              tokenResponse = _context.sent;\n              _context.next = 10;\n              return _this.callMsGraph(tokenResponse.accessToken);\n\n            case 10:\n              graphResponse = _context.sent;\n\n              _this.loginToWizlab(graphResponse.id);\n\n              _context.next = 18;\n              break;\n\n            case 14:\n              _context.prev = 14;\n              _context.t0 = _context[\"catch\"](1);\n              console.error(_context.t0);\n              onError(_context.t0);\n\n            case 18:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee, null, [[1, 14]]);\n    }));\n\n    _this.loginToWizlab = function (msalId) {\n      var params = {\n        msalId: msalId,\n        name: getRandomName(),\n        icon: getRandomUserIcon()\n      };\n      request.loginByMsal(params).then(function (res) {\n        return res.json();\n      }).then(function (json) {\n        localStorage.setItem(\"wizToken\", json.token);\n\n        _this.props.updateUserInfo(json.user);\n\n        _this.props.dismiss();\n      }).catch(function (e) {\n        console.error(e);\n\n        _this.props.dismiss();\n      });\n    };\n\n    return _this;\n  }\n\n  _createClass(MsalSignIn, [{\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      this.loginToMsal();\n    }\n  }, {\n    key: \"callMsGraph\",\n    value: function callMsGraph(accessToken) {\n      var headers = new Headers();\n      var bearer = \"Bearer \".concat(accessToken);\n      headers.append(\"Authorization\", bearer);\n      var options = {\n        method: \"GET\",\n        headers: headers\n      };\n      return fetch(graphConfig.graphMeEndpoint, options).then(function (response) {\n        return response.json();\n      }).catch(function (error) {\n        return console.log(error);\n      });\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      return React.createElement(React.Fragment, null);\n    }\n  }]);\n\n  return MsalSignIn;\n}(Component);\n\nexport default connect(undefined, {\n  updateUserInfo: userInfoActions.updateUserInfo\n})(withMsal(MsalSignIn));","map":{"version":3,"sources":["/Users/jimmy/Documents/Wizschool/wizlab_web2/src/Common/Component/SignIn/Component/MsalSignIn/Container.js"],"names":["React","Component","withMsal","connect","loginRequest","graphConfig","getRandomName","getRandomUserIcon","userInfoActions","request","MsalSignIn","loginToMsal","props","msalContext","onError","instance","loginPopup","loginResponse","acquireTokenSilent","account","tokenResponse","callMsGraph","accessToken","graphResponse","loginToWizlab","id","console","error","msalId","params","name","icon","loginByMsal","then","res","json","localStorage","setItem","token","updateUserInfo","user","dismiss","catch","e","headers","Headers","bearer","append","options","method","fetch","graphMeEndpoint","response","log","undefined"],"mappings":"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","sourcesContent":["import React, { Component } from \"react\";\nimport { withMsal } from \"@azure/msal-react\";\nimport { connect } from \"react-redux\";\nimport { loginRequest, graphConfig } from \"../../../../Util/MsalConfig\";\nimport { getRandomName, getRandomUserIcon } from \"../../../../Util/RandomGenerator\";\nimport * as userInfoActions from \"../../../../Store/Reducer/UserInfo\";\nimport * as request from \"../../../../Util/HTTPRequest\";\n\nclass MsalSignIn extends Component {\n  componentDidMount() {\n    this.loginToMsal();\n  }\n\n  loginToMsal = async () => {\n    const { msalContext, onError } = this.props;\n    try{\n      const loginResponse = await msalContext.instance.loginPopup(loginRequest);\n      const tokenResponse = await msalContext.instance.acquireTokenSilent({\n        ...loginRequest,\n        account: loginResponse.account\n      });\n      const graphResponse = await this.callMsGraph(tokenResponse.accessToken);\n      this.loginToWizlab(graphResponse.id);\n    }catch(e) {\n      console.error(e);\n      onError(e);\n    }\n  }\n\n  loginToWizlab = msalId => {\n    const params = {\n      msalId: msalId,\n      name: getRandomName(),\n      icon: getRandomUserIcon()\n    };\n    request.loginByMsal(params)\n      .then(res=> res.json())\n      .then(json=> {\n        localStorage.setItem(\"wizToken\", json.token);\n        this.props.updateUserInfo(json.user);\n        this.props.dismiss();\n      })\n      .catch(e=> {\n        console.error(e);\n        this.props.dismiss();\n      })\n  }\n\n  callMsGraph(accessToken) {\n    const headers = new Headers();\n    const bearer = `Bearer ${accessToken}`;\n\n    headers.append(\"Authorization\", bearer);\n\n    const options = {\n      method: \"GET\",\n      headers: headers\n    };\n\n    return fetch(graphConfig.graphMeEndpoint, options)\n      .then(response => response.json())\n      .catch(error => console.log(error));\n  }\n\n  render() {\n    return <></>;\n  }\n}\n\nexport default connect(\n  undefined,\n  { updateUserInfo: userInfoActions.updateUserInfo }\n)(withMsal(MsalSignIn));\n"]},"metadata":{},"sourceType":"module"}