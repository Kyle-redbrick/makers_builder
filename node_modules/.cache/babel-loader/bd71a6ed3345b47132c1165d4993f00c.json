{"ast":null,"code":"import _objectSpread from \"/Users/jimmy/Documents/Wizschool/astroboy/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread\";\nimport _classCallCheck from \"/Users/jimmy/Documents/Wizschool/astroboy/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"/Users/jimmy/Documents/Wizschool/astroboy/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";\nimport _inherits from \"/Users/jimmy/Documents/Wizschool/astroboy/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";\nimport _possibleConstructorReturn from \"/Users/jimmy/Documents/Wizschool/astroboy/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"/Users/jimmy/Documents/Wizschool/astroboy/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";\nvar _jsxFileName = \"/Users/jimmy/Documents/Wizschool/astroboy/src/Common/Component/OOBCEditor/index.js\";\n\nfunction _createSuper(Derived) { var hasNativeReflectConstruct = _isNativeReflectConstruct(); return function _createSuperInternal() { var Super = _getPrototypeOf(Derived), result; if (hasNativeReflectConstruct) { var NewTarget = _getPrototypeOf(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return _possibleConstructorReturn(this, result); }; }\n\nfunction _isNativeReflectConstruct() { if (typeof Reflect === \"undefined\" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === \"function\") return true; try { Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {})); return true; } catch (e) { return false; } }\n\nimport React, { Component } from \"react\";\nimport { CONTEXTMENU } from \"./Constant\";\nimport Localization from \"./Localization\";\nimport Alert from \"./Alert\";\nimport Sound from \"./Sound\";\nimport OOBC from \"./OOBC\";\nimport View from \"./View\";\n\nvar OOBCEditor = /*#__PURE__*/function (_Component) {\n  _inherits(OOBCEditor, _Component);\n\n  var _super = _createSuper(OOBCEditor);\n\n  function OOBCEditor(props) {\n    var _this;\n\n    _classCallCheck(this, OOBCEditor);\n\n    _this = _super.call(this, props);\n\n    _this.onClickLine = function (line) {\n      var currentLine = _this.state.currentLine;\n\n      if (line === currentLine) {\n        _this.setCurrentLine(null);\n      } else {\n        Sound.playWithId(\"touchLine\");\n\n        _this.setCurrentLine(line);\n      }\n    };\n\n    _this.onClickFoldLine = function (line) {\n      Sound.playWithId(\"touchLine\");\n\n      if (line.folded) {\n        line.unfold();\n      } else {\n        line.fold();\n      }\n\n      _this.onUpdateContext();\n    };\n\n    _this.onDragLine = function (dragLine, hoverLine, dragOffset) {\n      if (dragLine.lineNum === hoverLine.lineNum) return;\n\n      _this.scrollWhileDraggingLineIfNeeded(dragOffset);\n\n      var didMove;\n\n      if (_this.getIsUpwardDragging(hoverLine, dragOffset)) {\n        didMove = dragLine.moveBefore(hoverLine);\n      } else {\n        didMove = dragLine.moveAfter(hoverLine);\n      }\n\n      if (didMove) _this.onUpdateContext();\n    };\n\n    _this.onDragLineOverEnd = function (dragLine) {\n      var didMove = dragLine.moveToLastOfContext();\n      if (didMove) _this.onUpdateContext();\n    };\n\n    _this.getIsUpwardDragging = function (hoverLine, dragOffset) {\n      var hoverLineElement = document.getElementById(\"oobceditor_line-\".concat(hoverLine.id));\n      if (!hoverLineElement) return false;\n      var hoverLineRect = hoverLineElement.getBoundingClientRect();\n\n      if (hoverLineRect.top + hoverLineRect.height / 2 > dragOffset.y) {\n        return true;\n      } else {\n        return false;\n      }\n    };\n\n    _this.onDragLineBegin = function (line) {\n      _this.prevLineFolded = line.folded;\n      _this.prevBlock = _this.state.currentBlock;\n\n      _this.setCurrentBlock(null);\n\n      var shouldFoldBeforeDragStart = line.getCallbackBlock() && !line.folded;\n\n      if (shouldFoldBeforeDragStart) {\n        line.fold();\n\n        _this.onUpdateContext();\n      }\n    };\n\n    _this.onDragLineEnd = function (line) {\n      _this.setCurrentBlock(_this.prevBlock);\n\n      if (!_this.prevLineFolded) {\n        line.unfold();\n\n        _this.onUpdateContext();\n      }\n\n      _this.clearScrollInterval();\n    };\n\n    _this.onScrollContext = function () {\n      _this.clearLineLongTouchTimeout();\n    };\n\n    _this.onClickContext = function () {\n      _this.setCurrentLine(null);\n    };\n\n    _this.onTouchLineStart = function (line, position) {\n      _this.lineLongTouchPosition = position;\n\n      _this.setLineLongTouchTimeout(function () {\n        _this.onLineLongTouch(line, _this.lineLongTouchPosition);\n      });\n    };\n\n    _this.onTouchLineMove = function (position) {\n      _this.lineLongTouchPosition = position;\n    };\n\n    _this.onTouchLineEnd = function (line) {\n      _this.clearLineLongTouchTimeout();\n    };\n\n    _this.onLineLongTouch = function (line, position) {\n      _this.clearLineLongTouchTimeout();\n\n      _this.openLineContextMenu(line, position);\n    };\n\n    _this.onClickInstanceBlock = function (instanceBlock) {\n      var currentBlock = _this.state.currentBlock;\n\n      if (instanceBlock !== currentBlock) {\n        Sound.playWithId(\"contextBlock\");\n\n        _this.setCurrentBlock(instanceBlock);\n      }\n    };\n\n    _this.onClickPrototypeBlock = function (prototypeBlock) {\n      if (_this.isDisabledPrototypeBlock(prototypeBlock)) {\n        _this.onClickDisabledPrototypeBlock(prototypeBlock);\n      } else {\n        var currentBlock = _this.state.currentBlock;\n        var instanceBlock = currentBlock.createInstanceBlockWith(prototypeBlock);\n        Sound.playWithId(\"prototypeBlock\");\n\n        _this.replaceOrCoverCurrentBlockWith(instanceBlock);\n      }\n    };\n\n    _this.onClickAddGlobalVar = function () {\n      _this.showGlobalVarPrompt();\n    };\n\n    _this.onConfirmGlobalVarPrompt = function (name) {\n      if (_this.checkGlobalVarAndAlertIfInvalid(name)) {\n        var onAddGlobalVar = _this.props.onAddGlobalVar;\n        if (onAddGlobalVar) onAddGlobalVar(name);\n      }\n    };\n\n    _this.onClickConstantBlockEdit = function (constantBlock) {\n      _this.setConstantBlockToEdit(constantBlock);\n    };\n\n    _this.onClickConstantEditorOverlay = function () {\n      _this.setConstantBlockToEdit(null);\n    };\n\n    _this.onClickConstantEditorConfirm = function (constantBlock, newData) {\n      constantBlock.data = newData;\n\n      _this.onUpdateContext();\n\n      _this.setConstantBlockToEdit(null);\n\n      _this.setCurrentBlock(constantBlock.findNextEmptyBlock());\n    };\n\n    _this.onClickConstantEditorCancel = function (constantBlock) {\n      _this.updateDefaultConstantDataIfNull(constantBlock);\n\n      _this.setConstantBlockToEdit(null);\n    };\n\n    _this.onChangeContantEditorData = function (data) {\n      var onChangeConstantEditorValue = _this.props.onChangeConstantEditorValue;\n\n      if (onChangeConstantEditorValue) {\n        onChangeConstantEditorValue(data);\n      }\n    };\n\n    _this.onClickSelectorCategory = function (category) {\n      Sound.playWithId(\"blockCategory\");\n\n      _this.setCurrentCategory(category);\n    };\n\n    _this.onClickSelectorClose = function () {\n      _this.setCurrentBlock(null);\n    };\n\n    _this.onLineContextMenu = function (line, position) {\n      _this.clearLineLongTouchTimeout();\n\n      _this.openLineContextMenu(line, position);\n    };\n\n    _this.onClickLineContextMenu = function (line, contextMenuId) {\n      Sound.playWithId(\"menu\");\n\n      switch (contextMenuId) {\n        case CONTEXTMENU.DELETE:\n          _this.onClickDeleteLine(line);\n\n          break;\n\n        case CONTEXTMENU.COPY:\n          _this.onClickCopyLine(line);\n\n          break;\n\n        case CONTEXTMENU.PASTE:\n          _this.onClickPasteLine(line);\n\n          break;\n\n        case CONTEXTMENU.ADD:\n          _this.onClickAddLine(line);\n\n          break;\n\n        case CONTEXTMENU.ENABLE:\n          _this.onClickEnableLine(line);\n\n          break;\n\n        case CONTEXTMENU.DISABLE:\n          _this.onClickDisableLine(line);\n\n          break;\n\n        case CONTEXTMENU.COMMENT:\n          _this.onClickAddComment(line);\n\n          break;\n\n        case CONTEXTMENU.DELETECOMMENT:\n          _this.onClickDeleteComment(line);\n\n          break;\n\n        default:\n          break;\n      }\n\n      _this.setState({\n        contextMenuInfo: null\n      });\n    };\n\n    _this.keyListener = function (event) {\n      var key = event.key;\n\n      switch (key) {\n        case \"Backspace\":\n        case \"Delete\":\n          _this.onDeleteKeyListener();\n\n          break;\n\n        case \"Enter\":\n          _this.onEnterKeyListener();\n\n          break;\n\n        case \"Tab\":\n          _this.onTabKeyListener();\n\n          break;\n\n        default:\n          break;\n      }\n    };\n\n    _this.onDeleteKeyListener = function () {\n      var currentLine = _this.state.currentLine;\n\n      if (currentLine) {\n        _this.onClickDeleteLine(currentLine);\n      }\n    };\n\n    _this.onEnterKeyListener = function () {\n      var currentLine = _this.state.currentLine;\n\n      if (currentLine) {\n        _this.onClickAddLine(currentLine);\n      }\n    };\n\n    _this.onTabKeyListener = function () {\n      var currentLine = _this.state.currentLine;\n\n      if (currentLine) {\n        _this.openLineContextMenu(currentLine);\n      }\n    };\n\n    _this.onClickZoomIn = function () {\n      _this.zoomInIfPossible();\n    };\n\n    _this.onClickZoomOut = function () {\n      _this.zoomOutIfPossible();\n    };\n\n    Localization.updateLocaleTo(_this.props.locale);\n    Alert.configureWith(_this.props.alert);\n    Sound.configureWith(_this.props.sound);\n    _this.oobcContext = new OOBC.Context();\n\n    _this.oobcContext.updatePrototypesInfo(_this.props.prototypesInfo);\n\n    _this.state = {\n      lines: _this.oobcContext.getDisplayLines(),\n      currentLine: null,\n      currentBlock: null,\n      constantBlockToEdit: null,\n      selectorInfo: null,\n      contextMenuInfo: null,\n      zoomLevel: 0\n    };\n    return _this;\n  }\n\n  _createClass(OOBCEditor, [{\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      this.setKeyListener();\n      this.loadZoomLevel();\n    }\n  }, {\n    key: \"componentWillUnmount\",\n    value: function componentWillUnmount() {\n      this.clearKeyListener();\n      this.clearScrollInterval();\n    }\n  }, {\n    key: \"componentDidUpdate\",\n    value: function componentDidUpdate(prevProps) {\n      if (JSON.stringify(prevProps.prototypesInfo) !== JSON.stringify(this.props.prototypesInfo)) {\n        this.onUpdatePrototypesInfo();\n      }\n\n      if (prevProps.locale !== this.props.locale) {\n        this.onUpdateLocale();\n      }\n    }\n  }, {\n    key: \"onUpdatePrototypesInfo\",\n    value: function onUpdatePrototypesInfo() {\n      this.oobcContext.updatePrototypesInfo(this.props.prototypesInfo);\n      var currentBlock = this.state.currentBlock;\n\n      if (currentBlock) {\n        var prevCategory = this.state.selectorInfo.currentCategory;\n        var selectorInfo = this.getSelectorInfoFor(currentBlock);\n        selectorInfo.currentCategory = prevCategory;\n        this.setState({\n          selectorInfo: selectorInfo\n        });\n      }\n    }\n  }, {\n    key: \"onUpdateLocale\",\n    value: function onUpdateLocale() {\n      Localization.updateLocaleTo(this.props.locale);\n      this.onUpdateContext();\n    }\n  }, {\n    key: \"initEmptyContext\",\n    value: function initEmptyContext() {\n      this.oobcContext = new OOBC.Context();\n      this.onInitContext();\n    }\n  }, {\n    key: \"initContextWith\",\n    value: function initContextWith(contextJSON) {\n      this.oobcContext = OOBC.Context.fromJSON(contextJSON);\n      this.onInitContext();\n    }\n  }, {\n    key: \"onInitContext\",\n    value: function onInitContext() {\n      this.oobcContext.updatePrototypesInfo(this.props.prototypesInfo);\n      this.setState({\n        lines: this.oobcContext.getDisplayLines(),\n        currentLine: null,\n        currentBlock: null,\n        selectorInfo: null\n      });\n    }\n  }, {\n    key: \"onUpdateContext\",\n    value: function onUpdateContext() {\n      var _this2 = this;\n\n      this.setState({\n        lines: this.oobcContext.getDisplayLines()\n      }, function () {\n        var onUpdateContextJSON = _this2.props.onUpdateContextJSON;\n\n        var contextJSON = _this2.getContextJSON();\n\n        if (onUpdateContextJSON) onUpdateContextJSON(contextJSON);\n      });\n    }\n  }, {\n    key: \"getContextJSON\",\n    value: function getContextJSON() {\n      return this.oobcContext.toJSON();\n    }\n  }, {\n    key: \"setCurrentLine\",\n    value: function setCurrentLine(line) {\n      var _this3 = this;\n\n      this.setState({\n        currentLine: line,\n        currentBlock: null,\n        selectorInfo: null,\n        contextMenuInfo: null\n      }, function () {\n        if (line) _this3.scrollToLine(line);\n      });\n    }\n  }, {\n    key: \"setCurrentBlock\",\n    value: function setCurrentBlock(block) {\n      var _this4 = this;\n\n      if (block) {\n        var parentLine = block.getParentLine();\n        var selectorInfo = this.getSelectorInfoFor(block);\n        this.setState({\n          currentLine: parentLine,\n          currentBlock: block,\n          selectorInfo: selectorInfo,\n          contextMenuInfo: null\n        }, function () {\n          _this4.scrollToLine(parentLine);\n        });\n      } else {\n        this.setState({\n          currentBlock: null,\n          selectorInfo: null\n        });\n      }\n    }\n  }, {\n    key: \"setCurrentCategory\",\n    value: function setCurrentCategory(category) {\n      if (!this.state.selectorInfo) return;\n\n      var selectorInfo = _objectSpread({}, this.state.selectorInfo, {\n        currentCategory: category\n      });\n\n      this.setState({\n        selectorInfo: selectorInfo\n      });\n    }\n  }, {\n    key: \"setConstantBlockToEdit\",\n    value: function setConstantBlockToEdit(constantBlock) {\n      var onChangeConstantEditorOn = this.props.onChangeConstantEditorOn;\n\n      if (onChangeConstantEditorOn) {\n        var constantEditorOn = !!constantBlock;\n        onChangeConstantEditorOn(constantEditorOn);\n      }\n\n      this.setState({\n        constantBlockToEdit: constantBlock\n      });\n    }\n  }, {\n    key: \"replaceOrCoverCurrentBlockWith\",\n    value: function replaceOrCoverCurrentBlockWith(instanceBlock) {\n      var _this5 = this;\n\n      if (this.state.currentBlock.isCompatibleWith(instanceBlock)) {\n        this.replaceCurrentBlockWith(instanceBlock);\n      } else {\n        var confirm = function confirm() {\n          _this5.coverCurrentBlockWith(instanceBlock);\n        };\n\n        this.showCoverBlockWarning(confirm);\n      }\n    }\n  }, {\n    key: \"replaceCurrentBlockWith\",\n    value: function replaceCurrentBlockWith(instanceBlock) {\n      this.state.currentBlock.replaceWith(instanceBlock);\n      this.onReplaceOrCoverCurrentBlockWith(instanceBlock);\n    }\n  }, {\n    key: \"showCoverBlockWarning\",\n    value: function showCoverBlockWarning(confirm) {\n      var formatWithId = Localization.formatWithId;\n      Alert.confirm({\n        title: formatWithId(\"ID_OOBC_ALERT_REPLACE_BLOCK_TITLE\"),\n        message: formatWithId(\"ID_OOBC_ALERT_REPLACE_BLOCK_MESSAGE\"),\n        confirmButtonName: Localization.formatWithId(\"ID_OOBC_GENERAL_REPLACE\"),\n        confirmButtonAction: confirm,\n        cancelButtonName: Localization.formatWithId(\"ID_OOBC_GENERAL_CANCEL\")\n      });\n    }\n  }, {\n    key: \"coverCurrentBlockWith\",\n    value: function coverCurrentBlockWith(instanceBlock) {\n      this.state.currentBlock.coverWith(instanceBlock);\n      this.onReplaceOrCoverCurrentBlockWith(instanceBlock);\n    }\n  }, {\n    key: \"onReplaceOrCoverCurrentBlockWith\",\n    value: function onReplaceOrCoverCurrentBlockWith(instanceBlock) {\n      this.addLineBelowIfNeeded();\n      this.onUpdateContext();\n\n      if (this.shouldOpenConstantEditorFor(instanceBlock)) {\n        this.setConstantBlockToEdit(instanceBlock);\n      } else {\n        this.setCurrentBlock(instanceBlock.findNextEmptyBlock());\n      }\n    }\n  }, {\n    key: \"addLineBelowIfNeeded\",\n    value: function addLineBelowIfNeeded() {\n      var currentLine = this.state.currentLine;\n\n      if (currentLine.isLastSibling()) {\n        currentLine.addSibling();\n      }\n    }\n  }, {\n    key: \"shouldOpenConstantEditorFor\",\n    value: function shouldOpenConstantEditorFor(block) {\n      switch (block.type) {\n        case OOBC.TYPE.BLOCK.NUMBERBLOCK:\n        case OOBC.TYPE.BLOCK.STRINGBLOCK:\n        case OOBC.TYPE.BLOCK.KEY:\n          return block.data === null;\n\n        case OOBC.TYPE.BLOCK.POSITION:\n          return true;\n\n        default:\n          return false;\n      }\n    }\n  }, {\n    key: \"scrollWhileDraggingLineIfNeeded\",\n    value: function scrollWhileDraggingLineIfNeeded(dragOffset) {\n      var context = document.getElementById(\"oobceditor_context\");\n      var contextRect = context.getBoundingClientRect();\n      var contextOffsetY = dragOffset.y - contextRect.top;\n      var offsetToScroll = 20;\n\n      if (contextOffsetY < offsetToScroll) {\n        if (!this.scrollInterval) {\n          this.scrollInterval = setInterval(function () {\n            context.scrollTo({\n              top: context.scrollTop - 1\n            });\n          }, 1);\n        }\n      } else if (contextRect.height - contextOffsetY < offsetToScroll) {\n        if (!this.scrollInterval) {\n          this.scrollInterval = setInterval(function () {\n            context.scrollTo({\n              top: context.scrollTop + 1\n            });\n          }, 1);\n        }\n      } else {\n        this.clearScrollInterval();\n      }\n    }\n  }, {\n    key: \"clearScrollInterval\",\n    value: function clearScrollInterval() {\n      if (this.scrollInterval) {\n        clearInterval(this.scrollInterval);\n        this.scrollInterval = undefined;\n      }\n    }\n  }, {\n    key: \"scrollToLine\",\n    value: function scrollToLine(line) {\n      var scroller = document.getElementById(\"oobceditor_context\");\n      var element = document.getElementById(\"oobceditor_line-\".concat(line.id));\n\n      if (scroller && element) {\n        var top;\n\n        if (this.state.currentBlock) {\n          top = element.offsetTop - (scroller.offsetHeight / 2 - element.offsetHeight) / 2;\n        } else {\n          top = element.offsetTop - (scroller.offsetHeight - element.offsetHeight) / 2;\n        }\n\n        scroller.scroll({\n          top: top,\n          behavior: \"smooth\"\n        });\n      }\n    }\n  }, {\n    key: \"setLineLongTouchTimeout\",\n    value: function setLineLongTouchTimeout(callback) {\n      this.clearLineLongTouchTimeout();\n      this.lineLongTouchTimeout = setTimeout(callback, 700);\n    }\n  }, {\n    key: \"clearLineLongTouchTimeout\",\n    value: function clearLineLongTouchTimeout() {\n      if (this.lineLongTouchTimeout) {\n        clearTimeout(this.lineLongTouchTimeout);\n        this.lineLongTouchTimeout = undefined;\n      }\n    }\n  }, {\n    key: \"isDisabledPrototypeBlock\",\n    value: function isDisabledPrototypeBlock(prototypeBlock) {\n      var _ref = this.state.selectorInfo || {},\n          _ref$disabledPrototyp = _ref.disabledPrototypeBlocks,\n          disabledPrototypeBlocks = _ref$disabledPrototyp === void 0 ? [] : _ref$disabledPrototyp;\n\n      return disabledPrototypeBlocks.includes(prototypeBlock);\n    }\n  }, {\n    key: \"onClickDisabledPrototypeBlock\",\n    value: function onClickDisabledPrototypeBlock(prototypeBlock) {\n      var formatWithId = Localization.formatWithId;\n\n      if (prototypeBlock instanceof OOBC.Action && (prototypeBlock.data === \"playAnimation\" || prototypeBlock.data === \"stopAnimation\")) {\n        Alert.alert({\n          title: formatWithId(\"ID_OOBC_ALERT_DISABLED_BLOCK_TITLE\"),\n          message: formatWithId(\"ID_OOBC_ALERT_DISABLED_ANIMATEBLOCK_MESSAGE\"),\n          buttonName: formatWithId(\"ID_OOBC_GENERAL_CONFIRM\")\n        });\n      } else {\n        Alert.alert({\n          title: formatWithId(\"ID_OOBC_ALERT_DISABLED_BLOCK_TITLE\"),\n          message: formatWithId(\"ID_OOBC_ALERT_DISABLED_BLOCK_MESSAGE\"),\n          buttonName: formatWithId(\"ID_OOBC_GENERAL_CONFIRM\")\n        });\n      }\n    }\n  }, {\n    key: \"showGlobalVarPrompt\",\n    value: function showGlobalVarPrompt() {\n      var formatWithId = Localization.formatWithId;\n      Alert.prompt({\n        title: formatWithId(\"ID_OOBC_ALERT_ADDVAR_TITLE\"),\n        message: formatWithId(\"ID_OOBC_ALERT_ADDVAR_MESSAGE\"),\n        placeholder: formatWithId(\"ID_OOBC_ALERT_ADDVAR_PLACEHOLDER\"),\n        confirmButtonName: formatWithId(\"ID_OOBC_GENERAL_CONFIRM\"),\n        cancelButtonName: formatWithId(\"ID_OOBC_GENERAL_CANCEL\"),\n        confirmButtonAction: this.onConfirmGlobalVarPrompt\n      });\n    }\n  }, {\n    key: \"checkGlobalVarAndAlertIfInvalid\",\n    value: function checkGlobalVarAndAlertIfInvalid(name) {\n      var formatWithId = Localization.formatWithId;\n\n      if (!this.checkGlobalVarName(name)) {\n        Alert.alert({\n          title: formatWithId(\"ID_OOBC_ALERT_ADDVAR_TITLE\"),\n          message: formatWithId(\"ID_OOBC_ALERT_ADDVAR_INVALIDNAME_MESSAGE\"),\n          buttonName: Localization.formatWithId(\"ID_OOBC_GENERAL_CONFIRM\"),\n          buttonAction: this.onClickAddGlobalVar\n        });\n        return false;\n      }\n\n      if (this.checkGlobalVarExist(name)) {\n        Alert.alert({\n          title: formatWithId(\"ID_OOBC_ALERT_ADDVAR_TITLE\"),\n          message: formatWithId(\"ID_OOBC_ALERT_ADDVAR_EXISTNAME_MESSAGE\"),\n          buttonName: Localization.formatWithId(\"ID_OOBC_GENERAL_CONFIRM\"),\n          buttonAction: this.onClickAddGlobalVar\n        });\n        return false;\n      }\n\n      return true;\n    }\n  }, {\n    key: \"checkGlobalVarName\",\n    value: function checkGlobalVarName(name) {\n      return RegExp(\"^[a-zA-Z_$][a-zA-Z_$0-9]*$\").test(name);\n    }\n  }, {\n    key: \"checkGlobalVarExist\",\n    value: function checkGlobalVarExist(name) {\n      var _ref2 = this.props.prototypesInfo || {},\n          _ref2$variables = _ref2.variables,\n          variables = _ref2$variables === void 0 ? [] : _ref2$variables;\n\n      return variables.includes(name);\n    }\n  }, {\n    key: \"updateDefaultConstantDataIfNull\",\n    value: function updateDefaultConstantDataIfNull(constantBlock) {\n      if (constantBlock.data === null) {\n        switch (constantBlock.type) {\n          case OOBC.TYPE.BLOCK.NUMBERBLOCK:\n            constantBlock.data = 0;\n            break;\n\n          case OOBC.TYPE.BLOCK.STRINGBLOCK:\n            constantBlock.data = Localization.formatWithId(\"ID_OOBC_BLOCK_STRING_DEFAULT\");\n            break;\n\n          default:\n            break;\n        }\n\n        this.onUpdateContext();\n      }\n    }\n  }, {\n    key: \"getSelectorInfoFor\",\n    value: function getSelectorInfoFor(instanceBlock) {\n      var selectorInfo = {\n        categories: [],\n        currentCategory: null,\n        prototypeBlocksOf: {},\n        disabledPrototypeBlocks: []\n      };\n      var replaceablePrototypeBlocks = instanceBlock.filterPrototypeBlocksReplaceable(this.oobcContext.getPrototypeBlocks());\n      var disabledPrototypeBlocks = instanceBlock.filterPrototypeBlocksDisabled(replaceablePrototypeBlocks);\n      selectorInfo.disabledPrototypeBlocks = disabledPrototypeBlocks;\n\n      for (var i in replaceablePrototypeBlocks) {\n        var prototypeBlock = replaceablePrototypeBlocks[i];\n        var category = prototypeBlock.category;\n\n        if (!selectorInfo.categories.includes(category)) {\n          selectorInfo.categories.push(category);\n          selectorInfo.prototypeBlocksOf[category] = [];\n        }\n\n        selectorInfo.prototypeBlocksOf[category].push(prototypeBlock);\n      }\n\n      if (instanceBlock.checkBlockReplaceable(new OOBC.Variable())) {\n        if (!selectorInfo.categories.includes(OOBC.TYPE.CATEGORY.VARIABLE)) {\n          selectorInfo.categories.push(OOBC.TYPE.CATEGORY.VARIABLE);\n        }\n\n        selectorInfo.prototypeBlocksOf[OOBC.TYPE.CATEGORY.VARIABLE] = this.oobcContext.prototypeBlocks.filter(function (block) {\n          return block.category === OOBC.TYPE.CATEGORY.VARIABLE;\n        });\n      }\n\n      this.sortCategories(selectorInfo.categories);\n      selectorInfo.currentCategory = selectorInfo.categories[0];\n      return selectorInfo;\n    }\n  }, {\n    key: \"sortCategories\",\n    value: function sortCategories(categories) {\n      var priority = [OOBC.TYPE.CATEGORY.CONSTANT, OOBC.TYPE.CATEGORY.GAMEOBJECT, OOBC.TYPE.CATEGORY.ACTION, OOBC.TYPE.CATEGORY.PROPERTY, OOBC.TYPE.CATEGORY.OPERATOR, OOBC.TYPE.CATEGORY.UTIL, OOBC.TYPE.CATEGORY.VARIABLE, OOBC.TYPE.CATEGORY.FUNCTIONBLOCK, OOBC.TYPE.CATEGORY.CALLBACK];\n      categories.sort(function (a, b) {\n        return priority.indexOf(a) - priority.indexOf(b);\n      });\n    }\n  }, {\n    key: \"getCurrentCategory\",\n    value: function getCurrentCategory() {\n      var selectorInfo = this.state.selectorInfo;\n      if (!selectorInfo) return;\n      return selectorInfo.currentCategory;\n    }\n  }, {\n    key: \"openLineContextMenu\",\n    value: function openLineContextMenu(line, position) {\n      var contextMenuInfo = this.getContextMenuInfoFor(line, position);\n      Sound.playWithId(\"contextBlock\");\n      this.setContextMenuInfo(contextMenuInfo);\n    }\n  }, {\n    key: \"getContextMenuInfoFor\",\n    value: function getContextMenuInfoFor(line, position) {\n      var contextMenuIds = this.getAvailableContextMenuIdsFor(line);\n      var style = this.getContextMenuStyle(position, contextMenuIds.length, line);\n      return {\n        line: line,\n        contextMenuIds: contextMenuIds,\n        style: style\n      };\n    }\n  }, {\n    key: \"getAvailableContextMenuIdsFor\",\n    value: function getAvailableContextMenuIdsFor(line) {\n      var contextMenuIds = [];\n\n      if (this.state.lines.length > 1) {\n        contextMenuIds.push(CONTEXTMENU.DELETE);\n      }\n\n      if (line.block.data) {\n        contextMenuIds.push(CONTEXTMENU.COPY);\n      }\n\n      if (this.copiedLine) {\n        contextMenuIds.push(CONTEXTMENU.PASTE);\n      }\n\n      contextMenuIds.push(CONTEXTMENU.ADD);\n\n      if (line.disabled) {\n        contextMenuIds.push(CONTEXTMENU.ENABLE);\n      } else {\n        contextMenuIds.push(CONTEXTMENU.DISABLE);\n      } // TODO: 코멘트 기능이 추가되기 전까지 코멘트 메뉴를 보여주지 않습니다.\n      // if (line.comment) {\n      //   contextMenuIds.push(CONTEXTMENU.DELETECOMMENT);\n      // } else {\n      //   contextMenuIds.push(CONTEXTMENU.COMMENT);\n      // }\n\n\n      return contextMenuIds;\n    }\n  }, {\n    key: \"getContextMenuStyle\",\n    value: function getContextMenuStyle(position, contextMenuCount, line) {\n      var px, py;\n\n      if (position) {\n        px = position.x;\n        py = position.y;\n      } else {\n        var lineRect = document.getElementById(\"oobceditor_line-\".concat(line.id)).getBoundingClientRect();\n        px = lineRect.width;\n        py = lineRect.top + lineRect.height / 2;\n      }\n\n      var width = 120;\n      var height = contextMenuCount * 30 + 12;\n      var offset = 18;\n      var oobceditorRect = document.getElementById(\"oobceditor\").getBoundingClientRect();\n      var top = py - oobceditorRect.top - offset;\n      var maxTop = oobceditorRect.height - height - offset;\n      if (top > maxTop) top = maxTop;\n      var left = px - oobceditorRect.left + offset;\n      var maxLeft = oobceditorRect.width - width - offset;\n      if (left > maxLeft) left = maxLeft;\n      return {\n        top: top,\n        left: left,\n        width: width,\n        height: height\n      };\n    }\n  }, {\n    key: \"setContextMenuInfo\",\n    value: function setContextMenuInfo(contextMenuInfo) {\n      var _this6 = this;\n\n      this.setState({\n        contextMenuInfo: null\n      }, function () {\n        if (!contextMenuInfo) return;\n\n        _this6.setState({\n          currentLine: contextMenuInfo.line,\n          currentBlock: null,\n          contextMenuInfo: contextMenuInfo\n        });\n      });\n    }\n  }, {\n    key: \"onClickDeleteLine\",\n    value: function onClickDeleteLine(line) {\n      var _this7 = this;\n\n      if (line.isEmpty()) {\n        Sound.stopWithId(\"menu\");\n        Sound.playWithId(\"deleteLine\");\n        this.oobcContext.deleteLine(line);\n        this.setCurrentLine(null);\n        this.onUpdateContext();\n      } else {\n        var formatWithId = Localization.formatWithId;\n        Alert.confirm({\n          title: formatWithId(\"ID_OOBC_ALERT_DELETELINE_TITLE\"),\n          message: formatWithId(\"ID_OOBC_ALERT_DELETELINE_MESSAGE\"),\n          confirmButtonName: Localization.formatWithId(\"ID_OOBC_GENERAL_CLEAR\"),\n          confirmButtonAction: function confirmButtonAction() {\n            Sound.stopWithId(\"menu\");\n            Sound.playWithId(\"deleteLine\");\n\n            _this7.oobcContext.deleteLine(line);\n\n            _this7.setCurrentLine(null);\n\n            _this7.onUpdateContext();\n          },\n          cancelButtonName: Localization.formatWithId(\"ID_OOBC_GENERAL_CANCEL\")\n        });\n      }\n    }\n  }, {\n    key: \"onClickCopyLine\",\n    value: function onClickCopyLine(line) {\n      this.copiedLine = line;\n    }\n  }, {\n    key: \"onClickPasteLine\",\n    value: function onClickPasteLine(line) {\n      if (!this.copiedLine) return;\n      var clone = this.copiedLine.clone();\n      line.addAfter(clone);\n      this.onUpdateContext();\n      this.setCurrentLine(clone);\n    }\n  }, {\n    key: \"onClickAddLine\",\n    value: function onClickAddLine(line) {\n      var newLine = line.addEmptyAfter();\n      this.onUpdateContext();\n      this.setCurrentLine(newLine);\n    }\n  }, {\n    key: \"onClickEnableLine\",\n    value: function onClickEnableLine(line) {\n      line.enable();\n      this.onUpdateContext();\n    }\n  }, {\n    key: \"onClickDisableLine\",\n    value: function onClickDisableLine(line) {\n      line.disable();\n      this.onUpdateContext();\n    }\n  }, {\n    key: \"onClickAddComment\",\n    value: function onClickAddComment(line) {}\n  }, {\n    key: \"onClickDeleteComment\",\n    value: function onClickDeleteComment(line) {}\n  }, {\n    key: \"getInstanceBlockElementAt\",\n    value: function getInstanceBlockElementAt(lineNum, blockNum) {\n      var instanceBlock = this.getInstanceBlockAt(lineNum, blockNum);\n      if (!instanceBlock) return;\n      var element = document.getElementById(\"oobceditor_block-\".concat(instanceBlock.id));\n      return element;\n    }\n  }, {\n    key: \"getInstanceBlockAt\",\n    value: function getInstanceBlockAt(lineNum, blockNum) {\n      return this.oobcContext.getBlockAt(lineNum, blockNum);\n    }\n  }, {\n    key: \"clickInstanceBlockAt\",\n    value: function clickInstanceBlockAt(lineNum, blockNum) {\n      var instanceBlock = this.getInstanceBlockAt(lineNum, blockNum);\n      if (!instanceBlock) return;\n\n      if (this.state.currentBlock === instanceBlock && instanceBlock instanceof OOBC.Constant) {\n        this.onClickConstantBlockEdit(instanceBlock);\n      } else {\n        this.onClickInstanceBlock(instanceBlock);\n      }\n    }\n  }, {\n    key: \"getPrototypeBlockElementWithData\",\n    value: function getPrototypeBlockElementWithData(data) {\n      var prototypeBlock = this.getPrototypeBlockWithData(data);\n      if (!prototypeBlock) return;\n      var element = document.getElementById(\"oobceditor_block-\".concat(prototypeBlock.id));\n      return element;\n    }\n  }, {\n    key: \"getPrototypeBlockWithData\",\n    value: function getPrototypeBlockWithData(data) {\n      var currentCategoryPrototypeBlocks = this.getCurrentCategoryPrototypeBlocks();\n      var prototypeBlockWithData = currentCategoryPrototypeBlocks.find(function (prototypeBlock) {\n        return prototypeBlock.data === data;\n      });\n      return prototypeBlockWithData;\n    }\n  }, {\n    key: \"getCurrentCategoryPrototypeBlocks\",\n    value: function getCurrentCategoryPrototypeBlocks() {\n      var selectorInfo = this.state.selectorInfo;\n      if (!selectorInfo) return [];\n      var currentCategory = selectorInfo.currentCategory,\n          prototypeBlocksOf = selectorInfo.prototypeBlocksOf;\n      var prototypeBlocks = prototypeBlocksOf[currentCategory];\n      return prototypeBlocks;\n    }\n  }, {\n    key: \"clickPrototypeBlockWithData\",\n    value: function clickPrototypeBlockWithData(data) {\n      var prototypeBlock = this.getPrototypeBlockWithData(data);\n      if (!prototypeBlock) return;\n      this.onClickPrototypeBlock(prototypeBlock);\n    }\n  }, {\n    key: \"getSelectorCategoryElementWithName\",\n    value: function getSelectorCategoryElementWithName(category) {\n      var element = document.getElementById(\"oobceditor_selector_category-\".concat(category));\n      return element;\n    }\n  }, {\n    key: \"onClickSelectorCategoryWithName\",\n    value: function onClickSelectorCategoryWithName(category) {\n      this.onClickSelectorCategory(category);\n    }\n  }, {\n    key: \"setKeyListener\",\n    value: function setKeyListener() {// window.addEventListener(\"keyup\", this.keyListener);\n    }\n  }, {\n    key: \"clearKeyListener\",\n    value: function clearKeyListener() {// window.removeEventListener(\"keyup\", this.keyListener);\n    }\n  }, {\n    key: \"loadZoomLevel\",\n    value: function loadZoomLevel() {\n      var zoomLevel = this.getZoomLevelFromLocal();\n      this.setState({\n        zoomLevel: zoomLevel\n      });\n      this.maxZoomLevel = 4;\n      this.minZoomLevel = 0;\n    }\n  }, {\n    key: \"updateZoomLevelToLocal\",\n    value: function updateZoomLevelToLocal() {\n      var zoomLevel = this.state.zoomLevel;\n      localStorage.setItem(\"oobcEditorZoomLevel\", zoomLevel);\n    }\n  }, {\n    key: \"getZoomLevelFromLocal\",\n    value: function getZoomLevelFromLocal() {\n      var defaultZoomLevel = 3;\n      var zoomLevel = parseInt(localStorage.getItem(\"oobcEditorZoomLevel\"));\n\n      if (isNaN(zoomLevel)) {\n        return defaultZoomLevel;\n      } else {\n        return zoomLevel;\n      }\n    }\n  }, {\n    key: \"zoomInIfPossible\",\n    value: function zoomInIfPossible() {\n      var _this8 = this;\n\n      var zoomLevel = this.state.zoomLevel + 1;\n\n      if (zoomLevel <= this.maxZoomLevel) {\n        this.setState({\n          zoomLevel: zoomLevel\n        }, function () {\n          _this8.updateZoomLevelToLocal();\n        });\n      }\n    }\n  }, {\n    key: \"zoomOutIfPossible\",\n    value: function zoomOutIfPossible() {\n      var _this9 = this;\n\n      var zoomLevel = this.state.zoomLevel - 1;\n\n      if (zoomLevel >= this.minZoomLevel) {\n        this.setState({\n          zoomLevel: zoomLevel\n        }, function () {\n          _this9.updateZoomLevelToLocal();\n        });\n      }\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _this$state = this.state,\n          lines = _this$state.lines,\n          currentLine = _this$state.currentLine,\n          currentBlock = _this$state.currentBlock,\n          constantBlockToEdit = _this$state.constantBlockToEdit,\n          selectorInfo = _this$state.selectorInfo,\n          contextMenuInfo = _this$state.contextMenuInfo,\n          zoomLevel = _this$state.zoomLevel;\n      var isMinZoom = this.minZoomLevel === zoomLevel;\n      var isMaxZoom = this.maxZoomLevel === zoomLevel;\n      return React.createElement(View, {\n        context: this.oobcContext,\n        lines: lines,\n        currentLine: currentLine,\n        currentBlock: currentBlock,\n        constantBlockToEdit: constantBlockToEdit,\n        selectorMode: this.props.selectorMode,\n        selectorInfo: selectorInfo,\n        contextMenuInfo: contextMenuInfo,\n        zoomLevel: zoomLevel,\n        isMinZoom: isMinZoom,\n        isMaxZoom: isMaxZoom,\n        onScrollContext: this.onScrollContext,\n        onClickContext: this.onClickContext,\n        onClickLine: this.onClickLine,\n        onLineContextMenu: this.onLineContextMenu,\n        onClickLineContextMenu: this.onClickLineContextMenu,\n        onClickFoldLine: this.onClickFoldLine,\n        onTouchLineStart: this.onTouchLineStart,\n        onTouchLineMove: this.onTouchLineMove,\n        onTouchLineEnd: this.onTouchLineEnd,\n        onDragLine: this.onDragLine,\n        onDragLineOverEnd: this.onDragLineOverEnd,\n        onDragLineBegin: this.onDragLineBegin,\n        onDragLineEnd: this.onDragLineEnd,\n        onClickInstanceBlock: this.onClickInstanceBlock,\n        onClickPrototypeBlock: this.onClickPrototypeBlock,\n        onClickAddGlobalVar: this.onClickAddGlobalVar,\n        onClickConstantBlockEdit: this.onClickConstantBlockEdit,\n        onClickConstantEditorOverlay: this.onClickConstantEditorOverlay,\n        onClickConstantEditorConfirm: this.onClickConstantEditorConfirm,\n        onClickConstantEditorCancel: this.onClickConstantEditorCancel,\n        onChangeContantEditorData: this.onChangeContantEditorData,\n        onClickSelectorCategory: this.onClickSelectorCategory,\n        onClickSelectorClose: this.onClickSelectorClose,\n        onClickZoomIn: this.onClickZoomIn,\n        onClickZoomOut: this.onClickZoomOut,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 860\n        },\n        __self: this\n      });\n    }\n  }]);\n\n  return OOBCEditor;\n}(Component);\n\nexport default OOBCEditor;","map":{"version":3,"sources":["/Users/jimmy/Documents/Wizschool/astroboy/src/Common/Component/OOBCEditor/index.js"],"names":["React","Component","CONTEXTMENU","Localization","Alert","Sound","OOBC","View","OOBCEditor","props","onClickLine","line","currentLine","state","setCurrentLine","playWithId","onClickFoldLine","folded","unfold","fold","onUpdateContext","onDragLine","dragLine","hoverLine","dragOffset","lineNum","scrollWhileDraggingLineIfNeeded","didMove","getIsUpwardDragging","moveBefore","moveAfter","onDragLineOverEnd","moveToLastOfContext","hoverLineElement","document","getElementById","id","hoverLineRect","getBoundingClientRect","top","height","y","onDragLineBegin","prevLineFolded","prevBlock","currentBlock","setCurrentBlock","shouldFoldBeforeDragStart","getCallbackBlock","onDragLineEnd","clearScrollInterval","onScrollContext","clearLineLongTouchTimeout","onClickContext","onTouchLineStart","position","lineLongTouchPosition","setLineLongTouchTimeout","onLineLongTouch","onTouchLineMove","onTouchLineEnd","openLineContextMenu","onClickInstanceBlock","instanceBlock","onClickPrototypeBlock","prototypeBlock","isDisabledPrototypeBlock","onClickDisabledPrototypeBlock","createInstanceBlockWith","replaceOrCoverCurrentBlockWith","onClickAddGlobalVar","showGlobalVarPrompt","onConfirmGlobalVarPrompt","name","checkGlobalVarAndAlertIfInvalid","onAddGlobalVar","onClickConstantBlockEdit","constantBlock","setConstantBlockToEdit","onClickConstantEditorOverlay","onClickConstantEditorConfirm","newData","data","findNextEmptyBlock","onClickConstantEditorCancel","updateDefaultConstantDataIfNull","onChangeContantEditorData","onChangeConstantEditorValue","onClickSelectorCategory","category","setCurrentCategory","onClickSelectorClose","onLineContextMenu","onClickLineContextMenu","contextMenuId","DELETE","onClickDeleteLine","COPY","onClickCopyLine","PASTE","onClickPasteLine","ADD","onClickAddLine","ENABLE","onClickEnableLine","DISABLE","onClickDisableLine","COMMENT","onClickAddComment","DELETECOMMENT","onClickDeleteComment","setState","contextMenuInfo","keyListener","event","key","onDeleteKeyListener","onEnterKeyListener","onTabKeyListener","onClickZoomIn","zoomInIfPossible","onClickZoomOut","zoomOutIfPossible","updateLocaleTo","locale","configureWith","alert","sound","oobcContext","Context","updatePrototypesInfo","prototypesInfo","lines","getDisplayLines","constantBlockToEdit","selectorInfo","zoomLevel","setKeyListener","loadZoomLevel","clearKeyListener","prevProps","JSON","stringify","onUpdatePrototypesInfo","onUpdateLocale","prevCategory","currentCategory","getSelectorInfoFor","onInitContext","contextJSON","fromJSON","onUpdateContextJSON","getContextJSON","toJSON","scrollToLine","block","parentLine","getParentLine","onChangeConstantEditorOn","constantEditorOn","isCompatibleWith","replaceCurrentBlockWith","confirm","coverCurrentBlockWith","showCoverBlockWarning","replaceWith","onReplaceOrCoverCurrentBlockWith","formatWithId","title","message","confirmButtonName","confirmButtonAction","cancelButtonName","coverWith","addLineBelowIfNeeded","shouldOpenConstantEditorFor","isLastSibling","addSibling","type","TYPE","BLOCK","NUMBERBLOCK","STRINGBLOCK","KEY","POSITION","context","contextRect","contextOffsetY","offsetToScroll","scrollInterval","setInterval","scrollTo","scrollTop","clearInterval","undefined","scroller","element","offsetTop","offsetHeight","scroll","behavior","callback","lineLongTouchTimeout","setTimeout","clearTimeout","disabledPrototypeBlocks","includes","Action","buttonName","prompt","placeholder","checkGlobalVarName","buttonAction","checkGlobalVarExist","RegExp","test","variables","categories","prototypeBlocksOf","replaceablePrototypeBlocks","filterPrototypeBlocksReplaceable","getPrototypeBlocks","filterPrototypeBlocksDisabled","i","push","checkBlockReplaceable","Variable","CATEGORY","VARIABLE","prototypeBlocks","filter","sortCategories","priority","CONSTANT","GAMEOBJECT","ACTION","PROPERTY","OPERATOR","UTIL","FUNCTIONBLOCK","CALLBACK","sort","a","b","indexOf","getContextMenuInfoFor","setContextMenuInfo","contextMenuIds","getAvailableContextMenuIdsFor","style","getContextMenuStyle","length","copiedLine","disabled","contextMenuCount","px","py","x","lineRect","width","offset","oobceditorRect","maxTop","left","maxLeft","isEmpty","stopWithId","deleteLine","clone","addAfter","newLine","addEmptyAfter","enable","disable","blockNum","getInstanceBlockAt","getBlockAt","Constant","getPrototypeBlockWithData","currentCategoryPrototypeBlocks","getCurrentCategoryPrototypeBlocks","prototypeBlockWithData","find","getZoomLevelFromLocal","maxZoomLevel","minZoomLevel","localStorage","setItem","defaultZoomLevel","parseInt","getItem","isNaN","updateZoomLevelToLocal","isMinZoom","isMaxZoom","selectorMode"],"mappings":"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","sourcesContent":["import React, { Component } from \"react\";\nimport { CONTEXTMENU } from \"./Constant\";\nimport Localization from \"./Localization\";\nimport Alert from \"./Alert\";\nimport Sound from \"./Sound\";\nimport OOBC from \"./OOBC\";\nimport View from \"./View\";\n\nclass OOBCEditor extends Component {\n  constructor(props) {\n    super(props);\n    Localization.updateLocaleTo(this.props.locale);\n    Alert.configureWith(this.props.alert);\n    Sound.configureWith(this.props.sound);\n\n    this.oobcContext = new OOBC.Context();\n    this.oobcContext.updatePrototypesInfo(this.props.prototypesInfo);\n\n    this.state = {\n      lines: this.oobcContext.getDisplayLines(),\n      currentLine: null,\n      currentBlock: null,\n      constantBlockToEdit: null,\n      selectorInfo: null,\n      contextMenuInfo: null,\n      zoomLevel: 0\n    };\n  }\n  componentDidMount() {\n    this.setKeyListener();\n    this.loadZoomLevel();\n  }\n  componentWillUnmount() {\n    this.clearKeyListener();\n    this.clearScrollInterval();\n  }\n  componentDidUpdate(prevProps) {\n    if (\n      JSON.stringify(prevProps.prototypesInfo) !==\n      JSON.stringify(this.props.prototypesInfo)\n    ) {\n      this.onUpdatePrototypesInfo();\n    }\n    if (prevProps.locale !== this.props.locale) {\n      this.onUpdateLocale();\n    }\n  }\n  onUpdatePrototypesInfo() {\n    this.oobcContext.updatePrototypesInfo(this.props.prototypesInfo);\n    const { currentBlock } = this.state;\n    if (currentBlock) {\n      const prevCategory = this.state.selectorInfo.currentCategory;\n      const selectorInfo = this.getSelectorInfoFor(currentBlock);\n      selectorInfo.currentCategory = prevCategory;\n      this.setState({ selectorInfo });\n    }\n  }\n  onUpdateLocale() {\n    Localization.updateLocaleTo(this.props.locale);\n    this.onUpdateContext();\n  }\n\n  initEmptyContext() {\n    this.oobcContext = new OOBC.Context();\n    this.onInitContext();\n  }\n  initContextWith(contextJSON) {\n    this.oobcContext = OOBC.Context.fromJSON(contextJSON);\n    this.onInitContext();\n  }\n  onInitContext() {\n    this.oobcContext.updatePrototypesInfo(this.props.prototypesInfo);\n    this.setState({\n      lines: this.oobcContext.getDisplayLines(),\n      currentLine: null,\n      currentBlock: null,\n      selectorInfo: null\n    });\n  }\n  onUpdateContext() {\n    this.setState({ lines: this.oobcContext.getDisplayLines() }, () => {\n      const { onUpdateContextJSON } = this.props;\n      const contextJSON = this.getContextJSON();\n      if (onUpdateContextJSON) onUpdateContextJSON(contextJSON);\n    });\n  }\n  getContextJSON() {\n    return this.oobcContext.toJSON();\n  }\n\n  setCurrentLine(line) {\n    this.setState(\n      {\n        currentLine: line,\n        currentBlock: null,\n        selectorInfo: null,\n        contextMenuInfo: null\n      },\n      () => {\n        if (line) this.scrollToLine(line);\n      }\n    );\n  }\n  setCurrentBlock(block) {\n    if (block) {\n      const parentLine = block.getParentLine();\n      const selectorInfo = this.getSelectorInfoFor(block);\n      this.setState(\n        {\n          currentLine: parentLine,\n          currentBlock: block,\n          selectorInfo: selectorInfo,\n          contextMenuInfo: null\n        },\n        () => {\n          this.scrollToLine(parentLine);\n        }\n      );\n    } else {\n      this.setState({\n        currentBlock: null,\n        selectorInfo: null\n      });\n    }\n  }\n  setCurrentCategory(category) {\n    if (!this.state.selectorInfo) return;\n    const selectorInfo = {\n      ...this.state.selectorInfo,\n      currentCategory: category\n    };\n    this.setState({ selectorInfo });\n  }\n  setConstantBlockToEdit(constantBlock) {\n    const { onChangeConstantEditorOn } = this.props;\n    if (onChangeConstantEditorOn) {\n      const constantEditorOn = !!constantBlock;\n      onChangeConstantEditorOn(constantEditorOn);\n    }\n    this.setState({ constantBlockToEdit: constantBlock });\n  }\n\n  replaceOrCoverCurrentBlockWith(instanceBlock) {\n    if (this.state.currentBlock.isCompatibleWith(instanceBlock)) {\n      this.replaceCurrentBlockWith(instanceBlock);\n    } else {\n      const confirm = () => {\n        this.coverCurrentBlockWith(instanceBlock);\n      };\n      this.showCoverBlockWarning(confirm);\n    }\n  }\n  replaceCurrentBlockWith(instanceBlock) {\n    this.state.currentBlock.replaceWith(instanceBlock);\n    this.onReplaceOrCoverCurrentBlockWith(instanceBlock);\n  }\n  showCoverBlockWarning(confirm) {\n    const { formatWithId } = Localization;\n    Alert.confirm({\n      title: formatWithId(\"ID_OOBC_ALERT_REPLACE_BLOCK_TITLE\"),\n      message: formatWithId(\"ID_OOBC_ALERT_REPLACE_BLOCK_MESSAGE\"),\n      confirmButtonName: Localization.formatWithId(\"ID_OOBC_GENERAL_REPLACE\"),\n      confirmButtonAction: confirm,\n      cancelButtonName: Localization.formatWithId(\"ID_OOBC_GENERAL_CANCEL\")\n    });\n  }\n  coverCurrentBlockWith(instanceBlock) {\n    this.state.currentBlock.coverWith(instanceBlock);\n    this.onReplaceOrCoverCurrentBlockWith(instanceBlock);\n  }\n  onReplaceOrCoverCurrentBlockWith(instanceBlock) {\n    this.addLineBelowIfNeeded();\n    this.onUpdateContext();\n    if (this.shouldOpenConstantEditorFor(instanceBlock)) {\n      this.setConstantBlockToEdit(instanceBlock);\n    } else {\n      this.setCurrentBlock(instanceBlock.findNextEmptyBlock());\n    }\n  }\n  addLineBelowIfNeeded() {\n    const { currentLine } = this.state;\n    if (currentLine.isLastSibling()) {\n      currentLine.addSibling();\n    }\n  }\n  shouldOpenConstantEditorFor(block) {\n    switch(block.type) {\n      case OOBC.TYPE.BLOCK.NUMBERBLOCK:\n      case OOBC.TYPE.BLOCK.STRINGBLOCK:\n      case OOBC.TYPE.BLOCK.KEY:\n        return block.data === null;\n      case OOBC.TYPE.BLOCK.POSITION:\n        return true;\n      default:\n        return false;\n    }\n  }\n\n  onClickLine = line => {\n    const { currentLine } = this.state;\n    if (line === currentLine) {\n      this.setCurrentLine(null);\n    } else {\n      Sound.playWithId(\"touchLine\");\n      this.setCurrentLine(line);\n    }\n  };\n  onClickFoldLine = line => {\n    Sound.playWithId(\"touchLine\");\n    if (line.folded) {\n      line.unfold();\n    } else {\n      line.fold();\n    }\n    this.onUpdateContext();\n  };\n  onDragLine = (dragLine, hoverLine, dragOffset) => {\n    if (dragLine.lineNum === hoverLine.lineNum) return;\n\n    this.scrollWhileDraggingLineIfNeeded(dragOffset);\n\n    let didMove;\n    if (this.getIsUpwardDragging(hoverLine, dragOffset)) {\n      didMove = dragLine.moveBefore(hoverLine);\n    } else {\n      didMove = dragLine.moveAfter(hoverLine);\n    }\n\n    if (didMove) this.onUpdateContext();\n  };\n  onDragLineOverEnd = dragLine => {\n    const didMove = dragLine.moveToLastOfContext();\n    if (didMove) this.onUpdateContext();\n  };\n  scrollWhileDraggingLineIfNeeded(dragOffset) {\n    const context = document.getElementById(\"oobceditor_context\");\n    const contextRect = context.getBoundingClientRect();\n    const contextOffsetY = dragOffset.y - contextRect.top;\n    const offsetToScroll = 20;\n    if (contextOffsetY < offsetToScroll) {\n      if (!this.scrollInterval) {\n        this.scrollInterval = setInterval(() => {\n          context.scrollTo({ top: context.scrollTop - 1 });\n        }, 1);\n      }\n    } else if (contextRect.height - contextOffsetY < offsetToScroll) {\n      if (!this.scrollInterval) {\n        this.scrollInterval = setInterval(() => {\n          context.scrollTo({ top: context.scrollTop + 1 });\n        }, 1);\n      }\n    } else {\n      this.clearScrollInterval();\n    }\n  }\n  getIsUpwardDragging = (hoverLine, dragOffset) => {\n    const hoverLineElement = document.getElementById(\n      `oobceditor_line-${hoverLine.id}`\n    );\n    if (!hoverLineElement) return false;\n    const hoverLineRect = hoverLineElement.getBoundingClientRect();\n    if (hoverLineRect.top + hoverLineRect.height / 2 > dragOffset.y) {\n      return true;\n    } else {\n      return false;\n    }\n  };\n  clearScrollInterval() {\n    if (this.scrollInterval) {\n      clearInterval(this.scrollInterval);\n      this.scrollInterval = undefined;\n    }\n  }\n  onDragLineBegin = line => {\n    this.prevLineFolded = line.folded;\n    this.prevBlock = this.state.currentBlock;\n    this.setCurrentBlock(null);\n    const shouldFoldBeforeDragStart = line.getCallbackBlock() && !line.folded;\n    if (shouldFoldBeforeDragStart) {\n      line.fold();\n      this.onUpdateContext();\n    }\n  };\n  onDragLineEnd = line => {\n    this.setCurrentBlock(this.prevBlock);\n    if (!this.prevLineFolded) {\n      line.unfold();\n      this.onUpdateContext();\n    }\n    this.clearScrollInterval();\n  };\n  scrollToLine(line) {\n    const scroller = document.getElementById(\"oobceditor_context\");\n    const element = document.getElementById(`oobceditor_line-${line.id}`);\n    if (scroller && element) {\n      let top;\n      if (this.state.currentBlock) {\n        top =\n          element.offsetTop -\n          (scroller.offsetHeight / 2 - element.offsetHeight) / 2;\n      } else {\n        top =\n          element.offsetTop -\n          (scroller.offsetHeight - element.offsetHeight) / 2;\n      }\n      scroller.scroll({ top, behavior: \"smooth\" });\n    }\n  }\n\n  onScrollContext = () => {\n    this.clearLineLongTouchTimeout();\n  };\n  onClickContext = () => { \n    this.setCurrentLine(null);\n  }\n\n  onTouchLineStart = (line, position) => {\n    this.lineLongTouchPosition = position;\n    this.setLineLongTouchTimeout(() => {\n      this.onLineLongTouch(line, this.lineLongTouchPosition);\n    });\n  };\n  onTouchLineMove = position => {\n    this.lineLongTouchPosition = position;\n  };\n  onTouchLineEnd = line => {\n    this.clearLineLongTouchTimeout();\n  };\n  onLineLongTouch = (line, position) => {\n    this.clearLineLongTouchTimeout();\n    this.openLineContextMenu(line, position);\n  };\n  setLineLongTouchTimeout(callback) {\n    this.clearLineLongTouchTimeout();\n    this.lineLongTouchTimeout = setTimeout(callback, 700);\n  }\n  clearLineLongTouchTimeout() {\n    if (this.lineLongTouchTimeout) {\n      clearTimeout(this.lineLongTouchTimeout);\n      this.lineLongTouchTimeout = undefined;\n    }\n  }\n\n  onClickInstanceBlock = instanceBlock => {\n    const { currentBlock } = this.state;\n    if (instanceBlock !== currentBlock) {\n      Sound.playWithId(\"contextBlock\");\n      this.setCurrentBlock(instanceBlock);\n    }\n  };\n  onClickPrototypeBlock = prototypeBlock => {\n    if (this.isDisabledPrototypeBlock(prototypeBlock)) {\n      this.onClickDisabledPrototypeBlock(prototypeBlock);\n    } else {\n      const { currentBlock } = this.state;\n      const instanceBlock = currentBlock.createInstanceBlockWith(\n        prototypeBlock\n      );\n      Sound.playWithId(\"prototypeBlock\");\n      this.replaceOrCoverCurrentBlockWith(instanceBlock);\n    }\n  };\n  isDisabledPrototypeBlock(prototypeBlock) {\n    const { disabledPrototypeBlocks = [] } = this.state.selectorInfo || {};\n    return disabledPrototypeBlocks.includes(prototypeBlock);\n  }\n  onClickDisabledPrototypeBlock(prototypeBlock) {\n    const { formatWithId } = Localization;\n    if (\n      prototypeBlock instanceof OOBC.Action &&\n      (prototypeBlock.data === \"playAnimation\" ||\n        prototypeBlock.data === \"stopAnimation\")\n    ) {\n      Alert.alert({\n        title: formatWithId(\"ID_OOBC_ALERT_DISABLED_BLOCK_TITLE\"),\n        message: formatWithId(\"ID_OOBC_ALERT_DISABLED_ANIMATEBLOCK_MESSAGE\"),\n        buttonName: formatWithId(\"ID_OOBC_GENERAL_CONFIRM\")\n      });\n    } else {\n      Alert.alert({\n        title: formatWithId(\"ID_OOBC_ALERT_DISABLED_BLOCK_TITLE\"),\n        message: formatWithId(\"ID_OOBC_ALERT_DISABLED_BLOCK_MESSAGE\"),\n        buttonName: formatWithId(\"ID_OOBC_GENERAL_CONFIRM\")\n      });\n    }\n  }\n\n  onClickAddGlobalVar = () => {\n    this.showGlobalVarPrompt();\n  };\n  showGlobalVarPrompt() {\n    const { formatWithId } = Localization;\n    Alert.prompt({\n      title: formatWithId(\"ID_OOBC_ALERT_ADDVAR_TITLE\"),\n      message: formatWithId(\"ID_OOBC_ALERT_ADDVAR_MESSAGE\"),\n      placeholder: formatWithId(\"ID_OOBC_ALERT_ADDVAR_PLACEHOLDER\"),\n      confirmButtonName: formatWithId(\"ID_OOBC_GENERAL_CONFIRM\"),\n      cancelButtonName: formatWithId(\"ID_OOBC_GENERAL_CANCEL\"),\n      confirmButtonAction: this.onConfirmGlobalVarPrompt\n    });\n  }\n  onConfirmGlobalVarPrompt = name => {\n    if (this.checkGlobalVarAndAlertIfInvalid(name)) {\n      const { onAddGlobalVar } = this.props;\n      if (onAddGlobalVar) onAddGlobalVar(name);\n    }\n  };\n  checkGlobalVarAndAlertIfInvalid(name) {\n    const { formatWithId } = Localization;\n    if (!this.checkGlobalVarName(name)) {\n      Alert.alert({\n        title: formatWithId(\"ID_OOBC_ALERT_ADDVAR_TITLE\"),\n        message: formatWithId(\"ID_OOBC_ALERT_ADDVAR_INVALIDNAME_MESSAGE\"),\n        buttonName: Localization.formatWithId(\"ID_OOBC_GENERAL_CONFIRM\"),\n        buttonAction: this.onClickAddGlobalVar\n      });\n      return false;\n    }\n    if (this.checkGlobalVarExist(name)) {\n      Alert.alert({\n        title: formatWithId(\"ID_OOBC_ALERT_ADDVAR_TITLE\"),\n        message: formatWithId(\"ID_OOBC_ALERT_ADDVAR_EXISTNAME_MESSAGE\"),\n        buttonName: Localization.formatWithId(\"ID_OOBC_GENERAL_CONFIRM\"),\n        buttonAction: this.onClickAddGlobalVar\n      });\n      return false;\n    }\n    return true;\n  }\n  checkGlobalVarName(name) {\n    return RegExp(\"^[a-zA-Z_$][a-zA-Z_$0-9]*$\").test(name);\n  }\n  checkGlobalVarExist(name) {\n    const { variables = [] } = this.props.prototypesInfo || {};\n    return variables.includes(name);\n  }\n\n  onClickConstantBlockEdit = constantBlock => {\n    this.setConstantBlockToEdit(constantBlock);\n  };\n  onClickConstantEditorOverlay = () => {\n    this.setConstantBlockToEdit(null);\n  };\n  onClickConstantEditorConfirm = (constantBlock, newData) => {\n    constantBlock.data = newData;\n    this.onUpdateContext();\n    this.setConstantBlockToEdit(null);\n    this.setCurrentBlock(constantBlock.findNextEmptyBlock());\n  };\n  onClickConstantEditorCancel = constantBlock => {\n    this.updateDefaultConstantDataIfNull(constantBlock);\n    this.setConstantBlockToEdit(null);\n  };\n  updateDefaultConstantDataIfNull(constantBlock) {\n    if (constantBlock.data === null) {\n      switch (constantBlock.type) {\n        case OOBC.TYPE.BLOCK.NUMBERBLOCK:\n          constantBlock.data = 0;\n          break;\n        case OOBC.TYPE.BLOCK.STRINGBLOCK:\n          constantBlock.data = Localization.formatWithId(\n            \"ID_OOBC_BLOCK_STRING_DEFAULT\"\n          );\n          break;\n        default:\n          break;\n      }\n      this.onUpdateContext();\n    }\n  }\n  onChangeContantEditorData = data => {\n    const { onChangeConstantEditorValue } = this.props;\n    if (onChangeConstantEditorValue) {\n      onChangeConstantEditorValue(data);\n    }\n  };\n\n  onClickSelectorCategory = category => {\n    Sound.playWithId(\"blockCategory\");\n    this.setCurrentCategory(category);\n  };\n  onClickSelectorClose = () => {\n    this.setCurrentBlock(null);\n  };\n  getSelectorInfoFor(instanceBlock) {\n    const selectorInfo = {\n      categories: [],\n      currentCategory: null,\n      prototypeBlocksOf: {},\n      disabledPrototypeBlocks: []\n    };\n    const replaceablePrototypeBlocks = instanceBlock.filterPrototypeBlocksReplaceable(\n      this.oobcContext.getPrototypeBlocks()\n    );\n    const disabledPrototypeBlocks = instanceBlock.filterPrototypeBlocksDisabled(\n      replaceablePrototypeBlocks\n    );\n    selectorInfo.disabledPrototypeBlocks = disabledPrototypeBlocks;\n    for (let i in replaceablePrototypeBlocks) {\n      const prototypeBlock = replaceablePrototypeBlocks[i];\n      const category = prototypeBlock.category;\n      if (!selectorInfo.categories.includes(category)) {\n        selectorInfo.categories.push(category);\n        selectorInfo.prototypeBlocksOf[category] = [];\n      }\n      selectorInfo.prototypeBlocksOf[category].push(prototypeBlock);\n    }\n    if(instanceBlock.checkBlockReplaceable(new OOBC.Variable())) {\n      if (!selectorInfo.categories.includes(OOBC.TYPE.CATEGORY.VARIABLE)) {\n        selectorInfo.categories.push(OOBC.TYPE.CATEGORY.VARIABLE);\n      }\n      selectorInfo.prototypeBlocksOf[OOBC.TYPE.CATEGORY.VARIABLE] = \n      this.oobcContext.prototypeBlocks.filter(block => block.category === OOBC.TYPE.CATEGORY.VARIABLE);\n    }\n    this.sortCategories(selectorInfo.categories);\n    selectorInfo.currentCategory = selectorInfo.categories[0];\n    return selectorInfo;\n  }\n  sortCategories(categories) {\n    const priority = [\n      OOBC.TYPE.CATEGORY.CONSTANT,\n      OOBC.TYPE.CATEGORY.GAMEOBJECT,\n      OOBC.TYPE.CATEGORY.ACTION,\n      OOBC.TYPE.CATEGORY.PROPERTY,\n      OOBC.TYPE.CATEGORY.OPERATOR,\n      OOBC.TYPE.CATEGORY.UTIL,\n      OOBC.TYPE.CATEGORY.VARIABLE,\n      OOBC.TYPE.CATEGORY.FUNCTIONBLOCK,\n      OOBC.TYPE.CATEGORY.CALLBACK\n    ];\n    categories.sort((a, b) => priority.indexOf(a) - priority.indexOf(b));\n  }\n  getCurrentCategory() {\n    const { selectorInfo } = this.state;\n    if (!selectorInfo) return;\n    return selectorInfo.currentCategory;\n  }\n\n  onLineContextMenu = (line, position) => {\n    this.clearLineLongTouchTimeout();\n    this.openLineContextMenu(line, position);\n  };\n  openLineContextMenu(line, position) {\n    const contextMenuInfo = this.getContextMenuInfoFor(line, position);\n    Sound.playWithId(\"contextBlock\");\n    this.setContextMenuInfo(contextMenuInfo);\n  }\n  getContextMenuInfoFor(line, position) {\n    const contextMenuIds = this.getAvailableContextMenuIdsFor(line);\n    const style = this.getContextMenuStyle(\n      position,\n      contextMenuIds.length,\n      line\n    );\n    return { line, contextMenuIds, style };\n  }\n  getAvailableContextMenuIdsFor(line) {\n    const contextMenuIds = [];\n    if (this.state.lines.length > 1) {\n      contextMenuIds.push(CONTEXTMENU.DELETE);\n    }\n    if (line.block.data) {\n      contextMenuIds.push(CONTEXTMENU.COPY);\n    }\n    if (this.copiedLine) {\n      contextMenuIds.push(CONTEXTMENU.PASTE);\n    }\n    contextMenuIds.push(CONTEXTMENU.ADD);\n    if (line.disabled) {\n      contextMenuIds.push(CONTEXTMENU.ENABLE);\n    } else {\n      contextMenuIds.push(CONTEXTMENU.DISABLE);\n    }\n    // TODO: 코멘트 기능이 추가되기 전까지 코멘트 메뉴를 보여주지 않습니다.\n    // if (line.comment) {\n    //   contextMenuIds.push(CONTEXTMENU.DELETECOMMENT);\n    // } else {\n    //   contextMenuIds.push(CONTEXTMENU.COMMENT);\n    // }\n    return contextMenuIds;\n  }\n  getContextMenuStyle(position, contextMenuCount, line) {\n    let px, py;\n    if (position) {\n      px = position.x;\n      py = position.y;\n    } else {\n      const lineRect = document\n        .getElementById(`oobceditor_line-${line.id}`)\n        .getBoundingClientRect();\n      px = lineRect.width;\n      py = lineRect.top + lineRect.height / 2;\n    }\n    const width = 120;\n    const height = contextMenuCount * 30 + 12;\n    const offset = 18;\n    const oobceditorRect = document\n      .getElementById(\"oobceditor\")\n      .getBoundingClientRect();\n    let top = py - oobceditorRect.top - offset;\n    const maxTop = oobceditorRect.height - height - offset;\n    if (top > maxTop) top = maxTop;\n    let left = px - oobceditorRect.left + offset;\n    const maxLeft = oobceditorRect.width - width - offset;\n    if (left > maxLeft) left = maxLeft;\n\n    return { top, left, width, height };\n  }\n  setContextMenuInfo(contextMenuInfo) {\n    this.setState({ contextMenuInfo: null }, () => {\n      if (!contextMenuInfo) return;\n      this.setState({\n        currentLine: contextMenuInfo.line,\n        currentBlock: null,\n        contextMenuInfo\n      });\n    });\n  }\n\n  onClickLineContextMenu = (line, contextMenuId) => {\n    Sound.playWithId(\"menu\");\n    switch (contextMenuId) {\n      case CONTEXTMENU.DELETE:\n        this.onClickDeleteLine(line);\n        break;\n      case CONTEXTMENU.COPY:\n        this.onClickCopyLine(line);\n        break;\n      case CONTEXTMENU.PASTE:\n        this.onClickPasteLine(line);\n        break;\n      case CONTEXTMENU.ADD:\n        this.onClickAddLine(line);\n        break;\n      case CONTEXTMENU.ENABLE:\n        this.onClickEnableLine(line);\n        break;\n      case CONTEXTMENU.DISABLE:\n        this.onClickDisableLine(line);\n        break;\n      case CONTEXTMENU.COMMENT:\n        this.onClickAddComment(line);\n        break;\n      case CONTEXTMENU.DELETECOMMENT:\n        this.onClickDeleteComment(line);\n        break;\n      default:\n        break;\n    }\n    this.setState({ contextMenuInfo: null });\n  };\n  onClickDeleteLine(line) {\n    if (line.isEmpty()) {\n      Sound.stopWithId(\"menu\");\n      Sound.playWithId(\"deleteLine\");\n      this.oobcContext.deleteLine(line);\n      this.setCurrentLine(null);\n      this.onUpdateContext();\n    } else {\n      const { formatWithId } = Localization;\n      Alert.confirm({\n        title: formatWithId(\"ID_OOBC_ALERT_DELETELINE_TITLE\"),\n        message: formatWithId(\"ID_OOBC_ALERT_DELETELINE_MESSAGE\"),\n        confirmButtonName: Localization.formatWithId(\"ID_OOBC_GENERAL_CLEAR\"),\n        confirmButtonAction: () => {\n          Sound.stopWithId(\"menu\");\n          Sound.playWithId(\"deleteLine\");\n          this.oobcContext.deleteLine(line);\n          this.setCurrentLine(null);\n          this.onUpdateContext();\n        },\n        cancelButtonName: Localization.formatWithId(\"ID_OOBC_GENERAL_CANCEL\")\n      });\n    }\n  }\n  onClickCopyLine(line) {\n    this.copiedLine = line;\n  }\n  onClickPasteLine(line) {\n    if (!this.copiedLine) return;\n    const clone = this.copiedLine.clone();\n    line.addAfter(clone);\n    this.onUpdateContext();\n    this.setCurrentLine(clone);\n  }\n  onClickAddLine(line) {\n    const newLine = line.addEmptyAfter();\n    this.onUpdateContext();\n    this.setCurrentLine(newLine);\n  }\n  onClickEnableLine(line) {\n    line.enable();\n    this.onUpdateContext();\n  }\n  onClickDisableLine(line) {\n    line.disable();\n    this.onUpdateContext();\n  }\n  onClickAddComment(line) {}\n  onClickDeleteComment(line) {}\n\n  getInstanceBlockElementAt(lineNum, blockNum) {\n    const instanceBlock = this.getInstanceBlockAt(lineNum, blockNum);\n    if (!instanceBlock) return;\n    const element = document.getElementById(\n      `oobceditor_block-${instanceBlock.id}`\n    );\n    return element;\n  }\n  getInstanceBlockAt(lineNum, blockNum) {\n    return this.oobcContext.getBlockAt(lineNum, blockNum);\n  }\n  clickInstanceBlockAt(lineNum, blockNum) {\n    const instanceBlock = this.getInstanceBlockAt(lineNum, blockNum);\n    if (!instanceBlock) return;\n    if (\n      this.state.currentBlock === instanceBlock &&\n      instanceBlock instanceof OOBC.Constant\n    ) {\n      this.onClickConstantBlockEdit(instanceBlock);\n    } else {\n      this.onClickInstanceBlock(instanceBlock);\n    }\n  }\n  getPrototypeBlockElementWithData(data) {\n    const prototypeBlock = this.getPrototypeBlockWithData(data);\n    if (!prototypeBlock) return;\n    const element = document.getElementById(\n      `oobceditor_block-${prototypeBlock.id}`\n    );\n    return element;\n  }\n  getPrototypeBlockWithData(data) {\n    const currentCategoryPrototypeBlocks = this.getCurrentCategoryPrototypeBlocks();\n    const prototypeBlockWithData = currentCategoryPrototypeBlocks.find(\n      prototypeBlock => prototypeBlock.data === data\n    );\n    return prototypeBlockWithData;\n  }\n  getCurrentCategoryPrototypeBlocks() {\n    const { selectorInfo } = this.state;\n    if (!selectorInfo) return [];\n    const { currentCategory, prototypeBlocksOf } = selectorInfo;\n    const prototypeBlocks = prototypeBlocksOf[currentCategory];\n    return prototypeBlocks;\n  }\n  clickPrototypeBlockWithData(data) {\n    const prototypeBlock = this.getPrototypeBlockWithData(data);\n    if (!prototypeBlock) return;\n    this.onClickPrototypeBlock(prototypeBlock);\n  }\n  getSelectorCategoryElementWithName(category) {\n    const element = document.getElementById(\n      `oobceditor_selector_category-${category}`\n    );\n    return element;\n  }\n  onClickSelectorCategoryWithName(category) {\n    this.onClickSelectorCategory(category);\n  }\n\n  setKeyListener() {\n    // window.addEventListener(\"keyup\", this.keyListener);\n  }\n  clearKeyListener() {\n    // window.removeEventListener(\"keyup\", this.keyListener);\n  }\n  keyListener = event => {\n    const { key } = event;\n    switch (key) {\n      case \"Backspace\":\n      case \"Delete\":\n        this.onDeleteKeyListener();\n        break;\n      case \"Enter\":\n        this.onEnterKeyListener();\n        break;\n      case \"Tab\":\n        this.onTabKeyListener();\n        break;\n      default:\n        break;\n    }\n  };\n  onDeleteKeyListener = () => {\n    const { currentLine } = this.state;\n    if (currentLine) {\n      this.onClickDeleteLine(currentLine);\n    }\n  };\n  onEnterKeyListener = () => {\n    const { currentLine } = this.state;\n    if (currentLine) {\n      this.onClickAddLine(currentLine);\n    }\n  };\n  onTabKeyListener = () => {\n    const { currentLine } = this.state;\n    if (currentLine) {\n      this.openLineContextMenu(currentLine);\n    }\n  };\n\n  loadZoomLevel() {\n    let zoomLevel = this.getZoomLevelFromLocal();\n    this.setState({ zoomLevel });\n    this.maxZoomLevel = 4;\n    this.minZoomLevel = 0;\n  }\n  updateZoomLevelToLocal() {\n    const { zoomLevel } = this.state;\n    localStorage.setItem(\"oobcEditorZoomLevel\", zoomLevel);\n  }\n  getZoomLevelFromLocal() {\n    const defaultZoomLevel = 3;\n    const zoomLevel = parseInt(localStorage.getItem(\"oobcEditorZoomLevel\"));\n    if (isNaN(zoomLevel)) {\n      return defaultZoomLevel;\n    } else {\n      return zoomLevel;\n    }\n  }\n  onClickZoomIn = () => {\n    this.zoomInIfPossible();\n  };\n  zoomInIfPossible() {\n    const zoomLevel = this.state.zoomLevel + 1;\n    if (zoomLevel <= this.maxZoomLevel) {\n      this.setState({ zoomLevel }, () => {\n        this.updateZoomLevelToLocal();\n      });\n    }\n  }\n  onClickZoomOut = () => {\n    this.zoomOutIfPossible();\n  };\n  zoomOutIfPossible() {\n    const zoomLevel = this.state.zoomLevel - 1;\n    if (zoomLevel >= this.minZoomLevel) {\n      this.setState({ zoomLevel }, () => {\n        this.updateZoomLevelToLocal();\n      });\n    }\n  }\n\n  render() {\n    const {\n      lines,\n      currentLine,\n      currentBlock,\n      constantBlockToEdit,\n      selectorInfo,\n      contextMenuInfo,\n      zoomLevel\n    } = this.state;\n    const isMinZoom = this.minZoomLevel === zoomLevel;\n    const isMaxZoom = this.maxZoomLevel === zoomLevel;\n\n    return (\n      <View\n        context={this.oobcContext}\n        lines={lines}\n        currentLine={currentLine}\n        currentBlock={currentBlock}\n        constantBlockToEdit={constantBlockToEdit}\n        selectorMode={this.props.selectorMode}\n        selectorInfo={selectorInfo}\n        contextMenuInfo={contextMenuInfo}\n        zoomLevel={zoomLevel}\n        isMinZoom={isMinZoom}\n        isMaxZoom={isMaxZoom}\n        onScrollContext={this.onScrollContext}\n        onClickContext={this.onClickContext}\n        onClickLine={this.onClickLine}\n        onLineContextMenu={this.onLineContextMenu}\n        onClickLineContextMenu={this.onClickLineContextMenu}\n        onClickFoldLine={this.onClickFoldLine}\n        onTouchLineStart={this.onTouchLineStart}\n        onTouchLineMove={this.onTouchLineMove}\n        onTouchLineEnd={this.onTouchLineEnd}\n        onDragLine={this.onDragLine}\n        onDragLineOverEnd={this.onDragLineOverEnd}\n        onDragLineBegin={this.onDragLineBegin}\n        onDragLineEnd={this.onDragLineEnd}\n        onClickInstanceBlock={this.onClickInstanceBlock}\n        onClickPrototypeBlock={this.onClickPrototypeBlock}\n        onClickAddGlobalVar={this.onClickAddGlobalVar}\n        onClickConstantBlockEdit={this.onClickConstantBlockEdit}\n        onClickConstantEditorOverlay={this.onClickConstantEditorOverlay}\n        onClickConstantEditorConfirm={this.onClickConstantEditorConfirm}\n        onClickConstantEditorCancel={this.onClickConstantEditorCancel}\n        onChangeContantEditorData={this.onChangeContantEditorData}\n        onClickSelectorCategory={this.onClickSelectorCategory}\n        onClickSelectorClose={this.onClickSelectorClose}\n        onClickZoomIn={this.onClickZoomIn}\n        onClickZoomOut={this.onClickZoomOut}\n      />\n    );\n  }\n}\n\nexport default OOBCEditor;\n"]},"metadata":{},"sourceType":"module"}