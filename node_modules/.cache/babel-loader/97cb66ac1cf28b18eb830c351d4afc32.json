{"ast":null,"code":"import _regeneratorRuntime from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _slicedToArray from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";\nvar _jsxFileName = \"/Users/jimmy/Documents/Wizschool/wizlab_web2/src/Page/Python/Components/CodeEditor/index.js\";\nimport React, { useState, useEffect } from \"react\";\nimport { injectIntl, FormattedMessage } from \"react-intl\";\nimport \"./index.scss\";\nimport \"codemirror/lib/codemirror.css\";\nimport \"codemirror/mode/python/python\";\nimport \"codemirror/theme/monokai.css\";\nimport \"codemirror/addon/hint/show-hint\";\nimport zoomInIcon from \"../../../../Image/newPython/zoom-in.svg\";\nimport zoomOutIcon from \"../../../../Image/newPython/zoom-out.svg\";\nimport playIcon from \"../../../../Image/newPython/ic-play@2x.png\";\nimport resetIcon from \"../../../../Image/newPython/ic-reset@2x.png\";\nimport submitIcon from \"../../../../Image/newPython/ic-submit@2x.png\";\nimport PopUp, { showPopUp } from \"../../../../Common/Component/PopUp\";\nimport { playButtonEffect } from \"../../Util/PlaySound\";\nvar ace = window.ace;\nvar aceEditor = undefined;\n\nvar CodeEditor = function CodeEditor(props) {\n  var isCodeEditorOpen = props.isCodeEditorOpen,\n      isExecWindowOpen = props.isExecWindowOpen,\n      handleExecWindow = props.handleExecWindow,\n      contentBoxWidth = props.contentBoxWidth,\n      contentBoxHeight = props.contentBoxHeight,\n      checkAnswer = props.checkAnswer,\n      templateCode = props.templateCode,\n      sampleData = props.sampleData,\n      isShowAnswerCode = props.isShowAnswerCode,\n      conditionCheck = props.conditionCheck,\n      setConditionCheck = props.setConditionCheck,\n      isShowClear = props.isShowClear; // const [code, setCode] = useState(templateCode);\n\n  var _useState = useState(\"...\"),\n      _useState2 = _slicedToArray(_useState, 2),\n      codeResult = _useState2[0],\n      setCodeResult = _useState2[1];\n\n  useEffect(function () {\n    setAce();\n    window.addEventListener(\"resize\", setAceCodeResize);\n    return function () {\n      window.removeEventListener(\"resize\", setAceCodeResize);\n    };\n  }, []);\n  useEffect(function () {\n    setAceCode();\n  }, [templateCode]);\n  useEffect(function () {\n    if (isShowClear) {\n      setCodeResult(\"...\");\n      handleExecWindow(false);\n    }\n  }, [isShowClear]);\n  useEffect(function () {\n    setAceCodeResize();\n  }, [isExecWindowOpen, isCodeEditorOpen]);\n\n  var setAce = function setAce() {\n    aceEditor = ace.edit(\"codeEditor\");\n    aceEditor.session.setMode(\"ace/mode/python\");\n    aceEditor.setTheme(\"ace/theme/wizschool-python\");\n    aceEditor.setOption(\"highlightActiveLine\", true);\n    aceEditor.setOption(\"highlightSelectedWord\", true);\n    aceEditor.setOption(\"showPrintMargin\", false);\n    aceEditor.getSession().setUseWrapMode(false);\n    aceEditor.on(\"click\", handleOnClick);\n    aceEditor.container.style.lineHeight = 2;\n    aceEditor.container.style.fontSize = \"14px\";\n  };\n\n  var setAceCodeResize = function setAceCodeResize() {\n    aceEditor.resize();\n  };\n\n  var setAceCode = function setAceCode() {\n    aceEditor.setValue(\"\", 0);\n\n    if (sampleData !== \"\") {\n      aceEditor.setValue(sampleData + \"\\n\", 1); // sample Data 먼저 setting\n\n      aceEditor.execCommand(\"foldall\"); // sample data가 fold(collapse) 할수 있다면 모두 접어두기\n    }\n\n    aceEditor.session.insert({\n      // sample data 뒤에 템플릿 코드 입력하기\n      row: aceEditor.session.getLength(),\n      column: 0\n    }, templateCode);\n  };\n\n  var handleOnClick = function handleOnClick(e) {\n    //ace에서 클릭 위치 가져오기\n    var pos = e.getDocumentPosition();\n    var line = e.editor.session.getLine(pos.row); //클릭한 라인에서 btn정규표현식(들) 가져오기\n\n    var btnRegex = /@![1-2](.*?)[1-2]!@/gim;\n    var btnMatches = [];\n    var btnMatch;\n\n    while (btnMatch = btnRegex.exec(line)) {\n      btnMatches.push(btnMatch);\n    }\n\n    for (var i = 0; i < btnMatches.length; i++) {\n      var _btnMatch = btnMatches[i];\n      var startRow = pos.row;\n      var startColumn = _btnMatch.index;\n      var endRow = pos.row;\n      var endColumn = startColumn + _btnMatch[0].length; //btn정규표현식의 범위내에 커서가 위치한다면, 코드 삭제 및 커서 이동\n\n      if (pos.column >= startColumn && pos.column <= endColumn) {\n        var range = new ace.Range(startRow, startColumn, endRow, endColumn);\n        e.editor.session.doc.remove(range);\n        e.editor.moveCursorToPosition({\n          row: startRow,\n          column: startColumn\n        });\n        break;\n      }\n    }\n  }; // font size zooin or zoomout\n\n\n  var changeFontSize = function changeFontSize(type) {\n    if (type === \"plus\") {\n      var zoomInsize = aceEditor.getFontSize() + 2;\n\n      if (zoomInsize > 50) {\n        return;\n      }\n\n      aceEditor.setFontSize(zoomInsize);\n    } else if (type === \"minus\") {\n      var MIN_SIZE = 8;\n      var zoomOutsize = aceEditor.getFontSize() - 2;\n\n      if (zoomOutsize < MIN_SIZE) {\n        return;\n      }\n\n      aceEditor.setFontSize(zoomOutsize);\n    }\n  }; // run code\n\n\n  var onClickExecBtn = /*#__PURE__*/function () {\n    var _ref = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee() {\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              window.languagePluginLoader.then(function () {\n                window.pyodide.loadPackage([]).then(function () {\n                  try {\n                    var _code = \"\\nimport json\\nfrom io import StringIO\\nimport sys\\nimport re\\n\\ndef wizschool_runserver():\\n    old_stdout = sys.stdout\\n    sys.stdout = mystdout = StringIO()\\n    \\n    exec(\\\"\".concat(aceEditor.getValue().replaceAll('\\r', '\\\\r').replaceAll('\\n', '\\\\n').replace(/\"/g, \"\\\\\\\"\"), \"\\\")\\n    sys.stdout = old_stdout\\n\\n    return mystdout.getvalue()\\n\\nwizschool_runserver()\\n        \");\n\n                    var output = window.pyodide.runPython(_code);\n                    setCodeResult(output);\n                    handleExecWindow(true);\n                  } catch (error) {\n                    setCodeResult(error.message);\n                    handleExecWindow(true);\n                  }\n                });\n              }); // TODO: 실행결과가 맞고, 실행결과가 이미지로 나오는 경우라면 아래 팝업 띄우기\n              // showPopUp(<PopUp.PythonExecResult />, {\n              //   defaultPadding: false,\n              //   pythonPopup: true,\n              //   dismissButton: false\n              // });\n\n            case 1:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee);\n    }));\n\n    return function onClickExecBtn() {\n      return _ref.apply(this, arguments);\n    };\n  }();\n\n  var onClickSubmitBtn = function onClickSubmitBtn() {\n    if (isShowAnswerCode) {\n      showPopUp(React.createElement(PopUp.PythonAlert, {\n        textMessage: props.intl.formatMessage({\n          id: \"ID_PYTHON_SUBMIT_MSG\"\n        }),\n        againAction: function againAction() {\n          checkAnswer(codeResult);\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 188\n        },\n        __self: this\n      }), {\n        defaultPadding: false,\n        pythonPopup: true,\n        dismissButton: false\n      }); // TODO: 실행한 결과값이 미션의 정답과 일치하는지 확인 후 outro 영상 보여주기\n    } else {\n      showPopUp(React.createElement(PopUp.PythonOneButtonAlert, {\n        textMessage: props.intl.formatMessage({\n          id: \"ID_PYTHON_SUBMIT_ERROR_MSG\"\n        }),\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 195\n        },\n        __self: this\n      }), {\n        defaultPadding: false,\n        pythonPopup: true\n      });\n    }\n  };\n\n  return React.createElement(\"div\", {\n    className: \"pythonCodeEditor \".concat(isCodeEditorOpen ? \"open\" : \"close\"),\n    style: {\n      width: \"calc(100vw - \".concat(contentBoxWidth, \"px - 1.5625vw - 0.78125vw)\"),\n      height: \"\".concat(contentBoxHeight, \"px\")\n    },\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 203\n    },\n    __self: this\n  }, React.createElement(\"div\", {\n    className: \"codeEditor\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 210\n    },\n    __self: this\n  }, React.createElement(\"div\", {\n    className: \"codeEditorBtnWrapper\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 211\n    },\n    __self: this\n  }, React.createElement(\"button\", {\n    className: conditionCheck === \"playBtn\" ? \"playBtnBlink\" : \"playBtn\",\n    onClick: function onClick() {\n      if (conditionCheck === \"playBtn\") setConditionCheck(\"\");\n      playButtonEffect();\n      onClickExecBtn();\n    },\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 212\n    },\n    __self: this\n  }, React.createElement(\"img\", {\n    src: playIcon,\n    alt: \"\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 219\n    },\n    __self: this\n  }), React.createElement(FormattedMessage, {\n    id: \"ID_PYTHON_PLAY_BUTTON\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 220\n    },\n    __self: this\n  })), React.createElement(\"button\", {\n    className: conditionCheck === \"submitBtn\" ? \"submitBtnBlink\" : \"submitBtn\",\n    onClick: function onClick() {\n      if (conditionCheck === \"submitBtn\") setConditionCheck(\"\");\n      playButtonEffect();\n      onClickSubmitBtn();\n    },\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 222\n    },\n    __self: this\n  }, React.createElement(\"img\", {\n    src: submitIcon,\n    alt: \"\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 229\n    },\n    __self: this\n  }), React.createElement(FormattedMessage, {\n    id: \"ID_PYTHON_SUBMIT_BUTTON\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 230\n    },\n    __self: this\n  })), React.createElement(\"button\", {\n    className: conditionCheck === \"resetBtn\" ? \"resetBtnBlink\" : \"resetBtn\",\n    onClick: function onClick() {\n      if (conditionCheck === \"resetBtn\") setConditionCheck(\"\");\n      playButtonEffect();\n      setAceCode();\n    },\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 232\n    },\n    __self: this\n  }, React.createElement(\"img\", {\n    src: resetIcon,\n    alt: \"\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 240\n    },\n    __self: this\n  }), React.createElement(FormattedMessage, {\n    id: \"ID_PYTHON_RESET_BUTTON\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 241\n    },\n    __self: this\n  }))), React.createElement(\"div\", {\n    className: \"codeTextArea\",\n    id: \"codeEditor\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 244\n    },\n    __self: this\n  }), React.createElement(\"div\", {\n    className: \"btnWrapper\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 245\n    },\n    __self: this\n  }, React.createElement(\"button\", {\n    className: \"zoomInBtn\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 246\n    },\n    __self: this\n  }, React.createElement(\"img\", {\n    src: zoomInIcon,\n    alt: \"\",\n    onClick: function onClick() {\n      changeFontSize(\"plus\");\n    },\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 247\n    },\n    __self: this\n  })), React.createElement(\"button\", {\n    className: \"zoomOutBtn\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 255\n    },\n    __self: this\n  }, React.createElement(\"img\", {\n    src: zoomOutIcon,\n    alt: \"\",\n    onClick: function onClick() {\n      changeFontSize(\"minus\");\n    },\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 256\n    },\n    __self: this\n  })))), React.createElement(\"div\", {\n    className: \"executionView\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 267\n    },\n    __self: this\n  }, React.createElement(\"div\", {\n    className: \"executionHeader\",\n    onClick: function onClick() {\n      return handleExecWindow();\n    },\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 268\n    },\n    __self: this\n  }, React.createElement(\"span\", {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 269\n    },\n    __self: this\n  }, React.createElement(FormattedMessage, {\n    id: \"ID_PYTHON_EXECUTION_TITLE\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 269\n    },\n    __self: this\n  })), React.createElement(\"span\", {\n    className: isExecWindowOpen ? \"execIconOn\" : \"execIconOff\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 270\n    },\n    __self: this\n  })), isExecWindowOpen && React.createElement(\"div\", {\n    className: \"executionBody\",\n    id: \"output\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 272\n    },\n    __self: this\n  }, React.createElement(\"pre\", {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 272\n    },\n    __self: this\n  }, codeResult))));\n};\n\nexport default injectIntl(CodeEditor);","map":{"version":3,"sources":["/Users/jimmy/Documents/Wizschool/wizlab_web2/src/Page/Python/Components/CodeEditor/index.js"],"names":["React","useState","useEffect","injectIntl","FormattedMessage","playIcon","resetIcon","submitIcon","PopUp","showPopUp","playButtonEffect","ace","window","aceEditor","undefined","CodeEditor","props","isCodeEditorOpen","isExecWindowOpen","handleExecWindow","contentBoxWidth","contentBoxHeight","checkAnswer","templateCode","sampleData","isShowAnswerCode","conditionCheck","setConditionCheck","isShowClear","codeResult","setCodeResult","setAce","addEventListener","setAceCodeResize","removeEventListener","setAceCode","edit","session","setMode","setTheme","setOption","getSession","setUseWrapMode","on","handleOnClick","container","style","lineHeight","fontSize","resize","setValue","execCommand","insert","row","getLength","column","e","pos","getDocumentPosition","line","editor","getLine","btnRegex","btnMatches","btnMatch","exec","push","i","length","startRow","startColumn","index","endRow","endColumn","range","Range","doc","remove","moveCursorToPosition","changeFontSize","type","zoomInsize","getFontSize","setFontSize","MIN_SIZE","zoomOutsize","onClickExecBtn","languagePluginLoader","then","pyodide","loadPackage","_code","getValue","replaceAll","replace","output","runPython","error","message","onClickSubmitBtn","intl","formatMessage","id","defaultPadding","pythonPopup","dismissButton","width","height","zoomInIcon","zoomOutIcon"],"mappings":"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","sourcesContent":["import React, { useState, useEffect } from \"react\";\nimport { injectIntl, FormattedMessage } from \"react-intl\";\nimport \"./index.scss\";\n\nimport \"codemirror/lib/codemirror.css\";\nimport \"codemirror/mode/python/python\";\nimport \"codemirror/theme/monokai.css\";\nimport \"codemirror/addon/hint/show-hint\";\n\nimport zoomInIcon from \"../../../../Image/newPython/zoom-in.svg\";\nimport zoomOutIcon from \"../../../../Image/newPython/zoom-out.svg\";\nimport playIcon from \"../../../../Image/newPython/ic-play@2x.png\";\nimport resetIcon from \"../../../../Image/newPython/ic-reset@2x.png\";\nimport submitIcon from \"../../../../Image/newPython/ic-submit@2x.png\";\nimport PopUp, { showPopUp } from \"../../../../Common/Component/PopUp\";\n\nimport { playButtonEffect } from \"../../Util/PlaySound\";\n\nlet ace = window.ace;\nlet aceEditor = undefined;\n\nconst CodeEditor = props => {\n  const {\n    isCodeEditorOpen,\n    isExecWindowOpen,\n    handleExecWindow,\n    contentBoxWidth,\n    contentBoxHeight,\n    checkAnswer,\n    templateCode,\n    sampleData,\n    isShowAnswerCode,\n    conditionCheck,\n    setConditionCheck,\n    isShowClear\n  } = props;\n\n  // const [code, setCode] = useState(templateCode);\n  const [codeResult, setCodeResult] = useState(\"...\");\n\n  useEffect(() => {\n    setAce();\n    window.addEventListener(\"resize\", setAceCodeResize);\n    return () => {\n      window.removeEventListener(\"resize\", setAceCodeResize);\n    }\n  }, []);\n  \n  useEffect(() => {\n    setAceCode()\n  }, [templateCode]);\n\n  useEffect(() => {\n    if(isShowClear) {\n      setCodeResult(\"...\");\n      handleExecWindow(false);\n    }\n  }, [isShowClear]);\n  \n  useEffect(() => {\n    setAceCodeResize();\n  }, [isExecWindowOpen, isCodeEditorOpen])\n\n  const setAce = () => {\n    aceEditor = ace.edit(\"codeEditor\");\n    aceEditor.session.setMode(`ace/mode/python`);\n    aceEditor.setTheme(\"ace/theme/wizschool-python\");\n    aceEditor.setOption(\"highlightActiveLine\", true);\n    aceEditor.setOption(\"highlightSelectedWord\", true);\n    aceEditor.setOption(\"showPrintMargin\", false);\n    aceEditor.getSession().setUseWrapMode(false);\n    aceEditor.on(\"click\", handleOnClick);\n    aceEditor.container.style.lineHeight = 2;\n    aceEditor.container.style.fontSize = \"14px\";\n  }\n  \n  const setAceCodeResize = () => {\n    aceEditor.resize();\n  }\n\n  const setAceCode = () => {\n    aceEditor.setValue(\"\",0);\n    \n    if(sampleData !== \"\") {\n      aceEditor.setValue(sampleData + \"\\n\" , 1); // sample Data 먼저 setting\n      aceEditor.execCommand(\"foldall\"); // sample data가 fold(collapse) 할수 있다면 모두 접어두기\n    }\n\n    aceEditor.session.insert({ // sample data 뒤에 템플릿 코드 입력하기\n        row: aceEditor.session.getLength(),\n        column: 0\n      }, templateCode)\n  }\n\n  const handleOnClick = e => {\n    //ace에서 클릭 위치 가져오기\n    const pos = e.getDocumentPosition();\n    const line = e.editor.session.getLine(pos.row);\n\n    //클릭한 라인에서 btn정규표현식(들) 가져오기\n    const btnRegex = /@![1-2](.*?)[1-2]!@/gim;\n    let btnMatches = [];\n    let btnMatch;\n    while ((btnMatch = btnRegex.exec(line))) {\n      btnMatches.push(btnMatch);\n    }\n\n    for(let i=0; i<btnMatches.length; i++) {\n      const btnMatch = btnMatches[i];\n      const startRow = pos.row;\n      const startColumn = btnMatch.index;\n      const endRow = pos.row;\n      const endColumn = startColumn + btnMatch[0].length;\n\n      //btn정규표현식의 범위내에 커서가 위치한다면, 코드 삭제 및 커서 이동\n      if(pos.column >= startColumn && pos.column <= endColumn) {\n        const range = new ace.Range(startRow, startColumn, endRow, endColumn);\n        e.editor.session.doc.remove(range);\n        e.editor.moveCursorToPosition({ row: startRow, column: startColumn });\n        break;\n      }\n    }\n  }\n\n  // font size zooin or zoomout\n  const changeFontSize = type => {\n    if(type === \"plus\") {\n      const zoomInsize = aceEditor.getFontSize() + 2;\n      if (zoomInsize > 50) {\n        return;\n      }\n      aceEditor.setFontSize(zoomInsize);\n    } else if(type === \"minus\"){\n      const MIN_SIZE = 8;\n      const zoomOutsize = aceEditor.getFontSize() - 2;\n      if (zoomOutsize < MIN_SIZE) {\n        return;\n      }\n      aceEditor.setFontSize(zoomOutsize);\n    }\n  };\n\n  // run code\n  const onClickExecBtn = async () => {\n    window.languagePluginLoader.then(() => {\n      window.pyodide.loadPackage([]).then(() => {\n\n        try {\n        const _code = `\nimport json\nfrom io import StringIO\nimport sys\nimport re\n\ndef wizschool_runserver():\n    old_stdout = sys.stdout\n    sys.stdout = mystdout = StringIO()\n    \n    exec(\"${aceEditor.getValue().replaceAll('\\r','\\\\r').replaceAll('\\n','\\\\n').replace(/\"/g, \"\\\\\\\"\")}\")\n    sys.stdout = old_stdout\n\n    return mystdout.getvalue()\n\nwizschool_runserver()\n        `\n\n          const output = window.pyodide.runPython(_code);\n          setCodeResult(output);\n          handleExecWindow(true);\n        } catch (error) {\n          setCodeResult(error.message)\n          handleExecWindow(true);  \n        }\n        \n      });\n    });\n\n    // TODO: 실행결과가 맞고, 실행결과가 이미지로 나오는 경우라면 아래 팝업 띄우기\n    // showPopUp(<PopUp.PythonExecResult />, {\n    //   defaultPadding: false,\n    //   pythonPopup: true,\n    //   dismissButton: false\n    // });\n  };\n\n  const onClickSubmitBtn = () => {\n    if(isShowAnswerCode) {\n      showPopUp(<PopUp.PythonAlert textMessage={props.intl.formatMessage({ id: \"ID_PYTHON_SUBMIT_MSG\" })} againAction={()=>{checkAnswer(codeResult)}}/>, {\n        defaultPadding: false,\n        pythonPopup: true,\n        dismissButton: false\n      });\n      // TODO: 실행한 결과값이 미션의 정답과 일치하는지 확인 후 outro 영상 보여주기\n    } else {\n      showPopUp(<PopUp.PythonOneButtonAlert textMessage={props.intl.formatMessage({ id: \"ID_PYTHON_SUBMIT_ERROR_MSG\" })}/>, {\n        defaultPadding: false,\n        pythonPopup: true\n      });\n    }\n  };\n\n  return (\n    <div\n      className={`pythonCodeEditor ${isCodeEditorOpen ? \"open\" : \"close\"}`}\n      style={{\n        width: `calc(100vw - ${contentBoxWidth}px - 1.5625vw - 0.78125vw)`,\n        height: `${contentBoxHeight}px`\n      }}\n    >\n      <div className=\"codeEditor\">\n        <div className=\"codeEditorBtnWrapper\">\n          <button \n            className={conditionCheck === \"playBtn\" ? \"playBtnBlink\" : \"playBtn\"} \n            onClick={()=>{\n              if(conditionCheck === \"playBtn\") setConditionCheck(\"\")\n              playButtonEffect(); \n              onClickExecBtn();\n            }}>\n            <img src={playIcon} alt=\"\" />\n            <FormattedMessage id=\"ID_PYTHON_PLAY_BUTTON\" />\n          </button>\n          <button \n            className={conditionCheck === \"submitBtn\" ? \"submitBtnBlink\" : \"submitBtn\"} \n            onClick={()=>{\n              if(conditionCheck === \"submitBtn\") setConditionCheck(\"\")\n              playButtonEffect(); \n              onClickSubmitBtn();\n            }}>\n            <img src={submitIcon} alt=\"\" />\n            <FormattedMessage id=\"ID_PYTHON_SUBMIT_BUTTON\" />\n          </button>\n          <button\n            className={conditionCheck === \"resetBtn\" ? \"resetBtnBlink\" : \"resetBtn\"}\n            onClick={() => {\n              if(conditionCheck === \"resetBtn\") setConditionCheck(\"\")\n              playButtonEffect();\n              setAceCode();\n            }}\n          >\n            <img src={resetIcon} alt=\"\" />\n            <FormattedMessage id=\"ID_PYTHON_RESET_BUTTON\" />\n          </button>\n        </div>\n        <div className=\"codeTextArea\" id=\"codeEditor\"></div>\n        <div className=\"btnWrapper\">\n          <button className=\"zoomInBtn\">\n            <img\n              src={zoomInIcon}\n              alt=\"\"\n              onClick={() => {\n                changeFontSize(\"plus\");\n              }}\n            />\n          </button>\n          <button className=\"zoomOutBtn\">\n            <img\n              src={zoomOutIcon}\n              alt=\"\"\n              onClick={() => {\n                changeFontSize(\"minus\");\n              }}\n            />\n          </button>\n        </div>\n      </div>\n\n      <div className=\"executionView\">\n        <div className=\"executionHeader\" onClick={() => handleExecWindow()}>\n          <span><FormattedMessage id=\"ID_PYTHON_EXECUTION_TITLE\" /></span>\n          <span className={isExecWindowOpen ? \"execIconOn\" : \"execIconOff\"} />\n        </div>\n        {isExecWindowOpen && <div className=\"executionBody\" id=\"output\"><pre>{codeResult}</pre></div>}\n      </div>\n    </div>\n  );\n};\n\nexport default injectIntl(CodeEditor);\n"]},"metadata":{},"sourceType":"module"}