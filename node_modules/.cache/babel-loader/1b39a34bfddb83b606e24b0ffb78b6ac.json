{"ast":null,"code":"import _regeneratorRuntime from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _objectSpread from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread\";\nimport _toConsumableArray from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";\nimport _classCallCheck from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";\nimport _possibleConstructorReturn from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";\nimport _inherits from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";\nvar _jsxFileName = \"/Users/jimmy/Documents/Wizschool/wizlab_web2/src/Page/OCP2/Components/OCPGameDetail/Container.js\";\nimport React, { Component } from \"react\";\nimport { connect } from \"react-redux\";\nimport { injectIntl } from \"react-intl\";\nimport View from \"./View\";\nimport * as action from \"../../../../Common/Store/Reducer/UserInfo\";\nimport moment from \"moment\";\nimport * as request from \"../../../../Common/Util/HTTPRequest\";\nimport PopUp, { showPopUp } from \"../../../../Common/Component/PopUp\";\nimport SignIn from \"../../../../Common/Component/SignIn\";\nimport SignUp from \"../../../../Common/Component/SignUp\";\nimport { resetOcpToken } from \"../../../../Common/Util/OcpToken\";\nimport OCPCertification from \"../../../../Common/Component/OCPCertification\";\nimport { detectIE } from \"../../../../Common/Util/detectBrowser\";\n\nvar Container =\n/*#__PURE__*/\nfunction (_Component) {\n  _inherits(Container, _Component);\n\n  function Container(props) {\n    var _this;\n\n    _classCallCheck(this, Container);\n\n    _this = _possibleConstructorReturn(this, _getPrototypeOf(Container).call(this, props));\n\n    _this.componentDidMount = function () {\n      _this.setResizeEventListener();\n    };\n\n    _this.setShowGameDetail = function (param) {\n      var then = param.then;\n      if (then && typeof then !== \"function\") return console.error(\"Unknown type of then in setShowGameDetail\");\n\n      _this.setState({\n        isShowGameDetail: _this.props.isShowGameDetail\n      }, function () {\n        if (_this.state.isShowGameDetail) {\n          _this.setState(_this.DEFAULT_STATE);\n\n          if (then) then();\n        } else {\n          window.removeEventListener(\"resize\", _this.onResizeForStages);\n        }\n      });\n    };\n\n    _this.setMission = function (param) {\n      var then = param.then;\n      if (then && typeof then !== \"function\") return console.error(\"Unknown type of then in setMission\");\n\n      _this.setState({\n        mission: _this.props.selectedMission\n      }, function () {\n        if (then) then();\n      });\n    };\n\n    _this.setResizeEventListener = function () {\n      window.addEventListener(\"resize\", _this.onResizeForStages);\n    };\n\n    _this.onResizeForStages = function () {\n      if (_this.state.stages.length === 0) return;\n\n      _this.state.stages.forEach(function (_, index) {\n        var element = document.getElementById(\"OCPGameDetail_st_iw-mobile-round-\".concat(index));\n        if (!element) return;\n        var innerWidth = window.innerWidth - 20 * 2;\n        var itemWidth = (innerWidth - 40 * 4) / 5;\n        element.style.width = \"\".concat(itemWidth, \"px\");\n        element.style.height = \"\".concat(itemWidth, \"px\");\n      });\n    };\n\n    _this.getStages = function () {\n      var mission = _this.state.mission;\n      if (!mission) return;\n\n      _this.setState({\n        stages: _toConsumableArray(Array(10).keys()).map(function (_, index) {\n          var stageInfo = require(\"../../../Builder/utils/ocp/\".concat(mission.grade, \"/stages/\").concat(index + 1)).data;\n\n          return {\n            title: stageInfo.title,\n            img: stageInfo.img,\n            level: index + 1\n          };\n        })\n      });\n    };\n\n    _this.getComments = function () {\n      var offset = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 0;\n      var mission = _this.state.mission;\n      if (!mission.gameType || !mission.grade) return console.warn(\"not intended data in OCPGameDetail\");\n      var param = {\n        grade: mission.grade,\n        type: mission.gameType,\n        offset: offset * 10\n      };\n      request.getOCPComments(param).then(function (res) {\n        return res.json();\n      }).then(function (json) {\n        if (json.success) {\n          _this.setState({\n            comments: offset === 0 ? json.comments.filter(function (cm) {\n              return !cm.isDeleted;\n            }).map(function (cm) {\n              return _objectSpread({}, cm, {\n                interval: _this.manipulateCmTime(cm.createdAt)\n              });\n            }) : [].concat(_toConsumableArray(_this.state.comments), _toConsumableArray(json.comments.filter(function (cm) {\n              return !cm.isDeleted;\n            }).map(function (cm) {\n              return _objectSpread({}, cm, {\n                interval: _this.manipulateCmTime(cm.createdAt)\n              });\n            })))\n          });\n        } else {\n          if (json.msg) console.error(json.msg);\n        }\n      }).catch(function (e) {\n        console.error(e);\n      });\n    };\n\n    _this.getCount = function () {\n      var mission = _this.state.mission;\n      if (!mission.gameType || !mission.grade) return console.warn(\"not intended data in OCPGameDetail\");\n      var param = {\n        grade: mission.grade,\n        type: mission.gameType\n      };\n      request.getOCPCount(param).then(function (res) {\n        return res.json();\n      }).then(function (json) {\n        if (json.success) {\n          _this.setState({\n            commentCount: json.count.commentCount\n          });\n        } else {\n          if (json.msg) console.error(json.msg);\n        }\n      }).catch(function (e) {\n        console.error(e);\n      });\n    };\n\n    _this.addComment = function () {\n      var userinfo = _this.props.userinfo;\n      var _this$state = _this.state,\n          commentText = _this$state.commentText,\n          mission = _this$state.mission;\n      var param = {\n        email: userinfo.email,\n        commentText: commentText,\n        grade: mission.grade,\n        type: mission.gameType\n      };\n      request.addOCPComment(param).then(function (res) {\n        return res.json();\n      }).then(function (json) {\n        if (json.success) {\n          _this.setState({\n            comments: [_objectSpread({}, json.newComment, {\n              user: userinfo\n            })].concat(_toConsumableArray(_this.state.comments)),\n            commentText: \"\",\n            commentCount: _this.state.commentCount + 1\n          });\n        } else {\n          _this.handleAddCommentError(json.errorType);\n        }\n      }).catch(function (e) {\n        _this.handleAddCommentError(\"RequestError\", e);\n      });\n    };\n\n    _this.deleteComment = function (comment) {\n      var comments = _this.state.comments;\n      request.deleteOCPComment({\n        id: comment.id\n      }).then(function (res) {\n        return res.json();\n      }).then(function (json) {\n        if (json.success) {\n          _this.setState({\n            comments: _toConsumableArray(comments).filter(function (cm) {\n              return cm.id !== comment.id;\n            }),\n            commentCount: _this.state.commentCount - 1\n          });\n        }\n      });\n    };\n\n    _this.updateOCPUserPrint = function () {\n      var mission = _this.state.mission;\n\n      var guestInfo = _this.getGuestInfo();\n\n      if (!guestInfo) return;\n      request.updateMyOcpPrint2(_this.props.userinfo.email ? {\n        email: _this.props.userinfo.email,\n        grade: mission.grade,\n        type: mission.gameType\n      } : {\n        guestId: guestInfo.id,\n        grade: mission.grade,\n        type: mission.gameType\n      });\n    };\n\n    _this.addReport = function (commentId, reason) {\n      var userinfo = _this.props.userinfo;\n      if (!commentId || !userinfo.email) return;\n      var param = {\n        email: userinfo.email,\n        commentId: commentId,\n        reason: reason\n      };\n      request.addOCPReport(param).then(function (res) {\n        return res.json();\n      }).then(function (json) {\n        if (!json.success && json.errorType) _this.showErrorPopup(json.errorType);\n      }).catch(function (e) {\n        return console.error(e);\n      });\n    };\n\n    _this.onClickStage = function (stageLevel) {\n      if (!_this.checkIsValidOpenBuilder()) {\n        return;\n      }\n\n      var mission = _this.state.mission;\n\n      if (stageLevel === 1 || stageLevel <= mission.level + 1) {\n        _this.showBuilder(stageLevel);\n      } else {\n        showPopUp(React.createElement(PopUp.OneButton, {\n          title: _this.props.intl.formatMessage({\n            id: \"ID_LEARN_POPUP_STEP_CHECK_TITLE\"\n          }),\n          buttonName: _this.props.intl.formatMessage({\n            id: \"ID_LEARN_POPUP_STEP_CHECK_TITLE_BUTTON\"\n          }),\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 315\n          },\n          __self: this\n        }), {\n          darkmode: true,\n          mobileFullscreen: true\n        });\n      }\n    };\n\n    _this.onClickStartStage = function () {\n      var mission = _this.state.mission;\n      if (!_this.checkIsValidOpenBuilder()) return;\n\n      if (mission.level === 10) {\n        _this.showErrorPopup(\"allClear\");\n\n        return;\n      }\n\n      var stageLevel = 1;\n      if (mission.level && mission.level !== 0) stageLevel = mission.level + 1;\n\n      _this.showBuilder(stageLevel);\n    };\n\n    _this.onClickEventLink = function () {\n      window.open(\"/event/codingparty/review\");\n    };\n\n    _this.handleCommentChange = function (e) {\n      var value = e.target.value;\n\n      _this.setState({\n        commentText: value\n      });\n    };\n\n    _this.onClickCommentTextArea = function () {\n      _this.alertCommentEventEnded();\n    };\n\n    _this.onClickComment = function () {\n      _this.alertCommentEventEnded(); // if (!this.props.userinfo.email) {\n      //   this.showLoginPopup();\n      //   return;\n      // }\n      // if (!this.checkCommentValidation()) return;\n      // const { mission } = this.state;\n      // if (mission.level !== 10) {\n      //   this.showErrorPopup(\"notAllClear\");\n      //   return;\n      // }\n      // // add comment\n      // this.addComment();\n\n    };\n\n    _this.onClickReport = function (comment) {\n      showPopUp(React.createElement(PopUp.OneInput, {\n        title: \"\\uC2E0\\uACE0\\uC0AC\\uC720\\uB97C \\uC785\\uB825\\uD574\\uC8FC\\uC138\\uC694\",\n        buttonName: \"\\uD655\\uC778\",\n        inputLimit: 100,\n        buttonAction: function buttonAction(reason) {\n          _this.addReport(comment.id, reason);\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 383\n        },\n        __self: this\n      }), {\n        dismissOverlay: true,\n        darkmode: true,\n        mobileFullscreen: true\n      });\n    };\n\n    _this.onClickDelete = function (comment) {\n      showPopUp(React.createElement(PopUp.TwoButton, {\n        title: \"\\uC815\\uB9D0 \\uC0AD\\uC81C\\uD558\\uC2DC\\uACA0\\uC2B5\\uB2C8\\uAE4C?\",\n        cancelButtonName: \"\\uC544\\uB2C8\\uC624\",\n        confirmButtonName: \"\\uB124\",\n        confirmAction: function confirmAction() {\n          return _this.deleteComment(comment);\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 397\n        },\n        __self: this\n      }), {\n        dismissOverlay: true,\n        mobileFullscreen: true,\n        darkmode: true\n      });\n    };\n\n    _this.onClickCertification = function (isActiveDownload) {\n      _this.alertCertificationEnd(); // if (!this.state.mission) return;\n      // if (!isActiveDownload) {\n      //   this.showErrorPopup(\"certification\");\n      //   return;\n      // }\n      // showPopUp(\n      //   <PopUp.TwoButton\n      //     title=\"인증서를 출력하시겠습니까?\"\n      //     subtitle=\"나중에도 출력가능합니다.\"\n      //     cancelButtonName=\"아니오\"\n      //     confirmButtonName=\"네\"\n      //     confirmAction={() => this.handleCertification()}\n      //   />,\n      //   { dismissOverlay: true, darkmode: true }\n      // );\n\n    };\n\n    _this.alertCertificationEnd = function () {\n      showPopUp(React.createElement(PopUp.OneButton, {\n        title: \"\\uC778\\uC99D\\uC11C \\uBC1C\\uAE09 \\uAE30\\uAC04\\uC774 \\uC544\\uB2D9\\uB2C8\\uB2E4.\",\n        buttonName: \"\\uD655\\uC778\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 429\n        },\n        __self: this\n      }), {\n        darkmode: true\n      });\n    };\n\n    _this.onClickReset = function () {\n      showPopUp(React.createElement(PopUp.TwoButton, {\n        title: \"초기화를 정말 진행하시겠습니까?\",\n        subtitle: \"모든 게임 데이터가 초기화 됩니다\",\n        confirmButtonName: \"확인\",\n        cancelButtonName: \"취소\",\n        confirmAction: function confirmAction() {\n          resetOcpToken();\n          window.location.reload();\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 439\n        },\n        __self: this\n      }), {\n        mobileFullscreen: true,\n        darkmode: true\n      });\n    };\n\n    _this.onClickMore = function () {\n      _this.setState({\n        moreNum: _this.state.moreNum + 1\n      }, function () {\n        _this.getComments(_this.state.moreNum);\n      });\n    };\n\n    _this.onClickSignIn = function () {\n      showPopUp(React.createElement(SignIn, {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 468\n        },\n        __self: this\n      }), {\n        mobileFullscreen: true,\n        darkmode: true\n      });\n    };\n\n    _this.onClickFullScreen = function () {\n      _this.toggleIsShowFullScreenState();\n    };\n\n    _this.toggleIsShowFullScreenState = function () {\n      _this.setState({\n        isShowFullScreen: _this.state.isShowFullScreen ? false : true\n      });\n    };\n\n    _this.showBuilder = function (level) {\n      var mission = _this.state.mission;\n      var url = mission.gameType === \"block\" ? \"/ocp2/block/\".concat(mission.grade, \"/\").concat(level) : \"/ocp2/js/\".concat(mission.gameType, \"/\").concat(mission.grade, \"/\").concat(level);\n      var builder = window.open(url, \"_blank\");\n      builder.focus();\n    };\n\n    _this.checkIsValidOpenBuilder = function () {\n      if (!_this.checkIsMobileAndTableBrowerAndWarn()) return false;\n      if (!_this.checkIsChromeAndShowWarn()) return false;\n      return true;\n    };\n\n    _this.checkIsMobileAndTableBrowerAndWarn = function () {\n      if (_this.isMobileAndTableBrowser()) {\n        _this.showErrorPopup(\"mobileBuilder\");\n\n        return false;\n      }\n\n      return true;\n    };\n\n    _this.checkIsChromeAndShowWarn = function () {\n      if (_this.isIE()) {\n        showPopUp(React.createElement(PopUp.TwoButton, {\n          title: \"\\uC774\\uC6A9\\uC548\\uB0B4\",\n          subtitle: \"\\uBCF8 \\uD398\\uC774\\uC9C0\\uB294 \\uD06C\\uB86C\\uC5D0\\uC11C\\uB9CC \\uC815\\uC0C1 \\uB3D9\\uC791\\uD569\\uB2C8\\uB2E4\",\n          confirmButtonName: \"\\uD06C\\uB86C \\uC124\\uCE58\\uD558\\uAE30\",\n          cancelButtonName: \"\\uCDE8\\uC18C\",\n          confirmAction: function confirmAction() {\n            window.open(\"https://www.google.com/intl/ko/chrome/\", \"_blank\");\n          },\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 513\n          },\n          __self: this\n        }), {\n          darkmode: true,\n          mobileFullscreen: true\n        });\n        return false;\n      }\n\n      return true;\n    };\n\n    _this.isMobileAndTableBrowser = function () {\n      var check = false;\n\n      (function (a) {\n        if (/(android|bb\\d+|meego).+mobile|avantgo|bada\\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(a) || // eslint-disable-next-line no-useless-escape\n        /1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\\-(n|u)|c55\\/|capi|ccwa|cdm\\-|cell|chtm|cldc|cmd\\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\\-s|devi|dica|dmob|do(c|p)o|ds(12|\\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\\-|_)|g1 u|g560|gene|gf\\-5|g\\-mo|go(\\.w|od)|gr(ad|un)|haie|hcit|hd\\-(m|p|t)|hei\\-|hi(pt|ta)|hp( i|ip)|hs\\-c|ht(c(\\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\\-(20|go|ma)|i230|iac( |\\-|\\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\\/)|klon|kpt |kwc\\-|kyo(c|k)|le(no|xi)|lg( g|\\/(k|l|u)|50|54|\\-[a-w])|libw|lynx|m1\\-w|m3ga|m50\\/|ma(te|ui|xo)|mc(01|21|ca)|m\\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\\-2|po(ck|rt|se)|prox|psio|pt\\-g|qa\\-a|qc(07|12|21|32|60|\\-[2-7]|i\\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\\-|oo|p\\-)|sdk\\/|se(c(\\-|0|1)|47|mc|nd|ri)|sgh\\-|shar|sie(\\-|m)|sk\\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\\-|v\\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\\-|tdg\\-|tel(i|m)|tim\\-|t\\-mo|to(pl|sh)|ts(70|m\\-|m3|m5)|tx\\-9|up(\\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\\-|your|zeto|zte\\-/i.test(a.substr(0, 4))) check = true;\n      })(navigator.userAgent || navigator.vendor || window.opera);\n\n      return check;\n    };\n\n    _this.isIE = function () {\n      return detectIE();\n    };\n\n    _this.checkCommentValidation = function () {\n      var commentText = _this.state.commentText;\n\n      if (commentText === undefined || commentText === \"\") {\n        // validation check\n        _this.setState({\n          isCommentValid: false\n        }, function () {\n          if (_this.commentValidationTimer) clearTimeout(_this.commentValidationTimer);\n          _this.commentValidationTimer = setTimeout(function () {\n            _this.setState({\n              isCommentValid: true\n            });\n          }, 2000);\n        });\n\n        return false;\n      }\n\n      return true;\n    };\n\n    _this.getGuestInfo = function () {\n      return localStorage.getItem(\"ocpId\") && JSON.parse(localStorage.getItem(\"ocpId\"));\n    };\n\n    _this.showErrorPopup = function (type) {\n      var message;\n\n      switch (type) {\n        case \"certification\":\n          message = \"모든 단계를 클리어한 후 인증서를 출력할 수 있습니다\";\n          break;\n\n        case \"mobileBuilder\":\n          message = \"PC에서 다시 시도해 주세요\";\n          break;\n\n        case \"notAllClear\":\n          message = \"모든 단계를 클리어한 후 시도해 주세요\";\n          break;\n\n        case \"reportAlready\":\n          message = \"이미 신고한 유저입니다\";\n          break;\n\n        case \"Spam\":\n          // 욕설\n          message = \"욕설 및 비속어를 포함할 수 없습니다\";\n          break;\n\n        case \"allClear\":\n          message = \"모든 단계를 클리어했습니다\";\n          break;\n\n        default:\n          break;\n      }\n\n      if (!message) return;\n      showPopUp(React.createElement(PopUp.OneButton, {\n        title: message,\n        buttonName: \"확인\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 611\n        },\n        __self: this\n      }), {\n        darkmode: true,\n        mobileFullscreen: true\n      });\n    };\n\n    _this.manipulateCmTime = function (dateFormat) {\n      var cmMoment = moment(dateFormat);\n      var duration = moment.duration(moment().diff(cmMoment));\n      var resultTimeFormat;\n\n      if (duration.days() < 1) {\n        // 하루 이내\n        if (duration.hours() < 1) {\n          // 분으로 계산\n          resultTimeFormat = \"\".concat(duration.minutes() === 0 ? \"1\" : duration.minutes(), \"\\uBD84 \\uC804\");\n        } else {\n          // 시간으로 계산\n          resultTimeFormat = \"\".concat(duration.hours(), \"\\uC2DC\\uAC04 \\uC804\");\n        }\n      } else {\n        // 하루 이상 지난\n        resultTimeFormat = \"\".concat(duration.days(), \"\\uC77C \\uC804\");\n      }\n\n      return resultTimeFormat;\n    };\n\n    _this.showLoginPopup = function () {\n      showPopUp(React.createElement(PopUp.TwoButton, {\n        title: \"로그인 후 이용해주세요\",\n        confirmButtonNameId: \"ID_SIGNUP\",\n        cancelButtonNameId: \"ID_SIGNIN\",\n        cancelAction: function cancelAction() {\n          showPopUp(React.createElement(SignIn, {\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 646\n            },\n            __self: this\n          }), {\n            mobileFullscreen: true,\n            darkmode: true\n          });\n        },\n        confirmAction: function confirmAction() {\n          showPopUp(React.createElement(SignUp, {\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 652\n            },\n            __self: this\n          }), {\n            mobileFullscreen: true,\n            darkmode: true\n          });\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 641\n        },\n        __self: this\n      }), {\n        mobileFullscreen: true,\n        darkmode: true\n      });\n    };\n\n    _this.handleAddCommentError = function (errorType, e) {\n      var message;\n\n      switch (errorType) {\n        case \"InvalidUser\":\n          message = \"부적절한 유저입니다\";\n          break;\n\n        case \"ExistComment\":\n          message = \"이미 작성한 댓글이 있습니다.\";\n          break;\n\n        case \"Spam\":\n          // 욕설\n          message = \"욕설 및 비속어를 포함할 수 없습니다\";\n          break;\n\n        case \"CantCreated\":\n          message = \"알 수 없는 이유로 작성할 수 없습니다\";\n          break;\n\n        case \"RequestError\":\n          message = \"네트워크 상태를 확인한 후 다시 시도해주세요\";\n          console.error(e);\n          break;\n\n        default:\n          break;\n      }\n\n      if (message) {\n        showPopUp(React.createElement(PopUp.OneButton, {\n          title: message,\n          buttonName: \"확인\",\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 690\n          },\n          __self: this\n        }), {\n          darkmode: true,\n          mobileFullscreen: true\n        });\n      }\n    };\n\n    _this.handleCertification =\n    /*#__PURE__*/\n    _asyncToGenerator(\n    /*#__PURE__*/\n    _regeneratorRuntime.mark(function _callee() {\n      var guestInfo, name, organization, res, guest;\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              guestInfo = _this.getGuestInfo();\n\n              if (!_this.props.userinfo.email) {\n                _context.next = 5;\n                break;\n              }\n\n              if (_this.props.userinfo.organization) {\n                name = _this.props.userinfo.name;\n                organization = _this.props.userinfo.organization;\n              } else {\n                showPopUp(React.createElement(PopUp.OneInput, {\n                  title: \"\\uD559\\uAD50\\uB97C \\uC785\\uB825\\uD574\\uC8FC\\uC138\\uC694\",\n                  buttonName: \"\\uD655\\uC778\",\n                  inputLimit: 10,\n                  buttonAction: function buttonAction(org) {\n                    _this.showCertification(_this.props.userinfo.name, org);\n\n                    _this.updateOCPUser(org);\n                  },\n                  __source: {\n                    fileName: _jsxFileName,\n                    lineNumber: 706\n                  },\n                  __self: this\n                }), {\n                  dismissOverlay: true,\n                  darkmode: true\n                });\n              }\n\n              _context.next = 13;\n              break;\n\n            case 5:\n              if (!guestInfo) {\n                _context.next = 13;\n                break;\n              }\n\n              _context.next = 8;\n              return request.getOcpUser2({\n                guestId: guestInfo.id\n              });\n\n            case 8:\n              res = _context.sent;\n              _context.next = 11;\n              return res.json();\n\n            case 11:\n              guest = _context.sent;\n\n              if (!guest.name || !guest.organization) {\n                showPopUp(React.createElement(PopUp.TwoInput, {\n                  title: \"\\uD559\\uAD50\\uB97C \\uC785\\uB825\\uD574\\uC8FC\\uC138\\uC694\",\n                  buttonName: \"\\uD655\\uC778\",\n                  inputTitle1: \"\\uC774\\uB984\",\n                  inputTitle2: \"\\uD559\\uAD50\",\n                  inputLimit1: 8,\n                  inputLimit2: 10,\n                  buttonAction: function buttonAction(org, name) {\n                    _this.showCertification(name, org);\n\n                    _this.updateOCPUser(org, name);\n                  },\n                  __source: {\n                    fileName: _jsxFileName,\n                    lineNumber: 726\n                  },\n                  __self: this\n                }), {\n                  dismissOverlay: true,\n                  darkmode: true\n                });\n              } else {\n                _this.showCertification(guest.name, guest.organization);\n\n                _this.updateOCPUser(guest.organization, guest.name);\n              }\n\n            case 13:\n              if (name && organization) {\n                _this.showCertification(name.substring(0, 8), organization.substring(0, 10));\n              }\n\n            case 14:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee, this);\n    }));\n\n    _this.updateOCPUser = function (org) {\n      var name = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : _this.props.userinfo.name;\n\n      var guestInfo = _this.getGuestInfo();\n\n      request.updateOcpUser2({\n        guestId: guestInfo ? guestInfo.id : null,\n        email: _this.props.userinfo.email,\n        name: name,\n        organization: org\n      }).then(function (res) {\n        return res.json();\n      }).then(function (json) {\n        if (json) _this.props.updateUserInfo();\n      });\n    };\n\n    _this.showCertification = function (name, organization) {\n      var mission = _this.state.mission;\n      showPopUp(React.createElement(OCPCertification, {\n        organization: organization,\n        grade: mission.grade,\n        type: mission.gameType,\n        name: name,\n        callback: function callback() {\n          _this.updateOCPUserPrint();\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 773\n        },\n        __self: this\n      }), {\n        darkmode: true\n      });\n    };\n\n    _this.getCommaForamttedNumber = function (num) {\n      if (!num) return;\n      if (num === 0) return \"0\";\n      var regexp = /\\B(?=(\\d{3})+(?!\\d))/g;\n      return num.toString().replace(regexp, \",\");\n    };\n\n    _this.DEFAULT_STATE = {\n      comments: [],\n      moreNum: 0,\n      isShowFullScreen: false\n    };\n    _this.state = _objectSpread({\n      stages: [],\n      isShowGameDetail: _this.props.isShowGameDetail,\n      mission: _this.props.selectedMission,\n      commentText: undefined,\n      isCommentValid: true,\n      commentCount: undefined\n    }, _this.DEFAULT_STATE);\n    return _this;\n  }\n\n  _createClass(Container, [{\n    key: \"componentDidUpdate\",\n\n    /** Life Cycle */\n    value: function componentDidUpdate(prevProps, prevState) {\n      var _this2 = this;\n\n      var _this$props = this.props,\n          isShowGameDetail = _this$props.isShowGameDetail,\n          selectedMission = _this$props.selectedMission,\n          userinfo = _this$props.userinfo;\n\n      if (isShowGameDetail !== prevProps.isShowGameDetail) {\n        this.setShowGameDetail({\n          then: function then() {\n            if (_this2.state.isShowGameDetail) {\n              if (selectedMission !== prevProps.selectedMission) {\n                _this2.setMission({\n                  then: function then() {\n                    _this2.getStages();\n\n                    _this2.getComments();\n\n                    _this2.getCount();\n                  }\n                });\n              }\n            }\n          }\n        });\n      }\n\n      if (this.props.isShowGameDetail) {\n        if (selectedMission !== prevProps.selectedMission) {\n          this.setMission({\n            then: function then() {\n              _this2.getStages();\n\n              _this2.getComments();\n\n              _this2.getCount();\n            }\n          });\n        }\n      }\n\n      if (this.props.isShowGameDetail) {\n        if (userinfo.email !== prevProps.userinfo.email) {\n          this.props.onFocusForRefreshGameDetail();\n        }\n      }\n    }\n    /** Setting Methods */\n\n  }, {\n    key: \"alertCommentEventEnded\",\n    value: function alertCommentEventEnded() {\n      showPopUp(React.createElement(PopUp.OneButton, {\n        title: \"\\uD6C4\\uAE30 \\uC791\\uC131\\uAE30\\uAC04\\uC774 \\uC544\\uB2D9\\uB2C8\\uB2E4.\",\n        buttonName: \"\\uD655\\uC778\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 357\n        },\n        __self: this\n      }), {\n        darkmode: true\n      });\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _this$state2 = this.state,\n          stages = _this$state2.stages,\n          mission = _this$state2.mission,\n          isShowGameDetail = _this$state2.isShowGameDetail,\n          commentText = _this$state2.commentText,\n          comments = _this$state2.comments,\n          isCommentValid = _this$state2.isCommentValid,\n          commentCount = _this$state2.commentCount,\n          isShowFullScreen = _this$state2.isShowFullScreen;\n      var _this$props2 = this.props,\n          handleGameDetailBack = _this$props2.handleGameDetailBack,\n          userinfo = _this$props2.userinfo;\n      return React.createElement(View, {\n        stages: stages,\n        mission: mission,\n        userinfo: userinfo,\n        commentText: commentText,\n        handleCommentChange: this.handleCommentChange,\n        onClickCommentTextArea: this.onClickCommentTextArea,\n        isShowGameDetail: isShowGameDetail,\n        handleGameDetailBack: handleGameDetailBack,\n        onClickStage: this.onClickStage,\n        onClickEventLink: this.onClickEventLink,\n        comments: comments,\n        onClickComment: this.onClickComment,\n        onClickReport: this.onClickReport,\n        onClickDelete: this.onClickDelete,\n        onClickCertification: this.onClickCertification,\n        onClickReset: this.onClickReset,\n        isCommentValid: isCommentValid,\n        commentCount: this.getCommaForamttedNumber(commentCount),\n        onClickMore: this.onClickMore,\n        onClickStartStage: this.onClickStartStage,\n        onClickSignIn: this.onClickSignIn,\n        onClickFullScreen: this.onClickFullScreen,\n        isShowFullScreen: isShowFullScreen,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 807\n        },\n        __self: this\n      });\n    }\n  }]);\n\n  return Container;\n}(Component);\n\nexport default connect(function (state) {\n  return {\n    userinfo: state.userinfo\n  };\n}, {\n  updateUserInfo: action.updateUserInfo\n})(injectIntl(Container));","map":{"version":3,"sources":["/Users/jimmy/Documents/Wizschool/wizlab_web2/src/Page/OCP2/Components/OCPGameDetail/Container.js"],"names":["React","Component","connect","injectIntl","View","action","moment","request","PopUp","showPopUp","SignIn","SignUp","resetOcpToken","OCPCertification","detectIE","Container","props","componentDidMount","setResizeEventListener","setShowGameDetail","param","then","console","error","setState","isShowGameDetail","state","DEFAULT_STATE","window","removeEventListener","onResizeForStages","setMission","mission","selectedMission","addEventListener","stages","length","forEach","_","index","element","document","getElementById","innerWidth","itemWidth","style","width","height","getStages","Array","keys","map","stageInfo","require","grade","data","title","img","level","getComments","offset","gameType","warn","type","getOCPComments","res","json","success","comments","filter","cm","isDeleted","interval","manipulateCmTime","createdAt","msg","catch","e","getCount","getOCPCount","commentCount","count","addComment","userinfo","commentText","email","addOCPComment","newComment","user","handleAddCommentError","errorType","deleteComment","comment","deleteOCPComment","id","updateOCPUserPrint","guestInfo","getGuestInfo","updateMyOcpPrint2","guestId","addReport","commentId","reason","addOCPReport","showErrorPopup","onClickStage","stageLevel","checkIsValidOpenBuilder","showBuilder","intl","formatMessage","darkmode","mobileFullscreen","onClickStartStage","onClickEventLink","open","handleCommentChange","value","target","onClickCommentTextArea","alertCommentEventEnded","onClickComment","onClickReport","dismissOverlay","onClickDelete","onClickCertification","isActiveDownload","alertCertificationEnd","onClickReset","location","reload","onClickMore","moreNum","onClickSignIn","onClickFullScreen","toggleIsShowFullScreenState","isShowFullScreen","url","builder","focus","checkIsMobileAndTableBrowerAndWarn","checkIsChromeAndShowWarn","isMobileAndTableBrowser","isIE","check","a","test","substr","navigator","userAgent","vendor","opera","checkCommentValidation","undefined","isCommentValid","commentValidationTimer","clearTimeout","setTimeout","localStorage","getItem","JSON","parse","message","dateFormat","cmMoment","duration","diff","resultTimeFormat","days","hours","minutes","showLoginPopup","handleCertification","organization","name","org","showCertification","updateOCPUser","getOcpUser2","guest","substring","updateOcpUser2","updateUserInfo","getCommaForamttedNumber","num","regexp","toString","replace","prevProps","prevState","onFocusForRefreshGameDetail","handleGameDetailBack"],"mappings":"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","sourcesContent":["import React, { Component } from \"react\";\nimport { connect } from \"react-redux\";\nimport { injectIntl } from \"react-intl\";\nimport View from \"./View\";\nimport * as action from \"../../../../Common/Store/Reducer/UserInfo\";\nimport moment from \"moment\";\nimport * as request from \"../../../../Common/Util/HTTPRequest\";\nimport PopUp, { showPopUp } from \"../../../../Common/Component/PopUp\";\nimport SignIn from \"../../../../Common/Component/SignIn\";\nimport SignUp from \"../../../../Common/Component/SignUp\";\nimport { resetOcpToken } from \"../../../../Common/Util/OcpToken\";\nimport OCPCertification from \"../../../../Common/Component/OCPCertification\";\nimport { detectIE } from \"../../../../Common/Util/detectBrowser\";\n\nclass Container extends Component {\n  constructor(props) {\n    super(props);\n    this.DEFAULT_STATE = {\n      comments: [],\n      moreNum: 0,\n      isShowFullScreen: false\n    };\n    this.state = {\n      stages: [],\n      isShowGameDetail: this.props.isShowGameDetail,\n      mission: this.props.selectedMission,\n      commentText: undefined,\n      isCommentValid: true,\n      commentCount: undefined,\n      ...this.DEFAULT_STATE\n    };\n  }\n\n  componentDidMount = () => {\n    this.setResizeEventListener();\n  };\n\n  /** Life Cycle */\n  componentDidUpdate(prevProps, prevState) {\n    const { isShowGameDetail, selectedMission, userinfo } = this.props;\n    if (isShowGameDetail !== prevProps.isShowGameDetail) {\n      this.setShowGameDetail({\n        then: () => {\n          if (this.state.isShowGameDetail) {\n            if (selectedMission !== prevProps.selectedMission) {\n              this.setMission({\n                then: () => {\n                  this.getStages();\n                  this.getComments();\n                  this.getCount();\n                }\n              });\n            }\n          }\n        }\n      });\n    }\n\n    if (this.props.isShowGameDetail) {\n      if (selectedMission !== prevProps.selectedMission) {\n        this.setMission({\n          then: () => {\n            this.getStages();\n            this.getComments();\n            this.getCount();\n          }\n        });\n      }\n    }\n\n    if (this.props.isShowGameDetail) {\n      if (userinfo.email !== prevProps.userinfo.email) {\n        this.props.onFocusForRefreshGameDetail();\n      }\n    }\n  }\n\n  /** Setting Methods */\n  setShowGameDetail = param => {\n    const { then } = param;\n    if (then && typeof then !== \"function\")\n      return console.error(\"Unknown type of then in setShowGameDetail\");\n    this.setState(\n      {\n        isShowGameDetail: this.props.isShowGameDetail\n      },\n      () => {\n        if (this.state.isShowGameDetail) {\n          this.setState(this.DEFAULT_STATE);\n          if (then) then();\n        } else {\n          window.removeEventListener(\"resize\", this.onResizeForStages);\n        }\n      }\n    );\n  };\n\n  setMission = param => {\n    const { then } = param;\n    if (then && typeof then !== \"function\")\n      return console.error(\"Unknown type of then in setMission\");\n    this.setState(\n      {\n        mission: this.props.selectedMission\n      },\n      () => {\n        if (then) then();\n      }\n    );\n  };\n\n  setResizeEventListener = () => {\n    window.addEventListener(\"resize\", this.onResizeForStages);\n  };\n\n  onResizeForStages = () => {\n    if (this.state.stages.length === 0) return;\n    this.state.stages.forEach((_, index) => {\n      const element = document.getElementById(\n        `OCPGameDetail_st_iw-mobile-round-${index}`\n      );\n      if (!element) return;\n      const innerWidth = window.innerWidth - 20 * 2;\n      const itemWidth = (innerWidth - 40 * 4) / 5;\n      element.style.width = `${itemWidth}px`;\n      element.style.height = `${itemWidth}px`;\n    });\n  };\n\n  /** Network */\n  getStages = () => {\n    const { mission } = this.state;\n    if (!mission) return;\n    this.setState({\n      stages: [...Array(10).keys()].map((_, index) => {\n        const stageInfo = require(`../../../Builder/utils/ocp/${\n          mission.grade\n        }/stages/${index + 1}`).data;\n        return {\n          title: stageInfo.title,\n          img: stageInfo.img,\n          level: index + 1\n        };\n      })\n    });\n  };\n\n  getComments = (offset = 0) => {\n    const { mission } = this.state;\n\n    if (!mission.gameType || !mission.grade)\n      return console.warn(\"not intended data in OCPGameDetail\");\n    const param = {\n      grade: mission.grade,\n      type: mission.gameType,\n      offset: offset * 10\n    };\n    request\n      .getOCPComments(param)\n      .then(res => res.json())\n      .then(json => {\n        if (json.success) {\n          this.setState({\n            comments:\n              offset === 0\n                ? json.comments\n                    .filter(cm => !cm.isDeleted)\n                    .map(cm => {\n                      return {\n                        ...cm,\n                        interval: this.manipulateCmTime(cm.createdAt)\n                      };\n                    })\n                : [\n                    ...this.state.comments,\n                    ...json.comments\n                      .filter(cm => !cm.isDeleted)\n                      .map(cm => {\n                        return {\n                          ...cm,\n                          interval: this.manipulateCmTime(cm.createdAt)\n                        };\n                      })\n                  ]\n          });\n        } else {\n          if (json.msg) console.error(json.msg);\n        }\n      })\n      .catch(e => {\n        console.error(e);\n      });\n  };\n\n  getCount = () => {\n    const { mission } = this.state;\n    if (!mission.gameType || !mission.grade)\n      return console.warn(\"not intended data in OCPGameDetail\");\n    const param = { grade: mission.grade, type: mission.gameType };\n    request\n      .getOCPCount(param)\n      .then(res => res.json())\n      .then(json => {\n        if (json.success) {\n          this.setState({\n            commentCount: json.count.commentCount\n          });\n        } else {\n          if (json.msg) console.error(json.msg);\n        }\n      })\n      .catch(e => {\n        console.error(e);\n      });\n  };\n\n  addComment = () => {\n    const { userinfo } = this.props;\n    const { commentText, mission } = this.state;\n    const param = {\n      email: userinfo.email,\n      commentText,\n      grade: mission.grade,\n      type: mission.gameType\n    };\n    request\n      .addOCPComment(param)\n      .then(res => res.json())\n      .then(json => {\n        if (json.success) {\n          this.setState({\n            comments: [\n              {\n                ...json.newComment,\n                user: userinfo\n              },\n              ...this.state.comments\n            ],\n            commentText: \"\",\n            commentCount: this.state.commentCount + 1\n          });\n        } else {\n          this.handleAddCommentError(json.errorType);\n        }\n      })\n      .catch(e => {\n        this.handleAddCommentError(\"RequestError\", e);\n      });\n  };\n\n  deleteComment = comment => {\n    const { comments } = this.state;\n    request\n      .deleteOCPComment({ id: comment.id })\n      .then(res => res.json())\n      .then(json => {\n        if (json.success) {\n          this.setState({\n            comments: [...comments].filter(cm => cm.id !== comment.id),\n            commentCount: this.state.commentCount - 1\n          });\n        }\n      });\n  };\n\n  updateOCPUserPrint = () => {\n    const { mission } = this.state;\n    const guestInfo = this.getGuestInfo();\n    if (!guestInfo) return;\n\n    request.updateMyOcpPrint2(\n      this.props.userinfo.email\n        ? {\n            email: this.props.userinfo.email,\n            grade: mission.grade,\n            type: mission.gameType\n          }\n        : {\n            guestId: guestInfo.id,\n            grade: mission.grade,\n            type: mission.gameType\n          }\n    );\n  };\n\n  addReport = (commentId, reason) => {\n    const { userinfo } = this.props;\n    if (!commentId || !userinfo.email) return;\n    const param = {\n      email: userinfo.email,\n      commentId,\n      reason\n    };\n\n    request\n      .addOCPReport(param)\n      .then(res => res.json())\n      .then(json => {\n        if (!json.success && json.errorType)\n          this.showErrorPopup(json.errorType);\n      })\n      .catch(e => console.error(e));\n  };\n\n  /** Event Handler */\n  onClickStage = stageLevel => {\n    if (!this.checkIsValidOpenBuilder()) {\n      return;\n    }\n    const { mission } = this.state;\n    if (stageLevel === 1 || stageLevel <= mission.level + 1) {\n      this.showBuilder(stageLevel);\n    } else {\n      showPopUp(\n        <PopUp.OneButton\n          title={this.props.intl.formatMessage({\n            id: \"ID_LEARN_POPUP_STEP_CHECK_TITLE\"\n          })}\n          buttonName={this.props.intl.formatMessage({\n            id: \"ID_LEARN_POPUP_STEP_CHECK_TITLE_BUTTON\"\n          })}\n        />,\n        { darkmode: true, mobileFullscreen: true }\n      );\n    }\n  };\n\n  onClickStartStage = () => {\n    const { mission } = this.state;\n    if (!this.checkIsValidOpenBuilder()) return;\n    if (mission.level === 10) {\n      this.showErrorPopup(\"allClear\");\n      return;\n    }\n    let stageLevel = 1;\n    if (mission.level && mission.level !== 0) stageLevel = mission.level + 1;\n    this.showBuilder(stageLevel);\n  };\n\n  onClickEventLink = () => {\n    window.open(\"/event/codingparty/review\");\n  };\n\n  handleCommentChange = e => {\n    const { value } = e.target;\n    this.setState({\n      commentText: value\n    });\n  };\n\n  onClickCommentTextArea = () => {\n    this.alertCommentEventEnded();\n  };\n\n  alertCommentEventEnded() {\n    showPopUp(\n      <PopUp.OneButton title=\"후기 작성기간이 아닙니다.\" buttonName=\"확인\" />,\n      { darkmode: true }\n    );\n  }\n\n  onClickComment = () => {\n    this.alertCommentEventEnded();\n    // if (!this.props.userinfo.email) {\n    //   this.showLoginPopup();\n    //   return;\n    // }\n\n    // if (!this.checkCommentValidation()) return;\n\n    // const { mission } = this.state;\n    // if (mission.level !== 10) {\n    //   this.showErrorPopup(\"notAllClear\");\n    //   return;\n    // }\n\n    // // add comment\n    // this.addComment();\n  };\n\n  onClickReport = comment => {\n    showPopUp(\n      <PopUp.OneInput\n        title=\"신고사유를 입력해주세요\"\n        buttonName=\"확인\"\n        inputLimit={100}\n        buttonAction={reason => {\n          this.addReport(comment.id, reason);\n        }}\n      />,\n      { dismissOverlay: true, darkmode: true, mobileFullscreen: true }\n    );\n  };\n\n  onClickDelete = comment => {\n    showPopUp(\n      <PopUp.TwoButton\n        title=\"정말 삭제하시겠습니까?\"\n        cancelButtonName=\"아니오\"\n        confirmButtonName=\"네\"\n        confirmAction={() => this.deleteComment(comment)}\n      />,\n      { dismissOverlay: true, mobileFullscreen: true, darkmode: true }\n    );\n  };\n\n  onClickCertification = isActiveDownload => {\n    this.alertCertificationEnd();\n    // if (!this.state.mission) return;\n    // if (!isActiveDownload) {\n    //   this.showErrorPopup(\"certification\");\n    //   return;\n    // }\n\n    // showPopUp(\n    //   <PopUp.TwoButton\n    //     title=\"인증서를 출력하시겠습니까?\"\n    //     subtitle=\"나중에도 출력가능합니다.\"\n    //     cancelButtonName=\"아니오\"\n    //     confirmButtonName=\"네\"\n    //     confirmAction={() => this.handleCertification()}\n    //   />,\n    //   { dismissOverlay: true, darkmode: true }\n    // );\n  };\n\n  alertCertificationEnd = () => {\n    showPopUp(\n      <PopUp.OneButton\n        title=\"인증서 발급 기간이 아닙니다.\"\n        buttonName=\"확인\"\n      />,\n      { darkmode: true }\n    );\n  };\n\n  onClickReset = () => {\n    showPopUp(\n      <PopUp.TwoButton\n        title={\"초기화를 정말 진행하시겠습니까?\"}\n        subtitle={\"모든 게임 데이터가 초기화 됩니다\"}\n        confirmButtonName={\"확인\"}\n        cancelButtonName={\"취소\"}\n        confirmAction={() => {\n          resetOcpToken();\n          window.location.reload();\n        }}\n      />,\n      {\n        mobileFullscreen: true,\n        darkmode: true\n      }\n    );\n  };\n\n  onClickMore = () => {\n    this.setState(\n      {\n        moreNum: this.state.moreNum + 1\n      },\n      () => {\n        this.getComments(this.state.moreNum);\n      }\n    );\n  };\n\n  onClickSignIn = () => {\n    showPopUp(<SignIn />, {\n      mobileFullscreen: true,\n      darkmode: true\n    });\n  };\n\n  onClickFullScreen = () => {\n    this.toggleIsShowFullScreenState();\n  };\n\n  /** Methods */\n\n  toggleIsShowFullScreenState = () => {\n    this.setState({\n      isShowFullScreen: this.state.isShowFullScreen ? false : true\n    });\n  };\n\n  showBuilder = level => {\n    const { mission } = this.state;\n    const url =\n      mission.gameType === \"block\"\n        ? `/ocp2/block/${mission.grade}/${level}`\n        : `/ocp2/js/${mission.gameType}/${mission.grade}/${level}`;\n    let builder = window.open(url, \"_blank\");\n    builder.focus();\n  };\n\n  checkIsValidOpenBuilder = () => {\n    if (!this.checkIsMobileAndTableBrowerAndWarn()) return false;\n    if (!this.checkIsChromeAndShowWarn()) return false;\n    return true;\n  };\n\n  checkIsMobileAndTableBrowerAndWarn = () => {\n    if (this.isMobileAndTableBrowser()) {\n      this.showErrorPopup(\"mobileBuilder\");\n      return false;\n    }\n    return true;\n  };\n\n  checkIsChromeAndShowWarn = () => {\n    if (this.isIE()) {\n      showPopUp(\n        <PopUp.TwoButton\n          title=\"이용안내\"\n          subtitle=\"본 페이지는 크롬에서만 정상 동작합니다\"\n          confirmButtonName=\"크롬 설치하기\"\n          cancelButtonName=\"취소\"\n          confirmAction={() => {\n            window.open(\"https://www.google.com/intl/ko/chrome/\", \"_blank\");\n          }}\n        />,\n        { darkmode: true, mobileFullscreen: true }\n      );\n      return false;\n    }\n\n    return true;\n  };\n\n  isMobileAndTableBrowser = () => {\n    let check = false;\n    (function(a) {\n      if (\n        /(android|bb\\d+|meego).+mobile|avantgo|bada\\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(\n          a\n        ) ||\n        // eslint-disable-next-line no-useless-escape\n        /1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\\-(n|u)|c55\\/|capi|ccwa|cdm\\-|cell|chtm|cldc|cmd\\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\\-s|devi|dica|dmob|do(c|p)o|ds(12|\\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\\-|_)|g1 u|g560|gene|gf\\-5|g\\-mo|go(\\.w|od)|gr(ad|un)|haie|hcit|hd\\-(m|p|t)|hei\\-|hi(pt|ta)|hp( i|ip)|hs\\-c|ht(c(\\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\\-(20|go|ma)|i230|iac( |\\-|\\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\\/)|klon|kpt |kwc\\-|kyo(c|k)|le(no|xi)|lg( g|\\/(k|l|u)|50|54|\\-[a-w])|libw|lynx|m1\\-w|m3ga|m50\\/|ma(te|ui|xo)|mc(01|21|ca)|m\\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\\-2|po(ck|rt|se)|prox|psio|pt\\-g|qa\\-a|qc(07|12|21|32|60|\\-[2-7]|i\\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\\-|oo|p\\-)|sdk\\/|se(c(\\-|0|1)|47|mc|nd|ri)|sgh\\-|shar|sie(\\-|m)|sk\\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\\-|v\\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\\-|tdg\\-|tel(i|m)|tim\\-|t\\-mo|to(pl|sh)|ts(70|m\\-|m3|m5)|tx\\-9|up(\\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\\-|your|zeto|zte\\-/i.test(\n          a.substr(0, 4)\n        )\n      )\n        check = true;\n    })(navigator.userAgent || navigator.vendor || window.opera);\n    return check;\n  };\n\n  isIE = () => {\n    return detectIE();\n  };\n\n  checkCommentValidation = () => {\n    const { commentText } = this.state;\n    if (commentText === undefined || commentText === \"\") {\n      // validation check\n      this.setState(\n        {\n          isCommentValid: false\n        },\n        () => {\n          if (this.commentValidationTimer)\n            clearTimeout(this.commentValidationTimer);\n          this.commentValidationTimer = setTimeout(() => {\n            this.setState({\n              isCommentValid: true\n            });\n          }, 2000);\n        }\n      );\n      return false;\n    }\n    return true;\n  };\n\n  getGuestInfo = () => {\n    return (\n      localStorage.getItem(\"ocpId\") && JSON.parse(localStorage.getItem(\"ocpId\"))\n    );\n  };\n\n  showErrorPopup = type => {\n    let message;\n    switch (type) {\n      case \"certification\":\n        message = \"모든 단계를 클리어한 후 인증서를 출력할 수 있습니다\";\n        break;\n\n      case \"mobileBuilder\":\n        message = \"PC에서 다시 시도해 주세요\";\n        break;\n\n      case \"notAllClear\":\n        message = \"모든 단계를 클리어한 후 시도해 주세요\";\n        break;\n\n      case \"reportAlready\":\n        message = \"이미 신고한 유저입니다\";\n        break;\n\n      case \"Spam\":\n        // 욕설\n        message = \"욕설 및 비속어를 포함할 수 없습니다\";\n        break;\n\n      case \"allClear\":\n        message = \"모든 단계를 클리어했습니다\";\n        break;\n      default:\n        break;\n    }\n    if (!message) return;\n    showPopUp(<PopUp.OneButton title={message} buttonName={\"확인\"} />, {\n      darkmode: true,\n      mobileFullscreen: true\n    });\n  };\n\n  manipulateCmTime = dateFormat => {\n    const cmMoment = moment(dateFormat);\n    const duration = moment.duration(moment().diff(cmMoment));\n    let resultTimeFormat;\n    if (duration.days() < 1) {\n      // 하루 이내\n      if (duration.hours() < 1) {\n        // 분으로 계산\n        resultTimeFormat = `${\n          duration.minutes() === 0 ? \"1\" : duration.minutes()\n        }분 전`;\n      } else {\n        // 시간으로 계산\n        resultTimeFormat = `${duration.hours()}시간 전`;\n      }\n    } else {\n      // 하루 이상 지난\n      resultTimeFormat = `${duration.days()}일 전`;\n    }\n    return resultTimeFormat;\n  };\n\n  showLoginPopup = () => {\n    showPopUp(\n      <PopUp.TwoButton\n        title={\"로그인 후 이용해주세요\"}\n        confirmButtonNameId={\"ID_SIGNUP\"}\n        cancelButtonNameId={\"ID_SIGNIN\"}\n        cancelAction={() => {\n          showPopUp(<SignIn />, {\n            mobileFullscreen: true,\n            darkmode: true\n          });\n        }}\n        confirmAction={() => {\n          showPopUp(<SignUp />, {\n            mobileFullscreen: true,\n            darkmode: true\n          });\n        }}\n      />,\n      {\n        mobileFullscreen: true,\n        darkmode: true\n      }\n    );\n  };\n\n  handleAddCommentError = (errorType, e) => {\n    let message;\n    switch (errorType) {\n      case \"InvalidUser\":\n        message = \"부적절한 유저입니다\";\n        break;\n      case \"ExistComment\":\n        message = \"이미 작성한 댓글이 있습니다.\";\n        break;\n      case \"Spam\":\n        // 욕설\n        message = \"욕설 및 비속어를 포함할 수 없습니다\";\n        break;\n      case \"CantCreated\":\n        message = \"알 수 없는 이유로 작성할 수 없습니다\";\n        break;\n      case \"RequestError\":\n        message = \"네트워크 상태를 확인한 후 다시 시도해주세요\";\n        console.error(e);\n        break;\n      default:\n        break;\n    }\n\n    if (message) {\n      showPopUp(<PopUp.OneButton title={message} buttonName={\"확인\"} />, {\n        darkmode: true,\n        mobileFullscreen: true\n      });\n    }\n  };\n\n  handleCertification = async () => {\n    const guestInfo = this.getGuestInfo();\n    let name, organization;\n    if (this.props.userinfo.email) {\n      if (this.props.userinfo.organization) {\n        name = this.props.userinfo.name;\n        organization = this.props.userinfo.organization;\n      } else {\n        showPopUp(\n          <PopUp.OneInput\n            title=\"학교를 입력해주세요\"\n            buttonName=\"확인\"\n            inputLimit={10}\n            buttonAction={org => {\n              this.showCertification(this.props.userinfo.name, org);\n              this.updateOCPUser(org);\n            }}\n          />,\n          { dismissOverlay: true, darkmode: true }\n        );\n      }\n    } else {\n      if (guestInfo) {\n        const res = await request.getOcpUser2({\n          guestId: guestInfo.id\n        });\n        const guest = await res.json();\n        if (!guest.name || !guest.organization) {\n          showPopUp(\n            <PopUp.TwoInput\n              title=\"학교를 입력해주세요\"\n              buttonName=\"확인\"\n              inputTitle1=\"이름\"\n              inputTitle2=\"학교\"\n              inputLimit1={8}\n              inputLimit2={10}\n              buttonAction={(org, name) => {\n                this.showCertification(name, org);\n                this.updateOCPUser(org, name);\n              }}\n            />,\n            { dismissOverlay: true, darkmode: true }\n          );\n        } else {\n          this.showCertification(guest.name, guest.organization);\n          this.updateOCPUser(guest.organization, guest.name);\n        }\n      }\n    }\n\n    if (name && organization) {\n      this.showCertification(\n        name.substring(0, 8),\n        organization.substring(0, 10)\n      );\n    }\n  };\n\n  updateOCPUser = (org, name = this.props.userinfo.name) => {\n    const guestInfo = this.getGuestInfo();\n    request\n      .updateOcpUser2({\n        guestId: guestInfo ? guestInfo.id : null,\n        email: this.props.userinfo.email,\n        name: name,\n        organization: org\n      })\n      .then(res => res.json())\n      .then(json => {\n        if (json) this.props.updateUserInfo();\n      });\n  };\n\n  showCertification = (name, organization) => {\n    const { mission } = this.state;\n    showPopUp(\n      <OCPCertification\n        organization={organization}\n        grade={mission.grade}\n        type={mission.gameType}\n        name={name}\n        callback={() => {\n          this.updateOCPUserPrint();\n        }}\n      />,\n      { darkmode: true }\n    );\n  };\n\n  getCommaForamttedNumber = num => {\n    if (!num) return;\n    if (num === 0) return \"0\";\n    const regexp = /\\B(?=(\\d{3})+(?!\\d))/g;\n    return num.toString().replace(regexp, \",\");\n  };\n\n  render() {\n    const {\n      stages,\n      mission,\n      isShowGameDetail,\n      commentText,\n      comments,\n      isCommentValid,\n      commentCount,\n      isShowFullScreen\n    } = this.state;\n    const { handleGameDetailBack, userinfo } = this.props;\n\n    return (\n      <View\n        stages={stages}\n        mission={mission}\n        userinfo={userinfo}\n        commentText={commentText}\n        handleCommentChange={this.handleCommentChange}\n        onClickCommentTextArea={this.onClickCommentTextArea}\n        isShowGameDetail={isShowGameDetail}\n        handleGameDetailBack={handleGameDetailBack}\n        onClickStage={this.onClickStage}\n        onClickEventLink={this.onClickEventLink}\n        comments={comments}\n        onClickComment={this.onClickComment}\n        onClickReport={this.onClickReport}\n        onClickDelete={this.onClickDelete}\n        onClickCertification={this.onClickCertification}\n        onClickReset={this.onClickReset}\n        isCommentValid={isCommentValid}\n        commentCount={this.getCommaForamttedNumber(commentCount)}\n        onClickMore={this.onClickMore}\n        onClickStartStage={this.onClickStartStage}\n        onClickSignIn={this.onClickSignIn}\n        onClickFullScreen={this.onClickFullScreen}\n        isShowFullScreen={isShowFullScreen}\n      />\n    );\n  }\n}\n\nexport default connect(\n  state => ({ userinfo: state.userinfo }),\n  {\n    updateUserInfo: action.updateUserInfo\n  }\n)(injectIntl(Container));\n"]},"metadata":{},"sourceType":"module"}