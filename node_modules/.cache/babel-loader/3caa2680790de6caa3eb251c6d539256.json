{"ast":null,"code":"import _objectSpread from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread\";\nimport _classCallCheck from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";\nimport _possibleConstructorReturn from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";\nimport _inherits from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";\nvar _jsxFileName = \"/Users/jimmy/Documents/Wizschool/wizlab_web2/src/Page/Game/Component/List/Container.js\";\nimport React, { Component } from \"react\";\nimport { withRouter } from \"react-router-dom\";\nimport QueryString from \"query-string\";\nimport * as request from \"../../../../Common/Util/HTTPRequest\";\nimport View from \"./View\";\n\nvar Container =\n/*#__PURE__*/\nfunction (_Component) {\n  _inherits(Container, _Component);\n\n  function Container(props) {\n    var _this;\n\n    _classCallCheck(this, Container);\n\n    _this = _possibleConstructorReturn(this, _getPrototypeOf(Container).call(this, props));\n\n    _this.onClickTab = function (tab) {\n      var query = _objectSpread({}, _this.query);\n\n      if (tab === \"all\") {\n        delete query.tab;\n      } else {\n        query.tab = tab;\n      }\n\n      _this.props.history.replace(\"?\" + QueryString.stringify(query));\n    };\n\n    _this.onWindowScroll = function (e) {\n      if (window.scrollY + window.innerHeight > document.body.offsetHeight * 0.66) {\n        if (_this.state.total > _this.state.games.length) {\n          _this.loadMore();\n        }\n      }\n    };\n\n    _this.state = {\n      total: 0,\n      games: [],\n      placeholderGames: []\n    };\n    return _this;\n  }\n\n  _createClass(Container, [{\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      this.scrollToTop();\n      this.initAndLoad();\n      window.addEventListener(\"scroll\", this.onWindowScroll);\n    }\n  }, {\n    key: \"componentWillUnmount\",\n    value: function componentWillUnmount() {\n      window.removeEventListener(\"scroll\", this.onWindowScroll);\n    }\n  }, {\n    key: \"initAndLoad\",\n    value: function initAndLoad() {\n      var _this2 = this;\n\n      this.setState({\n        total: 0,\n        games: []\n      }, function () {\n        _this2.loadMore();\n      });\n    }\n  }, {\n    key: \"loadMore\",\n    value: function loadMore() {\n      var _this3 = this;\n\n      var count = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 10;\n\n      if (this.isLoading) {\n        return;\n      }\n\n      this.isLoading = true;\n      var options = {\n        order: {\n          weekly: \"weeklyViewCount\",\n          monthly: \"monthlyViewCount\"\n        }[this.type],\n        projectType: this.tab === \"all\" ? null : this.tab,\n        keyword: this.keyword,\n        offset: this.state.games.length,\n        limit: count\n      };\n      var queryString = QueryString.stringify(options);\n      request.getPublishedList(queryString).then(function (res) {\n        return res.json();\n      }).then(function (json) {\n        _this3.setState(function (prev) {\n          return {\n            total: json.count,\n            games: [].concat(prev.games, json.rows)\n          };\n        });\n\n        if (_this3.type === \"search\" && json.count <= 0) {\n          _this3.loadPlaceholderGames();\n        }\n      }).finally(function () {\n        _this3.isLoading = false;\n\n        _this3.onWindowScroll();\n      });\n    }\n  }, {\n    key: \"loadPlaceholderGames\",\n    value: function loadPlaceholderGames() {\n      var _this4 = this;\n\n      request.getProjectsByType({\n        type: \"recommend\",\n        limit: 12,\n        offset: 0\n      }).then(function (res) {\n        return res.json();\n      }).then(function (recommends) {\n        _this4.setState({\n          placeholderGames: recommends.map(function (recommend) {\n            return recommend.project;\n          })\n        });\n      });\n    }\n  }, {\n    key: \"componentDidUpdate\",\n    value: function componentDidUpdate(prevProps) {\n      var prevType = prevProps.match.params.type;\n\n      if (prevType !== this.type) {\n        this.initAndLoad();\n      }\n\n      var prevQuery = QueryString.parse(prevProps.location.search);\n      var prevTab = prevQuery.tab || \"all\";\n\n      if (prevTab !== this.tab) {\n        this.initAndLoad();\n      }\n\n      var prevKeyword = prevQuery.keyword;\n\n      if (prevKeyword !== this.keyword && this.keyword) {\n        this.initAndLoad();\n      }\n    }\n  }, {\n    key: \"scrollToTop\",\n    value: function scrollToTop() {\n      window.scrollTo({\n        top: 0,\n        behavior: \"smooth\"\n      });\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      return React.createElement(View, {\n        type: this.type,\n        tab: this.tab,\n        total: this.state.total,\n        games: this.state.games,\n        placeholderGames: this.state.placeholderGames,\n        onClickTab: this.onClickTab,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 127\n        },\n        __self: this\n      });\n    }\n  }, {\n    key: \"type\",\n    get: function get() {\n      return this.props.match.params.type;\n    }\n  }, {\n    key: \"tab\",\n    get: function get() {\n      return this.query.tab || \"all\";\n    }\n  }, {\n    key: \"keyword\",\n    get: function get() {\n      return this.query.keyword || null;\n    }\n  }, {\n    key: \"query\",\n    get: function get() {\n      return QueryString.parse(this.props.location.search);\n    }\n  }]);\n\n  return Container;\n}(Component);\n\nexport default withRouter(Container);","map":{"version":3,"sources":["/Users/jimmy/Documents/Wizschool/wizlab_web2/src/Page/Game/Component/List/Container.js"],"names":["React","Component","withRouter","QueryString","request","View","Container","props","onClickTab","tab","query","history","replace","stringify","onWindowScroll","e","window","scrollY","innerHeight","document","body","offsetHeight","state","total","games","length","loadMore","placeholderGames","scrollToTop","initAndLoad","addEventListener","removeEventListener","setState","count","isLoading","options","order","weekly","monthly","type","projectType","keyword","offset","limit","queryString","getPublishedList","then","res","json","prev","concat","rows","loadPlaceholderGames","finally","getProjectsByType","recommends","map","recommend","project","prevProps","prevType","match","params","prevQuery","parse","location","search","prevTab","prevKeyword","scrollTo","top","behavior"],"mappings":"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","sourcesContent":["import React, { Component } from \"react\";\nimport { withRouter } from \"react-router-dom\";\nimport QueryString from \"query-string\";\nimport * as request from \"../../../../Common/Util/HTTPRequest\";\nimport View from \"./View\";\n\nclass Container extends Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      total: 0,\n      games: [],\n      placeholderGames: []\n    };\n  }\n\n  get type() {\n    return this.props.match.params.type;\n  }\n  get tab() {\n    return this.query.tab || \"all\";\n  }\n  get keyword() {\n    return this.query.keyword || null;\n  }\n  get query() {\n    return QueryString.parse(this.props.location.search);\n  }\n\n  componentDidMount() {\n    this.scrollToTop();\n    this.initAndLoad();\n    window.addEventListener(\"scroll\", this.onWindowScroll);\n  }\n  componentWillUnmount() {\n    window.removeEventListener(\"scroll\", this.onWindowScroll);\n  }\n  initAndLoad() {\n    this.setState({ total: 0, games: [] }, () => {\n      this.loadMore();\n    })\n  }\n  loadMore(count = 10) {\n    if(this.isLoading) {\n      return;\n    }\n    this.isLoading = true;\n\n    const options = {\n      order: {\n        weekly: \"weeklyViewCount\",\n        monthly: \"monthlyViewCount\"\n      }[this.type],\n      projectType: this.tab === \"all\" ? null : this.tab,\n      keyword: this.keyword,\n      offset: this.state.games.length,\n      limit: count\n    }\n    const queryString = QueryString.stringify(options);\n    request\n      .getPublishedList(queryString)\n      .then(res => res.json())\n      .then(json => {\n        this.setState(prev => ({\n          total: json.count,\n          games: [].concat(prev.games, json.rows)\n        }));\n        if(this.type === \"search\" && json.count <= 0) {\n          this.loadPlaceholderGames();\n        }\n      })\n      .finally(() => {\n        this.isLoading = false;\n        this.onWindowScroll();\n      });\n  }\n  loadPlaceholderGames() {\n    request\n      .getProjectsByType({ type: \"recommend\", limit: 12, offset: 0 })\n      .then(res => res.json())\n      .then(recommends => {\n        this.setState({\n          placeholderGames: recommends.map(recommend => recommend.project)\n        });\n      });\n  }\n\n  componentDidUpdate(prevProps) {\n    const prevType = prevProps.match.params.type;\n    if(prevType !== this.type) {\n      this.initAndLoad();\n    }\n    const prevQuery = QueryString.parse(prevProps.location.search);\n    const prevTab = prevQuery.tab || \"all\";\n    if(prevTab !== this.tab) {\n      this.initAndLoad();\n    }\n    const prevKeyword = prevQuery.keyword;\n    if(prevKeyword !== this.keyword && this.keyword) {\n      this.initAndLoad();\n    }\n  }\n\n  onClickTab = tab => {\n    const query = { ...this.query };\n    if(tab === \"all\") {\n      delete query.tab;\n    } else {\n      query.tab = tab\n    }\n    this.props.history.replace(\"?\" + QueryString.stringify(query));\n  }\n\n  onWindowScroll = e => {\n    if(window.scrollY + window.innerHeight > document.body.offsetHeight * 0.66) {\n      if(this.state.total > this.state.games.length) {\n        this.loadMore();\n      }\n    }\n  }\n  scrollToTop() {\n    window.scrollTo({ top: 0, behavior: \"smooth\" });\n  }\n\n  render() {\n    return (\n      <View\n        type={this.type}\n        tab={this.tab}\n        total={this.state.total}\n        games={this.state.games}\n        placeholderGames={this.state.placeholderGames}\n        onClickTab={this.onClickTab}\n      />\n    );\n  }\n}\n\nexport default withRouter(Container);\n"]},"metadata":{},"sourceType":"module"}