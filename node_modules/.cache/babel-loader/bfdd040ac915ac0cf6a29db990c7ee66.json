{"ast":null,"code":"import _regeneratorRuntime from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/react-scripts/node_modules/@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/react-scripts/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _classCallCheck from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/react-scripts/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/react-scripts/node_modules/@babel/runtime/helpers/esm/createClass\";\nimport _possibleConstructorReturn from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/react-scripts/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/react-scripts/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";\nimport _inherits from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/react-scripts/node_modules/@babel/runtime/helpers/esm/inherits\";\nvar _jsxFileName = \"/Users/jimmy/Documents/Wizschool/wizlab_web2/src/Page/Mypage/Components/IconSetting/Container.js\";\nimport React, { Component } from \"react\";\nimport * as request from \"../../../../Common/Util/HTTPRequest\";\nimport * as userInfoActions from \"../../../../Common/Store/Reducer/UserInfo\";\nimport { injectIntl } from \"react-intl\";\nimport { connect } from \"react-redux\";\nimport { withRouter, Redirect } from \"react-router-dom\";\nimport { ImageCompressor } from \"../../../../Common/Util/FileCompressor\";\nimport View from \"./View\";\nimport PopUp, { showPopUp } from \"../../../../Common/Component/PopUp\";\n\nvar Container =\n/*#__PURE__*/\nfunction (_Component) {\n  _inherits(Container, _Component);\n\n  function Container(props) {\n    var _this;\n\n    _classCallCheck(this, Container);\n\n    _this = _possibleConstructorReturn(this, _getPrototypeOf(Container).call(this, props));\n\n    _this.componentDidMount = function () {\n      _this.getUserProfile();\n    };\n\n    _this.getUserProfile =\n    /*#__PURE__*/\n    _asyncToGenerator(\n    /*#__PURE__*/\n    _regeneratorRuntime.mark(function _callee() {\n      var profile;\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              _context.next = 2;\n              return request.userProfile({\n                email: _this.props.userinfo.email\n              }).then(function (res) {\n                return res.json();\n              }).catch(function (e) {\n                return console.error(e);\n              });\n\n            case 2:\n              profile = _context.sent;\n\n              _this.setState({\n                selectedIconUrl: profile.icon,\n                customIconUrl: profile.customIcon ? JSON.parse(profile.customIcon)[0] : null,\n                profile: profile\n              });\n\n            case 4:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee, this);\n    }));\n\n    _this.handleUploadIcon = function () {\n      document.getElementById(\"uploadInput\").click();\n    };\n\n    _this.handleUploadFile =\n    /*#__PURE__*/\n    function () {\n      var _ref2 = _asyncToGenerator(\n      /*#__PURE__*/\n      _regeneratorRuntime.mark(function _callee2(event) {\n        var data, file, downsized, response, json;\n        return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n          while (1) {\n            switch (_context2.prev = _context2.next) {\n              case 0:\n                data = new FormData();\n                file = event.target.files[0];\n\n                if (file) {\n                  _context2.next = 4;\n                  break;\n                }\n\n                return _context2.abrupt(\"return\");\n\n              case 4:\n                _context2.next = 6;\n                return ImageCompressor(file);\n\n              case 6:\n                downsized = _context2.sent;\n                data.append(\"file\", downsized);\n                _context2.prev = 8;\n                _context2.next = 11;\n                return request.upload(data);\n\n              case 11:\n                response = _context2.sent;\n                _context2.next = 14;\n                return response.json();\n\n              case 14:\n                json = _context2.sent;\n\n                _this.setState({\n                  selectedIconUrl: json.url,\n                  customIconUrl: json.url\n                });\n\n                _context2.next = 21;\n                break;\n\n              case 18:\n                _context2.prev = 18;\n                _context2.t0 = _context2[\"catch\"](8);\n                console.error(_context2.t0);\n\n              case 21:\n              case \"end\":\n                return _context2.stop();\n            }\n          }\n        }, _callee2, this, [[8, 18]]);\n      }));\n\n      return function (_x) {\n        return _ref2.apply(this, arguments);\n      };\n    }();\n\n    _this.handleSelectTab = function (tab) {\n      if (tab === _this.state.selectedTab) return;\n\n      _this.setState({\n        selectedTab: tab\n      });\n    };\n\n    _this.handleSelectIcon = function (iconUrl) {\n      if (iconUrl === _this.state.selectedIconUrl) return;\n\n      _this.setState({\n        selectedIconUrl: iconUrl\n      });\n    };\n\n    _this.handleSubmit =\n    /*#__PURE__*/\n    function () {\n      var _ref3 = _asyncToGenerator(\n      /*#__PURE__*/\n      _regeneratorRuntime.mark(function _callee3(e) {\n        var _this$state, selectedIconUrl, customIconUrl, params;\n\n        return _regeneratorRuntime.wrap(function _callee3$(_context3) {\n          while (1) {\n            switch (_context3.prev = _context3.next) {\n              case 0:\n                e.preventDefault();\n                _this$state = _this.state, selectedIconUrl = _this$state.selectedIconUrl, customIconUrl = _this$state.customIconUrl;\n\n                if (selectedIconUrl) {\n                  _context3.next = 4;\n                  break;\n                }\n\n                return _context3.abrupt(\"return\");\n\n              case 4:\n                params = {\n                  email: _this.props.userinfo.email,\n                  icon: selectedIconUrl\n                };\n\n                if (customIconUrl) {\n                  params[\"customIcon\"] = JSON.stringify([customIconUrl]);\n                }\n\n                _context3.prev = 6;\n                _context3.next = 9;\n                return request.updateUserInfo(params);\n\n              case 9:\n                _this.props.updateUserInfo(params);\n\n                showPopUp(React.createElement(PopUp.OneButton, {\n                  title: _this.props.intl.formatMessage({\n                    id: \"ID_SETTING_ALERT_TITLE_SUCC\"\n                  }),\n                  subtitle: _this.props.intl.formatMessage({\n                    id: \"ID_SETTING_ALERT_PROFILE_SUCC\"\n                  }),\n                  buttonName: _this.props.intl.formatMessage({\n                    id: \"ID_SETTING_ALERT_CLOSEBTN\"\n                  }),\n                  buttonAction: function buttonAction() {\n                    _this.props.history.replace(\"/mypage\");\n                  },\n                  __source: {\n                    fileName: _jsxFileName,\n                    lineNumber: 117\n                  },\n                  __self: this\n                }), {\n                  darkmode: true\n                });\n                _context3.next = 16;\n                break;\n\n              case 13:\n                _context3.prev = 13;\n                _context3.t0 = _context3[\"catch\"](6);\n                showPopUp(React.createElement(PopUp.OneButton, {\n                  title: _this.props.intl.formatMessage({\n                    id: \"ID_SETTING_ALERT_TITLE_FAIL\"\n                  }),\n                  subtitle: _this.props.intl.formatMessage({\n                    id: \"ID_SETTING_ALERT_RETRY\"\n                  }),\n                  buttonName: _this.props.intl.formatMessage({\n                    id: \"ID_SETTING_ALERT_CLOSEBTN\"\n                  }),\n                  __source: {\n                    fileName: _jsxFileName,\n                    lineNumber: 135\n                  },\n                  __self: this\n                }), {\n                  darkmode: true\n                });\n\n              case 16:\n              case \"end\":\n                return _context3.stop();\n            }\n          }\n        }, _callee3, this, [[6, 13]]);\n      }));\n\n      return function (_x2) {\n        return _ref3.apply(this, arguments);\n      };\n    }();\n\n    _this.onClickMobileTooltip = function (tooltip) {\n      showPopUp(React.createElement(PopUp.OneButton, {\n        title: tooltip,\n        buttonNameId: \"ID_MYPAGE_TOOLTIP_TIER_CONFIRM\",\n        intl: _this.props.intl,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 153\n        },\n        __self: this\n      }), {\n        darkmode: true,\n        dismissButton: false\n      });\n    };\n\n    _this.TAB_TYPE = {\n      ICON: {\n        title: _this.props.intl.formatMessage({\n          id: \"ID_MYPAGE_ICONSETTING_TABTAPE_ICON\"\n        }),\n        tooltip: _this.props.intl.formatMessage({\n          id: \"ID_MYPAGE_ICONSETTING_TABTAPE_ICONTOOLTIP\"\n        })\n      },\n      EDGE: {\n        title: _this.props.intl.formatMessage({\n          id: \"ID_MYPAGE_ICONSETTING_TABTAPE_EDGE\"\n        }),\n        tooltip: _this.props.intl.formatMessage({\n          id: \"ID_MYPAGE_ICONSETTING_TABTAPE_EDGETOOLTIP\"\n        })\n      }\n    };\n    _this.state = {\n      selectedTab: _this.TAB_TYPE.ICON.title,\n      selectedIconUrl: undefined,\n      customIconUrl: null,\n      profile: _this.props.userinfo\n    };\n    return _this;\n  }\n\n  _createClass(Container, [{\n    key: \"render\",\n    value: function render() {\n      if (!this.props.userinfo.email) {\n        return React.createElement(Redirect, {\n          to: \"/\",\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 164\n          },\n          __self: this\n        });\n      }\n\n      var _this$state2 = this.state,\n          selectedTab = _this$state2.selectedTab,\n          selectedIconUrl = _this$state2.selectedIconUrl,\n          profile = _this$state2.profile,\n          customIconUrl = _this$state2.customIconUrl;\n      return React.createElement(View, {\n        handleUploadIcon: this.handleUploadIcon,\n        handleUploadFile: this.handleUploadFile,\n        handleSelectIcon: this.handleSelectIcon,\n        handleSubmit: this.handleSubmit,\n        handleSelectTab: this.handleSelectTab,\n        selectedTab: selectedTab,\n        selectedIconUrl: selectedIconUrl,\n        profile: profile,\n        TAB_TYPE: this.TAB_TYPE,\n        customIconUrl: customIconUrl,\n        onClickMobileTooltip: this.onClickMobileTooltip,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 168\n        },\n        __self: this\n      });\n    }\n  }]);\n\n  return Container;\n}(Component);\n\nexport default connect(function (state) {\n  return {\n    userinfo: state.userinfo\n  };\n}, {\n  updateUserInfo: userInfoActions.updateUserInfo\n})(injectIntl(withRouter(Container)));","map":{"version":3,"sources":["/Users/jimmy/Documents/Wizschool/wizlab_web2/src/Page/Mypage/Components/IconSetting/Container.js"],"names":["React","Component","request","userInfoActions","injectIntl","connect","withRouter","Redirect","ImageCompressor","View","PopUp","showPopUp","Container","props","componentDidMount","getUserProfile","userProfile","email","userinfo","then","res","json","catch","e","console","error","profile","setState","selectedIconUrl","icon","customIconUrl","customIcon","JSON","parse","handleUploadIcon","document","getElementById","click","handleUploadFile","event","data","FormData","file","target","files","downsized","append","upload","response","url","handleSelectTab","tab","state","selectedTab","handleSelectIcon","iconUrl","handleSubmit","preventDefault","params","stringify","updateUserInfo","intl","formatMessage","id","history","replace","darkmode","onClickMobileTooltip","tooltip","dismissButton","TAB_TYPE","ICON","title","EDGE","undefined"],"mappings":"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","sourcesContent":["import React, { Component } from \"react\";\nimport * as request from \"../../../../Common/Util/HTTPRequest\";\nimport * as userInfoActions from \"../../../../Common/Store/Reducer/UserInfo\";\nimport { injectIntl } from \"react-intl\";\nimport { connect } from \"react-redux\";\nimport { withRouter, Redirect } from \"react-router-dom\";\nimport { ImageCompressor } from \"../../../../Common/Util/FileCompressor\";\nimport View from \"./View\";\nimport PopUp, { showPopUp } from \"../../../../Common/Component/PopUp\";\n\nclass Container extends Component {\n  constructor(props) {\n    super(props);\n\n    this.TAB_TYPE = {\n      ICON: {\n        title: this.props.intl.formatMessage({\n          id: `ID_MYPAGE_ICONSETTING_TABTAPE_ICON`\n        }),\n        tooltip: this.props.intl.formatMessage({\n          id: `ID_MYPAGE_ICONSETTING_TABTAPE_ICONTOOLTIP`\n        })\n      },\n      EDGE: {\n        title: this.props.intl.formatMessage({\n          id: `ID_MYPAGE_ICONSETTING_TABTAPE_EDGE`\n        }),\n        tooltip: this.props.intl.formatMessage({\n          id: `ID_MYPAGE_ICONSETTING_TABTAPE_EDGETOOLTIP`\n        })\n      }\n    };\n\n    this.state = {\n      selectedTab: this.TAB_TYPE.ICON.title,\n      selectedIconUrl: undefined,\n\n      customIconUrl: null,\n      profile: this.props.userinfo\n    };\n  }\n\n  componentDidMount = () => {\n    this.getUserProfile();\n  };\n\n  getUserProfile = async () => {\n    const profile = await request\n      .userProfile({ email: this.props.userinfo.email })\n      .then(res => res.json())\n      .catch(e => console.error(e));\n\n    this.setState({\n      selectedIconUrl: profile.icon,\n      customIconUrl: profile.customIcon\n        ? JSON.parse(profile.customIcon)[0]\n        : null,\n      profile\n    });\n  };\n\n  handleUploadIcon = () => {\n    document.getElementById(\"uploadInput\").click();\n  };\n\n  handleUploadFile = async event => {\n    let data = new FormData();\n    const file = event.target.files[0];\n    if (!file) return;\n    let downsized = await ImageCompressor(file);\n    data.append(\"file\", downsized);\n    try {\n      const response = await request.upload(data);\n      const json = await response.json();\n\n      this.setState({\n        selectedIconUrl: json.url,\n        customIconUrl: json.url\n      });\n    } catch (e) {\n      console.error(e);\n    }\n  };\n\n  handleSelectTab = tab => {\n    if (tab === this.state.selectedTab) return;\n    this.setState({\n      selectedTab: tab\n    });\n  };\n\n  handleSelectIcon = iconUrl => {\n    if (iconUrl === this.state.selectedIconUrl) return;\n    this.setState({\n      selectedIconUrl: iconUrl\n    });\n  };\n\n  handleSubmit = async e => {\n    e.preventDefault();\n    const { selectedIconUrl, customIconUrl } = this.state;\n    if (!selectedIconUrl) {\n      return;\n    }\n    const params = {\n      email: this.props.userinfo.email,\n      icon: selectedIconUrl\n    };\n    if (customIconUrl) {\n      params[\"customIcon\"] = JSON.stringify([customIconUrl]);\n    }\n\n    try {\n      await request.updateUserInfo(params);\n      this.props.updateUserInfo(params);\n      showPopUp(\n        <PopUp.OneButton\n          title={this.props.intl.formatMessage({\n            id: \"ID_SETTING_ALERT_TITLE_SUCC\"\n          })}\n          subtitle={this.props.intl.formatMessage({\n            id: \"ID_SETTING_ALERT_PROFILE_SUCC\"\n          })}\n          buttonName={this.props.intl.formatMessage({\n            id: \"ID_SETTING_ALERT_CLOSEBTN\"\n          })}\n          buttonAction={() => {\n            this.props.history.replace(\"/mypage\");\n          }}\n        />,\n        { darkmode: true }\n      );\n    } catch (err) {\n      showPopUp(\n        <PopUp.OneButton\n          title={this.props.intl.formatMessage({\n            id: \"ID_SETTING_ALERT_TITLE_FAIL\"\n          })}\n          subtitle={this.props.intl.formatMessage({\n            id: \"ID_SETTING_ALERT_RETRY\"\n          })}\n          buttonName={this.props.intl.formatMessage({\n            id: \"ID_SETTING_ALERT_CLOSEBTN\"\n          })}\n        />,\n        { darkmode: true }\n      );\n    }\n  };\n\n  onClickMobileTooltip = tooltip => {\n    showPopUp(\n      <PopUp.OneButton\n        title={tooltip}\n        buttonNameId=\"ID_MYPAGE_TOOLTIP_TIER_CONFIRM\"\n        intl={this.props.intl}\n      />,\n      { darkmode: true, dismissButton: false }\n    );\n  };\n\n  render() {\n    if (!this.props.userinfo.email) {\n      return <Redirect to=\"/\" />;\n    }\n    const { selectedTab, selectedIconUrl, profile, customIconUrl } = this.state;\n    return (\n      <View\n        handleUploadIcon={this.handleUploadIcon}\n        handleUploadFile={this.handleUploadFile}\n        handleSelectIcon={this.handleSelectIcon}\n        handleSubmit={this.handleSubmit}\n        handleSelectTab={this.handleSelectTab}\n        selectedTab={selectedTab}\n        selectedIconUrl={selectedIconUrl}\n        profile={profile}\n        TAB_TYPE={this.TAB_TYPE}\n        customIconUrl={customIconUrl}\n        onClickMobileTooltip={this.onClickMobileTooltip}\n      />\n    );\n  }\n}\n\nexport default connect(\n  state => ({ userinfo: state.userinfo }),\n  {\n    updateUserInfo: userInfoActions.updateUserInfo\n  }\n)(injectIntl(withRouter(Container)));\n"]},"metadata":{},"sourceType":"module"}