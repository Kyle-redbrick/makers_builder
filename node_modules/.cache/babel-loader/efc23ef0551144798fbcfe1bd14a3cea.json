{"ast":null,"code":"import _toConsumableArray from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";\nimport _regeneratorRuntime from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";\nimport _objectSpread from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread\";\nimport _asyncToGenerator from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _classCallCheck from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";\nimport _inherits from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";\nimport _possibleConstructorReturn from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";\nvar _jsxFileName = \"/Users/jimmy/Documents/Wizschool/wizlab_web2/src/Page/NewsDetail/Container.js\";\n\nfunction _createSuper(Derived) { var hasNativeReflectConstruct = _isNativeReflectConstruct(); return function _createSuperInternal() { var Super = _getPrototypeOf(Derived), result; if (hasNativeReflectConstruct) { var NewTarget = _getPrototypeOf(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return _possibleConstructorReturn(this, result); }; }\n\nfunction _isNativeReflectConstruct() { if (typeof Reflect === \"undefined\" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === \"function\") return true; try { Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {})); return true; } catch (e) { return false; } }\n\nimport React, { Component } from \"react\";\nimport { withRouter } from \"react-router-dom\";\nimport { injectIntl } from \"react-intl\";\nimport { connect } from \"react-redux\";\nimport View from \"./View\";\nimport * as request from \"../../Common/Util/HTTPRequest\";\n\nvar Container = /*#__PURE__*/function (_Component) {\n  _inherits(Container, _Component);\n\n  var _super = _createSuper(Container);\n\n  function Container(props) {\n    var _this;\n\n    _classCallCheck(this, Container);\n\n    _this = _super.call(this, props);\n\n    _this.componentDidMount = function () {\n      _this.fetchNewsItem();\n    };\n\n    _this.componentDidUpdate = function (prevProps) {\n      if (_this.props.match.params.id !== prevProps.match.params.id) {\n        _this.fetchNewsItem();\n      }\n    };\n\n    _this.fetchNewsItem = /*#__PURE__*/_asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee() {\n      var res, news, parentsComments;\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              _context.next = 2;\n              return request.getNewsDetail({\n                newsId: _this.props.match.params.id\n              });\n\n            case 2:\n              res = _context.sent;\n              _context.next = 5;\n              return res.json();\n\n            case 5:\n              news = _context.sent;\n\n              if (news) {\n                /* reconstruct for comment ui */\n                parentsComments = news.currentPageInfo.comments.reduce(function (pre, value) {\n                  if (!value.parentCommentId) {\n                    value.childComments = [];\n                    pre.push(value);\n                  }\n\n                  return pre;\n                }, []);\n                news.currentPageInfo.comments.forEach(function (item) {\n                  if (item.parentCommentId) {\n                    var index = parentsComments.findIndex(function (i) {\n                      return i.id === item.parentCommentId;\n                    });\n\n                    if (parentsComments[index]) {\n                      parentsComments[index].childComments.push(item);\n                    }\n                  }\n                });\n\n                _this.setState(_objectSpread({}, news.currentPageInfo, {\n                  comments: parentsComments,\n                  previousNews: news.previousNews,\n                  nextNews: news.nextNews\n                }));\n              }\n\n            case 7:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee);\n    }));\n\n    _this.onClickHome = function () {\n      _this.props.history.push(\"/news\");\n    };\n\n    _this.onClickPrevNews = function () {\n      var previousNews = _this.state.previousNews;\n\n      if (!previousNews) {\n        return;\n      }\n\n      _this.props.history.push(\"/news/detail/\".concat(previousNews.id));\n    };\n\n    _this.onClickNextNews = function () {\n      var nextNews = _this.state.nextNews;\n\n      if (!nextNews) {\n        return;\n      }\n\n      _this.props.history.push(\"/news/detail/\".concat(nextNews.id));\n    };\n\n    _this.onAddNewComment = function (comment) {\n      _this.setState(function (prevState) {\n        return {\n          comments: [].concat(_objectSpread({}, comment, {\n            childComments: []\n          }), prevState.comments)\n        };\n      });\n    };\n\n    _this.onClickNewReply = function (commentId) {\n      var comments = _toConsumableArray(_this.state.comments).map(function (comment) {\n        return _objectSpread({}, comment, {\n          showNewReply: comment.showNewReply ? false : comment.id === commentId\n        });\n      });\n\n      _this.setState({\n        comments: comments\n      });\n    };\n\n    _this.state = {\n      topic: undefined,\n      title: undefined,\n      createdAt: undefined,\n      id: undefined,\n      description: undefined,\n      comments: [],\n      previousNews: undefined,\n      nextNews: undefined\n    };\n    return _this;\n  }\n\n  _createClass(Container, [{\n    key: \"render\",\n    value: function render() {\n      var _this$state = this.state,\n          topic = _this$state.topic,\n          title = _this$state.title,\n          createdAt = _this$state.createdAt,\n          description = _this$state.description,\n          comments = _this$state.comments,\n          id = _this$state.id,\n          previousNews = _this$state.previousNews,\n          nextNews = _this$state.nextNews;\n      var onClickHome = this.onClickHome,\n          onClickPrevNews = this.onClickPrevNews,\n          onClickNextNews = this.onClickNextNews,\n          onClickNewReply = this.onClickNewReply,\n          onAddNewComment = this.onAddNewComment;\n      return /*#__PURE__*/React.createElement(View, {\n        onClickHome: onClickHome,\n        onClickPrevNews: onClickPrevNews,\n        onClickNextNews: onClickNextNews,\n        topic: topic,\n        title: title,\n        createdAt: createdAt,\n        description: description,\n        comments: comments,\n        id: id,\n        onClickNewReply: onClickNewReply,\n        previousNews: previousNews,\n        nextNews: nextNews,\n        email: this.props.email,\n        onAddNewComment: onAddNewComment,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 117,\n          columnNumber: 7\n        }\n      });\n    }\n  }]);\n\n  return Container;\n}(Component);\n\nexport default connect(function (state) {\n  return {\n    email: state.userinfo.email\n  };\n}, {})(withRouter(injectIntl(Container)));","map":{"version":3,"sources":["/Users/jimmy/Documents/Wizschool/wizlab_web2/src/Page/NewsDetail/Container.js"],"names":["React","Component","withRouter","injectIntl","connect","View","request","Container","props","componentDidMount","fetchNewsItem","componentDidUpdate","prevProps","match","params","id","getNewsDetail","newsId","res","json","news","parentsComments","currentPageInfo","comments","reduce","pre","value","parentCommentId","childComments","push","forEach","item","index","findIndex","i","setState","previousNews","nextNews","onClickHome","history","onClickPrevNews","state","onClickNextNews","onAddNewComment","comment","prevState","concat","onClickNewReply","commentId","map","showNewReply","topic","undefined","title","createdAt","description","email","userinfo"],"mappings":";;;;;;;;;;;;;;;AAAA,OAAOA,KAAP,IAAgBC,SAAhB,QAAiC,OAAjC;AACA,SAASC,UAAT,QAA2B,kBAA3B;AACA,SAASC,UAAT,QAA2B,YAA3B;AACA,SAASC,OAAT,QAAwB,aAAxB;AACA,OAAOC,IAAP,MAAiB,QAAjB;AACA,OAAO,KAAKC,OAAZ,MAAyB,+BAAzB;;IAEMC,S;;;;;AACJ,qBAAYC,KAAZ,EAAmB;AAAA;;AAAA;;AACjB,8BAAMA,KAAN;;AADiB,UAanBC,iBAbmB,GAaC,YAAM;AACxB,YAAKC,aAAL;AACD,KAfkB;;AAAA,UAgBnBC,kBAhBmB,GAgBE,UAAAC,SAAS,EAAI;AAChC,UAAI,MAAKJ,KAAL,CAAWK,KAAX,CAAiBC,MAAjB,CAAwBC,EAAxB,KAA+BH,SAAS,CAACC,KAAV,CAAgBC,MAAhB,CAAuBC,EAA1D,EAA8D;AAC5D,cAAKL,aAAL;AACD;AACF,KApBkB;;AAAA,UAqBnBA,aArBmB,yEAqBH;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,qBACEJ,OAAO,CAACU,aAAR,CAAsB;AACpCC,gBAAAA,MAAM,EAAE,MAAKT,KAAL,CAAWK,KAAX,CAAiBC,MAAjB,CAAwBC;AADI,eAAtB,CADF;;AAAA;AACVG,cAAAA,GADU;AAAA;AAAA,qBAIGA,GAAG,CAACC,IAAJ,EAJH;;AAAA;AAIVC,cAAAA,IAJU;;AAKd,kBAAIA,IAAJ,EAAU;AACR;AACIC,gBAAAA,eAFI,GAEcD,IAAI,CAACE,eAAL,CAAqBC,QAArB,CAA8BC,MAA9B,CACpB,UAACC,GAAD,EAAMC,KAAN,EAAgB;AACd,sBAAI,CAACA,KAAK,CAACC,eAAX,EAA4B;AAC1BD,oBAAAA,KAAK,CAACE,aAAN,GAAsB,EAAtB;AACAH,oBAAAA,GAAG,CAACI,IAAJ,CAASH,KAAT;AACD;;AACD,yBAAOD,GAAP;AACD,iBAPmB,EAQpB,EARoB,CAFd;AAaRL,gBAAAA,IAAI,CAACE,eAAL,CAAqBC,QAArB,CAA8BO,OAA9B,CAAsC,UAAAC,IAAI,EAAI;AAC5C,sBAAIA,IAAI,CAACJ,eAAT,EAA0B;AACxB,wBAAIK,KAAK,GAAGX,eAAe,CAACY,SAAhB,CACV,UAAAC,CAAC;AAAA,6BAAIA,CAAC,CAACnB,EAAF,KAASgB,IAAI,CAACJ,eAAlB;AAAA,qBADS,CAAZ;;AAGA,wBAAGN,eAAe,CAACW,KAAD,CAAlB,EAA0B;AACxBX,sBAAAA,eAAe,CAACW,KAAD,CAAf,CAAuBJ,aAAvB,CAAqCC,IAArC,CAA0CE,IAA1C;AACD;AACF;AACF,iBATD;;AAUA,sBAAKI,QAAL,mBACKf,IAAI,CAACE,eADV;AAEEC,kBAAAA,QAAQ,EAAEF,eAFZ;AAGEe,kBAAAA,YAAY,EAAEhB,IAAI,CAACgB,YAHrB;AAIEC,kBAAAA,QAAQ,EAAEjB,IAAI,CAACiB;AAJjB;AAMD;;AAlCa;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KArBG;;AAAA,UA0DnBC,WA1DmB,GA0DL,YAAM;AAClB,YAAK9B,KAAL,CAAW+B,OAAX,CAAmBV,IAAnB,CAAwB,OAAxB;AACD,KA5DkB;;AAAA,UA6DnBW,eA7DmB,GA6DD,YAAM;AAAA,UACdJ,YADc,GACG,MAAKK,KADR,CACdL,YADc;;AAEtB,UAAI,CAACA,YAAL,EAAmB;AACjB;AACD;;AACD,YAAK5B,KAAL,CAAW+B,OAAX,CAAmBV,IAAnB,wBAAwCO,YAAY,CAACrB,EAArD;AACD,KAnEkB;;AAAA,UAoEnB2B,eApEmB,GAoED,YAAM;AAAA,UACdL,QADc,GACD,MAAKI,KADJ,CACdJ,QADc;;AAEtB,UAAI,CAACA,QAAL,EAAe;AACb;AACD;;AACD,YAAK7B,KAAL,CAAW+B,OAAX,CAAmBV,IAAnB,wBAAwCQ,QAAQ,CAACtB,EAAjD;AACD,KA1EkB;;AAAA,UA6EnB4B,eA7EmB,GA6ED,UAAAC,OAAO,EAAI;AAC3B,YAAKT,QAAL,CAAc,UAAAU,SAAS;AAAA,eAAK;AAC1BtB,UAAAA,QAAQ,EAAE,GAAGuB,MAAH,mBAAeF,OAAf;AAAwBhB,YAAAA,aAAa,EAAE;AAAvC,cAA6CiB,SAAS,CAACtB,QAAvD;AADgB,SAAL;AAAA,OAAvB;AAGD,KAjFkB;;AAAA,UAkFnBwB,eAlFmB,GAkFD,UAAAC,SAAS,EAAI;AAC7B,UAAMzB,QAAQ,GAAG,mBAAI,MAAKkB,KAAL,CAAWlB,QAAf,EAAyB0B,GAAzB,CAA6B,UAAAL,OAAO;AAAA,iCAChDA,OADgD;AAEnDM,UAAAA,YAAY,EAAEN,OAAO,CAACM,YAAR,GAAuB,KAAvB,GAA+BN,OAAO,CAAC7B,EAAR,KAAeiC;AAFT;AAAA,OAApC,CAAjB;;AAIA,YAAKb,QAAL,CAAc;AAAEZ,QAAAA,QAAQ,EAARA;AAAF,OAAd;AACD,KAxFkB;;AAEjB,UAAKkB,KAAL,GAAa;AACXU,MAAAA,KAAK,EAAEC,SADI;AAEXC,MAAAA,KAAK,EAAED,SAFI;AAGXE,MAAAA,SAAS,EAAEF,SAHA;AAIXrC,MAAAA,EAAE,EAAEqC,SAJO;AAKXG,MAAAA,WAAW,EAAEH,SALF;AAMX7B,MAAAA,QAAQ,EAAE,EANC;AAOXa,MAAAA,YAAY,EAAEgB,SAPH;AAQXf,MAAAA,QAAQ,EAAEe;AARC,KAAb;AAFiB;AAYlB;;;;WA6ED,kBAAS;AAAA,wBAUH,KAAKX,KAVF;AAAA,UAELU,KAFK,eAELA,KAFK;AAAA,UAGLE,KAHK,eAGLA,KAHK;AAAA,UAILC,SAJK,eAILA,SAJK;AAAA,UAKLC,WALK,eAKLA,WALK;AAAA,UAMLhC,QANK,eAMLA,QANK;AAAA,UAOLR,EAPK,eAOLA,EAPK;AAAA,UAQLqB,YARK,eAQLA,YARK;AAAA,UASLC,QATK,eASLA,QATK;AAAA,UAYLC,WAZK,GAiBH,IAjBG,CAYLA,WAZK;AAAA,UAaLE,eAbK,GAiBH,IAjBG,CAaLA,eAbK;AAAA,UAcLE,eAdK,GAiBH,IAjBG,CAcLA,eAdK;AAAA,UAeLK,eAfK,GAiBH,IAjBG,CAeLA,eAfK;AAAA,UAgBLJ,eAhBK,GAiBH,IAjBG,CAgBLA,eAhBK;AAkBP,0BACE,oBAAC,IAAD;AACE,QAAA,WAAW,EAAEL,WADf;AAEE,QAAA,eAAe,EAAEE,eAFnB;AAGE,QAAA,eAAe,EAAEE,eAHnB;AAIE,QAAA,KAAK,EAAES,KAJT;AAKE,QAAA,KAAK,EAAEE,KALT;AAME,QAAA,SAAS,EAAEC,SANb;AAOE,QAAA,WAAW,EAAEC,WAPf;AAQE,QAAA,QAAQ,EAAEhC,QARZ;AASE,QAAA,EAAE,EAAER,EATN;AAUE,QAAA,eAAe,EAAEgC,eAVnB;AAWE,QAAA,YAAY,EAAEX,YAXhB;AAYE,QAAA,QAAQ,EAAEC,QAZZ;AAaE,QAAA,KAAK,EAAE,KAAK7B,KAAL,CAAWgD,KAbpB;AAcE,QAAA,eAAe,EAAEb,eAdnB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,QADF;AAkBD;;;;EA9HqB1C,S;;AAgIxB,eAAeG,OAAO,CACpB,UAAAqC,KAAK;AAAA,SAAK;AAAEe,IAAAA,KAAK,EAAEf,KAAK,CAACgB,QAAN,CAAeD;AAAxB,GAAL;AAAA,CADe,EAEpB,EAFoB,CAAP,CAGbtD,UAAU,CAACC,UAAU,CAACI,SAAD,CAAX,CAHG,CAAf","sourcesContent":["import React, { Component } from \"react\";\nimport { withRouter } from \"react-router-dom\";\nimport { injectIntl } from \"react-intl\";\nimport { connect } from \"react-redux\";\nimport View from \"./View\";\nimport * as request from \"../../Common/Util/HTTPRequest\";\n\nclass Container extends Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      topic: undefined,\n      title: undefined,\n      createdAt: undefined,\n      id: undefined,\n      description: undefined,\n      comments: [],\n      previousNews: undefined,\n      nextNews: undefined\n    };\n  }\n  componentDidMount = () => {\n    this.fetchNewsItem();\n  };\n  componentDidUpdate = prevProps => {\n    if (this.props.match.params.id !== prevProps.match.params.id) {\n      this.fetchNewsItem();\n    }\n  };\n  fetchNewsItem = async () => {\n    let res = await request.getNewsDetail({\n      newsId: this.props.match.params.id\n    });\n    let news = await res.json();\n    if (news) {\n      /* reconstruct for comment ui */\n      let parentsComments = news.currentPageInfo.comments.reduce(\n        (pre, value) => {\n          if (!value.parentCommentId) {\n            value.childComments = [];\n            pre.push(value);\n          }\n          return pre;\n        },\n        []\n      );\n\n      news.currentPageInfo.comments.forEach(item => {\n        if (item.parentCommentId) {\n          let index = parentsComments.findIndex(\n            i => i.id === item.parentCommentId\n          );\n          if(parentsComments[index]){\n            parentsComments[index].childComments.push(item);\n          }\n        }\n      });\n      this.setState({\n        ...news.currentPageInfo,\n        comments: parentsComments,\n        previousNews: news.previousNews,\n        nextNews: news.nextNews\n      });\n    }\n  };\n\n  onClickHome = () => {\n    this.props.history.push(\"/news\");\n  };\n  onClickPrevNews = () => {\n    const { previousNews } = this.state;\n    if (!previousNews) {\n      return;\n    }\n    this.props.history.push(`/news/detail/${previousNews.id}`);\n  };\n  onClickNextNews = () => {\n    const { nextNews } = this.state;\n    if (!nextNews) {\n      return;\n    }\n    this.props.history.push(`/news/detail/${nextNews.id}`);\n  };\n\n  // comment\n  onAddNewComment = comment => {\n    this.setState(prevState => ({\n      comments: [].concat({ ...comment, childComments: [] }, prevState.comments)\n    }));\n  };\n  onClickNewReply = commentId => {\n    const comments = [...this.state.comments].map(comment => ({\n      ...comment,\n      showNewReply: comment.showNewReply ? false : comment.id === commentId\n    }));\n    this.setState({ comments });\n  };\n  render() {\n    const {\n      topic,\n      title,\n      createdAt,\n      description,\n      comments,\n      id,\n      previousNews,\n      nextNews\n    } = this.state;\n    const {\n      onClickHome,\n      onClickPrevNews,\n      onClickNextNews,\n      onClickNewReply,\n      onAddNewComment\n    } = this;\n    return (\n      <View\n        onClickHome={onClickHome}\n        onClickPrevNews={onClickPrevNews}\n        onClickNextNews={onClickNextNews}\n        topic={topic}\n        title={title}\n        createdAt={createdAt}\n        description={description}\n        comments={comments}\n        id={id}\n        onClickNewReply={onClickNewReply}\n        previousNews={previousNews}\n        nextNews={nextNews}\n        email={this.props.email}\n        onAddNewComment={onAddNewComment}\n      />\n    );\n  }\n}\nexport default connect(\n  state => ({ email: state.userinfo.email }),\n  {}\n)(withRouter(injectIntl(Container)));\n"]},"metadata":{},"sourceType":"module"}