{"ast":null,"code":"import _toConsumableArray from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";\nimport _classCallCheck from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";\nimport _assertThisInitialized from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/assertThisInitialized\";\nimport _inherits from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";\nimport _possibleConstructorReturn from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";\nvar _jsxFileName = \"/Users/jimmy/Documents/Wizschool/wizlab_web2/src/Page/Social/ArticleWrite/Container.js\";\n\nfunction _createSuper(Derived) { var hasNativeReflectConstruct = _isNativeReflectConstruct(); return function _createSuperInternal() { var Super = _getPrototypeOf(Derived), result; if (hasNativeReflectConstruct) { var NewTarget = _getPrototypeOf(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return _possibleConstructorReturn(this, result); }; }\n\nfunction _isNativeReflectConstruct() { if (typeof Reflect === \"undefined\" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === \"function\") return true; try { Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {})); return true; } catch (e) { return false; } }\n\nimport React, { Component } from \"react\";\nimport { connect } from \"react-redux\";\nimport { injectIntl } from \"react-intl\";\nimport { withRouter, Redirect } from \"react-router-dom\";\nimport * as request from \"../../../Common/Util/HTTPRequest\";\nimport PopUp, { showPopUp } from \"../../../Common/Component/PopUp\";\nimport View from \"./View\";\nimport { spamType } from \"../../../Common/Util/Constant\"; // import { showBingoPopup } from \"../../../Common/Component/PopUp/BingoPopup\";\n// import * as TrackingUtil from \"../../../Common/Util/TrackingUtil\";\n\nvar Container = /*#__PURE__*/function (_Component) {\n  _inherits(Container, _Component);\n\n  var _super = _createSuper(Container);\n\n  function Container(props) {\n    var _this;\n\n    _classCallCheck(this, Container);\n\n    _this = _super.call(this, props);\n\n    _this.setDraftEditorRef = function (draftEditor) {\n      if (draftEditor) _this.draftEditor = draftEditor;\n    };\n\n    _this.onClickFile = function () {\n      if (_this.draftEditor) _this.draftEditor.onClickFile();\n    };\n\n    _this.onClickGame = function () {\n      if (_this.draftEditor) _this.draftEditor.onClickGame();\n    };\n\n    _this.onClickCode = function () {\n      if (_this.draftEditor) _this.draftEditor.onClickCode();\n    };\n\n    _this.getArticle = function (id) {\n      request.getSocialArticle(id).then(function (res) {\n        return res.json();\n      }).then(function (article) {\n        var contents = JSON.parse(article.contents);\n        var tags = article.articleTags.map(function (articleTag) {\n          return articleTag.tag.name;\n        });\n        var questPoint = article.questPoint;\n        var questActive = !!article.questPoint;\n\n        _this.draftEditor.setContents(contents);\n\n        _this.setState({\n          title: article.title,\n          tags: tags,\n          questActive: questActive,\n          questPoint: questPoint\n        });\n      });\n    };\n\n    _this.addArticle = function () {\n      var formatMessage = _this.props.intl.formatMessage;\n\n      var contents = _this.draftEditor.getContents();\n\n      if ((_this.state.title + _this.draftEditor.getText()).length > 1000) {\n        showPopUp( /*#__PURE__*/React.createElement(PopUp.OneButton, {\n          title: formatMessage({\n            id: \"ID_SOCIAL_WARNNING\"\n          }),\n          buttonName: formatMessage({\n            id: \"ID_BUILDER_ALERT_CONFIRMBTN\"\n          }),\n          __self: _assertThisInitialized(_this),\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 68,\n            columnNumber: 9\n          }\n        }), {\n          darkmode: true,\n          dismissButton: false\n        });\n        return;\n      }\n\n      if (contents) {\n        showPopUp( /*#__PURE__*/React.createElement(PopUp.TwoButton, {\n          title: formatMessage({\n            id: \"ID_SOCIAL_WRITE_ADD_TITLE\"\n          }),\n          cancelButtonName: formatMessage({\n            id: \"ID_SOCIAL_WRITE_ADD_CANCEL\"\n          }),\n          confirmButtonName: formatMessage({\n            id: \"ID_SOCIAL_WRITE_ADD_CONFIRM\"\n          }),\n          confirmAction: function confirmAction() {\n            var _this$state = _this.state,\n                _this$state$title = _this$state.title,\n                title = _this$state$title === void 0 ? \" \" : _this$state$title,\n                tags = _this$state.tags,\n                questActive = _this$state.questActive,\n                questPoint = _this$state.questPoint;\n            request.addSocialArticle({\n              email: _this.props.userinfo.email,\n              title: title,\n              contents: JSON.stringify(contents),\n              text: title + _this.draftEditor.getText(),\n              tags: tags,\n              questPoint: questActive ? questPoint : 0\n            }).then(function (res) {\n              return res.json();\n            }).then(function (json) {\n              // if (json.bingoType) {\n              //   showBingoPopup(this.props.userinfo.email, json.bingoType, {\n              //     cancelAction: () => {\n              //       window.scrollTo(0, 0);\n              //       this.props.history.replace(`/social`);\n              //     },\n              //     confirmAction: () => {\n              //       this.props.history.replace(`/event/4`);\n              //     }\n              //   });\n              // } else {\n              if (json.success) {\n                window.scrollTo(0, 0);\n\n                _this.props.history.replace(\"/social\");\n              } else {\n                if (json.spam) {\n                  var _title;\n\n                  switch (json.spam) {\n                    case spamType.SPAM_BAD_WORD:\n                      _title = \"ID_SPAM_POPUP_TITLE_BAD_WORD\";\n                      break;\n\n                    case spamType.SPAM_DUPLICATION:\n                      _title = \"ID_SPAM_POPUP_TITLE_DUPLICATION\";\n                      break;\n\n                    case spamType.SPAM_TIME:\n                      _title = \"ID_SPAM_POPUP_TITLE_TIME\";\n                      break;\n\n                    default:\n                      break;\n                  }\n\n                  showPopUp( /*#__PURE__*/React.createElement(PopUp.OneButton, {\n                    title: formatMessage({\n                      id: _title\n                    }),\n                    buttonName: formatMessage({\n                      id: \"ID_SPAM_POPUP_CONFIRM\"\n                    }),\n                    __self: _assertThisInitialized(_this),\n                    __source: {\n                      fileName: _jsxFileName,\n                      lineNumber: 132,\n                      columnNumber: 23\n                    }\n                  }), {\n                    darkmode: true,\n                    dismissButton: false,\n                    dismissOverlay: true\n                  });\n                }\n              } // }\n\n            });\n          },\n          __self: _assertThisInitialized(_this),\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 81,\n            columnNumber: 9\n          }\n        }), {\n          darkmode: true,\n          dismissButton: false\n        });\n      } else {\n        showPopUp( /*#__PURE__*/React.createElement(PopUp.OneButton, {\n          title: formatMessage({\n            id: \"ID_SOCIAL_WRITE_EMPTY_TITLE\"\n          }),\n          buttonName: formatMessage({\n            id: \"ID_SOCIAL_WRITE_EMPTY_CONFIRM\"\n          }),\n          __self: _assertThisInitialized(_this),\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 154,\n            columnNumber: 9\n          }\n        }), {\n          darkmode: true,\n          dismissButton: false,\n          dismissOverlay: true\n        });\n      }\n    };\n\n    _this.updateArticle = function () {\n      var formatMessage = _this.props.intl.formatMessage;\n\n      var contents = _this.draftEditor.getContents();\n\n      if (contents) {\n        showPopUp( /*#__PURE__*/React.createElement(PopUp.TwoButton, {\n          title: formatMessage({\n            id: \"ID_SOCIAL_WRITE_UPDATE_TITLE\"\n          }),\n          cancelButtonName: formatMessage({\n            id: \"ID_SOCIAL_WRITE_UPDATE_CANCEL\"\n          }),\n          confirmButtonName: formatMessage({\n            id: \"ID_SOCIAL_WRITE_UPDATE_CONFIRM\"\n          }),\n          confirmAction: function confirmAction() {\n            var _this$state2 = _this.state,\n                _this$state2$title = _this$state2.title,\n                title = _this$state2$title === void 0 ? \" \" : _this$state2$title,\n                tags = _this$state2.tags;\n            request.updateSocialArticle({\n              id: _this.articleId,\n              title: title,\n              contents: JSON.stringify(contents),\n              text: title + _this.draftEditor.getText(),\n              tags: tags\n            }).then(function (res) {\n              return res.json();\n            }).then(function (json) {\n              if (json.success) {\n                window.scrollTo(0, 0);\n\n                _this.props.history.push(\"/social\");\n              }\n            });\n          },\n          __self: _assertThisInitialized(_this),\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 167,\n            columnNumber: 9\n          }\n        }), {\n          darkmode: true,\n          dismissButton: false\n        });\n      } else {\n        showPopUp( /*#__PURE__*/React.createElement(PopUp.OneButton, {\n          title: formatMessage({\n            id: \"ID_SOCIAL_WRITE_EMPTY_TITLE\"\n          }),\n          buttonName: formatMessage({\n            id: \"ID_SOCIAL_WRITE_EMPTY_CONFIRM\"\n          }),\n          __self: _assertThisInitialized(_this),\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 198,\n            columnNumber: 9\n          }\n        }), {\n          darkmode: true,\n          dismissButton: false,\n          dismissOverlay: true\n        });\n      }\n    };\n\n    _this.onChangeTitle = function (e) {\n      var title = e.target.value;\n\n      _this.setState({\n        title: title\n      });\n    };\n\n    _this.onClickQuest = function () {\n      var questActive = !_this.state.questActive;\n\n      _this.setState({\n        questActive: questActive,\n        questPoint: 1\n      });\n    };\n\n    _this.onChangeQuestPoint = function (e) {\n      var questPoint = e.target.value;\n\n      _this.setState({\n        questPoint: questPoint\n      });\n    };\n\n    _this.onClickSubmit = function () {\n      var id = _this.articleId;\n\n      if (id) {\n        _this.updateArticle();\n      } else {\n        _this.addArticle();\n      }\n    };\n\n    _this.onAddTag = function (tag) {\n      var tags = _this.state.tags;\n      var slicedTag = tag.slice(0, 10);\n\n      if (tags.indexOf(slicedTag) < 0) {\n        _this.setState({\n          tags: [].concat(tags, slicedTag)\n        });\n      }\n    };\n\n    _this.onDeleteTag = function (index) {\n      var tags = _toConsumableArray(_this.state.tags);\n\n      tags.splice(index, 1);\n\n      _this.setState({\n        tags: tags\n      });\n    };\n\n    _this.articleId = props.match.params.id;\n    _this.state = {\n      title: \"\",\n      tags: [],\n      questActive: false,\n      questPoint: 1\n    };\n    return _this;\n  }\n\n  _createClass(Container, [{\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      // TrackingUtil.sendPageEvent(\"/social/write\", this.props.userinfo.email);\n      var articleId = this.articleId;\n      if (articleId) this.getArticle(articleId);\n    } // draft\n\n  }, {\n    key: \"render\",\n    value: function render() {\n      if (!this.props.userinfo.email) {\n        return /*#__PURE__*/React.createElement(Redirect, {\n          to: \"/social\",\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 243,\n            columnNumber: 14\n          }\n        });\n      }\n\n      var _this$props = this.props,\n          intl = _this$props.intl,\n          userinfo = _this$props.userinfo;\n      var availablePoint = userinfo.availablePoint;\n      var _this$state3 = this.state,\n          title = _this$state3.title,\n          tags = _this$state3.tags,\n          questActive = _this$state3.questActive,\n          questPoint = _this$state3.questPoint;\n      var onChangeTitle = this.onChangeTitle,\n          onClickFile = this.onClickFile,\n          onClickGame = this.onClickGame,\n          onClickCode = this.onClickCode,\n          setDraftEditorRef = this.setDraftEditorRef,\n          onClickQuest = this.onClickQuest,\n          onChangeQuestPoint = this.onChangeQuestPoint,\n          onClickSubmit = this.onClickSubmit,\n          onAddTag = this.onAddTag,\n          onDeleteTag = this.onDeleteTag,\n          articleId = this.articleId;\n      return /*#__PURE__*/React.createElement(View, {\n        intl: intl,\n        title: title,\n        tags: tags,\n        questActive: questActive,\n        questPoint: questPoint,\n        userPoint: availablePoint,\n        onChangeTitle: onChangeTitle,\n        onClickFile: onClickFile,\n        onClickGame: onClickGame,\n        onClickCode: onClickCode,\n        setDraftEditorRef: setDraftEditorRef,\n        onClickQuest: onClickQuest,\n        onChangeQuestPoint: onChangeQuestPoint,\n        onClickSubmit: onClickSubmit,\n        onAddTag: onAddTag,\n        onDeleteTag: onDeleteTag,\n        articleId: articleId,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 264,\n          columnNumber: 7\n        }\n      });\n    }\n  }]);\n\n  return Container;\n}(Component);\n\nexport default connect(function (state) {\n  return {\n    userinfo: state.userinfo\n  };\n})(withRouter(injectIntl(Container)));","map":{"version":3,"sources":["/Users/jimmy/Documents/Wizschool/wizlab_web2/src/Page/Social/ArticleWrite/Container.js"],"names":["React","Component","connect","injectIntl","withRouter","Redirect","request","PopUp","showPopUp","View","spamType","Container","props","setDraftEditorRef","draftEditor","onClickFile","onClickGame","onClickCode","getArticle","id","getSocialArticle","then","res","json","article","contents","JSON","parse","tags","articleTags","map","articleTag","tag","name","questPoint","questActive","setContents","setState","title","addArticle","formatMessage","intl","getContents","state","getText","length","darkmode","dismissButton","addSocialArticle","email","userinfo","stringify","text","success","window","scrollTo","history","replace","spam","SPAM_BAD_WORD","SPAM_DUPLICATION","SPAM_TIME","dismissOverlay","updateArticle","updateSocialArticle","articleId","push","onChangeTitle","e","target","value","onClickQuest","onChangeQuestPoint","onClickSubmit","onAddTag","slicedTag","slice","indexOf","concat","onDeleteTag","index","splice","match","params","availablePoint"],"mappings":"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","sourcesContent":["import React, { Component } from \"react\";\nimport { connect } from \"react-redux\";\nimport { injectIntl } from \"react-intl\";\nimport { withRouter, Redirect } from \"react-router-dom\";\nimport * as request from \"../../../Common/Util/HTTPRequest\";\nimport PopUp, { showPopUp } from \"../../../Common/Component/PopUp\";\nimport View from \"./View\";\nimport { spamType } from \"../../../Common/Util/Constant\";\n// import { showBingoPopup } from \"../../../Common/Component/PopUp/BingoPopup\";\n// import * as TrackingUtil from \"../../../Common/Util/TrackingUtil\";\n\nclass Container extends Component {\n  constructor(props) {\n    super(props);\n    this.articleId = props.match.params.id;\n    this.state = {\n      title: \"\",\n      tags: [],\n      questActive: false,\n      questPoint: 1\n    };\n  }\n  componentDidMount() {\n    // TrackingUtil.sendPageEvent(\"/social/write\", this.props.userinfo.email);\n    const { articleId } = this;\n    if (articleId) this.getArticle(articleId);\n  }\n\n  // draft\n  setDraftEditorRef = draftEditor => {\n    if (draftEditor) this.draftEditor = draftEditor;\n  };\n  onClickFile = () => {\n    if (this.draftEditor) this.draftEditor.onClickFile();\n  };\n  onClickGame = () => {\n    if (this.draftEditor) this.draftEditor.onClickGame();\n  };\n  onClickCode = () => {\n    if (this.draftEditor) this.draftEditor.onClickCode();\n  };\n\n  // article\n  getArticle = id => {\n    request\n      .getSocialArticle(id)\n      .then(res => res.json())\n      .then(article => {\n        const contents = JSON.parse(article.contents);\n        const tags = article.articleTags.map(articleTag => articleTag.tag.name);\n        const questPoint = article.questPoint;\n        const questActive = !!article.questPoint;\n        this.draftEditor.setContents(contents);\n        this.setState({\n          title: article.title,\n          tags,\n          questActive,\n          questPoint\n        });\n      });\n  };\n  addArticle = () => {\n    const { formatMessage } = this.props.intl;\n    const contents = this.draftEditor.getContents();\n\n    if ((this.state.title + this.draftEditor.getText()).length > 1000) {\n      showPopUp(\n        <PopUp.OneButton\n          title={formatMessage({ id: \"ID_SOCIAL_WARNNING\" })}\n          buttonName={formatMessage({\n            id: \"ID_BUILDER_ALERT_CONFIRMBTN\"\n          })}\n        />,\n        { darkmode: true, dismissButton: false }\n      );\n\n      return;\n    }\n    if (contents) {\n      showPopUp(\n        <PopUp.TwoButton\n          title={formatMessage({ id: \"ID_SOCIAL_WRITE_ADD_TITLE\" })}\n          cancelButtonName={formatMessage({ id: \"ID_SOCIAL_WRITE_ADD_CANCEL\" })}\n          confirmButtonName={formatMessage({\n            id: \"ID_SOCIAL_WRITE_ADD_CONFIRM\"\n          })}\n          confirmAction={() => {\n            const { title = \" \", tags, questActive, questPoint } = this.state;\n            request\n              .addSocialArticle({\n                email: this.props.userinfo.email,\n                title,\n                contents: JSON.stringify(contents),\n                text: title + this.draftEditor.getText(),\n                tags,\n                questPoint: questActive ? questPoint : 0\n              })\n              .then(res => res.json())\n              .then(json => {\n                // if (json.bingoType) {\n                //   showBingoPopup(this.props.userinfo.email, json.bingoType, {\n                //     cancelAction: () => {\n                //       window.scrollTo(0, 0);\n                //       this.props.history.replace(`/social`);\n                //     },\n                //     confirmAction: () => {\n                //       this.props.history.replace(`/event/4`);\n                //     }\n                //   });\n                // } else {\n                if (json.success) {\n                  window.scrollTo(0, 0);\n                  this.props.history.replace(`/social`);\n                } else {\n                  if (json.spam) {\n                    let title;\n                    switch (json.spam) {\n                      case spamType.SPAM_BAD_WORD:\n                        title = \"ID_SPAM_POPUP_TITLE_BAD_WORD\";\n                        break;\n                      case spamType.SPAM_DUPLICATION:\n                        title = \"ID_SPAM_POPUP_TITLE_DUPLICATION\";\n                        break;\n                      case spamType.SPAM_TIME:\n                        title = \"ID_SPAM_POPUP_TITLE_TIME\";\n                        break;\n                      default:\n                        break;\n                    }\n\n                    showPopUp(\n                      <PopUp.OneButton\n                        title={formatMessage({ id: title })}\n                        buttonName={formatMessage({\n                          id: \"ID_SPAM_POPUP_CONFIRM\"\n                        })}\n                      />,\n                      {\n                        darkmode: true,\n                        dismissButton: false,\n                        dismissOverlay: true\n                      }\n                    );\n                  }\n                }\n                // }\n              });\n          }}\n        />,\n        { darkmode: true, dismissButton: false }\n      );\n    } else {\n      showPopUp(\n        <PopUp.OneButton\n          title={formatMessage({ id: \"ID_SOCIAL_WRITE_EMPTY_TITLE\" })}\n          buttonName={formatMessage({ id: \"ID_SOCIAL_WRITE_EMPTY_CONFIRM\" })}\n        />,\n        { darkmode: true, dismissButton: false, dismissOverlay: true }\n      );\n    }\n  };\n  updateArticle = () => {\n    const { formatMessage } = this.props.intl;\n    const contents = this.draftEditor.getContents();\n    if (contents) {\n      showPopUp(\n        <PopUp.TwoButton\n          title={formatMessage({ id: \"ID_SOCIAL_WRITE_UPDATE_TITLE\" })}\n          cancelButtonName={formatMessage({\n            id: \"ID_SOCIAL_WRITE_UPDATE_CANCEL\"\n          })}\n          confirmButtonName={formatMessage({\n            id: \"ID_SOCIAL_WRITE_UPDATE_CONFIRM\"\n          })}\n          confirmAction={() => {\n            const { title = \" \", tags } = this.state;\n            request\n              .updateSocialArticle({\n                id: this.articleId,\n                title,\n                contents: JSON.stringify(contents),\n                text: title + this.draftEditor.getText(),\n                tags\n              })\n              .then(res => res.json())\n              .then(json => {\n                if (json.success) {\n                  window.scrollTo(0, 0);\n                  this.props.history.push(`/social`);\n                }\n              });\n          }}\n        />,\n        { darkmode: true, dismissButton: false }\n      );\n    } else {\n      showPopUp(\n        <PopUp.OneButton\n          title={formatMessage({ id: \"ID_SOCIAL_WRITE_EMPTY_TITLE\" })}\n          buttonName={formatMessage({ id: \"ID_SOCIAL_WRITE_EMPTY_CONFIRM\" })}\n        />,\n        { darkmode: true, dismissButton: false, dismissOverlay: true }\n      );\n    }\n  };\n\n  onChangeTitle = e => {\n    const title = e.target.value;\n    this.setState({ title });\n  };\n  onClickQuest = () => {\n    const questActive = !this.state.questActive;\n    this.setState({ questActive, questPoint: 1 });\n  };\n  onChangeQuestPoint = e => {\n    const questPoint = e.target.value;\n    this.setState({ questPoint });\n  };\n  onClickSubmit = () => {\n    const id = this.articleId;\n    if (id) {\n      this.updateArticle();\n    } else {\n      this.addArticle();\n    }\n  };\n\n  onAddTag = tag => {\n    const { tags } = this.state;\n    const slicedTag = tag.slice(0, 10);\n    if (tags.indexOf(slicedTag) < 0) {\n      this.setState({ tags: [].concat(tags, slicedTag) });\n    }\n  };\n  onDeleteTag = index => {\n    const tags = [...this.state.tags];\n    tags.splice(index, 1);\n    this.setState({ tags });\n  };\n\n  render() {\n    if (!this.props.userinfo.email) {\n      return <Redirect to=\"/social\" />;\n    }\n\n    const { intl, userinfo } = this.props;\n    const { availablePoint } = userinfo;\n    const { title, tags, questActive, questPoint } = this.state;\n    const {\n      onChangeTitle,\n      onClickFile,\n      onClickGame,\n      onClickCode,\n      setDraftEditorRef,\n      onClickQuest,\n      onChangeQuestPoint,\n      onClickSubmit,\n      onAddTag,\n      onDeleteTag,\n      articleId\n    } = this;\n\n    return (\n      <View\n        intl={intl}\n        title={title}\n        tags={tags}\n        questActive={questActive}\n        questPoint={questPoint}\n        userPoint={availablePoint}\n        onChangeTitle={onChangeTitle}\n        onClickFile={onClickFile}\n        onClickGame={onClickGame}\n        onClickCode={onClickCode}\n        setDraftEditorRef={setDraftEditorRef}\n        onClickQuest={onClickQuest}\n        onChangeQuestPoint={onChangeQuestPoint}\n        onClickSubmit={onClickSubmit}\n        onAddTag={onAddTag}\n        onDeleteTag={onDeleteTag}\n        articleId={articleId}\n      />\n    );\n  }\n}\n\nexport default connect(state => ({ userinfo: state.userinfo }))(\n  withRouter(injectIntl(Container))\n);\n"]},"metadata":{},"sourceType":"module"}