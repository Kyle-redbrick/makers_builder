{"ast":null,"code":"import _regeneratorRuntime from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _slicedToArray from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";\nimport _objectWithoutProperties from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectWithoutProperties\";\nimport _taggedTemplateLiteral from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/taggedTemplateLiteral\";\nvar _jsxFileName = \"/Users/jimmy/Documents/Wizschool/wizlab_web2/src/Page/LMS/Components/Comments.js\";\n\nfunction _templateObject2() {\n  var data = _taggedTemplateLiteral([\"\"]);\n\n  _templateObject2 = function _templateObject2() {\n    return data;\n  };\n\n  return data;\n}\n\nfunction _templateObject() {\n  var data = _taggedTemplateLiteral([\"\\n  width: 100%;\\n  padding-bottom: 160px;\\n\\n  @media screen and (max-width: 1334px){\\n    padding-bottom: 50px;\\n  }\\n\"]);\n\n  _templateObject = function _templateObject() {\n    return data;\n  };\n\n  return data;\n}\n\nimport React, { useCallback, useEffect, useRef, useState } from \"react\";\nimport { connect } from \"react-redux\";\nimport styled from \"@emotion/styled\";\nimport Container from \"../../CourseDetail/Components/Container\";\nimport Title from \"../../CourseDetail/Components/Title\";\nimport CommentItem from \"../../CourseDetail/Components/CommentItem\";\nimport CommentWrite from \"../../CourseDetail/Components/CommentWrite\";\nimport { Comment } from \"../../../models\";\nimport { getComments, postComment } from \"../api\";\nvar Self = styled.div(_templateObject());\nvar CommentsWrap = styled.div(_templateObject2());\n\nvar Comments = function Comments(_ref) {\n  var questionId = _ref.questionId,\n      items = _ref.items,\n      onAfterSubmit = _ref.onAfterSubmit,\n      props = _objectWithoutProperties(_ref, [\"questionId\", \"items\", \"onAfterSubmit\"]);\n\n  var _useState = useState(null),\n      _useState2 = _slicedToArray(_useState, 2),\n      currentIdOnComment = _useState2[0],\n      setCurrentIdOnComment = _useState2[1];\n\n  var _useState3 = useState(null),\n      _useState4 = _slicedToArray(_useState3, 2),\n      currentIdOnMore = _useState4[0],\n      setCurrentIdOnMore = _useState4[1];\n\n  var inputClicksEventRef = useRef(new Map());\n  var inputClickEventRef = useRef(function (e) {\n    inputClicksEventRef.current.forEach(function (v) {\n      return v(e);\n    });\n  }, []);\n\n  var _useState5 = useState([]),\n      _useState6 = _slicedToArray(_useState5, 2),\n      comments = _useState6[0],\n      setComments = _useState6[1];\n\n  var init = useCallback(function () {\n    fetchComments();\n  }, [questionId]);\n  useEffect(init, []);\n  useEffect(function () {\n    window.addEventListener(\"click\", inputClickEventRef.current);\n    return function () {\n      window.removeEventListener(\"click\", inputClickEventRef.current);\n    };\n  }, []);\n  var handleChangeMore = useCallback(function (id) {\n    setCurrentIdOnMore(id);\n  }, []);\n  var handleChangeComment = useCallback(function (id) {\n    setCurrentIdOnComment(id);\n  }, []);\n  var handleCreateComment = useCallback( /*#__PURE__*/function () {\n    var _ref2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(text) {\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              _context.prev = 0;\n              _context.next = 3;\n              return postComment({\n                email: props.email,\n                contentId: questionId,\n                message: text,\n                contentType: \"dreamQuestion\"\n              });\n\n            case 3:\n              onAfterSubmit();\n              fetchComments();\n              _context.next = 10;\n              break;\n\n            case 7:\n              _context.prev = 7;\n              _context.t0 = _context[\"catch\"](0);\n              window.alert(_context.t0.message);\n\n            case 10:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee, null, [[0, 7]]);\n    }));\n\n    return function (_x) {\n      return _ref2.apply(this, arguments);\n    };\n  }(), [postComment]);\n  var handleAppearCommentWrite = useCallback(function (id, callback) {\n    inputClicksEventRef.current.set(id, callback);\n  }, []);\n  var handleDisappearCommentWrite = useCallback(function (id) {\n    inputClicksEventRef.current.delete(id);\n  }, []);\n  var fetchComments = useCallback(function () {\n    getComments({\n      contentId: questionId,\n      contentType: \"dreamQuestion\"\n    }).then(function (comments) {\n      setComments(comments.rows.map(function (c) {\n        return new Comment(c);\n      }));\n    });\n  }, [getComments]);\n  return React.createElement(Self, Object.assign({}, props, {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 92\n    },\n    __self: this\n  }), React.createElement(Container, {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 93\n    },\n    __self: this\n  }, React.createElement(Title, {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 94\n    },\n    __self: this\n  }, \"Comment\"), React.createElement(CommentWrite, {\n    commentId: \"root\",\n    onDisappear: handleDisappearCommentWrite,\n    onAppear: handleAppearCommentWrite,\n    onSubmit: handleCreateComment,\n    writeMode: true,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 95\n    },\n    __self: this\n  }), React.createElement(CommentsWrap, {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 102\n    },\n    __self: this\n  }, comments.map(function (item) {\n    return React.createElement(CommentItem, {\n      lectureId: questionId,\n      key: item.id,\n      item: item,\n      onAfterSubmit: onAfterSubmit,\n      currentIdOnComment: currentIdOnComment,\n      currentIdOnMore: currentIdOnMore,\n      handleChangeComment: handleChangeComment,\n      handleChangeMore: handleChangeMore,\n      onAppearCommentWrite: handleAppearCommentWrite,\n      onDisappearCommentWrite: handleDisappearCommentWrite,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 104\n      },\n      __self: this\n    });\n  }))));\n};\n\nexport default connect(function (state) {\n  return {\n    email: state.userinfo.email\n  };\n}, {})(Comments);","map":{"version":3,"sources":["/Users/jimmy/Documents/Wizschool/wizlab_web2/src/Page/LMS/Components/Comments.js"],"names":["React","useCallback","useEffect","useRef","useState","connect","styled","Container","Title","CommentItem","CommentWrite","Comment","getComments","postComment","Self","div","CommentsWrap","Comments","questionId","items","onAfterSubmit","props","currentIdOnComment","setCurrentIdOnComment","currentIdOnMore","setCurrentIdOnMore","inputClicksEventRef","Map","inputClickEventRef","e","current","forEach","v","comments","setComments","init","fetchComments","window","addEventListener","removeEventListener","handleChangeMore","id","handleChangeComment","handleCreateComment","text","email","contentId","message","contentType","alert","handleAppearCommentWrite","callback","set","handleDisappearCommentWrite","delete","then","rows","map","c","item","state","userinfo"],"mappings":"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","sourcesContent":["import React, { useCallback, useEffect, useRef, useState } from \"react\";\nimport { connect } from \"react-redux\";\nimport styled from \"@emotion/styled\";\n\nimport Container from \"../../CourseDetail/Components/Container\";\nimport Title from \"../../CourseDetail/Components/Title\";\nimport CommentItem from \"../../CourseDetail/Components/CommentItem\";\nimport CommentWrite from \"../../CourseDetail/Components/CommentWrite\";\nimport { Comment } from \"../../../models\"\n\nimport { getComments, postComment } from \"../api\";\n\nconst Self = styled.div`\n  width: 100%;\n  padding-bottom: 160px;\n\n  @media screen and (max-width: 1334px){\n    padding-bottom: 50px;\n  }\n`;\n\nconst CommentsWrap = styled.div``;\n\nconst Comments = ({ questionId, items, onAfterSubmit, ...props }) => {\n  const [currentIdOnComment, setCurrentIdOnComment] = useState(null);\n  const [currentIdOnMore, setCurrentIdOnMore] = useState(null);\n  const inputClicksEventRef = useRef(new Map());\n  const inputClickEventRef = useRef((e) => {\n    inputClicksEventRef.current.forEach(v => v(e))\n  }, []);\n  const [comments, setComments] = useState([]);\n\n  const init = useCallback(() => {\n    fetchComments();\n  }, [questionId])\n\n  useEffect(init, []);\n\n  useEffect(() => {\n    window.addEventListener(\"click\", inputClickEventRef.current);\n    return () => {\n      window.removeEventListener(\"click\", inputClickEventRef.current);\n    };\n  }, []);\n\n  const handleChangeMore = useCallback((id) => {\n    setCurrentIdOnMore(id);\n  }, [])\n\n  const handleChangeComment = useCallback((id) => {\n    setCurrentIdOnComment(id);\n  }, [])\n\n  const handleCreateComment = useCallback(\n    async (text) => {\n      try {\n        await postComment({\n          email: props.email,\n          contentId: questionId,\n          message: text,\n          contentType: \"dreamQuestion\"\n        });\n\n        onAfterSubmit();\n        fetchComments();\n      } catch (e) {\n        window.alert(e.message);\n      }\n    },\n    [postComment]\n  );\n\n  const handleAppearCommentWrite = useCallback((id, callback) => {\n    inputClicksEventRef.current.set(id, callback)\n  }, [])\n\n\n  const handleDisappearCommentWrite = useCallback((id) => {\n    inputClicksEventRef.current.delete(id)\n  }, [])\n\n  const fetchComments = useCallback(\n    () => {\n      getComments({ contentId: questionId, contentType: \"dreamQuestion\" }).then((comments) => {\n        setComments(comments.rows.map((c) => new Comment(c)));\n      });\n    },\n    [getComments]\n  );\n\n  return (\n    <Self {...props}>\n      <Container>\n        <Title>Comment</Title>\n        <CommentWrite\n          commentId=\"root\"\n          onDisappear={handleDisappearCommentWrite}\n          onAppear={handleAppearCommentWrite}\n          onSubmit={handleCreateComment}\n          writeMode={true}\n        />\n        <CommentsWrap>\n          {comments.map((item) => (\n            <CommentItem \n              lectureId={questionId}\n              key={item.id}\n              item={item}\n              onAfterSubmit={onAfterSubmit}\n              currentIdOnComment={currentIdOnComment}\n              currentIdOnMore={currentIdOnMore}\n              handleChangeComment={handleChangeComment}\n              handleChangeMore={handleChangeMore}\n              onAppearCommentWrite={handleAppearCommentWrite}\n              onDisappearCommentWrite={handleDisappearCommentWrite}\n            />\n          ))}\n        </CommentsWrap>\n      </Container>\n    </Self>\n  );\n};\n\n\nexport default connect(\n  state => ({\n    email: state.userinfo.email,\n  }),\n  {}\n)(Comments);\n"]},"metadata":{},"sourceType":"module"}