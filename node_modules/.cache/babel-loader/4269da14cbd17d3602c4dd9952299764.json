{"ast":null,"code":"import _regeneratorRuntime from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _slicedToArray from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";\nimport _objectWithoutProperties from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectWithoutProperties\";\nimport _taggedTemplateLiteral from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/taggedTemplateLiteral\";\nvar _jsxFileName = \"/Users/jimmy/Documents/Wizschool/wizlab_web2/src/Page/CourseDetail/Sections/Comments.js\";\n\nfunction _templateObject2() {\n  var data = _taggedTemplateLiteral([\"\"]);\n\n  _templateObject2 = function _templateObject2() {\n    return data;\n  };\n\n  return data;\n}\n\nfunction _templateObject() {\n  var data = _taggedTemplateLiteral([\"\\n  width: 100%;\\n  padding-bottom: 160px;\\n\\n  @media screen and (max-width: 1169px){\\n    padding-bottom: 50px;\\n  }\\n\"]);\n\n  _templateObject = function _templateObject() {\n    return data;\n  };\n\n  return data;\n}\n\nimport React, { useCallback, useEffect, useRef, useState } from \"react\";\nimport { connect } from \"react-redux\";\nimport { FormattedMessage } from \"react-intl\";\nimport styled from \"@emotion/styled\";\nimport Container from \"../Components/Container\";\nimport Title from \"../Components/Title\";\nimport CommentItem from \"../Components/CommentItem\";\nimport CommentWrite from \"../Components/CommentWrite\";\nimport { postComment } from \"../api\";\nvar Self = styled.div(_templateObject());\nvar CommentsWrap = styled.div(_templateObject2());\n\nvar Comments = function Comments(_ref) {\n  var courseId = _ref.courseId,\n      items = _ref.items,\n      onAfterSubmit = _ref.onAfterSubmit,\n      props = _objectWithoutProperties(_ref, [\"courseId\", \"items\", \"onAfterSubmit\"]);\n\n  var _useState = useState(null),\n      _useState2 = _slicedToArray(_useState, 2),\n      currentIdOnComment = _useState2[0],\n      setCurrentIdOnComment = _useState2[1];\n\n  var _useState3 = useState(null),\n      _useState4 = _slicedToArray(_useState3, 2),\n      currentIdOnMore = _useState4[0],\n      setCurrentIdOnMore = _useState4[1];\n\n  var inputClicksEventRef = useRef(new Map());\n  var inputClickEventRef = useRef(function (e) {\n    inputClicksEventRef.current.forEach(function (v) {\n      return v(e);\n    });\n  }, []);\n  useEffect(function () {\n    window.addEventListener(\"click\", inputClickEventRef.current);\n    return function () {\n      window.removeEventListener(\"click\", inputClickEventRef.current);\n    };\n  }, []);\n  var handleChangeMore = useCallback(function (id) {\n    setCurrentIdOnMore(id);\n  }, []);\n  var handleChangeComment = useCallback(function (id) {\n    setCurrentIdOnComment(id);\n  }, []);\n  var handleCreateComment = useCallback(\n  /*#__PURE__*/\n  function () {\n    var _ref2 = _asyncToGenerator(\n    /*#__PURE__*/\n    _regeneratorRuntime.mark(function _callee(text) {\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              _context.prev = 0;\n              _context.next = 3;\n              return postComment({\n                email: props.email,\n                lectureId: courseId,\n                message: text\n              });\n\n            case 3:\n              onAfterSubmit();\n              _context.next = 9;\n              break;\n\n            case 6:\n              _context.prev = 6;\n              _context.t0 = _context[\"catch\"](0);\n              window.alert(_context.t0.message);\n\n            case 9:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee, this, [[0, 6]]);\n    }));\n\n    return function (_x) {\n      return _ref2.apply(this, arguments);\n    };\n  }(), [postComment]);\n  var handleAppearCommentWrite = useCallback(function (id, callback) {\n    inputClicksEventRef.current.set(id, callback);\n  }, []);\n  var handleDisappearCommentWrite = useCallback(function (id) {\n    inputClicksEventRef.current.delete(id);\n  }, []);\n  return React.createElement(Self, Object.assign({}, props, {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 74\n    },\n    __self: this\n  }), React.createElement(Container, {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 75\n    },\n    __self: this\n  }, React.createElement(Title, {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 76\n    },\n    __self: this\n  }, React.createElement(FormattedMessage, {\n    id: \"ID_COURSE_DETAIL_COMMENT_REVIEW\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 76\n    },\n    __self: this\n  })), React.createElement(CommentWrite, {\n    commentId: \"root\",\n    onDisappear: handleDisappearCommentWrite,\n    onAppear: handleAppearCommentWrite,\n    onSubmit: handleCreateComment,\n    writeMode: true,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 77\n    },\n    __self: this\n  }), React.createElement(CommentsWrap, {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 78\n    },\n    __self: this\n  }, items.map(function (item) {\n    return React.createElement(CommentItem, {\n      lectureId: courseId,\n      key: item.id,\n      item: item,\n      onAfterSubmit: onAfterSubmit,\n      currentIdOnComment: currentIdOnComment,\n      currentIdOnMore: currentIdOnMore,\n      handleChangeComment: handleChangeComment,\n      handleChangeMore: handleChangeMore,\n      onAppearCommentWrite: handleAppearCommentWrite,\n      onDisappearCommentWrite: handleDisappearCommentWrite,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 80\n      },\n      __self: this\n    });\n  }))));\n};\n\nexport default connect(function (state) {\n  return {\n    email: state.userinfo.email\n  };\n}, {})(Comments);","map":{"version":3,"sources":["/Users/jimmy/Documents/Wizschool/wizlab_web2/src/Page/CourseDetail/Sections/Comments.js"],"names":["React","useCallback","useEffect","useRef","useState","connect","FormattedMessage","styled","Container","Title","CommentItem","CommentWrite","postComment","Self","div","CommentsWrap","Comments","courseId","items","onAfterSubmit","props","currentIdOnComment","setCurrentIdOnComment","currentIdOnMore","setCurrentIdOnMore","inputClicksEventRef","Map","inputClickEventRef","e","current","forEach","v","window","addEventListener","removeEventListener","handleChangeMore","id","handleChangeComment","handleCreateComment","text","email","lectureId","message","alert","handleAppearCommentWrite","callback","set","handleDisappearCommentWrite","delete","map","item","state","userinfo"],"mappings":"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","sourcesContent":["import React, { useCallback, useEffect, useRef, useState } from \"react\";\nimport { connect } from \"react-redux\";\nimport { FormattedMessage } from \"react-intl\";\nimport styled from \"@emotion/styled\";\n\nimport Container from \"../Components/Container\";\nimport Title from \"../Components/Title\";\nimport CommentItem from \"../Components/CommentItem\"; \nimport CommentWrite from \"../Components/CommentWrite\";\nimport { postComment } from \"../api\";\n\nconst Self = styled.div`\n  width: 100%;\n  padding-bottom: 160px;\n\n  @media screen and (max-width: 1169px){\n    padding-bottom: 50px;\n  }\n`;\n\nconst CommentsWrap = styled.div``;\n\nconst Comments = ({ courseId, items, onAfterSubmit, ...props }) => {  \n  const [currentIdOnComment, setCurrentIdOnComment] = useState(null);\n  const [currentIdOnMore, setCurrentIdOnMore] = useState(null);\n  const inputClicksEventRef = useRef(new Map());\n  const inputClickEventRef = useRef((e) => {\n    inputClicksEventRef.current.forEach(v => v(e))\n  }, []);\n  \n\n  useEffect(() => {\n    window.addEventListener(\"click\", inputClickEventRef.current);\n    return () => {\n      window.removeEventListener(\"click\", inputClickEventRef.current);\n    };\n  }, []);\n\n  const handleChangeMore = useCallback((id) => {\n    setCurrentIdOnMore(id);\n  }, [])\n\n  const handleChangeComment = useCallback((id) => {\n    setCurrentIdOnComment(id);\n  }, [])\n\n  const handleCreateComment = useCallback(\n    async (text) => {\n      try {\n        await postComment({ \n          email: props.email,\n          lectureId: courseId, \n          message: text,\n        });\n\n        onAfterSubmit();\n      } catch (e) {\n        window.alert(e.message);\n      }\n    },\n    [postComment]\n  );\n\n  const handleAppearCommentWrite = useCallback((id, callback) => {\n    inputClicksEventRef.current.set(id, callback)\n  }, [])\n\n\n  const handleDisappearCommentWrite = useCallback((id) => {\n    inputClicksEventRef.current.delete(id)\n  }, [])\n\n  return (\n    <Self {...props}>\n      <Container>\n        <Title><FormattedMessage id=\"ID_COURSE_DETAIL_COMMENT_REVIEW\" /></Title>\n        <CommentWrite commentId=\"root\" onDisappear={handleDisappearCommentWrite} onAppear={handleAppearCommentWrite} onSubmit={handleCreateComment} writeMode={true} />\n        <CommentsWrap>\n          {items.map((item) => (\n            <CommentItem \n              lectureId={courseId}\n              key={item.id}\n              item={item}\n              onAfterSubmit={onAfterSubmit}\n              currentIdOnComment={currentIdOnComment}\n              currentIdOnMore={currentIdOnMore}\n              handleChangeComment={handleChangeComment}\n              handleChangeMore={handleChangeMore}\n              onAppearCommentWrite={handleAppearCommentWrite}\n              onDisappearCommentWrite={handleDisappearCommentWrite}\n            />\n          ))}\n        </CommentsWrap>\n      </Container>\n    </Self>\n  );\n};\n\n\nexport default connect(\n  state => ({\n    email: state.userinfo.email,\n  }),\n  {}\n)(Comments);\n"]},"metadata":{},"sourceType":"module"}