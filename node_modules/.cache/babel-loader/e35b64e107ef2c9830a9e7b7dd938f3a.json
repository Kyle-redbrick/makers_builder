{"ast":null,"code":"import _toConsumableArray from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/react-scripts/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";\nimport _objectSpread from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/react-scripts/node_modules/@babel/runtime/helpers/esm/objectSpread\";\nimport _classCallCheck from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/react-scripts/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/react-scripts/node_modules/@babel/runtime/helpers/esm/createClass\";\nimport _possibleConstructorReturn from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/react-scripts/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/react-scripts/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";\nimport _inherits from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/react-scripts/node_modules/@babel/runtime/helpers/esm/inherits\";\nvar _jsxFileName = \"/Users/jimmy/Documents/Wizschool/wizlab_web2/src/Page/Builder/Component/SoundBox/Container.js\";\nimport React, { Component } from \"react\";\nimport { connect } from \"react-redux\";\nimport AssetLibrary from \"../../utils/assetLibrary\";\nimport onClickOutside from \"react-onclickoutside\";\nimport * as interactionActions from \"../../Store/Reducer/interaction\";\nimport * as sceneActions from \"../../Store/Reducer/scene\";\nimport RndWrapper from \"../../utils/RndWrapper\";\nimport CustomSound from \"./Component/CustomSound\";\nimport { showPopUp } from \"../../../../Common/Component/PopUp\";\nimport store from \"../../Store\";\nimport View from \"./View\";\n\nvar Container =\n/*#__PURE__*/\nfunction (_Component) {\n  _inherits(Container, _Component);\n\n  function Container(props) {\n    var _this;\n\n    _classCallCheck(this, Container);\n\n    _this = _possibleConstructorReturn(this, _getPrototypeOf(Container).call(this, props));\n\n    _this.handleClickOutside = function () {\n      var jukebox = _this.props.jukebox;\n\n      if (jukebox.isPlaying) {\n        _this.props.stopSound();\n      }\n    };\n\n    _this.setCurrentCategory = function (category, subcate) {\n      if (!subcate) subcate = category;\n\n      _this.setState({\n        assets: [],\n        currentCategory: category,\n        currentSubCategory: subcate\n      }, function () {\n        _this.loadAssets(subcate);\n      });\n    };\n\n    _this.loadAssets = function (subcate, callback) {\n      if (subcate) {\n        AssetLibrary.loadAssetsByCategory(subcate, function (assets) {\n          if (callback) {\n            callback();\n          } else {\n            _this.setState({\n              assets: assets\n            });\n          }\n        });\n      }\n    };\n\n    _this.handleSelectAsset = function (assetId) {\n      if (assetId !== _this.state.selectedAssetId) {\n        _this.setState({\n          selectedAssetId: assetId\n        });\n\n        var item = AssetLibrary.getSoundAsset(assetId);\n\n        _this.props.playSound({\n          id: item.id,\n          path: item.path,\n          type: item.type\n        });\n      } else {\n        _this.setState({\n          selectedAssetId: undefined\n        }, _this.props.stopSound);\n      }\n    };\n\n    _this.handleAddAsset = function (asset) {\n      if (_this.props.soundIds.find(function (id) {\n        return id === asset.assetId;\n      })) {\n        return;\n      }\n\n      var assetId = asset.assetId,\n          type = asset.type,\n          subtype = asset.subtype;\n\n      var _this$reduceBasket = _this.reduceBasket([{\n        assetId: assetId,\n        type: type,\n        subtype: subtype\n      }]),\n          spriteInfos = _this$reduceBasket.spriteInfos;\n\n      if (spriteInfos.length !== 0) {\n        _this.props.addSounds(spriteInfos);\n      }\n    };\n\n    _this.handleRemoveAsset = function (assetId) {\n      _this.props.removeSound(assetId);\n    };\n\n    _this.setSpriteInfo = function (item) {\n      var asset = AssetLibrary.getSoundAsset(item.assetId);\n      var type = asset.type;\n      var subtype = asset.subtype;\n      var assetId = item.assetId;\n      var name = asset.defaultName;\n      return {\n        name: name,\n        assetId: assetId,\n        type: type,\n        subtype: subtype\n      };\n    };\n\n    _this.reduceBasket = function (assets) {\n      return assets.reduce(function (acc, cur) {\n        if (cur.subtype === \"camera\") {\n          var checkCamera = false;\n\n          for (var i = 0; i < _this.props.spriteIds.length; i++) {\n            if (_this.props.sprites[_this.props.spriteIds[i]].preview.subtype === \"camera\") {\n              checkCamera = true;\n              break;\n            }\n          }\n\n          if (!checkCamera) {\n            acc.spriteInfos.push(_this.setSpriteInfo(cur));\n          }\n        } else if (cur.subtype === \"joystick\") {\n          acc.spriteInfos.push(_this.setSpriteInfo(cur));\n        } else {\n          acc.spriteInfos.push(_this.setSpriteInfo(cur));\n        }\n\n        return acc;\n      }, {\n        spriteInfos: [],\n        soundInfos: []\n      });\n    };\n\n    _this.countUpSameName = function (defaultName, nameArray) {\n      var max = nameArray.reduce(function (max, id) {\n        var name = id.replace(/\\(\\d+\\)$/, \"\");\n        var num;\n\n        if (defaultName === name) {\n          num = id.replace(defaultName, \"\").replace(/\\(|\\)/g, \"\");\n          num = !!num ? Number(num) : 1;\n          return Math.max(max, num);\n        } else {\n          return max;\n        }\n      }, 0);\n\n      if (max > 0) {\n        return \"\".concat(defaultName, \"(\").concat(max + 1, \")\");\n      } else {\n        return defaultName;\n      }\n    };\n\n    _this.onClickCustomSound = function () {\n      showPopUp(React.createElement(CustomSound, {\n        countUpSameName: _this.countUpSameName,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 173\n        },\n        __self: this\n      }), {\n        store: store,\n        defaultPadding: false,\n        dismissOverlay: false,\n        dismissButton: false\n      });\n    };\n\n    _this.state = {\n      currentCategory: \"bgm\",\n      currentSubCategory: \"bgm\",\n      assets: [],\n      selectedAssetId: undefined,\n      categories: []\n    };\n    return _this;\n  }\n\n  _createClass(Container, [{\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      var _this2 = this;\n\n      AssetLibrary.loadAllSounds(function () {\n        var categories = AssetLibrary.categories.filter(function (c) {\n          return c.name === \"sfx\" || c.name === \"bgm\";\n        });\n\n        _this2.setState({\n          categories: categories.map(function (category) {\n            return _objectSpread({}, category, {\n              subCategories: [{\n                name: category.name,\n                localeName: JSON.stringify({\n                  ko: \"전체\",\n                  zh: \"All\",\n                  default: \"All\"\n                })\n              }].concat(_toConsumableArray(category.subCategories))\n            });\n          })\n        });\n\n        _this2.loadAssets(_this2.state.currentSubCategory);\n      });\n    }\n  }, {\n    key: \"componentWillUnmount\",\n    value: function componentWillUnmount() {\n      this.props.stopSound();\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _this$props = this.props,\n          soundIds = _this$props.soundIds,\n          jukebox = _this$props.jukebox,\n          zIndex = _this$props.zIndex,\n          isOn = _this$props.isOn,\n          handleSelectTab = _this$props.handleSelectTab,\n          handleChangeZIndex = _this$props.handleChangeZIndex;\n      var _this$state = this.state,\n          currentCategory = _this$state.currentCategory,\n          currentSubCategory = _this$state.currentSubCategory,\n          assets = _this$state.assets,\n          selectedAssetId = _this$state.selectedAssetId,\n          categories = _this$state.categories;\n      var setCurrentCategory = this.setCurrentCategory,\n          handleSelectAsset = this.handleSelectAsset,\n          handleAddAsset = this.handleAddAsset,\n          handleRemoveAsset = this.handleRemoveAsset,\n          onClickCustomSound = this.onClickCustomSound;\n\n      if (!isOn) {\n        return React.createElement(\"div\", {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 210\n          },\n          __self: this\n        });\n      }\n\n      return React.createElement(RndWrapper, {\n        id: \"soundBox\",\n        style: {\n          zIndex: zIndex\n        },\n        defaultWidth: 384,\n        defaultHeight: 500,\n        defaultX: 200,\n        defaultY: 5,\n        minWidth: 300,\n        minHeight: 300,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 213\n        },\n        __self: this\n      }, React.createElement(View, {\n        categories: categories,\n        soundIds: soundIds,\n        currentCategory: currentCategory,\n        currentSubCategory: currentSubCategory,\n        assets: assets,\n        selectedAssetId: selectedAssetId,\n        handleSelectTab: handleSelectTab,\n        setCurrentCategory: setCurrentCategory,\n        handleSelectAsset: handleSelectAsset,\n        handleAddAsset: handleAddAsset,\n        handleRemoveAsset: handleRemoveAsset,\n        jukebox: jukebox,\n        handleChangeZIndex: handleChangeZIndex,\n        onClickCustomSound: onClickCustomSound,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 223\n        },\n        __self: this\n      }));\n    }\n  }]);\n\n  return Container;\n}(Component);\n\nexport default connect(function (state) {\n  return {\n    jukebox: state.interaction.jukebox,\n    selectedSceneId: state.interaction.selected.scene,\n    selectedObject: state.interaction.selected.objects[state.interaction.selected.scene],\n    sprites: state.scene.scenes[state.interaction.selected.scene].sprites,\n    soundIds: state.scene.soundIds\n  };\n}, {\n  playSound: interactionActions.playSound,\n  stopSound: interactionActions.stopSound,\n  removeSound: sceneActions.removeSound,\n  addSounds: sceneActions.addSounds\n})(onClickOutside(Container));","map":{"version":3,"sources":["/Users/jimmy/Documents/Wizschool/wizlab_web2/src/Page/Builder/Component/SoundBox/Container.js"],"names":["React","Component","connect","AssetLibrary","onClickOutside","interactionActions","sceneActions","RndWrapper","CustomSound","showPopUp","store","View","Container","props","handleClickOutside","jukebox","isPlaying","stopSound","setCurrentCategory","category","subcate","setState","assets","currentCategory","currentSubCategory","loadAssets","callback","loadAssetsByCategory","handleSelectAsset","assetId","state","selectedAssetId","item","getSoundAsset","playSound","id","path","type","undefined","handleAddAsset","asset","soundIds","find","subtype","reduceBasket","spriteInfos","length","addSounds","handleRemoveAsset","removeSound","setSpriteInfo","name","defaultName","reduce","acc","cur","checkCamera","i","spriteIds","sprites","preview","push","soundInfos","countUpSameName","nameArray","max","replace","num","Number","Math","onClickCustomSound","defaultPadding","dismissOverlay","dismissButton","categories","loadAllSounds","filter","c","map","subCategories","localeName","JSON","stringify","ko","zh","default","zIndex","isOn","handleSelectTab","handleChangeZIndex","interaction","selectedSceneId","selected","scene","selectedObject","objects","scenes"],"mappings":"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","sourcesContent":["import React, { Component } from \"react\";\nimport { connect } from \"react-redux\";\nimport AssetLibrary from \"../../utils/assetLibrary\";\nimport onClickOutside from \"react-onclickoutside\";\nimport * as interactionActions from \"../../Store/Reducer/interaction\";\nimport * as sceneActions from \"../../Store/Reducer/scene\";\nimport RndWrapper from \"../../utils/RndWrapper\";\nimport CustomSound from \"./Component/CustomSound\";\nimport { showPopUp } from \"../../../../Common/Component/PopUp\";\nimport store from \"../../Store\";\nimport View from \"./View\";\n\nclass Container extends Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      currentCategory: \"bgm\",\n      currentSubCategory: \"bgm\",\n      assets: [],\n      selectedAssetId: undefined,\n      categories: []\n    };\n  }\n\n  componentDidMount() {\n    AssetLibrary.loadAllSounds(() => {\n      let categories = AssetLibrary.categories.filter(\n        c => c.name === \"sfx\" || c.name === \"bgm\"\n      );\n      this.setState({\n        categories: categories.map(category => {\n          return {\n            ...category,\n            subCategories: [\n              {\n                name: category.name,\n                localeName: JSON.stringify({\n                  ko: \"전체\",\n                  zh: \"All\",\n                  default: \"All\"\n                })\n              },\n              ...category.subCategories\n            ]\n          };\n        })\n      });\n      this.loadAssets(this.state.currentSubCategory);\n    });\n  }\n\n  componentWillUnmount() {\n    this.props.stopSound();\n  }\n\n  handleClickOutside = () => {\n    const { jukebox } = this.props;\n    if (jukebox.isPlaying) {\n      this.props.stopSound();\n    }\n  };\n\n  setCurrentCategory = (category, subcate) => {\n    if (!subcate) subcate = category;\n    this.setState(\n      { assets: [], currentCategory: category, currentSubCategory: subcate },\n      () => {\n        this.loadAssets(subcate);\n      }\n    );\n  };\n\n  loadAssets = (subcate, callback) => {\n    if (subcate) {\n      AssetLibrary.loadAssetsByCategory(subcate, assets => {\n        if (callback) {\n          callback();\n        } else {\n          this.setState({ assets });\n        }\n      });\n    }\n  };\n\n  handleSelectAsset = assetId => {\n    if (assetId !== this.state.selectedAssetId) {\n      this.setState({ selectedAssetId: assetId });\n      const item = AssetLibrary.getSoundAsset(assetId);\n      this.props.playSound({\n        id: item.id,\n        path: item.path,\n        type: item.type\n      });\n    } else {\n      this.setState({ selectedAssetId: undefined }, this.props.stopSound);\n    }\n  };\n\n  handleAddAsset = asset => {\n    if (this.props.soundIds.find(id => id === asset.assetId)) {\n      return;\n    }\n    const { assetId, type, subtype } = asset;\n    let { spriteInfos } = this.reduceBasket([{ assetId, type, subtype }]);\n    if (spriteInfos.length !== 0) {\n      this.props.addSounds(spriteInfos);\n    }\n  };\n\n  handleRemoveAsset = assetId => {\n    this.props.removeSound(assetId);\n  };\n\n  setSpriteInfo = item => {\n    const asset = AssetLibrary.getSoundAsset(item.assetId);\n    const type = asset.type;\n    const subtype = asset.subtype;\n    const assetId = item.assetId;\n    const name = asset.defaultName;\n    return { name, assetId, type, subtype };\n  };\n\n  reduceBasket = assets => {\n    return assets.reduce(\n      (acc, cur) => {\n        if (cur.subtype === \"camera\") {\n          let checkCamera = false;\n          for (var i = 0; i < this.props.spriteIds.length; i++) {\n            if (\n              this.props.sprites[this.props.spriteIds[i]].preview.subtype ===\n              \"camera\"\n            ) {\n              checkCamera = true;\n              break;\n            }\n          }\n          if (!checkCamera) {\n            acc.spriteInfos.push(this.setSpriteInfo(cur));\n          }\n        } else if (cur.subtype === \"joystick\") {\n          acc.spriteInfos.push(this.setSpriteInfo(cur));\n        } else {\n          acc.spriteInfos.push(this.setSpriteInfo(cur));\n        }\n\n        return acc;\n      },\n      { spriteInfos: [], soundInfos: [] }\n    );\n  };\n\n  countUpSameName = (defaultName, nameArray) => {\n    let max = nameArray.reduce((max, id) => {\n      let name = id.replace(/\\(\\d+\\)$/, \"\");\n      let num;\n      if (defaultName === name) {\n        num = id.replace(defaultName, \"\").replace(/\\(|\\)/g, \"\");\n        num = !!num ? Number(num) : 1;\n        return Math.max(max, num);\n      } else {\n        return max;\n      }\n    }, 0);\n    if (max > 0) {\n      return `${defaultName}(${max + 1})`;\n    } else {\n      return defaultName;\n    }\n  };\n\n  onClickCustomSound = () => {\n    showPopUp(\n      <CustomSound\n        countUpSameName={this.countUpSameName}\n      />,\n      {\n        store,\n        defaultPadding: false,\n        dismissOverlay: false,\n        dismissButton: false\n      }\n    );\n  }\n\n  render() {\n    const {\n      soundIds,\n      jukebox,\n      zIndex,\n      isOn,\n      handleSelectTab,\n      handleChangeZIndex\n    } = this.props;\n    const {\n      currentCategory,\n      currentSubCategory,\n      assets,\n      selectedAssetId,\n      categories\n    } = this.state;\n    const {\n      setCurrentCategory,\n      handleSelectAsset,\n      handleAddAsset,\n      handleRemoveAsset,\n      onClickCustomSound\n    } = this;\n\n    if (!isOn) {\n      return <div />;\n    }\n    return (\n      <RndWrapper\n        id=\"soundBox\"\n        style={{ zIndex }}\n        defaultWidth={384}\n        defaultHeight={500}\n        defaultX={200}\n        defaultY={5}\n        minWidth={300}\n        minHeight={300}\n      >\n        <View\n          categories={categories}\n          soundIds={soundIds}\n          currentCategory={currentCategory}\n          currentSubCategory={currentSubCategory}\n          assets={assets}\n          selectedAssetId={selectedAssetId}\n          handleSelectTab={handleSelectTab}\n          setCurrentCategory={setCurrentCategory}\n          handleSelectAsset={handleSelectAsset}\n          handleAddAsset={handleAddAsset}\n          handleRemoveAsset={handleRemoveAsset}\n          jukebox={jukebox}\n          handleChangeZIndex={handleChangeZIndex}\n          onClickCustomSound={onClickCustomSound}\n        />\n      </RndWrapper>\n    );\n  }\n}\n\nexport default connect(\n  state => ({\n    jukebox: state.interaction.jukebox,\n    selectedSceneId: state.interaction.selected.scene,\n    selectedObject:\n      state.interaction.selected.objects[state.interaction.selected.scene],\n    sprites: state.scene.scenes[state.interaction.selected.scene].sprites,\n    soundIds: state.scene.soundIds\n  }),\n  {\n    playSound: interactionActions.playSound,\n    stopSound: interactionActions.stopSound,\n    removeSound: sceneActions.removeSound,\n    addSounds: sceneActions.addSounds\n  }\n)(onClickOutside(Container));\n"]},"metadata":{},"sourceType":"module"}