{"ast":null,"code":"import _objectSpread from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread\";\nimport _defineProperty from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/defineProperty\";\nimport _classCallCheck from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";\nimport _possibleConstructorReturn from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";\nimport _inherits from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";\nvar _jsxFileName = \"/Users/jimmy/Documents/Wizschool/wizlab_web2/src/Common/Component/SignUp/Container.js\";\nimport React, { Component } from 'react';\nimport { connect } from \"react-redux\";\nimport { injectIntl } from \"react-intl\";\nimport PopUp, { showPopUp } from \"../PopUp\";\nimport View from \"./View\";\nimport { AGREEMENT, FIELD_TYPE } from \"../../Util/Constant\";\nimport Validate from \"../../Util/Validate\";\nimport * as TrackingUtil from \"../../Util/TrackingUtil\";\nimport { getRandomName, getRandomUserIcon } from \"../../Util/RandomGenerator\";\nimport sha256 from \"../../Util/SHA256\";\nimport * as request from \"../../Util/HTTPRequest\";\nimport * as userInfoActions from \"../../Store/Reducer/UserInfo\";\nimport SignIn from \"../SignIn\";\nimport moment from 'moment';\nexport var Container =\n/*#__PURE__*/\nfunction (_Component) {\n  _inherits(Container, _Component);\n\n  function Container(props) {\n    var _agreed2;\n\n    var _this;\n\n    _classCallCheck(this, Container);\n\n    _this = _possibleConstructorReturn(this, _getPrototypeOf(Container).call(this, props));\n\n    _this.onChangeField = function (id, value) {\n      _this.setState(_defineProperty({}, id, value), function () {\n        if (FIELD_TYPE.LOGIN_ID === id) _this.onLoginIdChanged();else if (FIELD_TYPE.PASSWORD === id) _this.onPasswordChanged();\n      });\n    };\n\n    _this.onLoginIdChanged = function () {\n      _this.loginIdDuplicate = false;\n\n      _this.setState({\n        warnings: {\n          loginId: _this.getWarning(FIELD_TYPE.LOGIN_ID)\n        }\n      });\n    };\n\n    _this.onPasswordChanged = function () {\n      _this.setState({\n        warnings: {},\n        pwValidation: {\n          length: Validate.passwordLength(_this.state.password),\n          mix: Validate.passwordComb(_this.state.password)\n        }\n      });\n    };\n\n    _this.onBlurField = function (id, value) {\n      if (FIELD_TYPE.LOGIN_ID === id) _this.onLoginIdBlur(value);\n    };\n\n    _this.onLoginIdBlur = function (loginId) {\n      var _Validate$loginId = Validate.loginId(loginId),\n          isValid = _Validate$loginId.result;\n\n      if (isValid) {\n        request.checkEmailDuplicate(loginId).then(function (res) {\n          return res.json();\n        }).then(function (json) {\n          var isDuplicate = !json;\n\n          _this.updateLoginIdDuplicateWarning(isDuplicate);\n        });\n      }\n    };\n\n    _this.onClickLogin = function () {\n      showPopUp(React.createElement(SignIn, {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 114\n        },\n        __self: this\n      }), {\n        mobileFullscreen: true,\n        darkmode: true\n      });\n    };\n\n    _this.onClickAgree = function (type) {\n      _this.setState({\n        warnings: _objectSpread({}, _this.state.warnings, {\n          agreement: undefined\n        })\n      });\n\n      if (AGREEMENT.ALL === type) {\n        var _agreed;\n\n        var _allAgreed = _this.allAgreed;\n\n        _this.setState({\n          agreed: (_agreed = {}, _defineProperty(_agreed, AGREEMENT.SERVICE_TERMS, !_allAgreed), _defineProperty(_agreed, AGREEMENT.PRIVACY, !_allAgreed), _defineProperty(_agreed, AGREEMENT.MARKETING, !_allAgreed), _agreed)\n        });\n      } else {\n        _this.setState({\n          agreed: _objectSpread({}, _this.state.agreed, _defineProperty({}, type, !_this.state.agreed[type]))\n        });\n      }\n    };\n\n    _this.onClickTerms = function (e, type) {\n      e.stopPropagation();\n\n      switch (type) {\n        case AGREEMENT.SERVICE_TERMS:\n          window.open(\"/support/terms\", \"_blank\");\n          break;\n\n        case AGREEMENT.PRIVACY:\n          window.open(\"/support/privacy\", \"_blank\");\n          break;\n\n        default:\n          break;\n      }\n    };\n\n    _this.onClickSignUp = function () {\n      var isValid = _this.validateFieldsAndAgreements(true);\n\n      if (!isValid) return;\n      var _this$state = _this.state,\n          loginId = _this$state.loginId,\n          password = _this$state.password,\n          birth = _this$state.birth,\n          agreed = _this$state.agreed;\n      var params = {\n        email: loginId,\n        password: sha256(password),\n        birth: moment([birth.year, birth.month, birth.date]).format(\"YYYY-MM-DD\"),\n        icon: getRandomUserIcon(),\n        name: getRandomName(),\n        isMarketingAgreement: agreed[AGREEMENT.MARKETING]\n      };\n      request.signup_new(params).then(function (res) {\n        return res.json();\n      }).then(function (json) {\n        if (json.success) {\n          TrackingUtil.kakaoPixelPageView(\"completeRegistration\");\n          TrackingUtil.sendGTMEvent(\"Signup_Success\");\n          window.setBizSpring();\n          localStorage.setItem(\"wizToken\", json.token);\n\n          _this.props.updateUserInfo(json.user);\n\n          showPopUp(React.createElement(PopUp.OneButton, {\n            title: _this.props.intl.formatMessage({\n              id: \"ID_SIGNUP_SIGNED_TITLE\"\n            }),\n            buttonName: _this.props.intl.formatMessage({\n              id: \"ID_SIGNUP_SIGNED_CONFIRM\"\n            }),\n            buttonAction: _this.props.isMobileSignupPage ? _this.redirectHome : false,\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 188\n            },\n            __self: this\n          }), {\n            darkmode: true\n          });\n        } else if (json.reason === \"DUPLICATE_ERROR\") {\n          _this.updateLoginIdDuplicateWarning(true);\n        }\n      });\n    };\n\n    _this.redirectHome = function () {\n      window.location.replace(\"/\");\n    };\n\n    _this.state = {\n      loginId: \"\",\n      password: \"\",\n      birth: {\n        year: undefined,\n        month: undefined,\n        date: undefined\n      },\n      agreed: (_agreed2 = {}, _defineProperty(_agreed2, AGREEMENT.SERVICE_TERMS, false), _defineProperty(_agreed2, AGREEMENT.PRIVACY, false), _defineProperty(_agreed2, AGREEMENT.MARKETING, false), _agreed2),\n      pwValidation: {\n        length: undefined,\n        mix: undefined\n      },\n      warnings: {},\n      okSigns: {}\n    };\n    return _this;\n  }\n\n  _createClass(Container, [{\n    key: \"updateLoginIdDuplicateWarning\",\n    value: function updateLoginIdDuplicateWarning(isDuplicate) {\n      this.loginIdDuplicate = isDuplicate;\n      this.setState({\n        warnings: _objectSpread({}, this.state.warnings, {\n          loginId: this.getWarning(FIELD_TYPE.LOGIN_ID)\n        }),\n        okSigns: _objectSpread({}, this.state.okSigns, {\n          loginId: isDuplicate ? undefined : this.props.intl.formatMessage({\n            id: \"ID_VALIDATE_SUCCESS_LOGINID\"\n          })\n        })\n      });\n    }\n  }, {\n    key: \"validateFieldsAndAgreements\",\n    value: function validateFieldsAndAgreements(updateWarning) {\n      var warnings = _objectSpread({}, this.state.warnings, {\n        loginId: this.getWarning(FIELD_TYPE.LOGIN_ID),\n        password: this.getWarning(FIELD_TYPE.PASSWORD),\n        birth: this.getWarning(FIELD_TYPE.BIRTH),\n        agreement: this.getAgreementWarning()\n      });\n\n      if (updateWarning) {\n        this.setState({\n          warnings: warnings\n        });\n      }\n\n      var valid = true;\n\n      var _arr = Object.values(warnings);\n\n      for (var _i = 0; _i < _arr.length; _i++) {\n        var warning = _arr[_i];\n\n        if (warning) {\n          valid = false;\n          break;\n        }\n      }\n\n      if (valid) {\n        var pwValidation = this.state.pwValidation;\n\n        for (var key in pwValidation) {\n          if (!pwValidation[key]) {\n            valid = false;\n            break;\n          }\n        }\n      }\n\n      return valid;\n    }\n  }, {\n    key: \"getWarning\",\n    value: function getWarning(fieldId) {\n      var fieldValue = this.state[fieldId];\n      var validation = this.validateField(fieldId, fieldValue);\n\n      if (validation.result) {\n        return undefined;\n      } else {\n        return this.props.intl.formatMessage({\n          id: validation.id\n        });\n      }\n    }\n  }, {\n    key: \"getAgreementWarning\",\n    value: function getAgreementWarning() {\n      var agreed = this.state.agreed;\n      var requiredAgreed = agreed[AGREEMENT.SERVICE_TERMS] && agreed[AGREEMENT.PRIVACY];\n\n      if (requiredAgreed) {\n        return undefined;\n      } else {\n        return this.props.intl.formatMessage({\n          id: \"ID_SIGNUP_WARNING_AGREEMENT\"\n        });\n      }\n    }\n  }, {\n    key: \"validateField\",\n    value: function validateField(fieldId, value) {\n      switch (fieldId) {\n        case \"loginId\":\n          if (this.loginIdDuplicate) {\n            return {\n              result: false,\n              id: \"ID_VALIDATE_FAIL_LOGINID_DUPLICATE\"\n            };\n          } else {\n            return Validate.loginId(value);\n          }\n\n        case \"password\":\n          return Validate.isEmpty(value, \"ID_VALIDATE_FAIL_PW_NULL\");\n\n        case \"birth\":\n          {\n            var _arr2 = Object.values(value);\n\n            for (var _i2 = 0; _i2 < _arr2.length; _i2++) {\n              var _value = _arr2[_i2];\n              if (_value === undefined) return {\n                result: false,\n                id: \"ID_VALIDATE_FAIL_BIRTH_NULL\"\n              };\n            }\n\n            return {\n              result: true\n            };\n          }\n\n        default:\n          return {\n            result: true\n          };\n      }\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      return React.createElement(View, Object.assign({}, this.state, {\n        allAgreed: this.allAgreed,\n        allValid: this.allValid,\n        onChangeField: this.onChangeField,\n        onBlurField: this.onBlurField,\n        onClickLogin: this.onClickLogin,\n        onClickAgree: this.onClickAgree,\n        onClickTerms: this.onClickTerms,\n        onClickSignUp: this.onClickSignUp,\n        isMobileSignupPage: this.props.isMobileSignupPage,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 278\n        },\n        __self: this\n      }));\n    }\n  }, {\n    key: \"allAgreed\",\n    get: function get() {\n      var allAgreed = true;\n\n      for (var key in this.state.agreed) {\n        if (!this.state.agreed[key]) {\n          allAgreed = false;\n          break;\n        }\n      }\n\n      return allAgreed;\n    }\n  }, {\n    key: \"allValid\",\n    get: function get() {\n      return this.validateFieldsAndAgreements(false);\n    }\n  }]);\n\n  return Container;\n}(Component); // function TermsPopup({ agreementType, text, onClickAgree }) {\n//   return (\n//     <div className=\"agreement\">\n//       <div className=\"agreement__title\">\n//         <FormattedMessage id={\"ID_SIGNUP_TERMS_AGREEMENT_\" + agreementType.toUpperCase()} />\n//       </div>\n//       <div className={`agreement__text agreement__text--${agreementType}`}>\n//         <Markdown source={text} />\n//       </div>\n//       <button\n//         className=\"popup_button\"\n//         onClick={() => {\n//           onClickAgree(agreementType);\n//         }}\n//       >\n//         <FormattedMessage id={\"ID_SIGNUP_AGREE\"} />\n//       </button>\n//     </div>\n//   );\n// }\n\nexport default connect(undefined, {\n  updateUserInfo: userInfoActions.updateUserInfo\n})(injectIntl(Container));","map":{"version":3,"sources":["/Users/jimmy/Documents/Wizschool/wizlab_web2/src/Common/Component/SignUp/Container.js"],"names":["React","Component","connect","injectIntl","PopUp","showPopUp","View","AGREEMENT","FIELD_TYPE","Validate","TrackingUtil","getRandomName","getRandomUserIcon","sha256","request","userInfoActions","SignIn","moment","Container","props","onChangeField","id","value","setState","LOGIN_ID","onLoginIdChanged","PASSWORD","onPasswordChanged","loginIdDuplicate","warnings","loginId","getWarning","pwValidation","length","passwordLength","state","password","mix","passwordComb","onBlurField","onLoginIdBlur","isValid","result","checkEmailDuplicate","then","res","json","isDuplicate","updateLoginIdDuplicateWarning","onClickLogin","mobileFullscreen","darkmode","onClickAgree","type","agreement","undefined","ALL","_allAgreed","allAgreed","agreed","SERVICE_TERMS","PRIVACY","MARKETING","onClickTerms","e","stopPropagation","window","open","onClickSignUp","validateFieldsAndAgreements","birth","params","email","year","month","date","format","icon","name","isMarketingAgreement","signup_new","success","kakaoPixelPageView","sendGTMEvent","setBizSpring","localStorage","setItem","token","updateUserInfo","user","intl","formatMessage","isMobileSignupPage","redirectHome","reason","location","replace","okSigns","updateWarning","BIRTH","getAgreementWarning","valid","Object","values","warning","key","fieldId","fieldValue","validation","validateField","requiredAgreed","isEmpty","_value","allValid"],"mappings":"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","sourcesContent":["import React, { Component } from 'react';\nimport { connect } from \"react-redux\";\nimport { injectIntl } from \"react-intl\";\nimport PopUp, { showPopUp } from \"../PopUp\";\nimport View from \"./View\";\nimport { AGREEMENT, FIELD_TYPE } from \"../../Util/Constant\";\nimport Validate from \"../../Util/Validate\";\nimport * as TrackingUtil from \"../../Util/TrackingUtil\";\nimport { getRandomName, getRandomUserIcon } from \"../../Util/RandomGenerator\";\nimport sha256 from \"../../Util/SHA256\";\nimport * as request from \"../../Util/HTTPRequest\";\nimport * as userInfoActions from \"../../Store/Reducer/UserInfo\";\nimport SignIn from \"../SignIn\";\nimport moment from 'moment';\n\nexport class Container extends Component {\n  constructor(props) {\n    super(props);\n\n    this.state = {\n      loginId: \"\",\n      password: \"\",\n      birth: {\n        year: undefined,\n        month: undefined,\n        date: undefined\n      },\n      agreed: {\n        [AGREEMENT.SERVICE_TERMS]: false,\n        [AGREEMENT.PRIVACY]: false,\n        [AGREEMENT.MARKETING]: false\n      },\n      pwValidation: {\n        length: undefined,\n        mix: undefined\n      },\n      warnings: {},\n      okSigns: {}\n    };\n  }\n\n  get allAgreed() {\n    let allAgreed = true;\n    for (const key in this.state.agreed) {\n      if (!this.state.agreed[key]) {\n        allAgreed = false;\n        break;\n      }\n    }\n    return allAgreed;\n  }\n\n  get allValid() {\n    return this.validateFieldsAndAgreements(false);\n  }\n\n  onChangeField = (id, value) => {\n    this.setState({ [id]: value }, () => {\n      if (FIELD_TYPE.LOGIN_ID === id)\n        this.onLoginIdChanged();\n      else if (FIELD_TYPE.PASSWORD === id)\n        this.onPasswordChanged();\n    });\n  }\n  onLoginIdChanged = () => {\n    this.loginIdDuplicate = false;\n    this.setState({\n      warnings: {\n        loginId: this.getWarning(FIELD_TYPE.LOGIN_ID)\n      }\n    });\n  }\n  onPasswordChanged = () => {\n    this.setState({\n      warnings: {},\n      pwValidation: {\n        length: Validate.passwordLength(this.state.password),\n        mix: Validate.passwordComb(this.state.password)\n      }\n    });\n  }\n  \n  onBlurField = (id, value) => {\n    if (FIELD_TYPE.LOGIN_ID === id)\n      this.onLoginIdBlur(value);\n  }\n  onLoginIdBlur = loginId => {\n    const { result: isValid } = Validate.loginId(loginId);\n    if (isValid) {\n      request.checkEmailDuplicate(loginId)\n        .then(res => res.json())\n        .then(json => {\n          const isDuplicate = !json;\n          this.updateLoginIdDuplicateWarning(isDuplicate);\n        })\n    }\n  }\n  updateLoginIdDuplicateWarning(isDuplicate) {\n    this.loginIdDuplicate = isDuplicate;\n    this.setState({\n      warnings: {\n       ...this.state.warnings,\n       loginId: this.getWarning(FIELD_TYPE.LOGIN_ID)\n      },\n      okSigns: {\n        ...this.state.okSigns,\n        loginId: isDuplicate ? undefined \n          : this.props.intl.formatMessage({ id: \"ID_VALIDATE_SUCCESS_LOGINID\" })\n      }\n    });\n  }\n\n  onClickLogin = () => {\n    showPopUp(<SignIn />, {\n      mobileFullscreen: true,\n      darkmode: true\n    });\n  }\n\n  onClickAgree = type => {\n    this.setState({\n      warnings: {\n        ...this.state.warnings,\n        agreement: undefined\n      }\n    })\n    if (AGREEMENT.ALL === type) {\n      const _allAgreed = this.allAgreed;\n      this.setState({\n        agreed: {\n          [AGREEMENT.SERVICE_TERMS]: !_allAgreed,\n          [AGREEMENT.PRIVACY]: !_allAgreed,\n          [AGREEMENT.MARKETING]: !_allAgreed\n        }\n      })\n    } else {\n      this.setState({\n        agreed: {\n          ...this.state.agreed,\n          [type]: !this.state.agreed[type]\n        } \n      });\n    }\n  }\n\n  onClickTerms = (e, type) => {\n    e.stopPropagation();\n    switch(type) {\n      case AGREEMENT.SERVICE_TERMS:\n        window.open(\"/support/terms\", \"_blank\");\n        break;\n      case AGREEMENT.PRIVACY:\n        window.open(\"/support/privacy\", \"_blank\");\n        break;\n      default:\n        break;\n    }\n  }\n\n  onClickSignUp = () => {\n    const isValid = this.validateFieldsAndAgreements(true);\n    if (!isValid) return;\n\n    const { loginId, password, birth, agreed } = this.state;\n    const params = {\n      email: loginId,\n      password: sha256(password),\n      birth: moment([birth.year, birth.month, birth.date]).format(\"YYYY-MM-DD\"),\n      icon: getRandomUserIcon(),\n      name: getRandomName(),\n      isMarketingAgreement: agreed[AGREEMENT.MARKETING]\n    };\n\n    request\n      .signup_new(params)\n      .then(res => res.json())\n      .then(json => {\n        if (json.success) {\n          TrackingUtil.kakaoPixelPageView(\"completeRegistration\");\n          TrackingUtil.sendGTMEvent(\"Signup_Success\");\n\n          window.setBizSpring();\n\n          localStorage.setItem(\"wizToken\", json.token);\n          this.props.updateUserInfo(json.user);\n\n          showPopUp(\n            <PopUp.OneButton\n              title={this.props.intl.formatMessage({ id: \"ID_SIGNUP_SIGNED_TITLE\" })}\n              buttonName={this.props.intl.formatMessage({ id: \"ID_SIGNUP_SIGNED_CONFIRM\" })}\n              buttonAction={this.props.isMobileSignupPage ? this.redirectHome : false}\n            />,\n            { darkmode: true }\n          );\n        } else if (json.reason === \"DUPLICATE_ERROR\") {\n          this.updateLoginIdDuplicateWarning(true);\n        }\n      });\n  }\n\n  redirectHome = () => {\n    window.location.replace(\"/\");\n  }\n\n  validateFieldsAndAgreements(updateWarning) {\n    const warnings = {\n      ...this.state.warnings,\n      loginId: this.getWarning(FIELD_TYPE.LOGIN_ID),\n      password: this.getWarning(FIELD_TYPE.PASSWORD),\n      birth: this.getWarning(FIELD_TYPE.BIRTH),\n      agreement: this.getAgreementWarning()\n    };\n    if (updateWarning) {\n      this.setState({\n        warnings\n      });\n    }\n\n    let valid = true;\n    for (const warning of Object.values(warnings)) {\n      if (warning) {\n        valid = false;\n        break;\n      }\n    }\n    if (valid) {\n      const pwValidation = this.state.pwValidation;\n      for (const key in pwValidation) {\n        if (!pwValidation[key]) {\n          valid = false;\n          break;\n        }\n      }\n    }\n    return valid;\n  }\n  getWarning(fieldId) {\n    const fieldValue = this.state[fieldId];\n    const validation = this.validateField(fieldId, fieldValue);\n    if (validation.result) {\n      return undefined;\n    } else {\n      return this.props.intl.formatMessage({ id: validation.id });\n    }\n  }\n  getAgreementWarning() {\n    const agreed = this.state.agreed;\n    const requiredAgreed = agreed[AGREEMENT.SERVICE_TERMS] && agreed[AGREEMENT.PRIVACY];\n    if (requiredAgreed) {\n      return undefined;\n    } else {\n      return this.props.intl.formatMessage({ id: \"ID_SIGNUP_WARNING_AGREEMENT\" });\n    }\n  }\n  validateField(fieldId, value) {\n    switch (fieldId) {\n      case \"loginId\":\n        if (this.loginIdDuplicate) {\n          return { result: false, id: \"ID_VALIDATE_FAIL_LOGINID_DUPLICATE\" };\n        } else {\n          return Validate.loginId(value);\n        }\n      case \"password\":\n        return Validate.isEmpty(value, \"ID_VALIDATE_FAIL_PW_NULL\");\n      case \"birth\": {\n        for (const _value of Object.values(value)) {\n          if (_value === undefined) return { result: false, id: \"ID_VALIDATE_FAIL_BIRTH_NULL\" };\n        }\n        return { result: true };\n      }\n      default:\n        return { result: true };\n    }\n  }\n\n  render() {\n    return (\n      <View\n        { ...this.state }\n        allAgreed={this.allAgreed}\n        allValid={this.allValid}\n        onChangeField={this.onChangeField}\n        onBlurField={this.onBlurField}\n        onClickLogin={this.onClickLogin}\n        onClickAgree={this.onClickAgree}\n        onClickTerms={this.onClickTerms}\n        onClickSignUp={this.onClickSignUp}\n        isMobileSignupPage={this.props.isMobileSignupPage}\n      />\n    )\n  }\n}\n\n// function TermsPopup({ agreementType, text, onClickAgree }) {\n//   return (\n//     <div className=\"agreement\">\n//       <div className=\"agreement__title\">\n//         <FormattedMessage id={\"ID_SIGNUP_TERMS_AGREEMENT_\" + agreementType.toUpperCase()} />\n//       </div>\n//       <div className={`agreement__text agreement__text--${agreementType}`}>\n//         <Markdown source={text} />\n//       </div>\n//       <button\n//         className=\"popup_button\"\n//         onClick={() => {\n//           onClickAgree(agreementType);\n//         }}\n//       >\n//         <FormattedMessage id={\"ID_SIGNUP_AGREE\"} />\n//       </button>\n//     </div>\n//   );\n// }\n\nexport default connect(\n  undefined,\n  {\n    updateUserInfo: userInfoActions.updateUserInfo\n  }\n)(injectIntl(Container));\n"]},"metadata":{},"sourceType":"module"}