{"ast":null,"code":"import _classCallCheck from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";\nimport _assertThisInitialized from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/assertThisInitialized\";\nimport _inherits from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";\nimport _possibleConstructorReturn from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";\nvar _jsxFileName = \"/Users/jimmy/Documents/Wizschool/wizlab_web2/src/Page/Builder/Component/Videoclass/Container.js\";\n\nfunction _createSuper(Derived) { var hasNativeReflectConstruct = _isNativeReflectConstruct(); return function _createSuperInternal() { var Super = _getPrototypeOf(Derived), result; if (hasNativeReflectConstruct) { var NewTarget = _getPrototypeOf(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return _possibleConstructorReturn(this, result); }; }\n\nfunction _isNativeReflectConstruct() { if (typeof Reflect === \"undefined\" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === \"function\") return true; try { Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {})); return true; } catch (e) { return false; } }\n\nimport React, { Component } from \"react\";\nimport { connect } from \"react-redux\";\nimport { withRouter } from \"react-router-dom\";\nimport { injectIntl } from \"react-intl\";\nimport * as previewActions from \"../../Store/Reducer/preview\";\nimport * as sceneActions from \"../../Store/Reducer/scene\";\nimport { VCTYPE } from \"../../../../Common/Util/Constant\";\nimport RndWrapper from \"../../utils/RndWrapper\";\nimport { checkConditions, checkGameEvent } from \"./util/condition\";\nimport { createEgoMessage } from \"./util/ego\";\nimport View from \"./View\";\nimport { showPopUp } from \"../../../../Common/Component/PopUp\";\nimport ReactDOM from \"react-dom\";\nimport wizclassPlayImg from \"../../../../Image/wizclass__play.svg\"; // import successImg from \"../../../../Image/videoclass/success-step-kr.png\";\n\nimport checkImg from \"../../../../Image/circle-check.svg\";\nimport closeImg from \"../../../../Image/close-btn-popup2.svg\";\nimport template from \"./template\";\n\nvar Container = /*#__PURE__*/function (_Component) {\n  _inherits(Container, _Component);\n\n  var _super = _createSuper(Container);\n\n  function Container(props) {\n    var _this;\n\n    _classCallCheck(this, Container);\n\n    _this = _super.call(this, props);\n\n    _this.updateConditionInterval = function () {\n      if (_this.checkConditionInterval) clearInterval(_this.checkConditionInterval);\n      if (_this.checkCodeInterval) clearInterval(_this.checkCodeInterval);\n      var currentStage = _this.state.currentStage;\n      var isClear = currentStage.isClear,\n          conditions = currentStage.conditions,\n          successDelay = currentStage.successDelay; // 이미 성공한 단계이거나 조건이 없는 단계면 검사하지 않음\n\n      if (!isClear && conditions) {\n        // 실행 조건이 있을 때, 코드 조건을 만족하면 실행 유도\n        if (conditions.findIndex(function (condition) {\n          return condition.type === VCTYPE.CONDITION.PLAY_ONCE;\n        }) > -1) {\n          _this.checkCodeInterval = setInterval(function () {\n            checkConditions(_this.videoclass, _this.props.state, {\n              successHandler: function successHandler() {\n                // this.props.flash(FLASHID.PLAY);\n                _this.egoSay([{\n                  type: VCTYPE.EGO.PLAY\n                }]);\n\n                clearInterval(_this.checkCodeInterval);\n              },\n              codeOnly: true\n            });\n          }, 1000);\n        } // 모든 조건을 만족하면 성공 표시\n\n\n        _this.checkConditionInterval = setInterval(function () {\n          checkConditions(_this.videoclass, _this.props.state, {\n            successHandler: function successHandler() {\n              currentStage.isClear = true;\n\n              if (!(conditions.length === 1 && (conditions[0].type === VCTYPE.CONDITION.SPRITE_SELECTED || conditions[0].type === VCTYPE.CONDITION.SCENE_SELECTED))) {\n                _this.successTimeout = setTimeout(function () {\n                  _this.showSuccess();\n                }, successDelay || 2000);\n              }\n\n              clearInterval(_this.checkConditionInterval);\n            }\n          });\n        }, 1000);\n      }\n    };\n\n    _this.nextStage = function () {\n      var nextStageNum = isNaN(_this.state.currentStage.nextStageNum) ? _this.videoclass.currentStageNum + 1 : _this.state.currentStage.nextStageNum;\n\n      if (nextStageNum < _this.maxStageNum) {\n        var currentStage = _this.videoclass.stages[nextStageNum];\n        currentStage.prevStageNum = _this.videoclass.currentStageNum;\n        _this.videoclass.currentStageNum = nextStageNum;\n\n        _this.setState({\n          currentStage: currentStage\n        }, function () {\n          var ego = currentStage.ego;\n\n          if (ego && ego.onStage) {\n            setTimeout(function () {\n              _this.egoSay(ego.onStage);\n            }, 2000);\n          } else {\n            _this.egoSay();\n          }\n\n          if (_this.successTimeout) {\n            clearTimeout(_this.successTimeout);\n          }\n\n          _this.updateConditionInterval();\n\n          _this.hideSuccess();\n\n          _this.props.setIsPlaying(false);\n\n          if (_this.videoclass.currentStageNum === _this.maxStageNum - 1) {\n            if (_this.onEndStage) _this.onEndStage();\n          }\n\n          if (_this.ocpFooterListenerForStageNumChange) {\n            _this.ocpFooterListenerForStageNumChange();\n          }\n        });\n      }\n    };\n\n    _this.prevStage = function () {\n      var prevStageNum = isNaN(_this.state.currentStage.prevStageNum) ? _this.videoclass.currentStageNum - 1 : _this.state.currentStage.prevStageNum;\n\n      if (prevStageNum >= 0) {\n        var currentStage = _this.videoclass.stages[prevStageNum];\n        _this.videoclass.currentStageNum = prevStageNum;\n\n        _this.setState({\n          currentStage: currentStage\n        }, function () {\n          _this.egoSay();\n\n          _this.updateConditionInterval();\n\n          _this.props.setIsPlaying(false);\n\n          if (_this.ocpFooterListenerForStageNumChange) {\n            _this.ocpFooterListenerForStageNumChange();\n          }\n        });\n      }\n    };\n\n    _this.onClickBranch = function (branch) {\n      var stageNum = branch.stageNum;\n\n      if (0 <= stageNum && stageNum < _this.maxStageNum) {\n        var currentStage = _this.videoclass.stages[stageNum];\n        var prevStageNum = _this.videoclass.currentStageNum;\n        if (prevStageNum < stageNum) currentStage.prevStageNum = prevStageNum;\n        _this.videoclass.currentStageNum = stageNum;\n\n        _this.setState({\n          currentStage: currentStage\n        }, function () {\n          _this.egoSay();\n\n          _this.updateConditionInterval();\n\n          _this.props.setIsPlaying(false);\n        });\n      }\n    };\n\n    _this.onKeydown = function (e) {\n      _this.keyPressed[e.key] = true;\n\n      if (_this.keyPressed[\"Shift\"] && _this.keyPressed[\"W\"] && _this.keyPressed[\"ArrowRight\"]) {\n        _this.nextStage();\n      }\n    };\n\n    _this.onKeyup = function (e) {\n      delete _this.keyPressed[e.key];\n    };\n\n    _this.addForceNextListener = function () {\n      _this.keyPressed = {};\n      document.addEventListener(\"keydown\", _this.onKeydown);\n      document.addEventListener(\"keyup\", _this.onKeyup);\n    };\n\n    _this.removeForceNextListener = function () {\n      document.removeEventListener(\"keydown\", _this.onKeydown);\n      document.removeEventListener(\"keyup\", _this.onKeyup);\n    };\n\n    _this.onClickNext = function () {\n      var intl = _this.props.intl;\n      var currentStage = _this.state.currentStage;\n\n      if (currentStage.isClear) {\n        _this.nextStage();\n      } else {\n        checkConditions(_this.videoclass, _this.props.state, {\n          successHandler: function successHandler() {\n            currentStage.isClear = true;\n\n            _this.nextStage();\n          },\n          failureHandler: function failureHandler(condition) {\n            _this.egoSay([{\n              type: VCTYPE.EGO.TEXT,\n              data: createEgoMessage(condition, _this.videoclass.customSpriteIdMap, intl)\n            }]);\n          }\n        });\n      }\n    };\n\n    _this.onClickPrev = function () {\n      _this.prevStage();\n    };\n\n    _this.onClickList = function () {\n      _this.showSidebar();\n\n      _this.updateStagesScroll();\n    };\n\n    _this.onClickHint = function () {\n      var hint = _this.state.currentStage.hint;\n      if (hint) _this.egoSay(hint);\n    };\n\n    _this.onClickAnsw = function () {\n      var answer = _this.state.currentStage.answer;\n      if (answer) _this.egoSay(answer, 300000);\n    };\n\n    _this.showSidebar = function () {\n      _this.setState({\n        isSidebarHidden: false\n      });\n    };\n\n    _this.hideSidebar = function () {\n      _this.setState({\n        isSidebarHidden: true\n      });\n    };\n\n    _this.onClickSidebarOverlay = function () {\n      _this.hideSidebar();\n    };\n\n    _this.onClickStage = function (stageNum) {\n      var currentStage = _this.videoclass.stages[stageNum];\n      _this.videoclass.currentStageNum = stageNum;\n\n      _this.setState({\n        currentStage: currentStage\n      }, function () {\n        _this.egoSay();\n\n        _this.updateConditionInterval();\n\n        _this.hideSidebar();\n\n        _this.hideSuccess();\n\n        _this.props.setIsPlaying(false);\n      });\n    };\n\n    _this.updateStagesScroll = function () {\n      var stagesElement = document.getElementById(\"vc_stages\");\n      var currentStageElement = document.getElementById(\"vc_stage-\".concat(_this.videoclass.currentStageNum));\n\n      if (stagesElement && currentStageElement) {\n        stagesElement.scrollTop = currentStageElement.offsetTop - stagesElement.offsetHeight / 3;\n      }\n    };\n\n    _this.toggleNav = function () {\n      _this.setState({\n        isNavOpen: !_this.state.isNavOpen\n      });\n    };\n\n    _this.setVideoRef = function (element) {\n      if (!element) return;\n      if (_this.videoRef) _this.videoRef.pause();\n      _this.videoRef = element;\n      _this.videoRef.disablePictureInPicture = true;\n      _this.videoRef.onplay = _this.videoOnplay;\n      _this.videoRef.onpause = _this.videoOnpause;\n      _this.videoRef.onended = _this.videoOnended;\n      _this.videoRef.onmouseout = _this.videoOnmouseout;\n      _this.videoRef.onmousemove = _this.videoOnmousemove;\n      _this.videoRef.ondblclick = _this.videoOndblclick;\n    };\n\n    _this.videoOnplay = function (e) {\n      _this.setState({\n        isVideoPlaying: true\n      });\n    };\n\n    _this.videoOnpause = function (e) {\n      _this.setState({\n        isVideoPlaying: false\n      });\n    };\n\n    _this.videoOnended = function (e) {\n      _this.setState({\n        isVideoPlaying: false\n      }, function () {\n        _this.nextStage();\n      });\n    };\n\n    _this.videoOnmouseout = function (e) {\n      if (_this.state.isVideoPlaying) {\n        if (_this.hideVideoUITimeeout) clearTimeout(_this.hideVideoUITimeeout);\n\n        _this.setState({\n          isVideoUIHidden: true\n        });\n      }\n    };\n\n    _this.videoOnmousemove = function (e) {\n      _this.setState({\n        isVideoUIHidden: false\n      });\n\n      if (_this.hideVideoUITimeeout) clearTimeout(_this.hideVideoUITimeeout);\n      _this.hideVideoUITimeeout = setTimeout(function () {\n        if (_this.state.isVideoPlaying) {\n          _this.setState({\n            isVideoUIHidden: true\n          });\n        }\n      }, 2500);\n    };\n\n    _this.videoOndblclick = function (e) {\n      e.preventDefault();\n      return false;\n    };\n\n    _this.showSuccess = function () {\n      if (_this.successAudio) {\n        _this.successAudio.pause();\n\n        _this.successAudio.currentTime = 0;\n\n        _this.successAudio.play();\n      } // this.setState({ isSuccessHidden: false });\n\n\n      var formatMessage = _this.props.intl.formatMessage;\n\n      _this.props.showModal(React.createElement(\"div\", {\n        className: \"vc_success_container\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 494\n        },\n        __self: this\n      }, React.createElement(\"img\", {\n        className: \"vc_success_icon\",\n        src: checkImg,\n        alt: \"success\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 496\n        },\n        __self: this\n      }), React.createElement(\"img\", {\n        className: \"close-img\",\n        src: closeImg,\n        alt: \"close\",\n        onClick: _this.hideSuccess,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 497\n        },\n        __self: this\n      }), React.createElement(\"div\", {\n        className: \"textWrapper\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 503\n        },\n        __self: this\n      }, React.createElement(\"p\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 504\n        },\n        __self: this\n      }, formatMessage({\n        id: \"ID_VIDEOCLASS_MISSION_SUCCESS01\"\n      })), React.createElement(\"p\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 505\n        },\n        __self: this\n      }, formatMessage({\n        id: \"ID_VIDEOCLASS_MISSION_SUCCESS02\"\n      })), React.createElement(\"p\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 506\n        },\n        __self: this\n      }, formatMessage({\n        id: \"ID_VIDEOCLASS_MISSION_SUCCESS03\"\n      }))), React.createElement(\"div\", {\n        className: \"vc_success_buttons\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 508\n        },\n        __self: this\n      }, React.createElement(\"div\", {\n        className: \"vc_success_button vc_success_button-more\",\n        onClick: _this.onClickSuccessMore,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 509\n        },\n        __self: this\n      }, React.createElement(\"span\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 513\n        },\n        __self: this\n      }, formatMessage({\n        id: \"ID_VIDEOCLASS_SUCCESS_MORE\"\n      }))), React.createElement(\"div\", {\n        className: \"vc_success_button vc_success_button-next\",\n        onClick: _this.onClickSuccessNext,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 515\n        },\n        __self: this\n      }, React.createElement(\"span\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 519\n        },\n        __self: this\n      }, formatMessage({\n        id: \"ID_VIDEOCLASS_SUCCESS_NEXT\"\n      }))))));\n    };\n\n    _this.hideSuccess = function () {\n      // this.setState({ isSuccessHidden: true });\n      _this.props.showModal(null);\n    };\n\n    _this.onClickSuccessNext = function () {\n      _this.nextStage();\n    };\n\n    _this.onClickSuccessMore = function () {\n      _this.hideSuccess();\n    };\n\n    _this.setEgoRef = function (egoRef) {\n      if (!egoRef) return;\n      _this.egoRef = egoRef.getWrappedInstance();\n    };\n\n    _this.egoSay = function (egoMessages, timeout) {\n      if (_this.egoRef) _this.egoRef.egoSay(egoMessages, timeout);\n    };\n\n    _this.onClickEgo = function () {\n      var ego = _this.state.currentStage.ego;\n\n      if (ego) {\n        _this.egoSay(ego, 5000);\n      }\n    };\n\n    _this.showCustomContent = function (content, onsetstate) {\n      _this.setState({\n        customContent: content\n      }, function () {\n        if (onsetstate) onsetstate();\n      });\n    };\n\n    _this.handleOcpLevelChange = function (level) {\n      _this.props.history.replace(\"./\".concat(level));\n\n      window.location.reload();\n    };\n\n    _this.handleNavInteraction = function () {\n      if (_this.navCloseTimeout) {\n        clearTimeout(_this.navCloseTimeout);\n      }\n    };\n\n    _this.closeWizClassGame = function () {\n      _this.setState({\n        isOpenWizclassGame: false\n      }, function () {\n        var footerControl = document.querySelector(\".ocpView_footer_stageControl\");\n\n        if (footerControl) {\n          footerControl.style.visibility = \"visible\";\n        }\n      });\n    };\n\n    if (props.videoclass) {\n      _this.videoclass = props.videoclass;\n    } else {\n      _this.videoclass = template;\n    }\n\n    if (props.setRef) {\n      props.setRef(_assertThisInitialized(_this));\n    }\n\n    _this.onEndStage = props.onEndStage;\n    _this.endStageButtonAction = props.endStageButtonAction;\n    _this.endStageButtonId = props.endStageButtonId;\n    _this.checkConditionInterval = null;\n    _this.checkCodeInterval = null;\n    _this.videoRef = null;\n    _this.egoRef = null;\n    _this.successAudio = new Audio(\"https://wizschool-assets.oss-cn-shanghai.aliyuncs.com/sfx/effect_3.mp3\");\n    var currentStageNum = _this.videoclass.currentStageNum;\n    var _currentStage = _this.videoclass.stages[currentStageNum];\n    _this.maxStageNum = _this.videoclass.stages.length;\n    _this.state = {\n      currentStage: _currentStage,\n      isSidebarHidden: true,\n      isVideoPlaying: false,\n      isVideoUIHidden: false,\n      isSuccessHidden: true,\n      customContent: null,\n      isNavOpen: false,\n      isOpenWizclassGame: false,\n      wizclassGameUrl: \"\"\n    };\n    return _this;\n  }\n\n  _createClass(Container, [{\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      var _this2 = this;\n\n      this.props.hideLockSprite(null, true);\n      this.updateConditionInterval();\n      this.addForceNextListener();\n      var currentStage = this.state.currentStage;\n\n      if (!currentStage.isOpen) {\n        currentStage.isOpen = true;\n      }\n\n      var isFromWizclass = this.props.email === \"multicampus01@wizschool.io\" || this.props.email === \"multicampus02@wizschool.io\" || this.props.email === \"multicampus03@wizschool.io\" || this.props.email === \"dream01@wizschool.io\" || this.props.email === \"dream02@wizschool.io\" || this.props.email === \"dream03@wizschool.io\";\n\n      if (isFromWizclass && this.props.match.params && this.props.match.params.type === \"escape\") {\n        if (this.props.videoclass.level === 1) {\n          var wizclassGameUrl;\n\n          if (this.videoclass.title.startsWith(\"초급\")) {\n            wizclassGameUrl = \"https://wizschool-published.s3.ap-northeast-2.amazonaws.com/5ae60ab3-f5ae-4084-93ee-a59be680f184.html\";\n          }\n\n          if (this.videoclass.title.startsWith(\"중급\")) {\n            wizclassGameUrl = \"https://wizschool-published.s3.ap-northeast-2.amazonaws.com/364d12bd-2af9-42e1-8eec-2005fbb063fa.html\";\n          }\n\n          if (this.videoclass.title.startsWith(\"고급\")) {\n            wizclassGameUrl = \"https://wizschool-published.s3.ap-northeast-2.amazonaws.com/d858e0f6-85fc-4d53-b4e4-19b35090bbe7.html\";\n          }\n\n          this.setState({\n            isNavOpen: false,\n            isOpenWizclassGame: true,\n            wizclassGameUrl: wizclassGameUrl\n          }, function () {\n            var footerControl = document.querySelector(\".ocpView_footer_stageControl\");\n\n            if (footerControl) {\n              footerControl.style.visibility = \"hidden\";\n            }\n\n            showPopUp(React.createElement(\"div\", {\n              className: \"wizclass__game__popup\",\n              __source: {\n                fileName: _jsxFileName,\n                lineNumber: 111\n              },\n              __self: this\n            }, React.createElement(\"img\", {\n              src: wizclassPlayImg,\n              alt: \"play\",\n              __source: {\n                fileName: _jsxFileName,\n                lineNumber: 112\n              },\n              __self: this\n            }), React.createElement(\"div\", {\n              className: \"wizclass__game__popup__title\",\n              __source: {\n                fileName: _jsxFileName,\n                lineNumber: 113\n              },\n              __self: this\n            }, \"\\uD654\\uBA74\\uC744 \\uD130\\uCE58\\uD574\\uC11C \\uC644\\uC131\\uB41C \\uAC8C\\uC784\\uC744 \\n \\uBA3C\\uC800 \\uC2E4\\uD589\\uD574\\uBCF4\\uC138\\uC694.\"), React.createElement(\"div\", {\n              className: \"wizclass__game__popup__desc\",\n              __source: {\n                fileName: _jsxFileName,\n                lineNumber: 116\n              },\n              __self: this\n            }, \"\\uBC29\\uC744 \\uD0C8\\uCD9C\\uD558\\uBA74 \\uAC8C\\uC784\\uC774 \\uD074\\uB9AC\\uC5B4\\uB429\\uB2C8\\uB2E4.\"), React.createElement(\"div\", {\n              className: \"wizclass__game__popup__button\",\n              onClick: function onClick() {\n                var popup = document.getElementById(\"popup\");\n\n                if (popup) {\n                  ReactDOM.render(null, popup);\n                }\n              },\n              __source: {\n                fileName: _jsxFileName,\n                lineNumber: 119\n              },\n              __self: this\n            }, \"\\uC2E4\\uD589\")));\n          });\n        } else {\n          setTimeout(function () {\n            _this2.setState({\n              isNavOpen: true\n            });\n          }, 500);\n          this.navCloseTimeout = setTimeout(function () {\n            _this2.setState({\n              isNavOpen: false\n            });\n          }, 5000);\n        }\n      } else {\n        setTimeout(function () {\n          _this2.setState({\n            isNavOpen: true\n          });\n        }, 500);\n        this.navCloseTimeout = setTimeout(function () {\n          _this2.setState({\n            isNavOpen: false\n          });\n        }, 5000);\n      }\n    }\n  }, {\n    key: \"componentWillUnmount\",\n    value: function componentWillUnmount() {\n      if (this.checkConditionInterval) clearInterval(this.checkConditionInterval);\n      if (this.checkCodeInterval) clearInterval(this.checkCodeInterval);\n      this.removeForceNextListener();\n    }\n  }, {\n    key: \"shouldComponentUpdate\",\n    value: function shouldComponentUpdate(nextProps, nextState) {\n      var _this3 = this;\n\n      var _this$state$currentSt = this.state.currentStage,\n          isClear = _this$state$currentSt.isClear,\n          conditions = _this$state$currentSt.conditions,\n          customIdMap = _this$state$currentSt.customIdMap;\n\n      if (!isClear && conditions) {\n        // 조건 업데이트\n        conditions.forEach(function (condition) {\n          if (condition.isClear) return;\n\n          if (condition.type === VCTYPE.CONDITION.PLAY_ONCE) {\n            // 게임 실행 조건 업데이트\n            if (nextProps.isPlaying) {\n              condition.isClear = true;\n            }\n          } else if (condition.type === VCTYPE.CONDITION.GAME_EVENT) {\n            // 게임 이벤트 조건 업데이트\n            if (checkGameEvent(condition.event, nextProps.lastGameEvent, customIdMap)) {\n              condition.isClear = true;\n            }\n          }\n        }); // 코드 조건을 만족하지 않고 게임 실행하면 에고가 안내\n\n        if (this.props.isPlaying !== nextProps.isPlaying && nextProps.isPlaying) {\n          checkConditions(this.videoclass, this.props.state, {\n            failureHandler: function failureHandler(condition) {\n              setTimeout(function () {\n                _this3.egoSay([{\n                  type: VCTYPE.EGO.TEXT,\n                  data: createEgoMessage(condition, _this3.videoclass.customSpriteIdMap, _this3.props.intl)\n                }]);\n              }, 2000);\n            },\n            codeOnly: true\n          });\n        }\n      } // 게임 이벤트 렌더링 최적화\n\n\n      if (JSON.stringify(this.props.lastGameEvent) !== JSON.stringify(nextProps.lastGameEvent)) {\n        return false;\n      }\n\n      return true;\n    }\n  }, {\n    key: \"componentDidUpdate\",\n    value: function componentDidUpdate(prevProps, prevState) {\n      var currentStage = this.state.currentStage;\n\n      if (!currentStage.isOpen) {\n        currentStage.isOpen = true;\n      }\n\n      if (prevProps.maxOcpLevel !== this.props.maxOcpLevel) {\n        if (this.props.setRef) {\n          this.props.setRef(this);\n        }\n      }\n    } // condition check by interval\n\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _this$props = this.props,\n          intl = _this$props.intl,\n          zIndex = _this$props.zIndex,\n          handleChangeZIndex = _this$props.handleChangeZIndex,\n          fixed = _this$props.fixed,\n          isPlaying = _this$props.isPlaying;\n      var _this$state = this.state,\n          currentStage = _this$state.currentStage,\n          isSidebarHidden = _this$state.isSidebarHidden,\n          isVideoPlaying = _this$state.isVideoPlaying,\n          isVideoUIHidden = _this$state.isVideoUIHidden,\n          isSuccessHidden = _this$state.isSuccessHidden,\n          customContent = _this$state.customContent,\n          isNavOpen = _this$state.isNavOpen,\n          isOpenWizclassGame = _this$state.isOpenWizclassGame,\n          wizclassGameUrl = _this$state.wizclassGameUrl;\n      var classTitle = this.videoclass.title;\n      var stages = this.videoclass.stages;\n      var currentStageNum = this.videoclass.currentStageNum;\n      var isStartStage = this.videoclass.currentStageNum === 0;\n      var isEndStage = this.videoclass.currentStageNum === this.maxStageNum - 1;\n      var withRnd = currentStage.type === VCTYPE.STEP.CODE || currentStage.type === VCTYPE.STEP.IMAGE && currentStage.conditions && currentStage.conditions.length > 0 && (currentStage.conditions[0].type === VCTYPE.CONDITION.SCENE_SELECTED || currentStage.conditions[0].type === VCTYPE.CONDITION.SPRITE_SELECTED);\n      var fullScreen = !withRnd;\n      var view = React.createElement(View, {\n        intl: intl,\n        fixed: fixed,\n        fullScreen: fullScreen,\n        handleChangeZIndex: handleChangeZIndex,\n        currentStage: currentStage,\n        isSidebarHidden: isSidebarHidden,\n        isVideoPlaying: isVideoPlaying,\n        isVideoUIHidden: isVideoUIHidden,\n        isSuccessHidden: isSuccessHidden,\n        customContent: customContent,\n        stages: stages,\n        currentStageNum: currentStageNum,\n        isStartStage: isStartStage,\n        isEndStage: isEndStage,\n        onClickNext: this.onClickNext,\n        onClickPrev: this.onClickPrev,\n        onClickList: this.onClickList,\n        onClickHint: this.onClickHint,\n        onClickAnsw: this.onClickAnsw,\n        onClickStage: this.onClickStage,\n        onClickSidebarOverlay: this.onClickSidebarOverlay,\n        setVideoRef: this.setVideoRef,\n        onClickSuccessNext: this.onClickSuccessNext,\n        onClickSuccessMore: this.onClickSuccessMore,\n        setEgoRef: this.setEgoRef,\n        onClickEgo: this.onClickEgo,\n        endStageButtonAction: this.endStageButtonAction,\n        endStageButtonId: this.endStageButtonId,\n        classTitle: classTitle,\n        maxOcpLevel: this.props.maxOcpLevel,\n        currentOcpLevel: this.props.videoclass.level,\n        handleOcpLevelChange: this.handleOcpLevelChange,\n        isNavOpen: isNavOpen,\n        toggleNav: this.toggleNav,\n        isPlaying: isPlaying,\n        handleNavInteraction: this.handleNavInteraction,\n        isOpenWizclassGame: isOpenWizclassGame,\n        closeWizClassGame: this.closeWizClassGame,\n        wizclassGameUrl: wizclassGameUrl,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 608\n        },\n        __self: this\n      });\n\n      if (fixed) {\n        var contentMain = document.getElementsByClassName(\"Content_Main\")[0];\n\n        if (contentMain) {\n          contentMain.style.position = fullScreen ? \"absolute\" : \"relative\";\n        }\n\n        return view;\n      } // Code, SelectSprite, SelectScene 은 전체화면이 아니다.\n\n\n      if (withRnd) {\n        view = React.createElement(RndWrapper, {\n          id: \"videoclass\",\n          style: {\n            zIndex: zIndex\n          },\n          defaultWidth: 550,\n          defaultHeight: 550 * 9 / 16 + 35,\n          defaultX: document.body.clientWidth - 630,\n          defaultY: 16,\n          minWidth: 550,\n          minHeight: 550 * 9 / 16 + 35,\n          lockAspectRatio: 16 / 9,\n          lockAspectRatioExtraHeight: 35,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 662\n          },\n          __self: this\n        }, view);\n      }\n\n      return view;\n    }\n  }]);\n\n  return Container;\n}(Component);\n\nexport default connect(function (state) {\n  return {\n    state: state,\n    lastGameEvent: state.game.lastEvent,\n    isPlaying: state.preview.isPlaying,\n    email: state.userinfo.email\n  };\n}, {\n  setIsPlaying: previewActions.setIsPlaying,\n  hideLockSprite: sceneActions.hideLockSprite\n})(withRouter(injectIntl(Container)));","map":{"version":3,"sources":["/Users/jimmy/Documents/Wizschool/wizlab_web2/src/Page/Builder/Component/Videoclass/Container.js"],"names":["React","Component","connect","withRouter","injectIntl","previewActions","sceneActions","VCTYPE","RndWrapper","checkConditions","checkGameEvent","createEgoMessage","View","showPopUp","ReactDOM","template","Container","props","updateConditionInterval","checkConditionInterval","clearInterval","checkCodeInterval","currentStage","state","isClear","conditions","successDelay","findIndex","condition","type","CONDITION","PLAY_ONCE","setInterval","videoclass","successHandler","egoSay","EGO","PLAY","codeOnly","length","SPRITE_SELECTED","SCENE_SELECTED","successTimeout","setTimeout","showSuccess","nextStage","nextStageNum","isNaN","currentStageNum","maxStageNum","stages","prevStageNum","setState","ego","onStage","clearTimeout","hideSuccess","setIsPlaying","onEndStage","ocpFooterListenerForStageNumChange","prevStage","onClickBranch","branch","stageNum","onKeydown","e","keyPressed","key","onKeyup","addForceNextListener","document","addEventListener","removeForceNextListener","removeEventListener","onClickNext","intl","failureHandler","TEXT","data","customSpriteIdMap","onClickPrev","onClickList","showSidebar","updateStagesScroll","onClickHint","hint","onClickAnsw","answer","isSidebarHidden","hideSidebar","onClickSidebarOverlay","onClickStage","stagesElement","getElementById","currentStageElement","scrollTop","offsetTop","offsetHeight","toggleNav","isNavOpen","setVideoRef","element","videoRef","pause","disablePictureInPicture","onplay","videoOnplay","onpause","videoOnpause","onended","videoOnended","onmouseout","videoOnmouseout","onmousemove","videoOnmousemove","ondblclick","videoOndblclick","isVideoPlaying","hideVideoUITimeeout","isVideoUIHidden","preventDefault","successAudio","currentTime","play","formatMessage","showModal","checkImg","closeImg","id","onClickSuccessMore","onClickSuccessNext","setEgoRef","egoRef","getWrappedInstance","egoMessages","timeout","onClickEgo","showCustomContent","content","onsetstate","customContent","handleOcpLevelChange","level","history","replace","window","location","reload","handleNavInteraction","navCloseTimeout","closeWizClassGame","isOpenWizclassGame","footerControl","querySelector","style","visibility","setRef","endStageButtonAction","endStageButtonId","Audio","isSuccessHidden","wizclassGameUrl","hideLockSprite","isOpen","isFromWizclass","email","match","params","title","startsWith","wizclassPlayImg","popup","render","nextProps","nextState","customIdMap","forEach","isPlaying","GAME_EVENT","event","lastGameEvent","JSON","stringify","prevProps","prevState","maxOcpLevel","zIndex","handleChangeZIndex","fixed","classTitle","isStartStage","isEndStage","withRnd","STEP","CODE","IMAGE","fullScreen","view","contentMain","getElementsByClassName","position","body","clientWidth","game","lastEvent","preview","userinfo"],"mappings":"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","sourcesContent":["import React, { Component } from \"react\";\nimport { connect } from \"react-redux\";\nimport { withRouter } from \"react-router-dom\";\nimport { injectIntl } from \"react-intl\";\nimport * as previewActions from \"../../Store/Reducer/preview\";\nimport * as sceneActions from \"../../Store/Reducer/scene\";\nimport { VCTYPE } from \"../../../../Common/Util/Constant\";\nimport RndWrapper from \"../../utils/RndWrapper\";\nimport { checkConditions, checkGameEvent } from \"./util/condition\";\nimport { createEgoMessage } from \"./util/ego\";\nimport View from \"./View\";\nimport { showPopUp } from \"../../../../Common/Component/PopUp\";\nimport ReactDOM from \"react-dom\";\nimport wizclassPlayImg from \"../../../../Image/wizclass__play.svg\";\n// import successImg from \"../../../../Image/videoclass/success-step-kr.png\";\nimport checkImg from \"../../../../Image/circle-check.svg\";\nimport closeImg from \"../../../../Image/close-btn-popup2.svg\";\n\nimport template from \"./template\";\n\nclass Container extends Component {\n  constructor(props) {\n    super(props);\n    if (props.videoclass) {\n      this.videoclass = props.videoclass;\n    } else {\n      this.videoclass = template;\n    }\n    if (props.setRef) {\n      props.setRef(this);\n    }\n    this.onEndStage = props.onEndStage;\n    this.endStageButtonAction = props.endStageButtonAction;\n    this.endStageButtonId = props.endStageButtonId;\n\n    this.checkConditionInterval = null;\n    this.checkCodeInterval = null;\n    this.videoRef = null;\n    this.egoRef = null;\n    this.successAudio = new Audio(\n      \"https://wizschool-assets.oss-cn-shanghai.aliyuncs.com/sfx/effect_3.mp3\"\n    );\n\n    const currentStageNum = this.videoclass.currentStageNum;\n    const currentStage = this.videoclass.stages[currentStageNum];\n    this.maxStageNum = this.videoclass.stages.length;\n\n    this.state = {\n      currentStage,\n      isSidebarHidden: true,\n      isVideoPlaying: false,\n      isVideoUIHidden: false,\n      isSuccessHidden: true,\n      customContent: null,\n      isNavOpen: false,\n      isOpenWizclassGame: false,\n      wizclassGameUrl: \"\"\n    };\n  }\n  componentDidMount() {\n    this.props.hideLockSprite(null, true);\n    this.updateConditionInterval();\n    this.addForceNextListener();\n    const { currentStage } = this.state;\n    if (!currentStage.isOpen) {\n      currentStage.isOpen = true;\n    }\n    let isFromWizclass =\n      this.props.email === \"multicampus01@wizschool.io\" ||\n      this.props.email === \"multicampus02@wizschool.io\" ||\n      this.props.email === \"multicampus03@wizschool.io\" ||\n      this.props.email === \"dream01@wizschool.io\" ||\n      this.props.email === \"dream02@wizschool.io\" ||\n      this.props.email === \"dream03@wizschool.io\";\n\n    if (\n      isFromWizclass &&\n      this.props.match.params &&\n      this.props.match.params.type === \"escape\"\n    ) {\n      if (this.props.videoclass.level === 1) {\n        let wizclassGameUrl;\n\n        if (this.videoclass.title.startsWith(\"초급\")) {\n          wizclassGameUrl =\n            \"https://wizschool-published.s3.ap-northeast-2.amazonaws.com/5ae60ab3-f5ae-4084-93ee-a59be680f184.html\";\n        }\n        if (this.videoclass.title.startsWith(\"중급\")) {\n          wizclassGameUrl =\n            \"https://wizschool-published.s3.ap-northeast-2.amazonaws.com/364d12bd-2af9-42e1-8eec-2005fbb063fa.html\";\n        }\n        if (this.videoclass.title.startsWith(\"고급\")) {\n          wizclassGameUrl =\n            \"https://wizschool-published.s3.ap-northeast-2.amazonaws.com/d858e0f6-85fc-4d53-b4e4-19b35090bbe7.html\";\n        }\n        this.setState(\n          {\n            isNavOpen: false,\n            isOpenWizclassGame: true,\n            wizclassGameUrl\n          },\n          () => {\n            let footerControl = document.querySelector(\n              \".ocpView_footer_stageControl\"\n            );\n            if (footerControl) {\n              footerControl.style.visibility = \"hidden\";\n            }\n\n            showPopUp(\n              <div className=\"wizclass__game__popup\">\n                <img src={wizclassPlayImg} alt=\"play\" />\n                <div className=\"wizclass__game__popup__title\">\n                  {`화면을 터치해서 완성된 게임을 \\n 먼저 실행해보세요.`}\n                </div>\n                <div className=\"wizclass__game__popup__desc\">\n                  방을 탈출하면 게임이 클리어됩니다.\n                </div>\n                <div\n                  className=\"wizclass__game__popup__button\"\n                  onClick={() => {\n                    let popup = document.getElementById(\"popup\");\n                    if (popup) {\n                      ReactDOM.render(null, popup);\n                    }\n                  }}\n                >\n                  실행\n                </div>\n              </div>\n            );\n          }\n        );\n      } else {\n        setTimeout(() => {\n          this.setState({ isNavOpen: true });\n        }, 500);\n        this.navCloseTimeout = setTimeout(() => {\n          this.setState({ isNavOpen: false });\n        }, 5000);\n      }\n    } else {\n      setTimeout(() => {\n        this.setState({ isNavOpen: true });\n      }, 500);\n      this.navCloseTimeout = setTimeout(() => {\n        this.setState({ isNavOpen: false });\n      }, 5000);\n    }\n  }\n\n  componentWillUnmount() {\n    if (this.checkConditionInterval) clearInterval(this.checkConditionInterval);\n    if (this.checkCodeInterval) clearInterval(this.checkCodeInterval);\n    this.removeForceNextListener();\n  }\n  shouldComponentUpdate(nextProps, nextState) {\n    const { isClear, conditions, customIdMap } = this.state.currentStage;\n    if (!isClear && conditions) {\n      // 조건 업데이트\n      conditions.forEach(condition => {\n        if (condition.isClear) return;\n        if (condition.type === VCTYPE.CONDITION.PLAY_ONCE) {\n          // 게임 실행 조건 업데이트\n          if (nextProps.isPlaying) {\n            condition.isClear = true;\n          }\n        } else if (condition.type === VCTYPE.CONDITION.GAME_EVENT) {\n          // 게임 이벤트 조건 업데이트\n          if (\n            checkGameEvent(\n              condition.event,\n              nextProps.lastGameEvent,\n              customIdMap\n            )\n          ) {\n            condition.isClear = true;\n          }\n        }\n      });\n      // 코드 조건을 만족하지 않고 게임 실행하면 에고가 안내\n      if (this.props.isPlaying !== nextProps.isPlaying && nextProps.isPlaying) {\n        checkConditions(this.videoclass, this.props.state, {\n          failureHandler: condition => {\n            setTimeout(() => {\n              this.egoSay([\n                {\n                  type: VCTYPE.EGO.TEXT,\n                  data: createEgoMessage(\n                    condition,\n                    this.videoclass.customSpriteIdMap,\n                    this.props.intl\n                  )\n                }\n              ]);\n            }, 2000);\n          },\n          codeOnly: true\n        });\n      }\n    }\n\n    // 게임 이벤트 렌더링 최적화\n    if (\n      JSON.stringify(this.props.lastGameEvent) !==\n      JSON.stringify(nextProps.lastGameEvent)\n    ) {\n      return false;\n    }\n\n    return true;\n  }\n  componentDidUpdate(prevProps, prevState) {\n    const { currentStage } = this.state;\n    if (!currentStage.isOpen) {\n      currentStage.isOpen = true;\n    }\n    if (prevProps.maxOcpLevel !== this.props.maxOcpLevel) {\n      if (this.props.setRef) {\n        this.props.setRef(this);\n      }\n    }\n  }\n\n  // condition check by interval\n  updateConditionInterval = () => {\n    if (this.checkConditionInterval) clearInterval(this.checkConditionInterval);\n    if (this.checkCodeInterval) clearInterval(this.checkCodeInterval);\n    const { currentStage } = this.state;\n    const { isClear, conditions, successDelay } = currentStage;\n    // 이미 성공한 단계이거나 조건이 없는 단계면 검사하지 않음\n    if (!isClear && conditions) {\n      // 실행 조건이 있을 때, 코드 조건을 만족하면 실행 유도\n      if (\n        conditions.findIndex(\n          condition => condition.type === VCTYPE.CONDITION.PLAY_ONCE\n        ) > -1\n      ) {\n        this.checkCodeInterval = setInterval(() => {\n          checkConditions(this.videoclass, this.props.state, {\n            successHandler: () => {\n              // this.props.flash(FLASHID.PLAY);\n              this.egoSay([{ type: VCTYPE.EGO.PLAY }]);\n              clearInterval(this.checkCodeInterval);\n            },\n            codeOnly: true\n          });\n        }, 1000);\n      }\n      // 모든 조건을 만족하면 성공 표시\n      this.checkConditionInterval = setInterval(() => {\n        checkConditions(this.videoclass, this.props.state, {\n          successHandler: () => {\n            currentStage.isClear = true;\n            if (\n              !(\n                conditions.length === 1 &&\n                (conditions[0].type === VCTYPE.CONDITION.SPRITE_SELECTED ||\n                  conditions[0].type === VCTYPE.CONDITION.SCENE_SELECTED)\n              )\n            ) {\n              this.successTimeout = setTimeout(() => {\n                this.showSuccess();\n              }, successDelay || 2000);\n            }\n            clearInterval(this.checkConditionInterval);\n          }\n        });\n      }, 1000);\n    }\n  };\n\n  // stage control\n  nextStage = () => {\n    const nextStageNum = isNaN(this.state.currentStage.nextStageNum)\n      ? this.videoclass.currentStageNum + 1\n      : this.state.currentStage.nextStageNum;\n    if (nextStageNum < this.maxStageNum) {\n      const currentStage = this.videoclass.stages[nextStageNum];\n      currentStage.prevStageNum = this.videoclass.currentStageNum;\n      this.videoclass.currentStageNum = nextStageNum;\n      this.setState({ currentStage }, () => {\n        const { ego } = currentStage;\n        if (ego && ego.onStage) {\n          setTimeout(() => {\n            this.egoSay(ego.onStage);\n          }, 2000);\n        } else {\n          this.egoSay();\n        }\n        if (this.successTimeout) {\n          clearTimeout(this.successTimeout);\n        }\n        this.updateConditionInterval();\n        this.hideSuccess();\n        this.props.setIsPlaying(false);\n        if (this.videoclass.currentStageNum === this.maxStageNum - 1) {\n          if (this.onEndStage) this.onEndStage();\n        }\n        if (this.ocpFooterListenerForStageNumChange) {\n          this.ocpFooterListenerForStageNumChange();\n        }\n      });\n    }\n  };\n  prevStage = () => {\n    const prevStageNum = isNaN(this.state.currentStage.prevStageNum)\n      ? this.videoclass.currentStageNum - 1\n      : this.state.currentStage.prevStageNum;\n    if (prevStageNum >= 0) {\n      const currentStage = this.videoclass.stages[prevStageNum];\n      this.videoclass.currentStageNum = prevStageNum;\n      this.setState({ currentStage }, () => {\n        this.egoSay();\n        this.updateConditionInterval();\n        this.props.setIsPlaying(false);\n        if (this.ocpFooterListenerForStageNumChange) {\n          this.ocpFooterListenerForStageNumChange();\n        }\n      });\n    }\n  };\n  onClickBranch = branch => {\n    const stageNum = branch.stageNum;\n    if (0 <= stageNum && stageNum < this.maxStageNum) {\n      const currentStage = this.videoclass.stages[stageNum];\n      const prevStageNum = this.videoclass.currentStageNum;\n      if (prevStageNum < stageNum) currentStage.prevStageNum = prevStageNum;\n      this.videoclass.currentStageNum = stageNum;\n      this.setState({ currentStage }, () => {\n        this.egoSay();\n        this.updateConditionInterval();\n        this.props.setIsPlaying(false);\n      });\n    }\n  };\n  // force next stage\n  onKeydown = e => {\n    this.keyPressed[e.key] = true;\n    if (\n      this.keyPressed[\"Shift\"] &&\n      this.keyPressed[\"W\"] &&\n      this.keyPressed[\"ArrowRight\"]\n    ) {\n      this.nextStage();\n    }\n  };\n  onKeyup = e => {\n    delete this.keyPressed[e.key];\n  };\n  addForceNextListener = () => {\n    this.keyPressed = {};\n    document.addEventListener(\"keydown\", this.onKeydown);\n    document.addEventListener(\"keyup\", this.onKeyup);\n  };\n  removeForceNextListener = () => {\n    document.removeEventListener(\"keydown\", this.onKeydown);\n    document.removeEventListener(\"keyup\", this.onKeyup);\n  };\n\n  // header control\n  onClickNext = () => {\n    const { intl } = this.props;\n    const { currentStage } = this.state;\n    if (currentStage.isClear) {\n      this.nextStage();\n    } else {\n      checkConditions(this.videoclass, this.props.state, {\n        successHandler: () => {\n          currentStage.isClear = true;\n          this.nextStage();\n        },\n        failureHandler: condition => {\n          this.egoSay([\n            {\n              type: VCTYPE.EGO.TEXT,\n              data: createEgoMessage(\n                condition,\n                this.videoclass.customSpriteIdMap,\n                intl\n              )\n            }\n          ]);\n        }\n      });\n    }\n  };\n  onClickPrev = () => {\n    this.prevStage();\n  };\n  onClickList = () => {\n    this.showSidebar();\n    this.updateStagesScroll();\n  };\n  onClickHint = () => {\n    const hint = this.state.currentStage.hint;\n    if (hint) this.egoSay(hint);\n  };\n  onClickAnsw = () => {\n    const answer = this.state.currentStage.answer;\n    if (answer) this.egoSay(answer, 300000);\n  };\n\n  // sidebar control\n  showSidebar = () => {\n    this.setState({ isSidebarHidden: false });\n  };\n  hideSidebar = () => {\n    this.setState({ isSidebarHidden: true });\n  };\n  onClickSidebarOverlay = () => {\n    this.hideSidebar();\n  };\n  onClickStage = stageNum => {\n    const currentStage = this.videoclass.stages[stageNum];\n    this.videoclass.currentStageNum = stageNum;\n    this.setState({ currentStage }, () => {\n      this.egoSay();\n      this.updateConditionInterval();\n      this.hideSidebar();\n      this.hideSuccess();\n      this.props.setIsPlaying(false);\n    });\n  };\n  updateStagesScroll = () => {\n    const stagesElement = document.getElementById(\"vc_stages\");\n    const currentStageElement = document.getElementById(\n      `vc_stage-${this.videoclass.currentStageNum}`\n    );\n    if (stagesElement && currentStageElement) {\n      stagesElement.scrollTop =\n        currentStageElement.offsetTop - stagesElement.offsetHeight / 3;\n    }\n  };\n\n  toggleNav = () => {\n    this.setState({ isNavOpen: !this.state.isNavOpen });\n  };\n\n  // video control\n  setVideoRef = element => {\n    if (!element) return;\n    if (this.videoRef) this.videoRef.pause();\n    this.videoRef = element;\n    this.videoRef.disablePictureInPicture = true;\n    this.videoRef.onplay = this.videoOnplay;\n    this.videoRef.onpause = this.videoOnpause;\n    this.videoRef.onended = this.videoOnended;\n    this.videoRef.onmouseout = this.videoOnmouseout;\n    this.videoRef.onmousemove = this.videoOnmousemove;\n    this.videoRef.ondblclick = this.videoOndblclick;\n  };\n  videoOnplay = e => {\n    this.setState({ isVideoPlaying: true });\n  };\n  videoOnpause = e => {\n    this.setState({ isVideoPlaying: false });\n  };\n  videoOnended = e => {\n    this.setState({ isVideoPlaying: false }, () => {\n      this.nextStage();\n    });\n  };\n  videoOnmouseout = e => {\n    if (this.state.isVideoPlaying) {\n      if (this.hideVideoUITimeeout) clearTimeout(this.hideVideoUITimeeout);\n      this.setState({ isVideoUIHidden: true });\n    }\n  };\n  videoOnmousemove = e => {\n    this.setState({ isVideoUIHidden: false });\n    if (this.hideVideoUITimeeout) clearTimeout(this.hideVideoUITimeeout);\n    this.hideVideoUITimeeout = setTimeout(() => {\n      if (this.state.isVideoPlaying) {\n        this.setState({ isVideoUIHidden: true });\n      }\n    }, 2500);\n  };\n  videoOndblclick = e => {\n    e.preventDefault();\n    return false;\n  };\n\n  // success control\n  showSuccess = () => {\n    if (this.successAudio) {\n      this.successAudio.pause();\n      this.successAudio.currentTime = 0;\n      this.successAudio.play();\n    }\n    // this.setState({ isSuccessHidden: false });\n    const { formatMessage } = this.props.intl;\n    this.props.showModal(\n      <div className=\"vc_success_container\">\n        {/* <img src={successImg} alt=\"success\" /> */}\n        <img className=\"vc_success_icon\" src={checkImg} alt=\"success\" />\n        <img\n          className=\"close-img\"\n          src={closeImg}\n          alt=\"close\"\n          onClick={this.hideSuccess}\n        />\n        <div className=\"textWrapper\">\n          <p>{formatMessage({ id: \"ID_VIDEOCLASS_MISSION_SUCCESS01\" })}</p>\n          <p>{formatMessage({ id: \"ID_VIDEOCLASS_MISSION_SUCCESS02\" })}</p>\n          <p>{formatMessage({ id: \"ID_VIDEOCLASS_MISSION_SUCCESS03\" })}</p>\n        </div>\n        <div className=\"vc_success_buttons\">\n          <div\n            className=\"vc_success_button vc_success_button-more\"\n            onClick={this.onClickSuccessMore}\n          >\n            <span>{formatMessage({ id: \"ID_VIDEOCLASS_SUCCESS_MORE\" })}</span>\n          </div>\n          <div\n            className=\"vc_success_button vc_success_button-next\"\n            onClick={this.onClickSuccessNext}\n          >\n            <span>{formatMessage({ id: \"ID_VIDEOCLASS_SUCCESS_NEXT\" })}</span>\n          </div>\n        </div>\n      </div>\n    );\n  };\n  hideSuccess = () => {\n    // this.setState({ isSuccessHidden: true });\n    this.props.showModal(null);\n  };\n  onClickSuccessNext = () => {\n    this.nextStage();\n  };\n  onClickSuccessMore = () => {\n    this.hideSuccess();\n  };\n\n  // ego control\n  setEgoRef = egoRef => {\n    if (!egoRef) return;\n    this.egoRef = egoRef.getWrappedInstance();\n  };\n  egoSay = (egoMessages, timeout) => {\n    if (this.egoRef) this.egoRef.egoSay(egoMessages, timeout);\n  };\n  onClickEgo = () => {\n    const { ego } = this.state.currentStage;\n    if (ego) {\n      this.egoSay(ego, 5000);\n    }\n  };\n\n  showCustomContent = (content, onsetstate) => {\n    this.setState({ customContent: content }, () => {\n      if (onsetstate) onsetstate();\n    });\n  };\n\n  handleOcpLevelChange = level => {\n    this.props.history.replace(`./${level}`);\n    window.location.reload();\n  };\n\n  handleNavInteraction = () => {\n    if (this.navCloseTimeout) {\n      clearTimeout(this.navCloseTimeout);\n    }\n  };\n\n  closeWizClassGame = () => {\n    this.setState({ isOpenWizclassGame: false }, () => {\n      let footerControl = document.querySelector(\n        \".ocpView_footer_stageControl\"\n      );\n      if (footerControl) {\n        footerControl.style.visibility = \"visible\";\n      }\n    });\n  };\n  render() {\n    const { intl, zIndex, handleChangeZIndex, fixed, isPlaying } = this.props;\n    const {\n      currentStage,\n      isSidebarHidden,\n      isVideoPlaying,\n      isVideoUIHidden,\n      isSuccessHidden,\n      customContent,\n      isNavOpen,\n      isOpenWizclassGame,\n      wizclassGameUrl\n    } = this.state;\n\n    const classTitle = this.videoclass.title;\n    const stages = this.videoclass.stages;\n    const currentStageNum = this.videoclass.currentStageNum;\n    const isStartStage = this.videoclass.currentStageNum === 0;\n    const isEndStage = this.videoclass.currentStageNum === this.maxStageNum - 1;\n    const withRnd =\n      currentStage.type === VCTYPE.STEP.CODE ||\n      (currentStage.type === VCTYPE.STEP.IMAGE &&\n        currentStage.conditions &&\n        currentStage.conditions.length > 0 &&\n        (currentStage.conditions[0].type === VCTYPE.CONDITION.SCENE_SELECTED ||\n          currentStage.conditions[0].type ===\n            VCTYPE.CONDITION.SPRITE_SELECTED));\n    const fullScreen = !withRnd;\n\n    let view = (\n      <View\n        intl={intl}\n        fixed={fixed}\n        fullScreen={fullScreen}\n        handleChangeZIndex={handleChangeZIndex}\n        currentStage={currentStage}\n        isSidebarHidden={isSidebarHidden}\n        isVideoPlaying={isVideoPlaying}\n        isVideoUIHidden={isVideoUIHidden}\n        isSuccessHidden={isSuccessHidden}\n        customContent={customContent}\n        stages={stages}\n        currentStageNum={currentStageNum}\n        isStartStage={isStartStage}\n        isEndStage={isEndStage}\n        onClickNext={this.onClickNext}\n        onClickPrev={this.onClickPrev}\n        onClickList={this.onClickList}\n        onClickHint={this.onClickHint}\n        onClickAnsw={this.onClickAnsw}\n        onClickStage={this.onClickStage}\n        onClickSidebarOverlay={this.onClickSidebarOverlay}\n        setVideoRef={this.setVideoRef}\n        onClickSuccessNext={this.onClickSuccessNext}\n        onClickSuccessMore={this.onClickSuccessMore}\n        setEgoRef={this.setEgoRef}\n        onClickEgo={this.onClickEgo}\n        endStageButtonAction={this.endStageButtonAction}\n        endStageButtonId={this.endStageButtonId}\n        classTitle={classTitle}\n        maxOcpLevel={this.props.maxOcpLevel}\n        currentOcpLevel={this.props.videoclass.level}\n        handleOcpLevelChange={this.handleOcpLevelChange}\n        isNavOpen={isNavOpen}\n        toggleNav={this.toggleNav}\n        isPlaying={isPlaying}\n        handleNavInteraction={this.handleNavInteraction}\n        isOpenWizclassGame={isOpenWizclassGame}\n        closeWizClassGame={this.closeWizClassGame}\n        wizclassGameUrl={wizclassGameUrl}\n      />\n    );\n\n    if (fixed) {\n      const contentMain = document.getElementsByClassName(\"Content_Main\")[0];\n      if (contentMain) {\n        contentMain.style.position = fullScreen ? \"absolute\" : \"relative\";\n      }\n      return view;\n    }\n\n    // Code, SelectSprite, SelectScene 은 전체화면이 아니다.\n    if (withRnd) {\n      view = (\n        <RndWrapper\n          id=\"videoclass\"\n          style={{ zIndex }}\n          defaultWidth={550}\n          defaultHeight={(550 * 9) / 16 + 35}\n          defaultX={document.body.clientWidth - 630}\n          defaultY={16}\n          minWidth={550}\n          minHeight={(550 * 9) / 16 + 35}\n          lockAspectRatio={16 / 9}\n          lockAspectRatioExtraHeight={35}\n        >\n          {view}\n        </RndWrapper>\n      );\n    }\n\n    return view;\n  }\n}\n\nexport default connect(\n  state => ({\n    state,\n    lastGameEvent: state.game.lastEvent,\n    isPlaying: state.preview.isPlaying,\n    email: state.userinfo.email\n  }),\n  {\n    setIsPlaying: previewActions.setIsPlaying,\n    hideLockSprite: sceneActions.hideLockSprite\n  }\n)(withRouter(injectIntl(Container)));\n"]},"metadata":{},"sourceType":"module"}