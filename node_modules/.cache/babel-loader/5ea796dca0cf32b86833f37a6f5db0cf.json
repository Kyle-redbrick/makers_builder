{"ast":null,"code":"import _objectSpread from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread\";\nimport _defineProperty from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/defineProperty\";\nimport _regeneratorRuntime from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _classCallCheck from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";\nimport _inherits from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";\nimport _possibleConstructorReturn from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";\nvar _jsxFileName = \"/Users/jimmy/Documents/Wizschool/wizlab_web2/src/Page/Builder/Container.js\";\n\nfunction _createSuper(Derived) { var hasNativeReflectConstruct = _isNativeReflectConstruct(); return function _createSuperInternal() { var Super = _getPrototypeOf(Derived), result; if (hasNativeReflectConstruct) { var NewTarget = _getPrototypeOf(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return _possibleConstructorReturn(this, result); }; }\n\nfunction _isNativeReflectConstruct() { if (typeof Reflect === \"undefined\" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === \"function\") return true; try { Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {})); return true; } catch (e) { return false; } }\n\nimport React, { Component } from \"react\";\nimport { connect } from \"react-redux\";\nimport { injectIntl } from \"react-intl\";\nimport { DndProvider } from \"react-dnd\";\nimport { HTML5Backend } from \"react-dnd-html5-backend\";\nimport \"react-toastify/dist/ReactToastify.css\";\nimport * as projectActions from \"./Store/Reducer/project\";\nimport * as previewActions from \"./Store/Reducer/preview\";\nimport * as webrtcActions from \"./Store/Reducer/webrtc\";\nimport * as videoActions from \"./Store/Reducer/video\";\nimport * as request from \"../../Common/Util/HTTPRequest\";\nimport AssetLibrary from \"./utils/assetLibrary\";\nimport { PAGETYPE, DEFAULT_VIDEO_URL } from \"../../Common/Util/Constant\";\nimport { detectIE } from \"../../Common/Util/detectBrowser\";\nimport View from \"./View\";\nimport Popup, { showPopUp } from \"../../Common/Component/PopUp\";\nimport * as TrackingUtil from \"../../Common/Util/TrackingUtil\";\n\nvar Container = /*#__PURE__*/function (_Component) {\n  _inherits(Container, _Component);\n\n  var _super = _createSuper(Container);\n\n  function Container(props) {\n    var _this;\n\n    _classCallCheck(this, Container);\n\n    _this = _super.call(this, props);\n    _this.componentDidMount = /*#__PURE__*/_asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee() {\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee);\n    }));\n\n    _this.componentWillUnmount = function () {\n      // this.timer && clearInterval(this.timer);\n      localStorage.removeItem(\"templateId\");\n    };\n\n    _this.loadTutorial = /*#__PURE__*/_asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2() {\n      var myLevelInx, res, list, completeArr, levelItem, template, tutorialState;\n      return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n        while (1) {\n          switch (_context2.prev = _context2.next) {\n            case 0:\n              /** load & valid check */\n              myLevelInx = 0;\n              _context2.next = 3;\n              return request.getMyTutorialList({\n                email: _this.props.email\n              });\n\n            case 3:\n              res = _context2.sent;\n              _context2.next = 6;\n              return res.json();\n\n            case 6:\n              list = _context2.sent;\n              completeArr = list.rows.filter(function (item) {\n                return item.isComplete;\n              });\n\n              if (completeArr.length) {\n                myLevelInx = completeArr.reduce(function (pv, cv) {\n                  return pv.tutorial.level > cv.tutorial.level ? pv : cv;\n                }).tutorial.level;\n              }\n\n              _context2.next = 11;\n              return request.getMyTutorial({\n                email: _this.props.email,\n                level: _this.state.params.level\n              }).then(function (res) {\n                return res.json();\n              });\n\n            case 11:\n              levelItem = _context2.sent;\n\n              if (levelItem) {\n                _context2.next = 22;\n                break;\n              }\n\n              if (!(myLevelInx + 1 === Number(_this.state.params.level))) {\n                _context2.next = 19;\n                break;\n              }\n\n              _context2.next = 16;\n              return request.createTutorialItem({\n                email: _this.props.email,\n                level: _this.state.params.level\n              });\n\n            case 16:\n              window.location.reload();\n              _context2.next = 20;\n              break;\n\n            case 19:\n              showPopUp(React.createElement(Popup.OneButton, {\n                title: \"\\uC798\\uBABB\\uB41C \\uACBD\\uB85C\\uC785\\uB2C8\\uB2E4\",\n                buttonName: \"\\uD655\\uC778\",\n                buttonAction: function buttonAction() {\n                  return _this.loadDefaultProject();\n                },\n                __source: {\n                  fileName: _jsxFileName,\n                  lineNumber: 408\n                },\n                __self: this\n              }));\n\n            case 20:\n              _context2.next = 25;\n              break;\n\n            case 22:\n              template = JSON.parse(levelItem.tutorial.template);\n              tutorialState = JSON.parse(levelItem.tutorial.state);\n              AssetLibrary.loadAssetsFromScene(tutorialState.scene, function () {\n                _this.props.setProject({\n                  state: tutorialState,\n                  videoclass: template\n                });\n\n                _this.setState({\n                  isLoading: false,\n                  currentTutorial: levelItem\n                });\n              });\n\n            case 25:\n            case \"end\":\n              return _context2.stop();\n          }\n        }\n      }, _callee2, this);\n    }));\n    _this.defaultMonitor = /*#__PURE__*/_asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee3() {\n      var response, project;\n      return _regeneratorRuntime.wrap(function _callee3$(_context3) {\n        while (1) {\n          switch (_context3.prev = _context3.next) {\n            case 0:\n              _context3.prev = 0;\n              _context3.next = 3;\n              return request.getDefaultProject();\n\n            case 3:\n              response = _context3.sent;\n              _context3.next = 6;\n              return response.json();\n\n            case 6:\n              project = _context3.sent;\n\n              _this.setBrowserTitle(project.name);\n\n              project.state = JSON.parse(project.state);\n              AssetLibrary.loadAssetsFromScene(project.state.scene, function () {\n                _this.props.setProject(project);\n\n                _this.setState({\n                  isLoading: false\n                });\n              });\n              _context3.next = 15;\n              break;\n\n            case 12:\n              _context3.prev = 12;\n              _context3.t0 = _context3[\"catch\"](0);\n              console.error(_context3.t0);\n\n            case 15:\n            case \"end\":\n              return _context3.stop();\n          }\n        }\n      }, _callee3, null, [[0, 12]]);\n    }));\n\n    _this.loadWizlab = function () {\n      document.title = \"wizclass\"; // const { pId } = this.state.params;\n      // if (pId) {\n      //   if (this.props.email) {\n      //     this.loadProject(pId);\n      //   } else {\n      //     this.handleDefaultCase();\n      //   }\n      // } else {\n      //   this.handleDefaultCase();\n      // }\n\n      var pId = _this.state.params.pId;\n\n      if (_this.props.email) {\n        if (pId) {\n          _this.loadProject(pId);\n        } else {\n          _this.setState({\n            isProjectPopupOpened: true\n          });\n        }\n      } else {\n        // this.handleDefaultCase();\n        if (!_this.props.email && _this.templateId) {\n          _this.loadTemplateProject(_this.templateId);\n\n          localStorage.removeItem(\"templateId\");\n          return;\n        }\n\n        try {\n          var urlParams = new URLSearchParams(window.location.search);\n          var templateId = urlParams.get(\"t\");\n\n          if (templateId) {\n            _this.loadTemplateProject(templateId);\n          } else {\n            _this.setState({\n              isProjectPopupOpened: true\n            });\n          }\n        } catch (e) {\n          _this.setState({\n            isProjectPopupOpened: false\n          });\n        }\n      }\n    };\n\n    _this.loadWizlabForQuestion = /*#__PURE__*/_asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee4() {\n      var questionId, response, projectState;\n      return _regeneratorRuntime.wrap(function _callee4$(_context4) {\n        while (1) {\n          switch (_context4.prev = _context4.next) {\n            case 0:\n              questionId = _this.state.params.questionId;\n              _context4.next = 3;\n              return request.getQuestionState({\n                id: questionId\n              });\n\n            case 3:\n              response = _context4.sent;\n              _context4.next = 6;\n              return response.json();\n\n            case 6:\n              projectState = _context4.sent;\n\n              if (projectState) {\n                projectState = JSON.parse(projectState.state);\n                AssetLibrary.loadAssetsFromScene(projectState.scene, function () {\n                  var project = {\n                    state: projectState,\n                    name: \"\"\n                  };\n\n                  _this.props.setProject(project);\n\n                  _this.setState({\n                    isLoading: false\n                  });\n                });\n              }\n\n            case 8:\n            case \"end\":\n              return _context4.stop();\n          }\n        }\n      }, _callee4);\n    }));\n\n    _this.openProjectPopup = function () {\n      _this.setState({\n        isProjectPopupOpened: true\n      });\n    };\n\n    _this.closeProjectPopup = function () {\n      _this.setState({\n        isProjectPopupOpened: false\n      });\n    };\n\n    _this.loadRecordProject = /*#__PURE__*/_asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee5() {\n      var state;\n      return _regeneratorRuntime.wrap(function _callee5$(_context5) {\n        while (1) {\n          switch (_context5.prev = _context5.next) {\n            case 0:\n              state = JSON.parse(_this.state.reservation.myLecture.lecture.state);\n              AssetLibrary.loadAssetsFromScene(state.scene, function () {\n                _this.props.setProject({\n                  state: state\n                });\n\n                _this.setState({\n                  isLoading: false\n                });\n              });\n\n            case 2:\n            case \"end\":\n              return _context5.stop();\n          }\n        }\n      }, _callee5);\n    }));\n\n    _this.loadProject = /*#__PURE__*/function () {\n      var _ref6 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee6(pId) {\n        var response, project, templateId;\n        return _regeneratorRuntime.wrap(function _callee6$(_context6) {\n          while (1) {\n            switch (_context6.prev = _context6.next) {\n              case 0:\n                _context6.prev = 0;\n                _context6.next = 3;\n                return request.getDevelopingProject({\n                  pId: pId\n                });\n\n              case 3:\n                response = _context6.sent;\n                _context6.next = 6;\n                return response.json();\n\n              case 6:\n                project = _context6.sent;\n\n                if (!project) {\n                  _context6.next = 22;\n                  break;\n                }\n\n                if (!(_this.state.pageType === PAGETYPE.BUILDER_READONLY || _this.state.pageType === PAGETYPE.QNA_READONLY)) {\n                  _context6.next = 14;\n                  break;\n                }\n\n                if (_this.props.isTutor) {\n                  _context6.next = 12;\n                  break;\n                }\n\n                _this.props.history.replace({\n                  pathname: \"/\" + PAGETYPE.BUILDER\n                });\n\n                return _context6.abrupt(\"return\");\n\n              case 12:\n                _context6.next = 17;\n                break;\n\n              case 14:\n                if (!(project.email !== _this.props.email && _this.state.pageType !== PAGETYPE.WIZLIVE && _this.state.pageType !== PAGETYPE.WIZLIVE_1V4)) {\n                  _context6.next = 17;\n                  break;\n                }\n\n                _this.props.history.replace({\n                  pathname: \"/\" + PAGETYPE.BUILDER\n                });\n\n                return _context6.abrupt(\"return\");\n\n              case 17:\n                _this.setBrowserTitle(project.name);\n\n                project.state = JSON.parse(project.state);\n                AssetLibrary.loadAssetsFromScene(project.state.scene, function () {\n                  _this.props.setProject(project);\n\n                  _this.setState({\n                    isLoading: false\n                  });\n                });\n                _context6.next = 24;\n                break;\n\n              case 22:\n                templateId = _this.state.params.templateId;\n\n                _this.createNewProjectFromServer(pId, templateId);\n\n              case 24:\n                _context6.next = 29;\n                break;\n\n              case 26:\n                _context6.prev = 26;\n                _context6.t0 = _context6[\"catch\"](0);\n                console.error(_context6.t0);\n\n              case 29:\n              case \"end\":\n                return _context6.stop();\n            }\n          }\n        }, _callee6, null, [[0, 26]]);\n      }));\n\n      return function (_x) {\n        return _ref6.apply(this, arguments);\n      };\n    }();\n\n    _this.setBrowserTitle = function (title) {\n      document.title = \"wizclass\";\n      if (title) document.title += \" - \".concat(title);\n    };\n\n    _this.createNewProjectFromServer = /*#__PURE__*/function () {\n      var _ref7 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee7(pId, templateId) {\n        var name, email, randomChar, params, response, project;\n        return _regeneratorRuntime.wrap(function _callee7$(_context7) {\n          while (1) {\n            switch (_context7.prev = _context7.next) {\n              case 0:\n                email = _this.props.email;\n\n                if (_this.state.lectureTitle) {\n                  name = _this.state.lectureTitle;\n                } else {\n                  randomChar = String.fromCharCode(Math.floor(Math.random() * Math.floor(48)) + 48); //temp\n\n                  name = _this.props.intl.formatMessage({\n                    id: \"ID_TIP_LAYOUT_NEW_PROJECT_FORMAT\"\n                  }, {\n                    randomChar: randomChar\n                  });\n                }\n\n                params = {\n                  pId: pId,\n                  email: email,\n                  name: name\n                };\n\n                if (_this.state.lectureState) {\n                  params.state = _this.state.lectureState;\n                }\n\n                if (templateId) {\n                  params.templateId = templateId;\n                }\n\n                _context7.prev = 5;\n                _context7.next = 8;\n                return request.postDevelopingProject(params);\n\n              case 8:\n                response = _context7.sent;\n                _context7.next = 11;\n                return response.json();\n\n              case 11:\n                project = _context7.sent;\n\n                _this.setBrowserTitle(project.name);\n\n                project.state = JSON.parse(project.state);\n                project.video = {\n                  videoURL: DEFAULT_VIDEO_URL\n                };\n                AssetLibrary.loadAssetsFromScene(project.state.scene, function () {\n                  _this.props.setProject(project);\n\n                  _this.setState({\n                    isLoading: false\n                  });\n                });\n                _context7.next = 21;\n                break;\n\n              case 18:\n                _context7.prev = 18;\n                _context7.t0 = _context7[\"catch\"](5);\n                console.error(_context7.t0);\n\n              case 21:\n              case \"end\":\n                return _context7.stop();\n            }\n          }\n        }, _callee7, null, [[5, 18]]);\n      }));\n\n      return function (_x2, _x3) {\n        return _ref7.apply(this, arguments);\n      };\n    }();\n\n    _this.loadDefaultProject = /*#__PURE__*/_asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee8() {\n      var response, project;\n      return _regeneratorRuntime.wrap(function _callee8$(_context8) {\n        while (1) {\n          switch (_context8.prev = _context8.next) {\n            case 0:\n              _context8.next = 2;\n              return request.getDefaultProject();\n\n            case 2:\n              response = _context8.sent;\n              _context8.next = 5;\n              return response.json();\n\n            case 5:\n              project = _context8.sent;\n              project.name = \"\";\n\n              _this.setBrowserTitle(project.name);\n\n              project.state = JSON.parse(project.state);\n              project.video = {\n                videoURL: DEFAULT_VIDEO_URL\n              };\n              AssetLibrary.loadAssetsFromScene(project.state.scene, function () {\n                _this.props.setProject(project);\n\n                _this.setState({\n                  isLoading: false\n                });\n              });\n\n            case 11:\n            case \"end\":\n              return _context8.stop();\n          }\n        }\n      }, _callee8);\n    }));\n\n    _this.loadTemplateProject = /*#__PURE__*/function () {\n      var _ref9 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee9(templateId) {\n        var response, project;\n        return _regeneratorRuntime.wrap(function _callee9$(_context9) {\n          while (1) {\n            switch (_context9.prev = _context9.next) {\n              case 0:\n                _context9.next = 2;\n                return request.getDefaultTemplateProject({\n                  id: templateId\n                });\n\n              case 2:\n                response = _context9.sent;\n                _context9.next = 5;\n                return response.json();\n\n              case 5:\n                project = _context9.sent;\n                project.name = \"\";\n\n                _this.setBrowserTitle(project.name);\n\n                project.state = JSON.parse(project.state);\n                project.video = {\n                  videoURL: DEFAULT_VIDEO_URL\n                };\n                AssetLibrary.loadAssetsFromScene(project.state.scene, function () {\n                  _this.props.setProject(project);\n\n                  _this.setState({\n                    isLoading: false\n                  });\n                });\n\n              case 11:\n              case \"end\":\n                return _context9.stop();\n            }\n          }\n        }, _callee9);\n      }));\n\n      return function (_x4) {\n        return _ref9.apply(this, arguments);\n      };\n    }();\n\n    _this.handleSelectMainViewMode = function (mainViewMode) {\n      _this.setState({\n        mainViewMode: mainViewMode\n      });\n    };\n\n    _this.handleChangeZIndex = function (name) {\n      var sort = function sort(arr) {\n        var indexes = arr.slice();\n\n        for (var i = 0; i < indexes.length; i++) {\n          if (name === indexes[i]) {\n            var value = indexes[i];\n            indexes.splice(i, 1);\n            indexes.push(value);\n            break;\n          }\n        }\n\n        return indexes;\n      };\n\n      _this.setState(function (state) {\n        return {\n          popupZIndexes: sort(state.popupZIndexes)\n        };\n      }, function () {\n        localStorage.setItem(\"popupZIndexes\", JSON.stringify(_this.state.popupZIndexes));\n      });\n    };\n\n    _this.handleSelectTab = function (name, from) {\n      _this.props.setLog(_defineProperty({}, name, !_this.state.popupStates[name]));\n\n      if (!_this.state.popupStates[name]) {\n        if (name === \"spriteView\" || name === \"sound\" || name === \"preview\") {\n          TrackingUtil.sendGAEvent({\n            category: \"Builder\",\n            action: \"MenuActions\",\n            label: name[0].toUpperCase() + name.slice(1)\n          });\n        }\n\n        if (name === \"spriteBox\") {\n          TrackingUtil.sendGAEvent({\n            category: \"Builder\",\n            action: \"AddSprite\",\n            label: from\n          });\n        }\n      }\n\n      _this.setState(function (state) {\n        return {\n          popupStates: _objectSpread({}, state.popupStates, _defineProperty({}, name, !state.popupStates[name]))\n        };\n      }, function () {\n        localStorage.setItem(\"popupStates\", JSON.stringify(_objectSpread({}, _this.state.popupStates, {\n          ocp: undefined,\n          tutorial: undefined,\n          live: undefined\n        })));\n\n        if (_this.state.popupStates[name]) {\n          _this.handleChangeZIndex(name);\n        }\n      });\n    };\n\n    _this.showModal = function (modalContent) {\n      _this.setState({\n        modalContent: modalContent\n      });\n    };\n\n    _this.handleHelp = function (isHelpOpened) {\n      _this.setState({\n        isHelpOpened: isHelpOpened\n      });\n    };\n\n    _this.setVideoclassRef = function (ref) {\n      _this.setState({\n        videoclassRef: ref\n      });\n    };\n\n    var popupStates = JSON.parse(localStorage.getItem(\"popupStates\"));\n\n    if (!popupStates) {\n      popupStates = {\n        video: false,\n        snippet: false,\n        api: false,\n        chat: false,\n        property: false,\n        spriteBox: false,\n        preview: false,\n        soundBox: false,\n        scene: false,\n        animation: false,\n        qna: false\n      };\n    }\n\n    popupStates = _objectSpread({}, popupStates, {\n      ocp: props.location.path.split(\"/\")[1] === PAGETYPE.OCP,\n      ocp2block: props.location.path.split(\"/\")[1] === PAGETYPE.OCP2 && props.location.path.split(\"/\")[2] === PAGETYPE.BLOCK,\n      ocp2js: props.location.path.split(\"/\")[1] === PAGETYPE.OCP2 && props.location.path.split(\"/\")[2] === PAGETYPE.JS,\n      tutorial: props.location.path.split(\"/\")[1] === PAGETYPE.TUTORIAL,\n      live: props.location.path.split(\"/\")[1] === PAGETYPE.WIZLIVE,\n      live1v4: props.location.path.split(\"/\")[1] === PAGETYPE.WIZLIVE_1V4,\n      monitor1v4: props.location.path.split(\"/\")[1] === PAGETYPE.MONITOR_1V4\n    });\n    var popupZIndexes = JSON.parse(localStorage.getItem(\"popupZIndexes\"));\n\n    if (!popupZIndexes || !popupZIndexes.includes(\"snippet\")) {\n      popupZIndexes = [\"ocp\", \"ocp2block\", \"ocp2js\", \"tutorial\", \"live\", \"video\", \"snippet\", \"api\", \"chat\", \"property\", \"spriteBox\", \"preview\", \"soundBox\", \"scene\", \"animation\", \"qna\"];\n    }\n\n    _this.templateId = localStorage.getItem(\"templateId\");\n    _this.roomId = null;\n    _this.state = {\n      isLoading: true,\n      isProjectPopupOpened: false,\n      params: props.location.params,\n      pageType: props.location.path.split(\"/\")[1],\n      popupStates: popupStates,\n      popupZIndexes: popupZIndexes,\n      currentTutorial: undefined,\n      videoclassRef: undefined\n    };\n\n    switch (_this.state.pageType) {\n      case PAGETYPE.WIZLIVE:\n        _this.state.reservationId = null;\n        _this.state.roomId = null;\n        _this.state.isTutor = null;\n        _this.state.studentEmail = null;\n        _this.state.tutorEmail = null;\n        _this.state.isFreeTrial = null;\n        break;\n\n      case PAGETYPE.WIZLIVE_1V4:\n      case PAGETYPE.MONITOR_1V4:\n        _this.state.reservationId = null;\n        _this.state.roomId = null;\n        _this.state.isTutor = null;\n        _this.state.studentEmail = null;\n        _this.state.tutorEmail = null;\n        _this.state.isFreeTrial = null;\n        break;\n\n      case PAGETYPE.RECORD_PLAYER:\n        _this.state.reservationId = _this.state.params.reservationId;\n        break;\n\n      default:\n        break;\n    }\n\n    _this.isIE = detectIE();\n    return _this;\n  }\n\n  _createClass(Container, [{\n    key: \"componentDidUpdate\",\n    value: function componentDidUpdate(prevProps, prevState) {\n      if (prevProps.email && !this.props.email) {\n        this.props.history.replace({\n          pathname: \"/\" + PAGETYPE.BUILDER\n        });\n        window.location.reload();\n      } else if (!prevProps.email && this.props.email && this.state.pageType !== PAGETYPE.OCP && this.state.pageType !== PAGETYPE.OCP2BLOCK && this.state.pageType !== PAGETYPE.OCP2JS && this.state.pageType !== PAGETYPE.OCP2) {\n        this.props.history.replace({\n          pathname: \"/\" + PAGETYPE.BUILDER\n        });\n        window.location.reload();\n      }\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _this$props = this.props,\n          screenMode = _this$props.screenMode,\n          location = _this$props.location,\n          email = _this$props.email,\n          name = _this$props.name;\n      var _this$state = this.state,\n          pageType = _this$state.pageType,\n          roomId = _this$state.roomId,\n          reservationId = _this$state.reservationId,\n          isTutor = _this$state.isTutor,\n          isLoading = _this$state.isLoading,\n          tutorEmail = _this$state.tutorEmail,\n          studentEmail = _this$state.studentEmail,\n          lectureVideos = _this$state.lectureVideos,\n          lectureSlides = _this$state.lectureSlides,\n          reservation = _this$state.reservation,\n          isProjectPopupOpened = _this$state.isProjectPopupOpened,\n          modalContent = _this$state.modalContent,\n          isHelpOpened = _this$state.isHelpOpened,\n          popupStates = _this$state.popupStates,\n          popupZIndexes = _this$state.popupZIndexes,\n          currentTutorial = _this$state.currentTutorial,\n          isFreeTrial = _this$state.isFreeTrial,\n          videoclassRef = _this$state.videoclassRef;\n      var pId = this.state.params.pId;\n      var isIE = this.isIE,\n          openProjectPopup = this.openProjectPopup,\n          closeProjectPopup = this.closeProjectPopup,\n          handleHelp = this.handleHelp,\n          handleChangeZIndex = this.handleChangeZIndex,\n          handleSelectTab = this.handleSelectTab,\n          showModal = this.showModal,\n          setVideoclassRef = this.setVideoclassRef;\n      return React.createElement(DndProvider, {\n        backend: HTML5Backend,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 780\n        },\n        __self: this\n      }, React.createElement(View, {\n        screenMode: screenMode,\n        location: location,\n        pageType: pageType,\n        roomId: roomId,\n        reservationId: reservationId,\n        isTutor: isTutor,\n        isLoading: isLoading,\n        isIE: isIE,\n        tutorEmail: tutorEmail,\n        studentEmail: studentEmail,\n        lectureVideos: lectureVideos,\n        lectureSlides: lectureSlides,\n        pId: pId,\n        reservation: reservation,\n        isProjectPopupOpened: isProjectPopupOpened,\n        openProjectPopup: openProjectPopup,\n        closeProjectPopup: closeProjectPopup,\n        modalContent: modalContent,\n        showModal: showModal,\n        isHelpOpened: isHelpOpened,\n        handleHelp: handleHelp,\n        popupStates: popupStates,\n        popupZIndexes: popupZIndexes,\n        handleChangeZIndex: handleChangeZIndex,\n        handleSelectTab: handleSelectTab,\n        currentTutorial: currentTutorial,\n        isFreeTrial: isFreeTrial,\n        videoclassRef: videoclassRef,\n        setVideoclassRef: setVideoclassRef,\n        email: email,\n        name: name,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 781\n        },\n        __self: this\n      }));\n    }\n  }]);\n\n  return Container;\n}(Component);\n\nexport default connect(function (state) {\n  return {\n    email: state.userinfo.email,\n    name: state.userinfo.name,\n    isTutor: state.userinfo.isTutor,\n    screenMode: state.preview.screenMode\n  };\n}, {\n  setProject: projectActions.setProject,\n  resetProject: projectActions.resetProject,\n  setGameVolume: previewActions.setGameVolume,\n  setLog: webrtcActions.setLog,\n  setVideoURL: videoActions.setVideoURL\n})(injectIntl(Container));","map":{"version":3,"sources":["/Users/jimmy/Documents/Wizschool/wizlab_web2/src/Page/Builder/Container.js"],"names":["React","Component","connect","injectIntl","DndProvider","HTML5Backend","projectActions","previewActions","webrtcActions","videoActions","request","AssetLibrary","PAGETYPE","DEFAULT_VIDEO_URL","detectIE","View","Popup","showPopUp","TrackingUtil","Container","props","componentDidMount","componentWillUnmount","localStorage","removeItem","loadTutorial","myLevelInx","getMyTutorialList","email","res","json","list","completeArr","rows","filter","item","isComplete","length","reduce","pv","cv","tutorial","level","getMyTutorial","state","params","then","levelItem","Number","createTutorialItem","window","location","reload","loadDefaultProject","template","JSON","parse","tutorialState","loadAssetsFromScene","scene","setProject","videoclass","setState","isLoading","currentTutorial","defaultMonitor","getDefaultProject","response","project","setBrowserTitle","name","console","error","loadWizlab","document","title","pId","loadProject","isProjectPopupOpened","templateId","loadTemplateProject","urlParams","URLSearchParams","search","get","e","loadWizlabForQuestion","questionId","getQuestionState","id","projectState","openProjectPopup","closeProjectPopup","loadRecordProject","reservation","myLecture","lecture","getDevelopingProject","pageType","BUILDER_READONLY","QNA_READONLY","isTutor","history","replace","pathname","BUILDER","WIZLIVE","WIZLIVE_1V4","createNewProjectFromServer","lectureTitle","randomChar","String","fromCharCode","Math","floor","random","intl","formatMessage","lectureState","postDevelopingProject","video","videoURL","getDefaultTemplateProject","handleSelectMainViewMode","mainViewMode","handleChangeZIndex","sort","arr","indexes","slice","i","value","splice","push","popupZIndexes","setItem","stringify","handleSelectTab","from","setLog","popupStates","sendGAEvent","category","action","label","toUpperCase","ocp","undefined","live","showModal","modalContent","handleHelp","isHelpOpened","setVideoclassRef","ref","videoclassRef","getItem","snippet","api","chat","property","spriteBox","preview","soundBox","animation","qna","path","split","OCP","ocp2block","OCP2","BLOCK","ocp2js","JS","TUTORIAL","live1v4","monitor1v4","MONITOR_1V4","includes","roomId","reservationId","studentEmail","tutorEmail","isFreeTrial","RECORD_PLAYER","isIE","prevProps","prevState","OCP2BLOCK","OCP2JS","screenMode","lectureVideos","lectureSlides","userinfo","resetProject","setGameVolume","setVideoURL"],"mappings":"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","sourcesContent":["import React, { Component } from \"react\";\nimport { connect } from \"react-redux\";\nimport { injectIntl } from \"react-intl\";\nimport { DndProvider } from \"react-dnd\";\nimport { HTML5Backend } from \"react-dnd-html5-backend\";\nimport \"react-toastify/dist/ReactToastify.css\";\nimport * as projectActions from \"./Store/Reducer/project\";\nimport * as previewActions from \"./Store/Reducer/preview\";\nimport * as webrtcActions from \"./Store/Reducer/webrtc\";\nimport * as videoActions from \"./Store/Reducer/video\";\nimport * as request from \"../../Common/Util/HTTPRequest\";\nimport AssetLibrary from \"./utils/assetLibrary\";\nimport { PAGETYPE, DEFAULT_VIDEO_URL } from \"../../Common/Util/Constant\";\nimport { detectIE } from \"../../Common/Util/detectBrowser\";\nimport View from \"./View\";\nimport Popup, { showPopUp } from \"../../Common/Component/PopUp\";\nimport * as TrackingUtil from \"../../Common/Util/TrackingUtil\";\n\nclass Container extends Component {\n  constructor(props) {\n    super(props);\n    let popupStates = JSON.parse(localStorage.getItem(\"popupStates\"));\n    if (!popupStates) {\n      popupStates = {\n        video: false,\n        snippet: false,\n        api: false,\n        chat: false,\n        property: false,\n        spriteBox: false,\n        preview: false,\n        soundBox: false,\n        scene: false,\n        animation: false,\n        qna: false\n      };\n    }\n    popupStates = {\n      ...popupStates,\n      ocp: props.location.path.split(\"/\")[1] === PAGETYPE.OCP,\n      ocp2block:\n        props.location.path.split(\"/\")[1] === PAGETYPE.OCP2 &&\n        props.location.path.split(\"/\")[2] === PAGETYPE.BLOCK,\n      ocp2js:\n        props.location.path.split(\"/\")[1] === PAGETYPE.OCP2 &&\n        props.location.path.split(\"/\")[2] === PAGETYPE.JS,\n      tutorial: props.location.path.split(\"/\")[1] === PAGETYPE.TUTORIAL,\n      live: props.location.path.split(\"/\")[1] === PAGETYPE.WIZLIVE,\n      live1v4: props.location.path.split(\"/\")[1] === PAGETYPE.WIZLIVE_1V4,\n      monitor1v4: props.location.path.split(\"/\")[1] === PAGETYPE.MONITOR_1V4\n    };\n\n    let popupZIndexes = JSON.parse(localStorage.getItem(\"popupZIndexes\"));\n    if (!popupZIndexes || !popupZIndexes.includes(\"snippet\")) {\n      popupZIndexes = [\n        \"ocp\",\n        \"ocp2block\",\n        \"ocp2js\",\n        \"tutorial\",\n        \"live\",\n        \"video\",\n        \"snippet\",\n        \"api\",\n        \"chat\",\n        \"property\",\n        \"spriteBox\",\n        \"preview\",\n        \"soundBox\",\n        \"scene\",\n        \"animation\",\n        \"qna\"\n      ];\n    }\n\n    this.templateId = localStorage.getItem(\"templateId\");\n\n    this.roomId = null;\n\n    this.state = {\n      isLoading: true,\n      isProjectPopupOpened: false,\n      params: props.location.params,\n      pageType: props.location.path.split(\"/\")[1],\n      popupStates,\n      popupZIndexes,\n      currentTutorial: undefined,\n      videoclassRef: undefined\n    };\n\n    switch (this.state.pageType) {\n      case PAGETYPE.WIZLIVE:\n        this.state.reservationId = null;\n        this.state.roomId = null;\n        this.state.isTutor = null;\n        this.state.studentEmail = null;\n        this.state.tutorEmail = null;\n        this.state.isFreeTrial = null;\n        break;\n      case PAGETYPE.WIZLIVE_1V4:\n      case PAGETYPE.MONITOR_1V4:\n        this.state.reservationId = null;\n        this.state.roomId = null;\n        this.state.isTutor = null;\n        this.state.studentEmail = null;\n        this.state.tutorEmail = null;\n        this.state.isFreeTrial = null;\n        break;\n      case PAGETYPE.RECORD_PLAYER:\n        this.state.reservationId = this.state.params.reservationId;\n        break;\n      default:\n        break;\n    }\n\n    this.isIE = detectIE();\n  }\n\n  componentDidMount = async () => {\n    // try {\n    //   if (this.isIE) {\n    //     this.props.history.replace(\"/\" + PAGETYPE.BUILDER);\n    //     return;\n    //   }\n\n    //   let { email } = this.props;\n    //   const { pageType, params } = this.state;\n    //   const { pId, step, grade, reservationId, type } = params;\n\n    //   if (pageType === PAGETYPE.WIZLIVE_1V4) {\n    //     const regexRoomId = /(\\w+)-(\\w+)-(\\w+)-(\\w+)-(\\w+)-(?<roomId>\\w+)/;\n\n    //     const {\n    //       groups: { roomId }\n    //     } = regexRoomId.exec(pId);\n\n    //     this.roomId = roomId;\n    //   }\n\n    //   // this.timer = setInterval(() => {\n    //   //   request.updateBuilderUsageTime({\n    //   //     email: this.props.email,\n    //   //     time: new Date().getTime()\n    //   //   });\n    //   // }, 1000);\n\n    //   // TrackingUtil.sendPageEvent(\"/\" + pageType, this.props.email);\n\n    //   switch (pageType) {\n    //     case PAGETYPE.WIZLIVE:\n    //       const wizLiveRoom = await request\n    //         .getWizLiveRoomId({ email })\n    //         .then(res => res.json());\n    //       if (wizLiveRoom && wizLiveRoom.roomId) {\n    //         wizLiveRoom.myLecture.lecture.guideVideo &&\n    //           this.props.setVideoURL(wizLiveRoom.myLecture.lecture.guideVideo);\n    //         this.setState(\n    //           {\n    //             reservationId: wizLiveRoom.id,\n    //             roomId: wizLiveRoom.roomId,\n    //             isTutor: wizLiveRoom.isTutor,\n    //             studentEmail: wizLiveRoom.studentEmail,\n    //             tutorEmail: wizLiveRoom.tutorEmail,\n    //             lectureVideos: JSON.parse(wizLiveRoom.myLecture.lecture.video),\n    //             lectureSlides: JSON.parse(wizLiveRoom.myLecture.lecture.slides),\n    //             lectureState: wizLiveRoom.myLecture.lecture.state,\n    //             lectureTitle: wizLiveRoom.myLecture.lecture.title,\n    //             isFreeTrial: wizLiveRoom.isFreeTrial\n    //           },\n    //           () => {\n    //             this.loadWizlab();\n    //           }\n    //         );\n    //       } else {\n    //         showPopUp(\n    //           <Popup.OneButton\n    //             intl={this.props.intl}\n    //             titleId=\"ID_BUILDER_ALERT_MSG_CLIVE_NOT_FOUND\"\n    //             buttonNameId=\"ID_BUILDER_ALERT_CONFIRMBTN\"\n    //             buttonAction={() => {\n    //               if (pId)\n    //                 this.props.history.replace(`/${PAGETYPE.BUILDER}/${pId}`);\n    //               else this.props.history.replace(\"/\" + PAGETYPE.WIZLIVE);\n    //             }}\n    //           />\n    //         );\n    //       }\n    //       break;\n    //     case PAGETYPE.MONITOR_1V4:\n    //     case PAGETYPE.WIZLIVE_1V4:\n    //       let wizLive1v4Room;\n\n    //       if (pageType === PAGETYPE.MONITOR_1V4) {\n    //         email = window.prompt(\n    //           \"튜터의 이메일을 입력해주세요\",\n    //           \"johnjs@wizschool.io\"\n    //         );\n\n    //         wizLive1v4Room = await request\n    //           .getMonitorRoom1v4({ email })\n    //           .then(res => res.json());\n    //       } else {\n    //         // WIZLIVE_1v4\n    //         wizLive1v4Room = await request\n    //           .getWizLive1v4RoomId({ email, roomId: this.roomId })\n    //           .then(res => res.json());\n    //       }\n\n    //       if (wizLive1v4Room && wizLive1v4Room.roomId) {\n    //         // wizLiveRoom.myLecture.lecture.guideVideo &&\n    //         //   this.props.setVideoURL(wizLiveRoom.myLecture.lecture.guideVideo);\n    //         this.setState(\n    //           {\n    //             reservationId: wizLive1v4Room.id,\n    //             roomId: wizLive1v4Room.roomId,\n    //             isTutor:\n    //               pageType === PAGETYPE.MONITOR_1V4\n    //                 ? false\n    //                 : wizLive1v4Room.isTutor,\n    //             studentEmail: wizLive1v4Room.studentEmail,\n    //             tutorEmail: wizLive1v4Room.tutorEmail,\n    //             lectureVideos: JSON.parse(\n    //               wizLive1v4Room.myLecture.lecture.video\n    //             ),\n    //             lectureSlides: JSON.parse(\n    //               wizLive1v4Room.myLecture.lecture.slides\n    //             ),\n    //             lectureState: wizLive1v4Room.myLecture.lecture.state,\n    //             lectureTitle: wizLive1v4Room.myLecture.lecture.title,\n    //             isFreeTrial: wizLive1v4Room.isFreeTrial\n    //           },\n    //           () => {\n    //             if (pageType === PAGETYPE.WIZLIVE_1V4) {\n    //               this.loadWizlab();\n    //             } else if (pageType === PAGETYPE.MONITOR_1V4) {\n    //               this.defaultMonitor();\n    //             }\n    //           }\n    //         );\n    //       } else {\n    //         showPopUp(\n    //           <Popup.OneButton\n    //             intl={this.props.intl}\n    //             titleId=\"ID_BUILDER_ALERT_MSG_CLIVE_NOT_FOUND\"\n    //             buttonNameId=\"ID_BUILDER_ALERT_CONFIRMBTN\"\n    //             buttonAction={() => {\n    //               if (pId)\n    //                 this.props.history.replace(`/${PAGETYPE.BUILDER}/${pId}`);\n    //               else this.props.history.replace(\"/\" + PAGETYPE.WIZLIVE);\n    //             }}\n    //           />\n    //         );\n    //       }\n    //       break;\n    //     case PAGETYPE.BUILDER:\n    //       this.loadWizlab();\n    //       break;\n    //     case PAGETYPE.BUILDER_EDIT:\n    //       this.loadWizlab();\n    //       break;\n    //     case PAGETYPE.BUILDER_READONLY:\n    //       showPopUp(\n    //         <Popup.OneButton\n    //           intl={this.props.intl}\n    //           titleId=\"ID_BUILDER_ALERT_MSG_READONLY\"\n    //           buttonNameId=\"ID_BUILDER_ALERT_CONFIRMBTN\"\n    //         />\n    //       );\n    //       this.loadWizlab();\n    //       break;\n    //     case PAGETYPE.QNA_READONLY:\n    //       showPopUp(\n    //         <Popup.OneButton\n    //           intl={this.props.intl}\n    //           titleId=\"ID_BUILDER_ALERT_MSG_READONLY\"\n    //           buttonNameId=\"ID_BUILDER_ALERT_CONFIRMBTN\"\n    //         />\n    //       );\n    //       this.loadWizlabForQuestion();\n    //       break;\n    //     case PAGETYPE.VIDEOCLASS:\n    //       this.loadDefaultProject();\n    //       break;\n    //     case PAGETYPE.OCP:\n    //       const stage = require(`./utils/ocp/${grade}/stages/${\n    //         step > 10 ? 10 : step\n    //       }`);\n    //       let ocpClass = stage.data;\n    //       ocpClass.state = stage.state;\n    //       AssetLibrary.loadAssetsFromScene(ocpClass.state.scene, () => {\n    //         this.props.setProject({\n    //           state: ocpClass.state,\n    //           videoclass: ocpClass\n    //         });\n    //         this.setState({ isLoading: false });\n    //       });\n    //       break;\n    //     case PAGETYPE.OCP2:\n    //       try {\n    //         let ocp2Template;\n    //         if (this.props.location.path.split(\"/\")[2] === PAGETYPE.BLOCK) {\n    //           ocp2Template = require(`./Component/OCP2/template/block/${grade}/${step}`);\n    //         } else if (this.props.location.path.split(\"/\")[2] === PAGETYPE.JS) {\n    //           ocp2Template = require(`./Component/OCP2/template/${type}/${grade}/${step}`);\n    //         }\n    //         AssetLibrary.loadAssetsFromScene(ocp2Template.state.scene, () => {\n    //           this.props.setProject({\n    //             state: ocp2Template.state,\n    //             videoclass: ocp2Template.data\n    //           });\n    //           this.setState({ isLoading: false });\n    //         });\n    //       } catch (e) {\n    //         console.error(e);\n    //         showPopUp(\n    //           <Popup.OneButton\n    //             title=\"수업정보가 올바르지 않습니다\"\n    //             buttonName=\"확인\"\n    //           />\n    //         );\n    //       }\n    //       break;\n    //     case PAGETYPE.TUTORIAL:\n    //       if (!this.props.email) {\n    //         showPopUp(\n    //           <Popup.OneButton\n    //             title=\"로그인 후 이용해주세요\"\n    //             buttonName=\"확인\"\n    //           />\n    //         );\n    //         this.loadDefaultProject();\n    //         return;\n    //       }\n    //       this.loadTutorial();\n    //       break;\n    //     case PAGETYPE.RECORD_PLAYER:\n    //       const reservation = await request\n    //         .getReservationById({ reservationId })\n    //         .then(res => res.json());\n    //       this.setState({ reservation: reservation.reservation }, () => {\n    //         this.loadRecordProject();\n    //       });\n    //       break;\n    //     case PAGETYPE.MONITOR:\n    //       this.defaultMonitor();\n    //       break;\n    //     case PAGETYPE.DREAMCLASS:\n    //       this.setState({ \n    //         isLoading: false, \n    //         popupStates: {\n    //           video: false,\n    //           snippet: false,\n    //           api: false,\n    //           chat: false,\n    //           property: false,\n    //           spriteBox: false,\n    //           preview: false,\n    //           soundBox: false,\n    //           scene: false,\n    //           animation: false,\n    //           qna: false\n    //         } \n    //       });\n    //       break;\n    //     default:\n    //       this.loadWizlab();\n    //       break;\n    //   }\n    // } catch (err) {\n    //   console.error(err);\n    // }\n  };\n\n  componentWillUnmount = () => {\n    // this.timer && clearInterval(this.timer);\n    localStorage.removeItem(\"templateId\");\n  };\n\n  loadTutorial = async () => {\n    /** load & valid check */\n    let myLevelInx = 0;\n    let res = await request.getMyTutorialList({ email: this.props.email });\n    let list = await res.json();\n    let completeArr = list.rows.filter(item => {\n      return item.isComplete;\n    });\n    if (completeArr.length) {\n      myLevelInx = completeArr.reduce((pv, cv) => {\n        return pv.tutorial.level > cv.tutorial.level ? pv : cv;\n      }).tutorial.level;\n    }\n\n    const levelItem = await request\n      .getMyTutorial({\n        email: this.props.email,\n        level: this.state.params.level\n      })\n      .then(res => res.json());\n\n    if (!levelItem) {\n      if (myLevelInx + 1 === Number(this.state.params.level)) {\n        await request.createTutorialItem({\n          email: this.props.email,\n          level: this.state.params.level\n        });\n        window.location.reload();\n      } else {\n        showPopUp(\n          <Popup.OneButton\n            title=\"잘못된 경로입니다\"\n            buttonName=\"확인\"\n            buttonAction={() => this.loadDefaultProject()}\n          />\n        );\n      }\n    } else {\n      const template = JSON.parse(levelItem.tutorial.template);\n      const tutorialState = JSON.parse(levelItem.tutorial.state);\n      AssetLibrary.loadAssetsFromScene(tutorialState.scene, () => {\n        this.props.setProject({\n          state: tutorialState,\n          videoclass: template\n        });\n        this.setState({ isLoading: false, currentTutorial: levelItem });\n      });\n    }\n  };\n\n  defaultMonitor = async () => {\n    try {\n      let response = await request.getDefaultProject();\n      const project = await response.json();\n\n      this.setBrowserTitle(project.name);\n      project.state = JSON.parse(project.state);\n\n      AssetLibrary.loadAssetsFromScene(project.state.scene, () => {\n        this.props.setProject(project);\n        this.setState({ isLoading: false });\n      });\n    } catch (e) {\n      console.error(e);\n    }\n  };\n\n  loadWizlab = () => {\n    document.title = \"wizclass\";\n    // const { pId } = this.state.params;\n    // if (pId) {\n    //   if (this.props.email) {\n    //     this.loadProject(pId);\n    //   } else {\n    //     this.handleDefaultCase();\n    //   }\n    // } else {\n    //   this.handleDefaultCase();\n    // }\n    const { pId } = this.state.params;\n    if (this.props.email) {\n      if (pId) {\n        this.loadProject(pId);\n      } else {\n        this.setState({ isProjectPopupOpened: true });\n      }\n    } else {\n      // this.handleDefaultCase();\n      if (!this.props.email && this.templateId) {\n        this.loadTemplateProject(this.templateId);\n        localStorage.removeItem(\"templateId\");\n        return;\n      }\n\n      try {\n        const urlParams = new URLSearchParams(window.location.search);\n        const templateId = urlParams.get(\"t\");\n        if (templateId) {\n          this.loadTemplateProject(templateId);\n        } else {\n          this.setState({ isProjectPopupOpened: true });\n        }\n      } catch (e) {\n        this.setState({ isProjectPopupOpened: false });\n      }\n    }\n  };\n\n  loadWizlabForQuestion = async () => {\n    const questionId = this.state.params.questionId;\n    let response = await request.getQuestionState({ id: questionId });\n    let projectState = await response.json();\n    if (projectState) {\n      projectState = JSON.parse(projectState.state);\n\n      AssetLibrary.loadAssetsFromScene(projectState.scene, () => {\n        const project = {\n          state: projectState,\n          name: \"\"\n        };\n        this.props.setProject(project);\n        this.setState({ isLoading: false });\n      });\n    }\n  };\n\n  componentDidUpdate(prevProps, prevState) {\n    if (prevProps.email && !this.props.email) {\n      this.props.history.replace({ pathname: \"/\" + PAGETYPE.BUILDER });\n      window.location.reload();\n    } else if (\n      !prevProps.email &&\n      this.props.email &&\n      this.state.pageType !== PAGETYPE.OCP &&\n      this.state.pageType !== PAGETYPE.OCP2BLOCK &&\n      this.state.pageType !== PAGETYPE.OCP2JS &&\n      this.state.pageType !== PAGETYPE.OCP2\n    ) {\n      this.props.history.replace({ pathname: \"/\" + PAGETYPE.BUILDER });\n      window.location.reload();\n    }\n  }\n\n  openProjectPopup = () => {\n    this.setState({ isProjectPopupOpened: true });\n  };\n\n  closeProjectPopup = () => {\n    this.setState({ isProjectPopupOpened: false });\n  };\n\n  loadRecordProject = async () => {\n    const state = JSON.parse(this.state.reservation.myLecture.lecture.state);\n    AssetLibrary.loadAssetsFromScene(state.scene, () => {\n      this.props.setProject({ state });\n      this.setState({ isLoading: false });\n    });\n  };\n\n  loadProject = async pId => {\n    try {\n      let response = await request.getDevelopingProject({ pId });\n      const project = await response.json();\n      if (project) {\n        if (\n          this.state.pageType === PAGETYPE.BUILDER_READONLY ||\n          this.state.pageType === PAGETYPE.QNA_READONLY\n        ) {\n          if (!this.props.isTutor) {\n            this.props.history.replace({ pathname: \"/\" + PAGETYPE.BUILDER });\n            return;\n          }\n        } else if (\n          project.email !== this.props.email &&\n          this.state.pageType !== PAGETYPE.WIZLIVE &&\n          this.state.pageType !== PAGETYPE.WIZLIVE_1V4\n        ) {\n          this.props.history.replace({\n            pathname: \"/\" + PAGETYPE.BUILDER\n          });\n          return;\n        }\n\n        this.setBrowserTitle(project.name);\n        project.state = JSON.parse(project.state);\n\n        AssetLibrary.loadAssetsFromScene(project.state.scene, () => {\n          this.props.setProject(project);\n          this.setState({ isLoading: false });\n        });\n      } else {\n        const { templateId } = this.state.params;\n        this.createNewProjectFromServer(pId, templateId);\n      }\n    } catch (e) {\n      console.error(e);\n    }\n  };\n\n  setBrowserTitle = title => {\n    document.title = `wizclass`;\n    if (title) document.title += ` - ${title}`;\n  };\n\n  createNewProjectFromServer = async (pId, templateId) => {\n    let name;\n    const email = this.props.email;\n\n    if (this.state.lectureTitle) {\n      name = this.state.lectureTitle;\n    } else {\n      const randomChar = String.fromCharCode(\n        Math.floor(Math.random() * Math.floor(48)) + 48\n      ); //temp\n      name = this.props.intl.formatMessage(\n        { id: \"ID_TIP_LAYOUT_NEW_PROJECT_FORMAT\" },\n        { randomChar: randomChar }\n      );\n    }\n    let params = { pId, email, name };\n    if (this.state.lectureState) {\n      params.state = this.state.lectureState;\n    }\n    if (templateId) {\n      params.templateId = templateId;\n    }\n    try {\n      const response = await request.postDevelopingProject(params);\n      const project = await response.json();\n      this.setBrowserTitle(project.name);\n      project.state = JSON.parse(project.state);\n      project.video = {\n        videoURL: DEFAULT_VIDEO_URL\n      };\n\n      AssetLibrary.loadAssetsFromScene(project.state.scene, () => {\n        this.props.setProject(project);\n        this.setState({ isLoading: false });\n      });\n    } catch (e) {\n      console.error(e);\n    }\n  };\n\n  loadDefaultProject = async () => {\n    const response = await request.getDefaultProject();\n    const project = await response.json();\n\n    project.name = \"\";\n    this.setBrowserTitle(project.name);\n    project.state = JSON.parse(project.state);\n    project.video = {\n      videoURL: DEFAULT_VIDEO_URL\n    };\n    AssetLibrary.loadAssetsFromScene(project.state.scene, () => {\n      this.props.setProject(project);\n      this.setState({ isLoading: false });\n    });\n  };\n\n  loadTemplateProject = async templateId => {\n    const response = await request.getDefaultTemplateProject({\n      id: templateId\n    });\n    const project = await response.json();\n\n    project.name = \"\";\n    this.setBrowserTitle(project.name);\n    project.state = JSON.parse(project.state);\n    project.video = {\n      videoURL: DEFAULT_VIDEO_URL\n    };\n    AssetLibrary.loadAssetsFromScene(project.state.scene, () => {\n      this.props.setProject(project);\n      this.setState({ isLoading: false });\n    });\n  };\n\n  handleSelectMainViewMode = mainViewMode => {\n    this.setState({ mainViewMode });\n  };\n\n  handleChangeZIndex = name => {\n    const sort = arr => {\n      let indexes = arr.slice();\n      for (let i = 0; i < indexes.length; i++) {\n        if (name === indexes[i]) {\n          const value = indexes[i];\n          indexes.splice(i, 1);\n          indexes.push(value);\n          break;\n        }\n      }\n      return indexes;\n    };\n\n    this.setState(\n      state => {\n        return {\n          popupZIndexes: sort(state.popupZIndexes)\n        };\n      },\n      () => {\n        localStorage.setItem(\n          \"popupZIndexes\",\n          JSON.stringify(this.state.popupZIndexes)\n        );\n      }\n    );\n  };\n\n  handleSelectTab = (name, from) => {\n    this.props.setLog({ [name]: !this.state.popupStates[name] });\n    if (!this.state.popupStates[name]) {\n      if (name === \"spriteView\" || name === \"sound\" || name === \"preview\") {\n        TrackingUtil.sendGAEvent({\n          category: \"Builder\",\n          action: `MenuActions`,\n          label: name[0].toUpperCase() + name.slice(1)\n        });\n      }\n\n      if (name === \"spriteBox\") {\n        TrackingUtil.sendGAEvent({\n          category: \"Builder\",\n          action: `AddSprite`,\n          label: from\n        });\n      }\n    }\n    this.setState(\n      state => {\n        return {\n          popupStates: {\n            ...state.popupStates,\n            [name]: !state.popupStates[name]\n          }\n        };\n      },\n      () => {\n        localStorage.setItem(\n          \"popupStates\",\n          JSON.stringify({\n            ...this.state.popupStates,\n            ocp: undefined,\n            tutorial: undefined,\n            live: undefined\n          })\n        );\n        if (this.state.popupStates[name]) {\n          this.handleChangeZIndex(name);\n        }\n      }\n    );\n  };\n\n  showModal = modalContent => {\n    this.setState({ modalContent });\n  };\n  handleHelp = isHelpOpened => {\n    this.setState({ isHelpOpened });\n  };\n\n  setVideoclassRef = ref => {\n    this.setState({ videoclassRef: ref });\n  };\n\n  render() {\n    const { screenMode, location, email, name } = this.props;\n    const {\n      pageType,\n      roomId,\n      reservationId,\n      isTutor,\n      isLoading,\n      tutorEmail,\n      studentEmail,\n      lectureVideos,\n      lectureSlides,\n      reservation,\n      isProjectPopupOpened,\n      modalContent,\n      isHelpOpened,\n      popupStates,\n      popupZIndexes,\n      currentTutorial,\n      isFreeTrial,\n      videoclassRef\n    } = this.state;\n    const { pId } = this.state.params;\n    const {\n      isIE,\n      openProjectPopup,\n      closeProjectPopup,\n      handleHelp,\n      handleChangeZIndex,\n      handleSelectTab,\n      showModal,\n      setVideoclassRef\n    } = this;\n\n    return (\n      <DndProvider backend={HTML5Backend}>\n        <View\n          screenMode={screenMode}\n          location={location}\n          pageType={pageType}\n          roomId={roomId}\n          reservationId={reservationId}\n          isTutor={isTutor}\n          isLoading={isLoading}\n          isIE={isIE}\n          tutorEmail={tutorEmail}\n          studentEmail={studentEmail}\n          lectureVideos={lectureVideos}\n          lectureSlides={lectureSlides}\n          pId={pId}\n          reservation={reservation}\n          isProjectPopupOpened={isProjectPopupOpened}\n          openProjectPopup={openProjectPopup}\n          closeProjectPopup={closeProjectPopup}\n          modalContent={modalContent}\n          showModal={showModal}\n          isHelpOpened={isHelpOpened}\n          handleHelp={handleHelp}\n          popupStates={popupStates}\n          popupZIndexes={popupZIndexes}\n          handleChangeZIndex={handleChangeZIndex}\n          handleSelectTab={handleSelectTab}\n          currentTutorial={currentTutorial}\n          isFreeTrial={isFreeTrial}\n          videoclassRef={videoclassRef}\n          setVideoclassRef={setVideoclassRef}\n          email={email}\n          name={name}\n        />\n      </DndProvider>\n    );\n  }\n}\n\nexport default connect(\n  state => ({\n    email: state.userinfo.email,\n    name: state.userinfo.name,\n    isTutor: state.userinfo.isTutor,\n    screenMode: state.preview.screenMode\n  }),\n  {\n    setProject: projectActions.setProject,\n    resetProject: projectActions.resetProject,\n    setGameVolume: previewActions.setGameVolume,\n    setLog: webrtcActions.setLog,\n    setVideoURL: videoActions.setVideoURL\n  }\n)(injectIntl(Container));\n"]},"metadata":{},"sourceType":"module"}