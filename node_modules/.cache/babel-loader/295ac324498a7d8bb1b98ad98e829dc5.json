{"ast":null,"code":"import _regeneratorRuntime from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _classCallCheck from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";\nimport _inherits from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";\nimport _possibleConstructorReturn from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";\nvar _jsxFileName = \"/Users/jimmy/Documents/Wizschool/wizlab_web2/src/Page/Builder/Component/Preload/Container.js\";\n\nfunction _createSuper(Derived) { var hasNativeReflectConstruct = _isNativeReflectConstruct(); return function _createSuperInternal() { var Super = _getPrototypeOf(Derived), result; if (hasNativeReflectConstruct) { var NewTarget = _getPrototypeOf(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return _possibleConstructorReturn(this, result); }; }\n\nfunction _isNativeReflectConstruct() { if (typeof Reflect === \"undefined\" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === \"function\") return true; try { Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {})); return true; } catch (e) { return false; } }\n\nimport React, { Component } from \"react\";\nimport { connect } from \"react-redux\";\nimport generatePreloadPage from \"../../utils/preloadPageGenerator\";\nimport \"./index.scss\";\n\nvar Container = /*#__PURE__*/function (_Component) {\n  _inherits(Container, _Component);\n\n  var _super = _createSuper(Container);\n\n  function Container(props) {\n    var _this;\n\n    _classCallCheck(this, Container);\n\n    _this = _super.call(this, props);\n    _this.preload = /*#__PURE__*/_asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2() {\n      return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n        while (1) {\n          switch (_context2.prev = _context2.next) {\n            case 0:\n              if (_this.timer) {\n                clearTimeout(_this.timer);\n              }\n\n              _this.timer = setTimeout( /*#__PURE__*/_asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee() {\n                var scene, scenes, sceneIds, soundIds, state, page;\n                return _regeneratorRuntime.wrap(function _callee$(_context) {\n                  while (1) {\n                    switch (_context.prev = _context.next) {\n                      case 0:\n                        scene = _this.props.scene;\n                        scenes = scene.scenes, sceneIds = scene.sceneIds, soundIds = scene.soundIds;\n                        state = {\n                          scene: {\n                            scenes: scenes,\n                            sceneIds: sceneIds,\n                            soundIds: soundIds\n                          }\n                        };\n                        _context.next = 5;\n                        return generatePreloadPage(state, true);\n\n                      case 5:\n                        page = _context.sent;\n\n                        if (_this.state.iframeSrcDoc !== page) {\n                          _this.setState({\n                            iframeSrcDoc: page\n                          });\n                        }\n\n                      case 7:\n                      case \"end\":\n                        return _context.stop();\n                    }\n                  }\n                }, _callee);\n              })), 1000);\n\n            case 2:\n            case \"end\":\n              return _context2.stop();\n          }\n        }\n      }, _callee2);\n    }));\n    _this.state = {\n      iframeSrcDoc: null\n    };\n    _this.timer = undefined;\n    return _this;\n  }\n\n  _createClass(Container, [{\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      this.preload();\n    }\n  }, {\n    key: \"componentDidUpdate\",\n    value: function componentDidUpdate() {\n      this.preload();\n    }\n  }, {\n    key: \"shouldComponentUpdate\",\n    value: function shouldComponentUpdate(nextProps, nextState) {\n      // check srcDoc change\n      if (this.state.iframeSrcDoc !== nextState.iframeSrcDoc) {\n        return true;\n      } // check sprites change\n\n\n      var oldScene = this.props.scene;\n      var oldSprites = [];\n\n      for (var i in oldScene.scenes) {\n        var spriteIds = oldScene.scenes[i].spriteIds;\n\n        for (var j in spriteIds) {\n          if (oldSprites.indexOf(spriteIds[j]) < 0) {\n            oldSprites.push(spriteIds[j]);\n          }\n        }\n      }\n\n      var newScene = nextProps.scene;\n\n      for (var _i in newScene.scenes) {\n        var _spriteIds = newScene.scenes[_i].spriteIds;\n\n        for (var _j in _spriteIds) {\n          if (oldSprites.indexOf(_spriteIds[_j]) < 0) {\n            return true;\n          }\n        }\n      } // check sounds change\n\n\n      for (var _i2 in newScene.soundIds) {\n        if (oldScene.soundIds.indexOf(newScene.soundIds[_i2]) < 0) {\n          return true;\n        }\n      }\n\n      return false;\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var iframeSrcDoc = this.state.iframeSrcDoc;\n      return React.createElement(\"div\", {\n        className: \"preload\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 79\n        },\n        __self: this\n      }, iframeSrcDoc && React.createElement(\"iframe\", {\n        title: \"wizlab\",\n        srcDoc: iframeSrcDoc,\n        onLoad: function onLoad() {// if (this.props.editor && !this.props.isPlaying) {\n          //   this.props.editor.focus();\n          // }\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 81\n        },\n        __self: this\n      }));\n    }\n  }]);\n\n  return Container;\n}(Component);\n\nexport default connect(function (state) {\n  return {\n    scene: state.scene,\n    isPlaying: state.preview.isPlaying\n  };\n}, {})(Container);","map":{"version":3,"sources":["/Users/jimmy/Documents/Wizschool/wizlab_web2/src/Page/Builder/Component/Preload/Container.js"],"names":["React","Component","connect","generatePreloadPage","Container","props","preload","timer","clearTimeout","setTimeout","scene","scenes","sceneIds","soundIds","state","page","iframeSrcDoc","setState","undefined","nextProps","nextState","oldScene","oldSprites","i","spriteIds","j","indexOf","push","newScene","isPlaying","preview"],"mappings":"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","sourcesContent":["import React, { Component } from \"react\";\nimport { connect } from \"react-redux\";\nimport generatePreloadPage from \"../../utils/preloadPageGenerator\";\nimport \"./index.scss\";\n\nclass Container extends Component {\n  constructor(props) {\n    super(props);\n    this.state = { iframeSrcDoc: null };\n    this.timer = undefined;\n  }\n  componentDidMount() {\n    this.preload();\n  }\n  componentDidUpdate() {\n    this.preload();\n  }\n  shouldComponentUpdate(nextProps, nextState) {\n    // check srcDoc change\n    if (this.state.iframeSrcDoc !== nextState.iframeSrcDoc) {\n      return true;\n    }\n\n    // check sprites change\n    const oldScene = this.props.scene;\n    let oldSprites = [];\n    for (let i in oldScene.scenes) {\n      const spriteIds = oldScene.scenes[i].spriteIds;\n      for (let j in spriteIds) {\n        if (oldSprites.indexOf(spriteIds[j]) < 0) {\n          oldSprites.push(spriteIds[j]);\n        }\n      }\n    }\n    const newScene = nextProps.scene;\n    for (let i in newScene.scenes) {\n      const spriteIds = newScene.scenes[i].spriteIds;\n      for (let j in spriteIds) {\n        if (oldSprites.indexOf(spriteIds[j]) < 0) {\n          return true;\n        }\n      }\n    }\n\n    // check sounds change\n    for (let i in newScene.soundIds) {\n      if (oldScene.soundIds.indexOf(newScene.soundIds[i]) < 0) {\n        return true;\n      }\n    }\n\n    return false;\n  }\n\n  preload = async () => {\n    if (this.timer) {\n      clearTimeout(this.timer);\n    }\n    this.timer = setTimeout(async () => {\n      const { scene } = this.props;\n      const { scenes, sceneIds, soundIds } = scene;\n      const state = {\n        scene: {\n          scenes,\n          sceneIds,\n          soundIds\n        }\n      };\n      const page = await generatePreloadPage(state, true);\n      if (this.state.iframeSrcDoc !== page) {\n        this.setState({ iframeSrcDoc: page });\n      }\n    }, 1000);\n  };\n\n  render() {\n    const { iframeSrcDoc } = this.state;\n    return (\n      <div className=\"preload\">\n        {iframeSrcDoc && (\n          <iframe\n            title=\"wizlab\"\n            srcDoc={iframeSrcDoc}\n            onLoad={() => {\n              // if (this.props.editor && !this.props.isPlaying) {\n              //   this.props.editor.focus();\n              // }\n            }}\n          />\n        )}\n      </div>\n    );\n  }\n}\n\nexport default connect(\n  state => ({\n    scene: state.scene,\n    isPlaying: state.preview.isPlaying\n  }),\n  {}\n)(Container);\n"]},"metadata":{},"sourceType":"module"}