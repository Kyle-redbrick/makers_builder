{"ast":null,"code":"import _regeneratorRuntime from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _classCallCheck from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";\nimport _inherits from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";\nimport _possibleConstructorReturn from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";\nvar _jsxFileName = \"/Users/jimmy/Documents/Wizschool/wizlab_web2/src/Common/Util/Subscribe.js\";\n\nfunction _createSuper(Derived) { var hasNativeReflectConstruct = _isNativeReflectConstruct(); return function _createSuperInternal() { var Super = _getPrototypeOf(Derived), result; if (hasNativeReflectConstruct) { var NewTarget = _getPrototypeOf(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return _possibleConstructorReturn(this, result); }; }\n\nfunction _isNativeReflectConstruct() { if (typeof Reflect === \"undefined\" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === \"function\") return true; try { Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {})); return true; } catch (e) { return false; } }\n\nimport React, { Component } from \"react\";\nimport { connect, Provider } from \"react-redux\";\nimport * as subscribeActions from \"../Store/Reducer/Subscribe\";\nimport store from \"../Store\";\nimport * as request from \"./HTTPRequest\";\nexport function withSubscribe(WrappedComponent) {\n  var Providee = connect(function (state) {\n    return {\n      email: state.userinfo.email,\n      subscribe: state.subscribe\n    };\n  }, {\n    addEmail: subscribeActions.addEmail,\n    deleteEmail: subscribeActions.deleteEmail\n  })( /*#__PURE__*/function (_Component) {\n    _inherits(_class2, _Component);\n\n    var _super = _createSuper(_class2);\n\n    function _class2() {\n      var _this;\n\n      _classCallCheck(this, _class2);\n\n      for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n        args[_key] = arguments[_key];\n      }\n\n      _this = _super.call.apply(_super, [this].concat(args));\n\n      _this.subscribe = function (email, callback) {\n        if (_this.props.email) {\n          request.addSubscribe({\n            email: _this.props.email,\n            creatorEmail: email\n          }).then(function (res) {\n            return res.json();\n          }).then(function (subscribe) {\n            if (subscribe.id) {\n              _this.props.addEmail(email);\n            }\n\n            if (callback) {\n              callback(!!subscribe.id);\n            }\n          }).catch(function (err) {\n            console.error(err);\n\n            if (callback) {\n              callback(false);\n            }\n          });\n        } else {\n          if (callback) {\n            callback(false);\n          }\n        }\n      };\n\n      _this.unsubscribe = function (email, callback) {\n        if (_this.props.email) {\n          request.removeSubscribe({\n            email: _this.props.email,\n            creatorEmail: email\n          }).then(function (res) {\n            return res.json();\n          }).then(function (json) {\n            if (json.success) {\n              _this.props.deleteEmail(email);\n            }\n\n            if (callback) {\n              callback(!!json.success);\n            }\n          }).catch(function (err) {\n            console.error(err);\n\n            if (callback) {\n              callback(false);\n            }\n          });\n        } else {\n          if (callback) {\n            callback(false);\n          }\n        }\n      };\n\n      return _this;\n    }\n\n    _createClass(_class2, [{\n      key: \"render\",\n      value: function render() {\n        return React.createElement(WrappedComponent, Object.assign({}, this.props, {\n          subscribeInfo: this.props.subscribe,\n          subscribe: this.subscribe,\n          unsubscribe: this.unsubscribe,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 73\n          },\n          __self: this\n        }));\n      }\n    }]);\n\n    return _class2;\n  }(Component));\n  return function (props) {\n    return React.createElement(Provider, {\n      store: store,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 86\n      },\n      __self: this\n    }, React.createElement(Providee, Object.assign({}, props, {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 87\n      },\n      __self: this\n    })));\n  };\n}\nexport function SubscribeManager(props) {\n  var Manager = connect(function (state) {\n    return {\n      email: state.userinfo.email\n    };\n  }, {\n    setEmails: subscribeActions.setEmails\n  })( /*#__PURE__*/function (_Component2) {\n    _inherits(_class3, _Component2);\n\n    var _super2 = _createSuper(_class3);\n\n    function _class3() {\n      _classCallCheck(this, _class3);\n\n      return _super2.apply(this, arguments);\n    }\n\n    _createClass(_class3, [{\n      key: \"componentDidMount\",\n      value: function componentDidMount() {\n        this.init();\n      }\n    }, {\n      key: \"init\",\n      value: function init() {\n        var _this2 = this;\n\n        this.loadSubscribes(this.props.email).then(function (subscribes) {\n          _this2.props.setEmails(subscribes.map(function (subscribe) {\n            return subscribe.creatorEmail;\n          }));\n        });\n      }\n    }, {\n      key: \"loadSubscribes\",\n      value: function () {\n        var _loadSubscribes = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(email) {\n          return _regeneratorRuntime.wrap(function _callee$(_context) {\n            while (1) {\n              switch (_context.prev = _context.next) {\n                case 0:\n                  if (!email) {\n                    _context.next = 13;\n                    break;\n                  }\n\n                  _context.prev = 1;\n                  _context.next = 4;\n                  return request.getSubscribesByType({\n                    email: email,\n                    type: \"intersted\"\n                  }).then(function (res) {\n                    return res.json();\n                  });\n\n                case 4:\n                  return _context.abrupt(\"return\", _context.sent);\n\n                case 7:\n                  _context.prev = 7;\n                  _context.t0 = _context[\"catch\"](1);\n                  console.error(_context.t0);\n                  return _context.abrupt(\"return\", []);\n\n                case 11:\n                  _context.next = 14;\n                  break;\n\n                case 13:\n                  return _context.abrupt(\"return\", []);\n\n                case 14:\n                case \"end\":\n                  return _context.stop();\n              }\n            }\n          }, _callee, null, [[1, 7]]);\n        }));\n\n        function loadSubscribes(_x) {\n          return _loadSubscribes.apply(this, arguments);\n        }\n\n        return loadSubscribes;\n      }()\n    }, {\n      key: \"componentDidUpdate\",\n      value: function componentDidUpdate(prevProps) {\n        if (prevProps.email !== this.props.email) {\n          this.didChangeUser();\n        }\n      }\n    }, {\n      key: \"didChangeUser\",\n      value: function didChangeUser() {\n        this.init();\n      }\n    }, {\n      key: \"render\",\n      value: function render() {\n        return null;\n      }\n    }]);\n\n    return _class3;\n  }(Component));\n  return React.createElement(Provider, {\n    store: store,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 139\n    },\n    __self: this\n  }, React.createElement(Manager, Object.assign({}, props, {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 140\n    },\n    __self: this\n  })));\n}","map":{"version":3,"sources":["/Users/jimmy/Documents/Wizschool/wizlab_web2/src/Common/Util/Subscribe.js"],"names":["React","Component","connect","Provider","subscribeActions","store","request","withSubscribe","WrappedComponent","Providee","state","email","userinfo","subscribe","addEmail","deleteEmail","callback","props","addSubscribe","creatorEmail","then","res","json","id","catch","err","console","error","unsubscribe","removeSubscribe","success","SubscribeManager","Manager","setEmails","init","loadSubscribes","subscribes","map","getSubscribesByType","type","prevProps","didChangeUser"],"mappings":"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","sourcesContent":["import React, { Component } from \"react\";\nimport { connect, Provider } from \"react-redux\";\nimport * as subscribeActions from \"../Store/Reducer/Subscribe\";\nimport store from \"../Store\"\nimport * as request from \"./HTTPRequest\";\n\nexport function withSubscribe(WrappedComponent) {\n  const Providee = connect(\n    state => ({\n      email: state.userinfo.email,\n      subscribe: state.subscribe\n    }),\n    {\n      addEmail: subscribeActions.addEmail,\n      deleteEmail: subscribeActions.deleteEmail\n    }\n  )(\n    class extends Component {\n\n      subscribe = (email, callback) => {\n        if(this.props.email) {\n          request\n            .addSubscribe({ email: this.props.email, creatorEmail: email })\n            .then(res => res.json())\n            .then(subscribe => {\n              if(subscribe.id) {\n                this.props.addEmail(email); \n              }\n              if(callback) {\n                callback(!!subscribe.id);\n              }\n            })\n            .catch(err => {\n              console.error(err);\n              if(callback) {\n                callback(false);\n              }\n            }) \n        } else {\n          if(callback) {\n            callback(false);\n          }\n        }\n      }\n      unsubscribe = (email, callback) => {\n        if(this.props.email) {\n          request\n            .removeSubscribe({ email: this.props.email, creatorEmail: email })\n            .then(res => res.json())\n            .then(json => {\n              if(json.success) {\n                this.props.deleteEmail(email);\n              }\n              if(callback) {\n                callback(!!json.success);\n              }\n            })\n            .catch(err => {\n              console.error(err);\n              if(callback) {\n                callback(false);\n              }\n            }) \n        } else {\n          if(callback) {\n            callback(false);\n          }\n        }\n      }\n\n      render() {\n        return (\n          <WrappedComponent\n            {...this.props}\n            subscribeInfo={this.props.subscribe}\n            subscribe={this.subscribe}\n            unsubscribe={this.unsubscribe}\n          />\n        );\n      }\n    }\n  )\n\n  return function (props) {\n    return (\n      <Provider store={store}>\n        <Providee {...props} />\n      </Provider>\n    );\n  };\n}\n\nexport function SubscribeManager(props) {\n  const Manager = connect(\n    state => ({ email: state.userinfo.email }),\n    { setEmails: subscribeActions.setEmails } \n  )(\n    class extends Component {\n      \n      componentDidMount() {\n        this.init();\n      }\n      init() {\n        this.loadSubscribes(this.props.email).then(subscribes => {\n          this.props.setEmails(subscribes.map(subscribe => subscribe.creatorEmail))\n        });\n      }\n      async loadSubscribes(email) {\n        if(email) {\n          try {\n            return await request\n             .getSubscribesByType({ email, type: \"intersted\" })\n             .then(res => res.json());\n          } catch(err) {\n            console.error(err);\n            return [];\n          }\n        } else {\n          return [];\n        }\n      }\n\n      componentDidUpdate(prevProps) {\n        if(prevProps.email !== this.props.email) {\n          this.didChangeUser();\n        }\n      }\n      didChangeUser() {\n        this.init();\n      }\n\n      render() {\n        return null;\n      }\n    }\n  )\n\n  return (\n    <Provider store={store}>\n      <Manager {...props} />\n    </Provider>\n  );\n}\n"]},"metadata":{},"sourceType":"module"}