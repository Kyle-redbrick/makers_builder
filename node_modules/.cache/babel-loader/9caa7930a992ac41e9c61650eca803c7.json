{"ast":null,"code":"import _toConsumableArray from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";\nimport _regeneratorRuntime from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _classCallCheck from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";\nimport _inherits from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";\nimport _possibleConstructorReturn from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";\nvar _jsxFileName = \"/Users/jimmy/Documents/Wizschool/wizlab_web2/src/Page/MyAPK/Components/CreateAPK/Container.js\";\n\nfunction _createSuper(Derived) { var hasNativeReflectConstruct = _isNativeReflectConstruct(); return function _createSuperInternal() { var Super = _getPrototypeOf(Derived), result; if (hasNativeReflectConstruct) { var NewTarget = _getPrototypeOf(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return _possibleConstructorReturn(this, result); }; }\n\nfunction _isNativeReflectConstruct() { if (typeof Reflect === \"undefined\" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === \"function\") return true; try { Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {})); return true; } catch (e) { return false; } }\n\nimport React, { Component } from \"react\";\nimport * as request from \"../../../../Common/Util/HTTPRequest\";\nimport { connect } from \"react-redux\";\nimport { injectIntl } from \"react-intl\";\nimport { Redirect } from \"react-router-dom\";\nimport View from \"./View\";\nimport PopUp, { showPopUp } from \"../../../../Common/Component/PopUp\";\nimport * as action from \"../../../../Common/Store/Reducer/UserInfo\";\nimport ApkPayLinkPopup from \"../APKPayLinkPopup\";\n\nvar Container = /*#__PURE__*/function (_Component) {\n  _inherits(Container, _Component);\n\n  var _super = _createSuper(Container);\n\n  function Container(props) {\n    var _this;\n\n    _classCallCheck(this, Container);\n\n    _this = _super.call(this, props);\n    _this.componentDidMount = /*#__PURE__*/_asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee() {\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              _this.setProjects();\n\n              _this.checkTicket();\n\n            case 2:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee);\n    }));\n    _this.checkTicket = /*#__PURE__*/_asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2() {\n      var userInfo;\n      return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n        while (1) {\n          switch (_context2.prev = _context2.next) {\n            case 0:\n              _context2.next = 2;\n              return _this.getUserTicket();\n\n            case 2:\n              userInfo = _context2.sent;\n\n              if (!(!userInfo || !userInfo.success)) {\n                _context2.next = 5;\n                break;\n              }\n\n              return _context2.abrupt(\"return\");\n\n            case 5:\n              if (!(userInfo.user.apkTicket < 1)) {\n                _context2.next = 8;\n                break;\n              }\n\n              showPopUp(React.createElement(ApkPayLinkPopup, {\n                onClickPay: function onClickPay() {\n                  _this.props.history.push(\"/payment\");\n                },\n                onCancel: function onCancel() {\n                  _this.props.history.replace(\"/myapk\");\n                },\n                __source: {\n                  fileName: _jsxFileName,\n                  lineNumber: 43\n                },\n                __self: this\n              }), {\n                defaultPadding: false,\n                mobileFullscreen: true\n              });\n              return _context2.abrupt(\"return\");\n\n            case 8:\n            case \"end\":\n              return _context2.stop();\n          }\n        }\n      }, _callee2, this);\n    }));\n    _this.getUserTicket = /*#__PURE__*/_asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee3() {\n      var userInfo;\n      return _regeneratorRuntime.wrap(function _callee3$(_context3) {\n        while (1) {\n          switch (_context3.prev = _context3.next) {\n            case 0:\n              _context3.next = 2;\n              return request.getUserApkTicket({\n                id: _this.props.userinfo.id\n              }).then(function (res) {\n                return res.json();\n              }).catch(function (e) {\n                console.error(e);\n                return undefined;\n              });\n\n            case 2:\n              userInfo = _context3.sent;\n              return _context3.abrupt(\"return\", userInfo);\n\n            case 4:\n            case \"end\":\n              return _context3.stop();\n          }\n        }\n      }, _callee3);\n    }));\n    _this.setProjects = /*#__PURE__*/_asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee4() {\n      var json, projectInfo;\n      return _regeneratorRuntime.wrap(function _callee4$(_context4) {\n        while (1) {\n          switch (_context4.prev = _context4.next) {\n            case 0:\n              _context4.next = 2;\n              return _this.getPublishedProjects();\n\n            case 2:\n              json = _context4.sent;\n\n              if (!(!json || !json.success)) {\n                _context4.next = 5;\n                break;\n              }\n\n              return _context4.abrupt(\"return\");\n\n            case 5:\n              projectInfo = {\n                projects: json.projects,\n                projectTotalCount: json.projectTotalCount\n              };\n              _context4.next = 8;\n              return _this.setProjectToState(projectInfo);\n\n            case 8:\n            case \"end\":\n              return _context4.stop();\n          }\n        }\n      }, _callee4);\n    }));\n    _this.getPublishedProjects = /*#__PURE__*/_asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee5() {\n      var json;\n      return _regeneratorRuntime.wrap(function _callee5$(_context5) {\n        while (1) {\n          switch (_context5.prev = _context5.next) {\n            case 0:\n              _context5.next = 2;\n              return request.getPublishedProjectsByUserWithOffset({\n                userId: _this.props.userinfo.id,\n                limit: 200,\n                offset: _this.state.projectTotalCount\n              }).then(function (res) {\n                return res.json();\n              }).catch(function (e) {\n                console.error(e.message);\n                return undefined;\n              });\n\n            case 2:\n              json = _context5.sent;\n              return _context5.abrupt(\"return\", json);\n\n            case 4:\n            case \"end\":\n              return _context5.stop();\n          }\n        }\n      }, _callee5);\n    }));\n\n    _this.setProjectToState = function (projectInfo) {\n      var projects = projectInfo.projects,\n          projectTotalCount = projectInfo.projectTotalCount;\n      return new Promise(function (resolve) {\n        return _this.setState({\n          projects: [].concat(_toConsumableArray(_this.state.projects), _toConsumableArray(projects)),\n          projectTotalCount: projectTotalCount\n        }, resolve);\n      });\n    };\n\n    _this.handleNextProcessType = /*#__PURE__*/function () {\n      var _ref6 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee6(processType, payload) {\n        var selectedProject, appName, appIcon, packageName;\n        return _regeneratorRuntime.wrap(function _callee6$(_context6) {\n          while (1) {\n            switch (_context6.prev = _context6.next) {\n              case 0:\n                _context6.t0 = processType;\n                _context6.next = _context6.t0 === _this.CREATINGPROCESS_TYPE.GUIDE ? 3 : _context6.t0 === _this.CREATINGPROCESS_TYPE.SELECTAPP ? 5 : _context6.t0 === _this.CREATINGPROCESS_TYPE.APPINFO ? 12 : 22;\n                break;\n\n              case 3:\n                _this.setNextProcess();\n\n                return _context6.abrupt(\"break\", 23);\n\n              case 5:\n                selectedProject = payload.selectedProject;\n\n                if (selectedProject) {\n                  _context6.next = 8;\n                  break;\n                }\n\n                return _context6.abrupt(\"return\");\n\n              case 8:\n                _context6.next = 10;\n                return _this.setSelectedProjectToState(selectedProject);\n\n              case 10:\n                _this.setNextProcess();\n\n                return _context6.abrupt(\"break\", 23);\n\n              case 12:\n                appName = payload.appName, appIcon = payload.appIcon, packageName = payload.packageName;\n\n                if (!(!appName || !appIcon || !packageName)) {\n                  _context6.next = 15;\n                  break;\n                }\n\n                return _context6.abrupt(\"return\");\n\n              case 15:\n                _context6.next = 17;\n                return _this.setAPKInfoToState(payload);\n\n              case 17:\n                if (!(!_this.state.apkInfo || !_this.state.selectedProject)) {\n                  _context6.next = 19;\n                  break;\n                }\n\n                return _context6.abrupt(\"return\");\n\n              case 19:\n                _context6.next = 21;\n                return _this.createAPK();\n\n              case 21:\n                return _context6.abrupt(\"break\", 23);\n\n              case 22:\n                return _context6.abrupt(\"break\", 23);\n\n              case 23:\n              case \"end\":\n                return _context6.stop();\n            }\n          }\n        }, _callee6);\n      }));\n\n      return function (_x, _x2) {\n        return _ref6.apply(this, arguments);\n      };\n    }();\n\n    _this.createAPK = /*#__PURE__*/_asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee7() {\n      var createdAPKInfo;\n      return _regeneratorRuntime.wrap(function _callee7$(_context7) {\n        while (1) {\n          switch (_context7.prev = _context7.next) {\n            case 0:\n              _context7.next = 2;\n              return _this.postCreateWizlabAPK();\n\n            case 2:\n              createdAPKInfo = _context7.sent;\n\n              if (!(!createdAPKInfo || !createdAPKInfo.success)) {\n                _context7.next = 6;\n                break;\n              }\n\n              // error handling\n              showPopUp(React.createElement(PopUp.OneButton, {\n                title: \"\\uC2E4\\uD328\",\n                __source: {\n                  fileName: _jsxFileName,\n                  lineNumber: 139\n                },\n                __self: this\n              }));\n              return _context7.abrupt(\"return\");\n\n            case 6:\n              _this.props.updateUserInfo({\n                apkTicket: _this.props.userinfo.apkTicket - 1\n              });\n\n              _this.setNextProcess();\n\n            case 8:\n            case \"end\":\n              return _context7.stop();\n          }\n        }\n      }, _callee7, this);\n    }));\n    _this.postCreateWizlabAPK = /*#__PURE__*/_asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee8() {\n      var _this$state$apkInfo, packageName, appName, appIcon, json;\n\n      return _regeneratorRuntime.wrap(function _callee8$(_context8) {\n        while (1) {\n          switch (_context8.prev = _context8.next) {\n            case 0:\n              _this$state$apkInfo = _this.state.apkInfo, packageName = _this$state$apkInfo.packageName, appName = _this$state$apkInfo.appName, appIcon = _this$state$apkInfo.appIcon;\n              _context8.next = 3;\n              return request.createWizlabAPK({\n                userId: _this.props.userinfo.id,\n                packageName: packageName,\n                appName: appName,\n                appIcon: appIcon,\n                pId: _this.state.selectedProject.pId\n              }).then(function (res) {\n                return res.json();\n              }).catch(function (e) {\n                console.error(e);\n                return undefined;\n              });\n\n            case 3:\n              json = _context8.sent;\n              return _context8.abrupt(\"return\", json);\n\n            case 5:\n            case \"end\":\n              return _context8.stop();\n          }\n        }\n      }, _callee8);\n    }));\n\n    _this.setSelectedProjectToState = function (selectedProject) {\n      return new Promise(function (resolve) {\n        return _this.setState({\n          selectedProject: selectedProject\n        }, resolve);\n      });\n    };\n\n    _this.setAPKInfoToState = function (apkInfo) {\n      return new Promise(function (resolve) {\n        return _this.setState({\n          apkInfo: apkInfo\n        }, resolve);\n      });\n    };\n\n    _this.setNextProcess = function () {\n      var processes = Object.keys(_this.CREATINGPROCESS_TYPE);\n      var currentProcessType = _this.state.currentProcessType;\n      var currentProcessIndex = processes.indexOf(currentProcessType);\n      if (currentProcessIndex + 1 >= processes.length) return;\n      var nextProcessIndex = currentProcessIndex + 1;\n\n      _this.setProcessTypeToState(processes[nextProcessIndex]);\n    };\n\n    _this.setProcessTypeToState = function (processType) {\n      _this.setState({\n        currentProcessType: processType\n      });\n    };\n\n    _this.onClickMovableProcess = /*#__PURE__*/function () {\n      var _ref9 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee9(processType) {\n        return _regeneratorRuntime.wrap(function _callee9$(_context9) {\n          while (1) {\n            switch (_context9.prev = _context9.next) {\n              case 0:\n                _this.checkTicket();\n\n                _context9.next = 3;\n                return _this.setSelectedProjectToState(null);\n\n              case 3:\n                _this.setProcessTypeToState(processType);\n\n              case 4:\n              case \"end\":\n                return _context9.stop();\n            }\n          }\n        }, _callee9);\n      }));\n\n      return function (_x3) {\n        return _ref9.apply(this, arguments);\n      };\n    }();\n\n    _this.CREATINGPROCESS_TYPE = {\n      GUIDE: \"GUIDE\",\n      SELECTAPP: \"SELECTAPP\",\n      APPINFO: \"APPINFO\",\n      MAKING: \"MAKING\"\n    };\n    _this.state = {\n      currentProcessType: _this.CREATINGPROCESS_TYPE.GUIDE,\n      projects: [],\n      projectTotalCount: 0,\n      selectedProject: undefined,\n      apkInfo: undefined\n    };\n    return _this;\n  }\n\n  _createClass(Container, [{\n    key: \"render\",\n    value: function render() {\n      if (!this.props.userinfo.email) {\n        return React.createElement(Redirect, {\n          to: \"/\",\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 210\n          },\n          __self: this\n        });\n      }\n\n      var _this$state = this.state,\n          projects = _this$state.projects,\n          selectedProject = _this$state.selectedProject,\n          currentProcessType = _this$state.currentProcessType,\n          apkInfo = _this$state.apkInfo;\n      return React.createElement(View, {\n        intl: this.props.intl,\n        CREATINGPROCESS_TYPE: this.CREATINGPROCESS_TYPE,\n        currentProcessType: currentProcessType,\n        projects: projects,\n        selectedProject: selectedProject,\n        handleNextProcessType: this.handleNextProcessType,\n        apkInfo: apkInfo,\n        history: this.props.history,\n        onClickMovableProcess: this.onClickMovableProcess,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 220\n        },\n        __self: this\n      });\n    }\n  }]);\n\n  return Container;\n}(Component);\n\nexport default connect(function (state) {\n  return {\n    userinfo: state.userinfo\n  };\n}, {\n  updateUserInfo: action.updateUserInfo\n})(injectIntl(Container));","map":{"version":3,"sources":["/Users/jimmy/Documents/Wizschool/wizlab_web2/src/Page/MyAPK/Components/CreateAPK/Container.js"],"names":["React","Component","request","connect","injectIntl","Redirect","View","PopUp","showPopUp","action","ApkPayLinkPopup","Container","props","componentDidMount","setProjects","checkTicket","getUserTicket","userInfo","success","user","apkTicket","history","push","replace","defaultPadding","mobileFullscreen","getUserApkTicket","id","userinfo","then","res","json","catch","e","console","error","undefined","getPublishedProjects","projectInfo","projects","projectTotalCount","setProjectToState","getPublishedProjectsByUserWithOffset","userId","limit","offset","state","message","Promise","resolve","setState","handleNextProcessType","processType","payload","CREATINGPROCESS_TYPE","GUIDE","SELECTAPP","APPINFO","setNextProcess","selectedProject","setSelectedProjectToState","appName","appIcon","packageName","setAPKInfoToState","apkInfo","createAPK","postCreateWizlabAPK","createdAPKInfo","updateUserInfo","createWizlabAPK","pId","processes","Object","keys","currentProcessType","currentProcessIndex","indexOf","length","nextProcessIndex","setProcessTypeToState","onClickMovableProcess","MAKING","email","intl"],"mappings":"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","sourcesContent":["import React, { Component } from \"react\";\nimport * as request from \"../../../../Common/Util/HTTPRequest\";\nimport { connect } from \"react-redux\";\nimport { injectIntl } from \"react-intl\";\nimport { Redirect } from \"react-router-dom\";\nimport View from \"./View\";\nimport PopUp, { showPopUp } from \"../../../../Common/Component/PopUp\";\nimport * as action from \"../../../../Common/Store/Reducer/UserInfo\";\nimport ApkPayLinkPopup from \"../APKPayLinkPopup\";\n\nclass Container extends Component {\n  constructor(props) {\n    super(props);\n\n    this.CREATINGPROCESS_TYPE = {\n      GUIDE: \"GUIDE\",\n      SELECTAPP: \"SELECTAPP\",\n      APPINFO: \"APPINFO\",\n      MAKING: \"MAKING\"\n    };\n\n    this.state = {\n      currentProcessType: this.CREATINGPROCESS_TYPE.GUIDE,\n      projects: [],\n      projectTotalCount: 0,\n      selectedProject: undefined,\n      apkInfo: undefined\n    };\n  }\n\n  componentDidMount = async () => {\n    this.setProjects();\n    this.checkTicket();\n  };\n\n  checkTicket = async () => {\n    const userInfo = await this.getUserTicket();\n    if (!userInfo || !userInfo.success) {\n      return;\n    }\n    if (userInfo.user.apkTicket < 1) {\n      showPopUp(\n        <ApkPayLinkPopup\n          onClickPay={() => {\n            this.props.history.push(\"/payment\");\n          }}\n          onCancel={() => {\n            this.props.history.replace(\"/myapk\");\n          }}\n        />,\n        { defaultPadding: false, mobileFullscreen: true }\n      );\n      return;\n    }\n  };\n\n  getUserTicket = async () => {\n    const userInfo = await request\n      .getUserApkTicket({\n        id: this.props.userinfo.id\n      })\n      .then(res => res.json())\n      .catch(e => {\n        console.error(e);\n        return undefined;\n      });\n    return userInfo;\n  };\n\n  setProjects = async () => {\n    const json = await this.getPublishedProjects();\n    if (!json || !json.success) {\n      // error handling for user exercise (ex. popup)\n      return;\n    }\n    const projectInfo = {\n      projects: json.projects,\n      projectTotalCount: json.projectTotalCount\n    };\n    await this.setProjectToState(projectInfo);\n  };\n\n  getPublishedProjects = async () => {\n    const json = await request\n      .getPublishedProjectsByUserWithOffset({\n        userId: this.props.userinfo.id,\n        limit: 200,\n        offset: this.state.projectTotalCount\n      })\n      .then(res => res.json())\n      .catch(e => {\n        console.error(e.message);\n        return undefined;\n      });\n    return json;\n  };\n\n  setProjectToState = projectInfo => {\n    const { projects, projectTotalCount } = projectInfo;\n    return new Promise(resolve =>\n      this.setState(\n        {\n          projects: [...this.state.projects, ...projects],\n          projectTotalCount\n        },\n        resolve\n      )\n    );\n  };\n\n  handleNextProcessType = async (processType, payload) => {\n    switch (processType) {\n      case this.CREATINGPROCESS_TYPE.GUIDE:\n        this.setNextProcess();\n        break;\n      case this.CREATINGPROCESS_TYPE.SELECTAPP:\n        const { selectedProject } = payload;\n        if (!selectedProject) return;\n        await this.setSelectedProjectToState(selectedProject);\n        this.setNextProcess();\n        break;\n\n      case this.CREATINGPROCESS_TYPE.APPINFO:\n        const { appName, appIcon, packageName } = payload;\n        if (!appName || !appIcon || !packageName) return;\n        await this.setAPKInfoToState(payload);\n        if (!this.state.apkInfo || !this.state.selectedProject) return;\n        await this.createAPK();\n        break;\n      default:\n        break;\n    }\n  };\n\n  createAPK = async () => {\n    const createdAPKInfo = await this.postCreateWizlabAPK();\n    if (!createdAPKInfo || !createdAPKInfo.success) {\n      // error handling\n      showPopUp(<PopUp.OneButton title=\"실패\" />);\n      return;\n    }\n    this.props.updateUserInfo({\n      apkTicket: this.props.userinfo.apkTicket - 1\n    });\n    this.setNextProcess();\n  };\n\n  postCreateWizlabAPK = async () => {\n    const { packageName, appName, appIcon } = this.state.apkInfo;\n    const json = await request\n      .createWizlabAPK({\n        userId: this.props.userinfo.id,\n        packageName,\n        appName,\n        appIcon,\n        pId: this.state.selectedProject.pId\n      })\n      .then(res => res.json())\n      .catch(e => {\n        console.error(e);\n        return undefined;\n      });\n    return json;\n  };\n\n  setSelectedProjectToState = selectedProject => {\n    return new Promise(resolve =>\n      this.setState(\n        {\n          selectedProject\n        },\n        resolve\n      )\n    );\n  };\n\n  setAPKInfoToState = apkInfo => {\n    return new Promise(resolve =>\n      this.setState(\n        {\n          apkInfo\n        },\n        resolve\n      )\n    );\n  };\n\n  setNextProcess = () => {\n    const processes = Object.keys(this.CREATINGPROCESS_TYPE);\n    const { currentProcessType } = this.state;\n    const currentProcessIndex = processes.indexOf(currentProcessType);\n    if (currentProcessIndex + 1 >= processes.length) return;\n    const nextProcessIndex = currentProcessIndex + 1;\n    this.setProcessTypeToState(processes[nextProcessIndex]);\n  };\n  setProcessTypeToState = processType => {\n    this.setState({\n      currentProcessType: processType\n    });\n  };\n\n  onClickMovableProcess = async processType => {\n    this.checkTicket();\n    await this.setSelectedProjectToState(null);\n    this.setProcessTypeToState(processType);\n  };\n\n  render() {\n    if (!this.props.userinfo.email) {\n      return <Redirect to=\"/\" />;\n    }\n    const {\n      projects,\n      selectedProject,\n      currentProcessType,\n      apkInfo\n    } = this.state;\n\n    return (\n      <View\n        intl={this.props.intl}\n        CREATINGPROCESS_TYPE={this.CREATINGPROCESS_TYPE}\n        currentProcessType={currentProcessType}\n        projects={projects}\n        selectedProject={selectedProject}\n        handleNextProcessType={this.handleNextProcessType}\n        apkInfo={apkInfo}\n        history={this.props.history}\n        onClickMovableProcess={this.onClickMovableProcess}\n      />\n    );\n  }\n}\n\nexport default connect(\n  state => ({ userinfo: state.userinfo }),\n  {\n    updateUserInfo: action.updateUserInfo\n  }\n)(injectIntl(Container));\n"]},"metadata":{},"sourceType":"module"}