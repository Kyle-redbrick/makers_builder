{"ast":null,"code":"import _regeneratorRuntime from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";\nimport _objectSpread from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread\";\nimport _asyncToGenerator from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _classCallCheck from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";\nimport _inherits from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";\nimport _possibleConstructorReturn from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";\nvar _jsxFileName = \"/Users/jimmy/Documents/Wizschool/wizlab_web2/src/Page/CourseDetail/Container.js\";\n\nfunction _createSuper(Derived) { var hasNativeReflectConstruct = _isNativeReflectConstruct(); return function _createSuperInternal() { var Super = _getPrototypeOf(Derived), result; if (hasNativeReflectConstruct) { var NewTarget = _getPrototypeOf(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return _possibleConstructorReturn(this, result); }; }\n\nfunction _isNativeReflectConstruct() { if (typeof Reflect === \"undefined\" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === \"function\") return true; try { Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {})); return true; } catch (e) { return false; } }\n\nimport React, { Component } from \"react\";\nimport { withMsal } from \"@azure/msal-react\";\nimport { connect } from \"react-redux\";\nimport * as userInfoActions from \"../../Common/Store/Reducer/UserInfo\";\nimport { loginRequest, graphConfig } from \"../../Common/Util/MsalConfig\";\nimport { getRandomName, getRandomUserIcon } from \"../../Common/Util/RandomGenerator\";\nimport * as request from \"../../Common/Util/HTTPRequest\";\nimport View from \"./View\";\n\nvar Container = /*#__PURE__*/function (_Component) {\n  _inherits(Container, _Component);\n\n  var _super = _createSuper(Container);\n\n  function Container() {\n    var _this;\n\n    _classCallCheck(this, Container);\n\n    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n\n    _this = _super.call.apply(_super, [this].concat(args));\n\n    _this.onClickLogin = function () {\n      _this.loginToMsal();\n    };\n\n    _this.loginToMsal = /*#__PURE__*/_asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee() {\n      var _this$props, msalContext, onError, loginResponse, tokenResponse, graphResponse;\n\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              _this$props = _this.props, msalContext = _this$props.msalContext, onError = _this$props.onError;\n              _context.prev = 1;\n              _context.next = 4;\n              return msalContext.instance.loginPopup(loginRequest);\n\n            case 4:\n              loginResponse = _context.sent;\n              _context.next = 7;\n              return msalContext.instance.acquireTokenSilent(_objectSpread({}, loginRequest, {\n                account: loginResponse.account\n              }));\n\n            case 7:\n              tokenResponse = _context.sent;\n              _context.next = 10;\n              return _this.callMsGraph(tokenResponse.accessToken);\n\n            case 10:\n              graphResponse = _context.sent;\n\n              _this.loginToWizlab(graphResponse.id);\n\n              _context.next = 18;\n              break;\n\n            case 14:\n              _context.prev = 14;\n              _context.t0 = _context[\"catch\"](1);\n              console.error(_context.t0);\n              if (onError) onError(_context.t0);\n\n            case 18:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee, null, [[1, 14]]);\n    }));\n\n    _this.loginToWizlab = function (msalId) {\n      var params = {\n        msalId: msalId,\n        name: getRandomName(),\n        icon: getRandomUserIcon()\n      };\n      request.loginByMsal(params).then(function (res) {\n        return res.json();\n      }).then(function (json) {\n        localStorage.setItem(\"wizToken\", json.token);\n\n        _this.props.updateUserInfo(json.user); // this.props.dismiss();\n\n      }).catch(function (e) {\n        console.error(e); // this.props.dismiss();\n      });\n    };\n\n    return _this;\n  }\n\n  _createClass(Container, [{\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      if (!this.props.email) {\n        this.loginToMsal();\n      }\n    }\n  }, {\n    key: \"callMsGraph\",\n    value: function callMsGraph(accessToken) {\n      var headers = new Headers();\n      var bearer = \"Bearer \".concat(accessToken);\n      headers.append(\"Authorization\", bearer);\n      var options = {\n        method: \"GET\",\n        headers: headers\n      };\n      return fetch(graphConfig.graphMeEndpoint, options).then(function (response) {\n        return response.json();\n      }).catch(function (error) {\n        return console.log(error);\n      });\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var email = this.props.email;\n      /* if atom project link, return to main page */\n\n      if (this.props.match.params.id === '49') window.location.pathname = \"/\";\n      return React.createElement(React.Fragment, {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 77\n        },\n        __self: this\n      }, React.createElement(View, {\n        courseId: this.props.match.params.id,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 78\n        },\n        __self: this\n      }), !email && React.createElement(\"div\", {\n        onClick: this.onClickLogin,\n        style: {\n          position: \"fixed\",\n          left: 0,\n          top: 0,\n          width: \"100vw\",\n          height: \"100vh\",\n          zIndex: 9999\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 80\n        },\n        __self: this\n      }));\n    }\n  }]);\n\n  return Container;\n}(Component);\n\nexport default connect(function (state) {\n  return {\n    email: state.userinfo.email\n  };\n}, {\n  updateUserInfo: userInfoActions.updateUserInfo\n})(withMsal(Container));","map":{"version":3,"sources":["/Users/jimmy/Documents/Wizschool/wizlab_web2/src/Page/CourseDetail/Container.js"],"names":["React","Component","withMsal","connect","userInfoActions","loginRequest","graphConfig","getRandomName","getRandomUserIcon","request","View","Container","onClickLogin","loginToMsal","props","msalContext","onError","instance","loginPopup","loginResponse","acquireTokenSilent","account","tokenResponse","callMsGraph","accessToken","graphResponse","loginToWizlab","id","console","error","msalId","params","name","icon","loginByMsal","then","res","json","localStorage","setItem","token","updateUserInfo","user","catch","e","email","headers","Headers","bearer","append","options","method","fetch","graphMeEndpoint","response","log","match","window","location","pathname","position","left","top","width","height","zIndex","state","userinfo"],"mappings":"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","sourcesContent":["import React, { Component } from \"react\";\nimport { withMsal } from \"@azure/msal-react\";\nimport { connect } from \"react-redux\";\nimport * as userInfoActions from \"../../Common/Store/Reducer/UserInfo\";\nimport { loginRequest, graphConfig } from \"../../Common/Util/MsalConfig\";\nimport { getRandomName, getRandomUserIcon } from \"../../Common/Util/RandomGenerator\";\nimport * as request from \"../../Common/Util/HTTPRequest\";\nimport View from \"./View\";\n\nclass Container extends Component {\n  componentDidMount() {\n    if(!this.props.email) {\n      this.loginToMsal();\n    }\n  }\n\n  onClickLogin = () => {\n    this.loginToMsal();\n  }\n\n  loginToMsal = async () => {\n    const { msalContext, onError } = this.props;\n    try{\n      const loginResponse = await msalContext.instance.loginPopup(loginRequest);\n      const tokenResponse = await msalContext.instance.acquireTokenSilent({\n        ...loginRequest,\n        account: loginResponse.account\n      });\n      const graphResponse = await this.callMsGraph(tokenResponse.accessToken);\n      this.loginToWizlab(graphResponse.id);\n    }catch(e) {\n      console.error(e);\n      if(onError) onError(e);\n    }\n  }\n\n  loginToWizlab = msalId => {\n    const params = {\n      msalId: msalId,\n      name: getRandomName(),\n      icon: getRandomUserIcon()\n    };\n    request.loginByMsal(params)\n      .then(res=> res.json())\n      .then(json=> {\n        localStorage.setItem(\"wizToken\", json.token);\n        this.props.updateUserInfo(json.user);\n        // this.props.dismiss();\n      })\n      .catch(e=> {\n        console.error(e);\n        // this.props.dismiss();\n      })\n  }\n\n  callMsGraph(accessToken) {\n    const headers = new Headers();\n    const bearer = `Bearer ${accessToken}`;\n\n    headers.append(\"Authorization\", bearer);\n\n    const options = {\n      method: \"GET\",\n      headers: headers\n    };\n\n    return fetch(graphConfig.graphMeEndpoint, options)\n      .then(response => response.json())\n      .catch(error => console.log(error));\n  }\n\n  render() {\n    const { email } = this.props;\n    /* if atom project link, return to main page */\n    if(this.props.match.params.id === '49') window.location.pathname = \"/\";\n    return (\n      <React.Fragment>\n        <View courseId={this.props.match.params.id} />\n        {!email && (\n          <div\n            onClick={this.onClickLogin}\n            style={{\n              position:\"fixed\",\n              left:0,\n              top:0,\n              width:\"100vw\",\n              height:\"100vh\",\n              zIndex:9999}} />\n        )}\n      </React.Fragment>\n    );\n  }\n}\n\nexport default connect(\n  (state) => ({ email: state.userinfo.email }),\n  { updateUserInfo: userInfoActions.updateUserInfo }\n)(withMsal(Container));\n"]},"metadata":{},"sourceType":"module"}