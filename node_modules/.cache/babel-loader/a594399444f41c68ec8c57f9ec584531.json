{"ast":null,"code":"import _classCallCheck from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";\nimport _possibleConstructorReturn from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";\nimport _inherits from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";\nvar _jsxFileName = \"/Users/jimmy/Documents/Wizschool/wizlab_web2/src/Common/Component/WizAppDetail/Component/Game/index.js\";\nimport React, { Component } from \"react\";\nimport \"./index.scss\";\nimport * as request from \"../../../../Util/HTTPRequest\";\nimport GameRanking from \"../../../GameRanking\";\nimport { connect } from \"react-redux\";\nimport { detectIE } from \"../../../../Util/detectBrowser\";\nimport { FormattedMessage } from \"react-intl\";\nimport chromeBtnImage from \"../../../../../Image/chrome-download.png\";\nimport FullBtnImage from \"../../../../../Image/fullscreen-btn.svg\";\nimport { getGuestId } from \"../../../../../Common/Util/GuestIdUtil\";\nimport { withRouter } from \"react-router-dom\";\nimport QueryString from \"query-string\";\n\nvar GameContainer =\n/*#__PURE__*/\nfunction (_Component) {\n  _inherits(GameContainer, _Component);\n\n  function GameContainer(props) {\n    var _this;\n\n    _classCallCheck(this, GameContainer);\n\n    _this = _possibleConstructorReturn(this, _getPrototypeOf(GameContainer).call(this, props));\n\n    _this.handleFocusIframe = function () {\n      setTimeout(function () {\n        if (_this.props.project.type === \"3D\") {\n          if (_this.screenRef) {\n            _this.screenRef.click();\n          }\n        }\n      }, 3000);\n    };\n\n    _this.getProject = function () {// const pId = this.props.pId;\n      // request\n      //   .getPublishedProject({ pId })\n      //   .then(res => res.json())\n      //   .then(async json => {\n      //     if (json.url) {\n      //       this.setState({ gameURL: json.url });\n      //     }\n      //   });\n    };\n\n    _this.handleScreenClick = function (e) {\n      e.stopPropagation();\n\n      if (_this.iframeRef) {\n        _this.iframeRef.contentWindow.focus();\n\n        _this.setState({\n          iframeFocused: true\n        });\n      }\n    };\n\n    _this.handleWindowFocus = function () {\n      _this.setState({\n        iframeFocused: false\n      });\n    };\n\n    _this.gameEventHandler = function (event) {\n      if (event.data.source) {\n        if (event.data.source === \"wizlab\") {\n          if (event.data.type === \"gameEvent\") {\n            var _JSON$parse = JSON.parse(event.data.message),\n                type = _JSON$parse.type,\n                data = _JSON$parse.data;\n\n            switch (type) {\n              case \"showRanking\":\n                _this.handleRankingShow(false);\n\n                break;\n\n              case \"showRankingAscending\":\n                _this.handleRankingShow(true);\n\n                break;\n\n              case \"hideRanking\":\n                _this.handleRankingHide();\n\n                break;\n\n              case \"saveScore\":\n                _this.saveScore(data);\n\n                break;\n\n              case \"saveGameData\":\n                _this.saveGameData(data);\n\n                break;\n\n              case \"resetGameData\":\n                _this.resetGameData();\n\n                break;\n\n              case \"loadGameData\":\n                _this.loadGameData();\n\n                break;\n\n              default:\n            }\n          }\n        }\n      }\n    };\n\n    _this.sendMessageToIframe = function (data) {\n      document.getElementById(\"wizlab__Iframe\").contentWindow.postMessage({\n        message: JSON.stringify(data),\n        source: \"wizlab\",\n        type: \"gameData\"\n      }, \"*\");\n    };\n\n    _this.saveGameData = function (data) {\n      var params = _this.getGameDataDefaultParams();\n\n      params.data = data;\n      request.saveGameData(params).then(function () {\n        _this.sendMessageToIframe({\n          type: \"onSaveGameData\"\n        });\n      }).catch(function (err) {\n        return console.error(err);\n      });\n    };\n\n    _this.resetGameData = function () {\n      var params = _this.getGameDataDefaultParams();\n\n      params.data = \"{}\";\n      request.saveGameData(params).then(function () {\n        _this.sendMessageToIframe({\n          type: \"onResetGameData\"\n        });\n      }).catch(function (err) {\n        return console.error(err);\n      });\n    };\n\n    _this.loadGameData = function () {\n      var params = _this.getGameDataDefaultParams();\n\n      request.loadGameData(params).then(function (res) {\n        return res.json();\n      }).then(function (json) {\n        _this.sendMessageToIframe({\n          type: \"onLoadGameData\",\n          data: json.data\n        });\n      }).catch(function (err) {\n        return console.error(err);\n      });\n    };\n\n    _this.handleRankingShow = function (isAsc) {\n      _this.setState({\n        isRankingVisible: true,\n        isAsc: isAsc\n      }, function () {\n        _this.iframeRef.blur();\n\n        _this.screenRef.focus(); // console.log(\"after ranking show\", document.activeElement);\n\n      });\n    };\n\n    _this.handleRankingHide = function () {\n      _this.setState({\n        isRankingVisible: false\n      }, function () {\n        _this.iframeRef.contentWindow.focus(); // console.log(\"after ranking hide\", document.activeElement);\n\n      });\n    };\n\n    _this.saveScore = function (score) {\n      if (_this.saveTimer) {\n        clearTimeout(_this.saveTimer);\n      }\n\n      _this.saveTimer = setTimeout(function () {\n        var pId = _this.props.pId;\n        var params = {\n          pId: pId,\n          score: score\n        };\n        var rankingId;\n\n        if (_this.props.email) {\n          rankingId = _this.props.email;\n          params.email = rankingId;\n        } else {\n          rankingId = getGuestId();\n          params.guestId = rankingId;\n        }\n\n        request.saveScore(params).then(function (res) {\n          return res.json();\n        }).then(function (json) {// console.log(json)\n        }).catch(function (err) {\n          return console.error(err);\n        });\n      }, 100);\n    };\n\n    _this.handlePlayBtn = function () {\n      _this.setState(function (state) {\n        return {\n          isPlaying: !state.isPlaying\n        };\n      });\n    };\n\n    _this.handleFullBtn = function (e) {\n      e.stopPropagation();\n\n      _this.setState(function (state) {\n        return {\n          isFullScreen: !state.isFullScreen\n        };\n      });\n    };\n\n    _this.getScreenRatio = function () {\n      var screenMode = _this.props.screenMode;\n      var screenRatio = {};\n\n      switch (screenMode) {\n        case \"VERTICAL\":\n          screenRatio.w = 9;\n          screenRatio.h = 16;\n          break;\n\n        case \"HORIZONTAL\":\n        default:\n          screenRatio.w = 16;\n          screenRatio.h = 9;\n          break;\n      }\n\n      return screenRatio;\n    };\n\n    _this.onFullScreenResize = function () {\n      if (_this.iframeRef) {\n        _this.iframeRef.contentWindow.focus();\n      }\n\n      var _this$state = _this.state,\n          btnGroupHeight = _this$state.btnGroupHeight,\n          blankPadding = _this$state.blankPadding;\n\n      var screenRatio = _this.getScreenRatio();\n\n      var windowRatio = {};\n      windowRatio.w = window.innerWidth || document.body.clientWidth;\n      windowRatio.h = window.innerHeight || document.body.clientHeight;\n      windowRatio.h -= btnGroupHeight;\n      var compareResult = windowRatio.w / windowRatio.h > screenRatio.w / screenRatio.h;\n      var nextBlankPadding;\n      if (compareResult) nextBlankPadding = \"LR\";else nextBlankPadding = \"TB\";\n\n      if (blankPadding !== nextBlankPadding) {\n        _this.setState({\n          blankPadding: nextBlankPadding\n        });\n      }\n    };\n\n    _this.getGamePage = function () {\n      var gameURL = _this.state.gameURL;\n\n      if (gameURL) {\n        return React.createElement(\"iframe\", {\n          sandbox: \"allow-scripts allow-same-origin\",\n          id: \"wizlab__Iframe\",\n          ref: _this.setIframeRef,\n          title: \"wizlab\",\n          src: gameURL,\n          scrolling: \"no\",\n          frameBorder: \"0\",\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 296\n          },\n          __self: this\n        });\n      } else {\n        return React.createElement(\"div\", {\n          className: \"GameScreen--progress\",\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 308\n          },\n          __self: this\n        }, React.createElement(\"div\", {\n          className: \"GameScreen--progress__left rotate\",\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 309\n          },\n          __self: this\n        }, React.createElement(\"span\", {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 310\n          },\n          __self: this\n        })), React.createElement(\"div\", {\n          className: \"GameScreen--progress__right rotate\",\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 312\n          },\n          __self: this\n        }, React.createElement(\"span\", {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 313\n          },\n          __self: this\n        })));\n      }\n    };\n\n    _this.setWizAppDetailZIndexTo = function (position) {\n      var wizAppDetailElement = document.getElementById(\"wizappDetail\");\n      if (wizAppDetailElement) wizAppDetailElement.style.zIndex = position === \"front\" ? 11 : 9;\n    };\n\n    _this.isIE = detectIE();\n    _this.screenRef = null;\n\n    _this.setScreenRef = function (elem) {\n      _this.screenRef = elem;\n    };\n\n    _this.iframeRef = null;\n\n    _this.setIframeRef = function (elem) {\n      _this.iframeRef = elem;\n    };\n\n    var _QueryString$parse = QueryString.parse(props.location.search),\n        fullScreen = _QueryString$parse.fullScreen;\n\n    _this.state = {\n      iframeFocused: true,\n      isPlaying: false,\n      isFullScreen: fullScreen ? true : false,\n      blankPadding: \"LR\",\n      btnGroupHeight: 38,\n      isRankingVisible: false,\n      isASC: false,\n      gameURL: props.project ? props.project.url : undefined\n    };\n    return _this;\n  }\n\n  _createClass(GameContainer, [{\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      window.addEventListener(\"focus\", this.handleWindowFocus);\n      window.addEventListener(\"message\", this.gameEventHandler, false);\n      this.getProject();\n      this.handleFocusIframe();\n    }\n  }, {\n    key: \"componentDidUpdate\",\n    value: function componentDidUpdate(prevProps, prevState) {\n      var isFullScreen = this.state.isFullScreen;\n\n      if (isFullScreen !== prevState.isFullScreen) {\n        if (isFullScreen) {\n          this.onFullScreenResize();\n          window.addEventListener(\"resize\", this.onFullScreenResize);\n        } else {\n          window.removeEventListener(\"resize\", this.onFullScreenResize);\n        }\n\n        var isMobile = window.innerWidth < 1080;\n\n        if (isMobile) {\n          this.setWizAppDetailZIndexTo(isFullScreen ? \"front\" : \"back\");\n        }\n      }\n\n      if (prevProps.pId !== this.props.pId) {\n        this.getProject();\n      }\n    }\n  }, {\n    key: \"componentWillUnmount\",\n    value: function componentWillUnmount() {\n      window.removeEventListener(\"message\", this.gameEventHandler);\n      window.removeEventListener(\"focus\", this.handleWindowFocus);\n    }\n  }, {\n    key: \"getGameDataDefaultParams\",\n    value: function getGameDataDefaultParams() {\n      var params = {\n        pId: this.props.pId\n      };\n\n      if (this.props.email) {\n        params.email = this.props.email;\n      } else {\n        params.guestId = getGuestId();\n      }\n\n      return params;\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _this$state2 = this.state,\n          isFullScreen = _this$state2.isFullScreen,\n          blankPadding = _this$state2.blankPadding,\n          isRankingVisible = _this$state2.isRankingVisible,\n          iframeFocused = _this$state2.iframeFocused,\n          isAsc = _this$state2.isAsc;\n      var _this$props = this.props,\n          screenMode = _this$props.screenMode,\n          pId = _this$props.pId;\n      var fullToggle = isFullScreen ? \"FULL\" : \"NOFULL\";\n      var direction = screenMode === \"VERTICAL\" ? \"VERT\" : \"HORI\";\n      var rankingToggle = isRankingVisible ? \"on\" : \"off\";\n      return React.createElement(\"div\", {\n        className: \"DetailGameContainer DetailGameContainer--\".concat(fullToggle),\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 339\n        },\n        __self: this\n      }, isFullScreen && React.createElement(\"div\", {\n        className: \"DetailGameContainer__overlay\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 340\n        },\n        __self: this\n      }), React.createElement(\"div\", {\n        className: \"GameLayout GameLayout--\".concat(fullToggle, \"--\").concat(direction, \"--\").concat(blankPadding),\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 341\n        },\n        __self: this\n      }, this.isIE ? React.createElement(\"div\", {\n        className: \"BlockedNoti\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 345\n        },\n        __self: this\n      }, React.createElement(\"div\", {\n        className: \"BlockedNoti__inner\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 346\n        },\n        __self: this\n      }, React.createElement(\"p\", {\n        className: \"BlockedNoti__text\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 347\n        },\n        __self: this\n      }, React.createElement(FormattedMessage, {\n        id: \"ID_BROWSER_BLOCK_TEXT1\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 348\n        },\n        __self: this\n      })), React.createElement(\"p\", {\n        className: \"BlockedNoti__text\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 350\n        },\n        __self: this\n      }, React.createElement(FormattedMessage, {\n        id: \"ID_BROWSER_BLOCK_TEXT2\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 351\n        },\n        __self: this\n      })), React.createElement(\"a\", {\n        href: \"https://www.google.com/chrome/\",\n        target: \"_blank\",\n        rel: \"noopener noreferrer\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 353\n        },\n        __self: this\n      }, React.createElement(\"img\", {\n        className: \"BlockedNoti__chromeBtn\",\n        src: chromeBtnImage,\n        alt: \"download-chrome\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 358\n        },\n        __self: this\n      })))) : React.createElement(\"div\", {\n        className: \"GameScreen\",\n        ref: this.setScreenRef,\n        onClick: this.handleScreenClick,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 367\n        },\n        __self: this\n      }, !iframeFocused && React.createElement(\"div\", {\n        className: \"GameScreen__block\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 372\n        },\n        __self: this\n      }), this.getGamePage(), React.createElement(\"div\", {\n        className: \"GameScreen__ranking--\".concat(rankingToggle),\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 374\n        },\n        __self: this\n      }, isRankingVisible && React.createElement(GameRanking, {\n        isAsc: isAsc,\n        pId: pId,\n        handleRankingHide: this.handleRankingHide,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 376\n        },\n        __self: this\n      }))), React.createElement(\"div\", {\n        className: \"GameBtnGroup\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 386\n        },\n        __self: this\n      }, React.createElement(\"div\", {\n        className: \"FullBtn\",\n        onClick: this.handleFullBtn,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 387\n        },\n        __self: this\n      }, React.createElement(\"img\", {\n        className: \"FullBtn__img\",\n        src: FullBtnImage,\n        alt: \"full-btn\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 388\n        },\n        __self: this\n      })))));\n    }\n  }]);\n\n  return GameContainer;\n}(Component);\n\nexport default connect(function (state) {\n  return {\n    email: state.userinfo.email\n  };\n}, {})(withRouter(GameContainer));","map":{"version":3,"sources":["/Users/jimmy/Documents/Wizschool/wizlab_web2/src/Common/Component/WizAppDetail/Component/Game/index.js"],"names":["React","Component","request","GameRanking","connect","detectIE","FormattedMessage","chromeBtnImage","getGuestId","withRouter","QueryString","GameContainer","props","handleFocusIframe","setTimeout","project","type","screenRef","click","getProject","handleScreenClick","e","stopPropagation","iframeRef","contentWindow","focus","setState","iframeFocused","handleWindowFocus","gameEventHandler","event","data","source","JSON","parse","message","handleRankingShow","handleRankingHide","saveScore","saveGameData","resetGameData","loadGameData","sendMessageToIframe","document","getElementById","postMessage","stringify","params","getGameDataDefaultParams","then","catch","err","console","error","res","json","isAsc","isRankingVisible","blur","score","saveTimer","clearTimeout","pId","rankingId","email","guestId","handlePlayBtn","state","isPlaying","handleFullBtn","isFullScreen","getScreenRatio","screenMode","screenRatio","w","h","onFullScreenResize","btnGroupHeight","blankPadding","windowRatio","window","innerWidth","body","clientWidth","innerHeight","clientHeight","compareResult","nextBlankPadding","getGamePage","gameURL","setIframeRef","setWizAppDetailZIndexTo","position","wizAppDetailElement","style","zIndex","isIE","setScreenRef","elem","location","search","fullScreen","isASC","url","undefined","addEventListener","prevProps","prevState","removeEventListener","isMobile","fullToggle","direction","rankingToggle","FullBtnImage","userinfo"],"mappings":"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","sourcesContent":["import React, { Component } from \"react\";\nimport \"./index.scss\";\nimport * as request from \"../../../../Util/HTTPRequest\";\nimport GameRanking from \"../../../GameRanking\";\nimport { connect } from \"react-redux\";\nimport { detectIE } from \"../../../../Util/detectBrowser\";\nimport { FormattedMessage } from \"react-intl\";\nimport chromeBtnImage from \"../../../../../Image/chrome-download.png\";\nimport FullBtnImage from \"../../../../../Image/fullscreen-btn.svg\";\nimport { getGuestId } from \"../../../../../Common/Util/GuestIdUtil\";\nimport { withRouter } from \"react-router-dom\";\nimport QueryString from \"query-string\";\n\nclass GameContainer extends Component {\n  constructor(props) {\n    super(props);\n    this.isIE = detectIE();\n    this.screenRef = null;\n    this.setScreenRef = elem => {\n      this.screenRef = elem;\n    };\n    this.iframeRef = null;\n    this.setIframeRef = elem => {\n      this.iframeRef = elem;\n    };\n\n    const { fullScreen } = QueryString.parse(props.location.search);\n    this.state = {\n      iframeFocused: true,\n      isPlaying: false,\n      isFullScreen: fullScreen ? true : false,\n      blankPadding: \"LR\",\n      btnGroupHeight: 38,\n      isRankingVisible: false,\n      isASC: false,\n      gameURL: props.project ? props.project.url : undefined\n    };\n  }\n\n  componentDidMount() {\n    window.addEventListener(\"focus\", this.handleWindowFocus);\n    window.addEventListener(\"message\", this.gameEventHandler, false);\n    this.getProject();\n    this.handleFocusIframe();\n\n  }\n\n\n  componentDidUpdate(prevProps, prevState) {\n    let { isFullScreen } = this.state;\n    if (isFullScreen !== prevState.isFullScreen) {\n      if (isFullScreen) {\n        this.onFullScreenResize();\n        window.addEventListener(\"resize\", this.onFullScreenResize);\n      } else {\n        window.removeEventListener(\"resize\", this.onFullScreenResize);\n      }\n      const isMobile = window.innerWidth < 1080;\n      if (isMobile) {\n        this.setWizAppDetailZIndexTo(isFullScreen ? \"front\" : \"back\");\n      }\n    }\n    if (prevProps.pId !== this.props.pId) {\n      this.getProject();\n    }\n  }\n\n  componentWillUnmount() {\n    window.removeEventListener(\"message\", this.gameEventHandler);\n    window.removeEventListener(\"focus\", this.handleWindowFocus);\n  }\n\n  handleFocusIframe = () => {\n    setTimeout(() => {\n      if (this.props.project.type === \"3D\") {\n        if (this.screenRef) {\n          this.screenRef.click();\n        }\n      }\n    }, 3000)\n  }\n\n  getProject = () => {\n    // const pId = this.props.pId;\n    // request\n    //   .getPublishedProject({ pId })\n    //   .then(res => res.json())\n    //   .then(async json => {\n    //     if (json.url) {\n    //       this.setState({ gameURL: json.url });\n    //     }\n    //   });\n  };\n\n  handleScreenClick = e => {\n    e.stopPropagation();\n    if (this.iframeRef) {\n      this.iframeRef.contentWindow.focus();\n      this.setState({\n        iframeFocused: true\n      });\n    }\n  };\n  handleWindowFocus = () => {\n    this.setState({\n      iframeFocused: false\n    });\n  };\n\n  gameEventHandler = event => {\n    if (event.data.source) {\n      if (event.data.source === \"wizlab\") {\n        if (event.data.type === \"gameEvent\") {\n          const { type, data } = JSON.parse(event.data.message);\n          switch (type) {\n            case \"showRanking\":\n              this.handleRankingShow(false);\n              break;\n            case \"showRankingAscending\":\n              this.handleRankingShow(true);\n              break;\n            case \"hideRanking\":\n              this.handleRankingHide();\n              break;\n            case \"saveScore\":\n              this.saveScore(data);\n              break;\n            case \"saveGameData\":\n              this.saveGameData(data);\n              break;\n            case \"resetGameData\":\n              this.resetGameData();\n              break;\n            case \"loadGameData\":\n              this.loadGameData();\n              break;\n            default:\n          }\n        }\n      }\n    }\n  };\n\n  getGameDataDefaultParams() {\n    let params = { pId: this.props.pId };\n    if (this.props.email) {\n      params.email = this.props.email;\n    } else {\n      params.guestId = getGuestId();\n    }\n    return params;\n  }\n\n  sendMessageToIframe = data => {\n    document\n      .getElementById(\"wizlab__Iframe\")\n      .contentWindow.postMessage(\n        { message: JSON.stringify(data), source: \"wizlab\", type: \"gameData\" },\n        \"*\"\n      );\n  };\n\n  saveGameData = data => {\n    const params = this.getGameDataDefaultParams();\n    params.data = data;\n    request\n      .saveGameData(params)\n      .then(() => {\n        this.sendMessageToIframe({ type: \"onSaveGameData\" });\n      })\n      .catch(err => console.error(err));\n  };\n\n  resetGameData = () => {\n    const params = this.getGameDataDefaultParams();\n    params.data = \"{}\";\n    request\n      .saveGameData(params)\n      .then(() => {\n        this.sendMessageToIframe({ type: \"onResetGameData\" });\n      })\n      .catch(err => console.error(err));\n  };\n\n  loadGameData = () => {\n    const params = this.getGameDataDefaultParams();\n    request\n      .loadGameData(params)\n      .then(res => res.json())\n      .then(json => {\n        this.sendMessageToIframe({ type: \"onLoadGameData\", data: json.data });\n      })\n      .catch(err => console.error(err));\n  };\n\n  handleRankingShow = isAsc => {\n    this.setState({ isRankingVisible: true, isAsc: isAsc }, () => {\n      this.iframeRef.blur();\n      this.screenRef.focus();\n      // console.log(\"after ranking show\", document.activeElement);\n    });\n  };\n\n  handleRankingHide = () => {\n    this.setState({ isRankingVisible: false }, () => {\n      this.iframeRef.contentWindow.focus();\n      // console.log(\"after ranking hide\", document.activeElement);\n    });\n  };\n\n  saveScore = score => {\n    if (this.saveTimer) {\n      clearTimeout(this.saveTimer);\n    }\n\n    this.saveTimer = setTimeout(() => {\n      const { pId } = this.props;\n      let params = {\n        pId: pId,\n        score: score\n      };\n      let rankingId;\n      if (this.props.email) {\n        rankingId = this.props.email;\n        params.email = rankingId;\n      } else {\n        rankingId = getGuestId();\n        params.guestId = rankingId;\n      }\n\n      request\n        .saveScore(params)\n        .then(res => res.json())\n        .then(json => {\n          // console.log(json)\n        })\n        .catch(err => console.error(err));\n    }, 100);\n  };\n\n  handlePlayBtn = () => {\n    this.setState(state => ({\n      isPlaying: !state.isPlaying\n    }));\n  };\n\n  handleFullBtn = e => {\n    e.stopPropagation();\n    this.setState(state => ({\n      isFullScreen: !state.isFullScreen\n    }));\n  };\n\n  getScreenRatio = () => {\n    let { screenMode } = this.props;\n    let screenRatio = {};\n    switch (screenMode) {\n      case \"VERTICAL\":\n        screenRatio.w = 9;\n        screenRatio.h = 16;\n        break;\n      case \"HORIZONTAL\":\n      default:\n        screenRatio.w = 16;\n        screenRatio.h = 9;\n        break;\n    }\n    return screenRatio;\n  };\n\n  onFullScreenResize = () => {\n    if (this.iframeRef) {\n      this.iframeRef.contentWindow.focus();\n    }\n    const { btnGroupHeight, blankPadding } = this.state;\n    const screenRatio = this.getScreenRatio();\n    const windowRatio = {};\n    windowRatio.w = window.innerWidth || document.body.clientWidth;\n    windowRatio.h = window.innerHeight || document.body.clientHeight;\n    windowRatio.h -= btnGroupHeight;\n\n    const compareResult =\n      windowRatio.w / windowRatio.h > screenRatio.w / screenRatio.h;\n    let nextBlankPadding;\n    if (compareResult) nextBlankPadding = \"LR\";\n    else nextBlankPadding = \"TB\";\n    if (blankPadding !== nextBlankPadding) {\n      this.setState({ blankPadding: nextBlankPadding });\n    }\n  };\n\n  getGamePage = () => {\n    const { gameURL } = this.state;\n    if (gameURL) {\n      return (\n        <iframe\n          sandbox=\"allow-scripts allow-same-origin\"\n          id=\"wizlab__Iframe\"\n          ref={this.setIframeRef}\n          title=\"wizlab\"\n          src={gameURL}\n          scrolling=\"no\"\n          frameBorder=\"0\"\n        />\n      );\n    } else {\n      return (\n        <div className=\"GameScreen--progress\">\n          <div className=\"GameScreen--progress__left rotate\">\n            <span />\n          </div>\n          <div className=\"GameScreen--progress__right rotate\">\n            <span />\n          </div>\n        </div>\n      );\n    }\n  };\n\n  setWizAppDetailZIndexTo = position => {\n    const wizAppDetailElement = document.getElementById(\"wizappDetail\");\n    if (wizAppDetailElement)\n      wizAppDetailElement.style.zIndex = position === \"front\" ? 11 : 9;\n  };\n\n  render() {\n    const {\n      isFullScreen,\n      blankPadding,\n      isRankingVisible,\n      iframeFocused,\n      isAsc\n    } = this.state;\n    const { screenMode, pId } = this.props;\n    const fullToggle = isFullScreen ? \"FULL\" : \"NOFULL\";\n    const direction = screenMode === \"VERTICAL\" ? \"VERT\" : \"HORI\";\n    let rankingToggle = isRankingVisible ? \"on\" : \"off\";\n    return (\n      <div className={`DetailGameContainer DetailGameContainer--${fullToggle}`}>\n        {isFullScreen && <div className=\"DetailGameContainer__overlay\" />}\n        <div\n          className={`GameLayout GameLayout--${fullToggle}--${direction}--${blankPadding}`}\n        >\n          {this.isIE ? (\n            <div className=\"BlockedNoti\">\n              <div className=\"BlockedNoti__inner\">\n                <p className=\"BlockedNoti__text\">\n                  <FormattedMessage id=\"ID_BROWSER_BLOCK_TEXT1\" />\n                </p>\n                <p className=\"BlockedNoti__text\">\n                  <FormattedMessage id=\"ID_BROWSER_BLOCK_TEXT2\" />\n                </p>\n                <a\n                  href={\"https://www.google.com/chrome/\"}\n                  target=\"_blank\"\n                  rel=\"noopener noreferrer\"\n                >\n                  <img\n                    className=\"BlockedNoti__chromeBtn\"\n                    src={chromeBtnImage}\n                    alt=\"download-chrome\"\n                  />\n                </a>\n              </div>\n            </div>\n          ) : (\n            <div\n              className=\"GameScreen\"\n              ref={this.setScreenRef}\n              onClick={this.handleScreenClick}\n            >\n              {!iframeFocused && <div className=\"GameScreen__block\" />}\n              {this.getGamePage()}\n              <div className={`GameScreen__ranking--${rankingToggle}`}>\n                {isRankingVisible && (\n                  <GameRanking\n                    isAsc={isAsc}\n                    pId={pId}\n                    handleRankingHide={this.handleRankingHide}\n                  />\n                )}\n              </div>\n            </div>\n          )}\n\n          <div className=\"GameBtnGroup\">\n            <div className=\"FullBtn\" onClick={this.handleFullBtn}>\n              <img className=\"FullBtn__img\" src={FullBtnImage} alt=\"full-btn\" />\n            </div>\n          </div>\n        </div>\n      </div>\n    );\n  }\n}\nexport default connect(\n  state => ({\n    email: state.userinfo.email\n  }),\n  {}\n)(withRouter(GameContainer));\n"]},"metadata":{},"sourceType":"module"}