{"ast":null,"code":"import _objectSpread from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread\";\nimport _classCallCheck from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";\nimport _inherits from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";\nimport _possibleConstructorReturn from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";\nvar _jsxFileName = \"/Users/jimmy/Documents/Wizschool/wizlab_web2/src/Page/Builder/Component/DreamBuilder/Container.js\";\n\nfunction _createSuper(Derived) { var hasNativeReflectConstruct = _isNativeReflectConstruct(); return function _createSuperInternal() { var Super = _getPrototypeOf(Derived), result; if (hasNativeReflectConstruct) { var NewTarget = _getPrototypeOf(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return _possibleConstructorReturn(this, result); }; }\n\nfunction _isNativeReflectConstruct() { if (typeof Reflect === \"undefined\" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === \"function\") return true; try { Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {})); return true; } catch (e) { return false; } }\n\nimport React, { Component } from \"react\";\nimport { withRouter } from \"react-router-dom\";\nimport { connect } from \"react-redux\";\nimport { injectIntl } from \"react-intl\";\nimport generatePID from \"../../../../Common/Util/PIDGenerator\";\nimport { showPopUp } from \"../../../../Common/Component/PopUp\";\nimport * as request from \"../../../../Common/Util/HTTPRequest\";\nimport * as projectActions from \"../../Store/Reducer/project\";\nimport * as previewActions from \"../../Store/Reducer/preview\";\nimport * as dreamActions from \"../../Store/Reducer/dream\";\nimport AssetLibrary from \"../../utils/assetLibrary\";\nimport MissionClearPopUp from \"./PopUp/MissionClear\";\nimport ProjectClearPopUp from \"./PopUp/ProjectClear\";\nimport View from \"./View\";\n\nvar Container = /*#__PURE__*/function (_Component) {\n  _inherits(Container, _Component);\n\n  var _super = _createSuper(Container);\n\n  function Container(props) {\n    var _this;\n\n    _classCallCheck(this, Container);\n\n    _this = _super.call(this, props);\n\n    _this.linkToDeveloping = function (developing) {\n      _this.props.history.replace(\"/builder/\".concat(developing.pId));\n\n      _this.props.history.go(0);\n    };\n\n    _this.forceSlideRerender = function () {\n      _this.setState({\n        shouldSlideRerender: true\n      }, function () {\n        _this.setState({\n          shouldSlideRerender: false\n        });\n      });\n    };\n\n    _this.didShowTutorialPopup = function () {\n      var didShowTutorialPopup = localStorage.getItem(\"didShowTutorial_\".concat(_this.props.editorMode));\n      if (didShowTutorialPopup) _this.setState({\n        isTutorialShow: false\n      });else _this.setState({\n        isTutorialShow: true\n      });\n    };\n\n    _this.hiddenTutorial = function () {\n      _this.setState({\n        isTutorialShow: false\n      });\n    };\n\n    _this.state = {\n      shouldSlideRerender: false,\n      isTutorialShow: false\n    };\n    return _this;\n  }\n\n  _createClass(Container, [{\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      this.load();\n    }\n  }, {\n    key: \"load\",\n    value: function load() {\n      var _this2 = this;\n\n      var myDreamLectureProjectId = this.props.match.params.id;\n      request.getMyDreamProject(myDreamLectureProjectId).then(function (res) {\n        return res.json();\n      }).then(function (myDreamProject) {\n        if (!myDreamProject) {\n          window.alert(\"no myDreamProject\");\n          return;\n        } // temp: 테스트 계정의 프로젝트는 유저 인증 생략하기\n\n\n        if (myDreamProject.email !== \"test@wizschool.io\" && myDreamProject.email !== _this2.props.email) {\n          window.alert(\"invalid user\");\n          return;\n        } // if(myDreamProject.email !== this.props.email) {\n        //   window.alert(\"invalid user\");\n        //   return;\n        // }\n\n\n        try {\n          myDreamProject.project.template = JSON.parse(myDreamProject.project.template);\n        } catch (err) {\n          window.alert(\"wrong template\");\n          return;\n        }\n\n        _this2.props.setMyDreamProject(myDreamProject);\n      });\n    }\n  }, {\n    key: \"componentDidUpdate\",\n    value: function componentDidUpdate(prevProps, prevState) {\n      if (this.props.myProject) {\n        if (!prevProps.myProject || prevProps.myProject.id !== this.props.myProject.id) {\n          this.didSetMyProject();\n        }\n      }\n\n      if (prevProps.currentMission !== this.props.currentMission) {\n        this.didSetCurrentMission();\n      }\n\n      if (prevProps.isConditionsClear !== this.props.isConditionsClear) {\n        if (this.props.currentMission && this.props.isConditionsClear) {\n          this.didClearConditions();\n        }\n      }\n\n      if (prevProps.editorMode !== this.props.editorMode) {\n        this.didShowTutorialPopup();\n      }\n    }\n  }, {\n    key: \"didSetMyProject\",\n    value: function didSetMyProject() {\n      var myProject = this.props.myProject;\n      var missions = (myProject.project.template.missions || []).map(function (mission, index) {\n        return _objectSpread({}, mission, {\n          isCompleted: index < myProject.completedMissionNum\n        });\n      });\n      var currentMissionIndex = this.props.isReplaying ? 0 : myProject.completedMissionNum;\n\n      if (currentMissionIndex > missions.length - 1) {\n        currentMissionIndex = missions.length - 1;\n      }\n\n      this.props.setDreamMissions(missions);\n      this.props.setCurrentDreamMissionIndex(currentMissionIndex);\n      this.save();\n    }\n  }, {\n    key: \"didSetCurrentMission\",\n    value: function didSetCurrentMission() {\n      var _this3 = this;\n\n      if (!this.props.currentMission) return;\n\n      if (this.missionSetTimer) {\n        clearTimeout(this.missionSetTimer);\n      } // TODO: Refer to the following issue.\n      // Issue Link: https://www.notion.so/wizschool/b77303a59acc4be7886ec81875607bf6\n\n\n      this.missionSetTimer = setTimeout(function () {\n        try {\n          var state = JSON.parse(_this3.props.currentMission.state);\n          AssetLibrary.loadAssetsFromScene(state.scene, function () {\n            _this3.props.setProject({\n              state: state\n            });\n\n            _this3.forceSlideRerender();\n          });\n        } catch (err) {\n          window.alert(\"wrong mission state\");\n        }\n      }, 200);\n    }\n  }, {\n    key: \"didClearConditions\",\n    value: function didClearConditions() {\n      if (!this.props.currentMission.isCompleted || this.props.isReplaying) {\n        this.props.completeCurrentDreamMission();\n\n        if (this.props.currentMissionIndex < this.props.missions.length - 1) {\n          this.didClearMission();\n        } else {\n          this.didClearProject();\n        }\n      }\n    }\n  }, {\n    key: \"didClearMission\",\n    value: function didClearMission() {\n      this.saveMissionClear();\n      this.alertMissionClear();\n    }\n  }, {\n    key: \"didClearProject\",\n    value: function didClearProject() {\n      this.saveProjectClear();\n      this.alertProjectClear();\n    }\n  }, {\n    key: \"saveMissionClear\",\n    value: function saveMissionClear() {\n      if (this.props.isReplaying) {\n        return;\n      }\n\n      this.save({\n        completedMissionNum: this.props.currentMissionIndex + 1\n      });\n    }\n  }, {\n    key: \"saveProjectClear\",\n    value: function saveProjectClear() {\n      if (this.props.isReplaying) {\n        return;\n      }\n\n      this.save({\n        completedMissionNum: this.props.missions.length,\n        completed: true\n      });\n    }\n  }, {\n    key: \"save\",\n    value: function save(values) {\n      var _this4 = this;\n\n      var myDreamLectureProjectId = this.props.match.params.id;\n      request.saveMyDreamProject(myDreamLectureProjectId, values).then(function (res) {\n        return res.json();\n      }).then(function (json) {\n        if (json.success) {\n          console.log(_this4.props.intl.formatMessage({\n            id: \"ID_DREAMBUILDER_SAVE_LECTURE\"\n          }));\n        } else {\n          console.warn(\"\".concat(_this4.props.intl.formatMessage({\n            id: \"ID_DREAMBUILDER_SAVE_LECTURE_ERROR\"\n          }), \"(\").concat(json.reason, \")\"));\n        }\n      });\n    }\n  }, {\n    key: \"alertMissionClear\",\n    value: function alertMissionClear() {\n      var _this5 = this;\n\n      if (!this.props.currentMission.conditions || this.props.currentMission.conditions.length < 1) return;\n      setTimeout(function () {\n        showPopUp(React.createElement(MissionClearPopUp, {\n          onClickConfirm: function onClickConfirm() {\n            _this5.props.setCurrentDreamMissionIndex(_this5.props.currentMissionIndex + 1);\n          },\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 172\n          },\n          __self: this\n        }), {\n          dismissButton: false\n        });\n      }, 2000);\n    }\n  }, {\n    key: \"alertProjectClear\",\n    value: function alertProjectClear() {\n      var _this6 = this;\n\n      setTimeout(function () {\n        showPopUp(React.createElement(ProjectClearPopUp, {\n          onClickCancel: function onClickCancel() {\n            if (_this6.props.isReplaying) {\n              window.close();\n            } else {\n              _this6.createDeveloping(window.close);\n            }\n          },\n          onClickConfirm: function onClickConfirm() {\n            if (_this6.props.isReplaying) {\n              _this6.linkToDeveloping(_this6.props.myProject.developing);\n            } else {\n              _this6.createDeveloping(_this6.linkToDeveloping);\n            }\n          },\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 183\n          },\n          __self: this\n        }), {\n          dismissButton: false\n        });\n      }, 1000);\n    }\n  }, {\n    key: \"createDeveloping\",\n    value: function createDeveloping(callback) {\n      var _this$props$myProject = this.props.myProject,\n          id = _this$props$myProject.id,\n          project = _this$props$myProject.project;\n      var params = {\n        pId: generatePID(this.props.email),\n        email: this.props.email,\n        name: project.title,\n        type: {\n          javascript: \"js\",\n          oobc: \"wizlabOOBC\"\n        }[project.lecture.course.type],\n        icon: project.thumbnailURL && project.thumbnailURL.toDreamclassS3URL(),\n        useCustomIcon: true,\n        state: JSON.stringify(this.getManipulatedProjectState()),\n        myDreamProjectId: id\n      };\n      request.postDevelopingProject(params).then(function (res) {\n        return res.json();\n      }).then(function (developing) {\n        if (callback) {\n          callback(developing);\n        }\n      });\n    }\n  }, {\n    key: \"getManipulatedProjectState\",\n    value: function getManipulatedProjectState() {\n      var state = JSON.parse(JSON.stringify(this.props.projectState));\n      state.preview.isPlaying = false;\n\n      for (var sceneId in state.scene.scenes) {\n        var scene = state.scene.scenes[sceneId];\n        scene.isHiddenLockSprites = false;\n\n        for (var spriteId in scene.sprites) {\n          var sprite = scene.sprites[spriteId];\n          sprite.locked = false;\n        }\n      }\n\n      return state;\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      return React.createElement(View, Object.assign({}, this.props, {\n        shouldSlideRerender: this.state.shouldSlideRerender,\n        isTutorialShow: this.state.isTutorialShow,\n        hiddenTutorial: this.hiddenTutorial,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 261\n        },\n        __self: this\n      }));\n    }\n  }]);\n\n  return Container;\n}(Component);\n\nexport default connect(function (state) {\n  return {\n    editorMode: state.scene.editorMode,\n    email: state.userinfo.email,\n    myProject: state.dream.myProject,\n    isReplaying: state.dream.isReplaying,\n    missions: state.dream.missions,\n    currentMission: state.dream.currentMission,\n    currentMissionIndex: state.dream.currentMissionIndex,\n    isConditionsClear: state.dream.isConditionsClear,\n    isCodeConditionsClear: state.dream.isCodeConditionsClear,\n    projectState: {\n      scene: state.scene,\n      interaction: state.interaction,\n      preview: state.preview\n    }\n  };\n}, {\n  setProject: projectActions.setProject,\n  setIsPlaying: previewActions.setIsPlaying,\n  setMyDreamProject: dreamActions.setMyDreamProject,\n  setDreamMissions: dreamActions.setDreamMissions,\n  setCurrentDreamMissionIndex: dreamActions.setCurrentDreamMissionIndex,\n  completeCurrentDreamMission: dreamActions.completeCurrentDreamMission\n})(withRouter(injectIntl(Container)));","map":{"version":3,"sources":["/Users/jimmy/Documents/Wizschool/wizlab_web2/src/Page/Builder/Component/DreamBuilder/Container.js"],"names":["React","Component","withRouter","connect","injectIntl","generatePID","showPopUp","request","projectActions","previewActions","dreamActions","AssetLibrary","MissionClearPopUp","ProjectClearPopUp","View","Container","props","linkToDeveloping","developing","history","replace","pId","go","forceSlideRerender","setState","shouldSlideRerender","didShowTutorialPopup","localStorage","getItem","editorMode","isTutorialShow","hiddenTutorial","state","load","myDreamLectureProjectId","match","params","id","getMyDreamProject","then","res","json","myDreamProject","window","alert","email","project","template","JSON","parse","err","setMyDreamProject","prevProps","prevState","myProject","didSetMyProject","currentMission","didSetCurrentMission","isConditionsClear","didClearConditions","missions","map","mission","index","isCompleted","completedMissionNum","currentMissionIndex","isReplaying","length","setDreamMissions","setCurrentDreamMissionIndex","save","missionSetTimer","clearTimeout","setTimeout","loadAssetsFromScene","scene","setProject","completeCurrentDreamMission","didClearMission","didClearProject","saveMissionClear","alertMissionClear","saveProjectClear","alertProjectClear","completed","values","saveMyDreamProject","success","console","log","intl","formatMessage","warn","reason","conditions","dismissButton","close","createDeveloping","callback","name","title","type","javascript","oobc","lecture","course","icon","thumbnailURL","toDreamclassS3URL","useCustomIcon","stringify","getManipulatedProjectState","myDreamProjectId","postDevelopingProject","projectState","preview","isPlaying","sceneId","scenes","isHiddenLockSprites","spriteId","sprites","sprite","locked","userinfo","dream","isCodeConditionsClear","interaction","setIsPlaying"],"mappings":"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","sourcesContent":["import React, { Component } from \"react\";\nimport { withRouter } from \"react-router-dom\";\nimport { connect } from \"react-redux\";\nimport { injectIntl } from \"react-intl\";\nimport generatePID from \"../../../../Common/Util/PIDGenerator\"\nimport { showPopUp } from \"../../../../Common/Component/PopUp\"\nimport * as request from \"../../../../Common/Util/HTTPRequest\";\nimport * as projectActions from \"../../Store/Reducer/project\";\nimport * as previewActions from \"../../Store/Reducer/preview\";\nimport * as dreamActions from \"../../Store/Reducer/dream\"\nimport AssetLibrary from \"../../utils/assetLibrary\";\nimport MissionClearPopUp from \"./PopUp/MissionClear\";\nimport ProjectClearPopUp from \"./PopUp/ProjectClear\";\nimport View from \"./View\";\n\nclass Container extends Component {\n  constructor(props) {\n    super(props);\n    this.state = { \n      shouldSlideRerender: false, \n      isTutorialShow: false \n    };\n  }\n  componentDidMount() {\n    this.load();\n  }\n  load() {\n    const { id: myDreamLectureProjectId } = this.props.match.params;\n    request\n      .getMyDreamProject(myDreamLectureProjectId)\n      .then(res => res.json())\n      .then(myDreamProject => {\n        if(!myDreamProject) {\n          window.alert(\"no myDreamProject\");\n          return;\n        }\n\n        // temp: 테스트 계정의 프로젝트는 유저 인증 생략하기\n        if(myDreamProject.email !== \"test@wizschool.io\" && myDreamProject.email !== this.props.email) {\n            window.alert(\"invalid user\");\n            return;\n        }\n        // if(myDreamProject.email !== this.props.email) {\n        //   window.alert(\"invalid user\");\n        //   return;\n        // }\n\n        try {\n          myDreamProject.project.template = JSON.parse(myDreamProject.project.template)\n        } catch(err) {\n          window.alert(\"wrong template\");\n          return;\n        }\n\n        this.props.setMyDreamProject(myDreamProject);\n      });\n  }\n\n  componentDidUpdate(prevProps, prevState) {\n    if(this.props.myProject) {\n      if(!prevProps.myProject || prevProps.myProject.id !== this.props.myProject.id) {\n        this.didSetMyProject();\n      }\n    }\n    if(prevProps.currentMission !== this.props.currentMission) {\n      this.didSetCurrentMission();\n    }\n    if(prevProps.isConditionsClear !== this.props.isConditionsClear) {\n      if(this.props.currentMission && this.props.isConditionsClear) {\n        this.didClearConditions();\n      }\n    }\n    if(prevProps.editorMode !== this.props.editorMode) {\n      this.didShowTutorialPopup();\n    }\n  }\n  didSetMyProject() {\n    const { myProject } = this.props;\n\n    const missions = \n      (myProject.project.template.missions || [])\n      .map((mission, index) => ({\n        ...mission, \n        isCompleted: index < myProject.completedMissionNum\n      }))\n\n    let currentMissionIndex = this.props.isReplaying ? 0 : myProject.completedMissionNum;\n    if(currentMissionIndex > missions.length - 1) {\n      currentMissionIndex = missions.length - 1\n    }\n    \n    this.props.setDreamMissions(missions);\n    this.props.setCurrentDreamMissionIndex(currentMissionIndex);\n    this.save();\n  }\n  didSetCurrentMission() {\n    if(!this.props.currentMission) return;\n\n    if(this.missionSetTimer) {\n      clearTimeout(this.missionSetTimer);\n    }\n  \n    // TODO: Refer to the following issue.\n    // Issue Link: https://www.notion.so/wizschool/b77303a59acc4be7886ec81875607bf6\n    this.missionSetTimer = setTimeout(() => {\n      try {\n        const state = JSON.parse(this.props.currentMission.state);\n        AssetLibrary.loadAssetsFromScene(state.scene, () => {\n          this.props.setProject({ state });\n          this.forceSlideRerender();\n        });\n      } catch(err) {\n        window.alert(\"wrong mission state\");\n      }\n    }, 200);\n  }\n  didClearConditions() {\n    if(!this.props.currentMission.isCompleted || this.props.isReplaying) {\n      this.props.completeCurrentDreamMission();\n\n      if(this.props.currentMissionIndex < this.props.missions.length - 1) {\n        this.didClearMission();\n      } else {\n        this.didClearProject();\n      }\n    }\n  }\n  didClearMission() {\n    this.saveMissionClear();\n    this.alertMissionClear();\n  }\n  didClearProject() {\n    this.saveProjectClear();\n    this.alertProjectClear();\n  }\n\n  saveMissionClear() {\n    if(this.props.isReplaying) {\n      return;\n    }\n\n    this.save({ completedMissionNum: this.props.currentMissionIndex + 1 });\n  }\n  saveProjectClear() {\n    if(this.props.isReplaying) {\n      return;\n    }\n\n    this.save({ \n      completedMissionNum: this.props.missions.length,\n      completed: true\n    });\n  }\n  save(values) {\n    const { id: myDreamLectureProjectId } = this.props.match.params;\n    request\n      .saveMyDreamProject(myDreamLectureProjectId, values)\n      .then(res => res.json())\n      .then(json => {\n        if(json.success) {\n          console.log(this.props.intl.formatMessage({ id: \"ID_DREAMBUILDER_SAVE_LECTURE\" }));\n        } else {\n          console.warn(`${this.props.intl.formatMessage({ id: \"ID_DREAMBUILDER_SAVE_LECTURE_ERROR\" })}(${json.reason})`);\n        }\n      });\n  }\n\n  alertMissionClear() {\n    if(!this.props.currentMission.conditions || this.props.currentMission.conditions.length < 1) return;\n    setTimeout(() => {\n      showPopUp(\n        <MissionClearPopUp\n          onClickConfirm={() => {\n            this.props.setCurrentDreamMissionIndex(this.props.currentMissionIndex + 1);\n          }}\n        />, { dismissButton: false }\n      );\n    }, 2000);\n  }\n  alertProjectClear() {\n    setTimeout(() => {\n      showPopUp(\n        <ProjectClearPopUp\n          onClickCancel={() => {\n            if(this.props.isReplaying) {\n              window.close();\n            } else { \n              this.createDeveloping(window.close);\n            }\n          }}\n          onClickConfirm={() => {\n            if(this.props.isReplaying) {\n              this.linkToDeveloping(this.props.myProject.developing);\n            } else { \n              this.createDeveloping(this.linkToDeveloping);\n            }\n          }}\n        />,\n        { dismissButton: false }\n      );\n    }, 1000);\n  }\n\n  createDeveloping(callback) {\n    const { id, project } = this.props.myProject;\n    const params = {\n      pId: generatePID(this.props.email),\n      email: this.props.email,\n      name: project.title,\n      type: { javascript: \"js\", oobc: \"wizlabOOBC\" }[project.lecture.course.type],\n      icon: project.thumbnailURL && project.thumbnailURL.toDreamclassS3URL(),\n      useCustomIcon: true,\n      state: JSON.stringify(this.getManipulatedProjectState()),\n      myDreamProjectId: id\n    }\n    request\n      .postDevelopingProject(params)\n      .then(res => res.json())\n      .then(developing => {\n        if(callback) {\n          callback(developing);\n        }\n      })\n  }\n  getManipulatedProjectState() {\n    const state = JSON.parse(JSON.stringify(this.props.projectState));\n    state.preview.isPlaying = false;\n    for(let sceneId in state.scene.scenes) {\n      const scene = state.scene.scenes[sceneId];\n      scene.isHiddenLockSprites = false;\n      for(let spriteId in scene.sprites) {\n        const sprite = scene.sprites[spriteId];\n        sprite.locked = false;\n      }\n    }\n    return state;\n  }\n  linkToDeveloping = developing => {\n    this.props.history.replace(`/builder/${developing.pId}`);\n    this.props.history.go(0);\n  }\n\n  forceSlideRerender = () => {\n    this.setState({ shouldSlideRerender: true }, () => {\n      this.setState({ shouldSlideRerender: false });\n    });\n  }\n\n  didShowTutorialPopup = () => {\n    const didShowTutorialPopup = localStorage.getItem(`didShowTutorial_${this.props.editorMode}`);\n    if (didShowTutorialPopup) this.setState({ isTutorialShow: false });\n    else this.setState({ isTutorialShow: true });\n  }\n\n  hiddenTutorial = () => {\n    this.setState({ isTutorialShow: false });\n  }\n\n  render() {\n    return (\n      <View \n        {...this.props}\n        shouldSlideRerender={this.state.shouldSlideRerender}\n        isTutorialShow={this.state.isTutorialShow}\n        hiddenTutorial={this.hiddenTutorial}\n      />\n    );\n  }\n}\n\nexport default connect(\n  state => ({ \n    editorMode: state.scene.editorMode,\n    email: state.userinfo.email,\n    myProject: state.dream.myProject,\n    isReplaying: state.dream.isReplaying,\n    missions: state.dream.missions,\n    currentMission: state.dream.currentMission,\n    currentMissionIndex: state.dream.currentMissionIndex,\n    isConditionsClear: state.dream.isConditionsClear,\n    isCodeConditionsClear: state.dream.isCodeConditionsClear,\n    projectState: {\n      scene: state.scene,\n      interaction: state.interaction,\n      preview: state.preview\n    }\n  }),\n  { \n    setProject: projectActions.setProject,\n    setIsPlaying: previewActions.setIsPlaying,\n    setMyDreamProject: dreamActions.setMyDreamProject,\n    setDreamMissions: dreamActions.setDreamMissions,\n    setCurrentDreamMissionIndex: dreamActions.setCurrentDreamMissionIndex,\n    completeCurrentDreamMission: dreamActions.completeCurrentDreamMission\n  }\n)(withRouter(injectIntl(Container)));\n"]},"metadata":{},"sourceType":"module"}