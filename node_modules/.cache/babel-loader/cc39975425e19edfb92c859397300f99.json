{"ast":null,"code":"import _regeneratorRuntime from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _classCallCheck from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";\nimport _possibleConstructorReturn from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";\nimport _inherits from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";\nvar _jsxFileName = \"/Users/jimmy/Documents/Wizschool/wizlab_web2/src/Page/Builder3D/Container.js\";\nimport React, { Component } from \"react\";\nimport { withRouter } from \"react-router-dom\";\nimport { connect } from \"react-redux\";\nimport * as projectActions from \"./Store/Reducer/project\";\nimport * as request from \"../../Common/Util/HTTPRequest\";\nimport { PAGETYPE } from \"../../Common/Util/Constant\";\nimport View from \"./View\";\n\nvar Container =\n/*#__PURE__*/\nfunction (_Component) {\n  _inherits(Container, _Component);\n\n  function Container(props) {\n    var _this;\n\n    _classCallCheck(this, Container);\n\n    _this = _possibleConstructorReturn(this, _getPrototypeOf(Container).call(this, props));\n\n    _this.setBrowserTitle = function (title) {\n      document.title = \"Dreamclass - Coding Party\";\n      if (title) document.title += \" - \".concat(title);\n    };\n\n    _this.state = {\n      isLoading: true\n    };\n    return _this;\n  }\n\n  _createClass(Container, [{\n    key: \"componentDidMount\",\n    value: function () {\n      var _componentDidMount = _asyncToGenerator(\n      /*#__PURE__*/\n      _regeneratorRuntime.mark(function _callee() {\n        var pId, email, project, templateId, templateProject;\n        return _regeneratorRuntime.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                pId = this.getPId();\n                email = this.props.email;\n\n                if (!pId) {\n                  _context.next = 13;\n                  break;\n                }\n\n                if (!email) {\n                  _context.next = 10;\n                  break;\n                }\n\n                _context.next = 6;\n                return this.loadDevelopingProject(pId);\n\n              case 6:\n                project = _context.sent;\n\n                if (project.email === email) {\n                  this.setProject(project);\n                } else {\n                  this.replaceToBuilderMain(true);\n                }\n\n                _context.next = 11;\n                break;\n\n              case 10:\n                this.replaceToBuilderMain(true);\n\n              case 11:\n                _context.next = 26;\n                break;\n\n              case 13:\n                if (!email) {\n                  _context.next = 17;\n                  break;\n                }\n\n                this.replaceToBuilderMain();\n                _context.next = 26;\n                break;\n\n              case 17:\n                templateId = this.getTemplateIdFromQueryParams();\n\n                if (!templateId) {\n                  _context.next = 25;\n                  break;\n                }\n\n                _context.next = 21;\n                return this.loadTemplateProject(templateId);\n\n              case 21:\n                templateProject = _context.sent;\n                this.setProject(templateProject);\n                _context.next = 26;\n                break;\n\n              case 25:\n                this.replaceToBuilderMain();\n\n              case 26:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee, this);\n      }));\n\n      function componentDidMount() {\n        return _componentDidMount.apply(this, arguments);\n      }\n\n      return componentDidMount;\n    }()\n  }, {\n    key: \"getPId\",\n    value: function getPId() {\n      var match = this.props.match;\n      return match.params.pId;\n    }\n  }, {\n    key: \"getTemplateIdFromQueryParams\",\n    value: function getTemplateIdFromQueryParams() {\n      var location = this.props.location;\n      var urlParams = new URLSearchParams(location.search);\n      var templateId = urlParams.get(\"t\");\n      return templateId;\n    }\n  }, {\n    key: \"loadDevelopingProject\",\n    value: function () {\n      var _loadDevelopingProject = _asyncToGenerator(\n      /*#__PURE__*/\n      _regeneratorRuntime.mark(function _callee2(pId) {\n        var project;\n        return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n          while (1) {\n            switch (_context2.prev = _context2.next) {\n              case 0:\n                _context2.next = 2;\n                return request.getDevelopingProject({\n                  pId: pId\n                }).then(function (res) {\n                  return res.json();\n                });\n\n              case 2:\n                project = _context2.sent;\n\n                if (project) {\n                  _context2.next = 7;\n                  break;\n                }\n\n                _context2.next = 6;\n                return this.createDevelopingProject(pId);\n\n              case 6:\n                project = _context2.sent;\n\n              case 7:\n                return _context2.abrupt(\"return\", project);\n\n              case 8:\n              case \"end\":\n                return _context2.stop();\n            }\n          }\n        }, _callee2, this);\n      }));\n\n      function loadDevelopingProject(_x) {\n        return _loadDevelopingProject.apply(this, arguments);\n      }\n\n      return loadDevelopingProject;\n    }()\n  }, {\n    key: \"createDevelopingProject\",\n    value: function () {\n      var _createDevelopingProject = _asyncToGenerator(\n      /*#__PURE__*/\n      _regeneratorRuntime.mark(function _callee3(pId) {\n        var email, name, type, templateId, params, project;\n        return _regeneratorRuntime.wrap(function _callee3$(_context3) {\n          while (1) {\n            switch (_context3.prev = _context3.next) {\n              case 0:\n                email = this.props.email;\n                name = \"새 3D 프로젝트\";\n                type = \"js3d\";\n                templateId = this.getTemplateIdFromUrlParams();\n                params = {\n                  pId: pId,\n                  email: email,\n                  name: name,\n                  type: type,\n                  templateId: templateId\n                };\n                _context3.next = 7;\n                return request.postDevelopingProject(params).then(function (res) {\n                  return res.json();\n                });\n\n              case 7:\n                project = _context3.sent;\n                return _context3.abrupt(\"return\", project);\n\n              case 9:\n              case \"end\":\n                return _context3.stop();\n            }\n          }\n        }, _callee3, this);\n      }));\n\n      function createDevelopingProject(_x2) {\n        return _createDevelopingProject.apply(this, arguments);\n      }\n\n      return createDevelopingProject;\n    }()\n  }, {\n    key: \"getTemplateIdFromUrlParams\",\n    value: function getTemplateIdFromUrlParams() {\n      var match = this.props.match;\n      return match.params.templateId;\n    }\n  }, {\n    key: \"loadTemplateProject\",\n    value: function () {\n      var _loadTemplateProject = _asyncToGenerator(\n      /*#__PURE__*/\n      _regeneratorRuntime.mark(function _callee4(templateId) {\n        var templateProject;\n        return _regeneratorRuntime.wrap(function _callee4$(_context4) {\n          while (1) {\n            switch (_context4.prev = _context4.next) {\n              case 0:\n                _context4.next = 2;\n                return request.getDefaultTemplateProject({\n                  id: templateId\n                }).then(function (res) {\n                  return res.json();\n                });\n\n              case 2:\n                templateProject = _context4.sent;\n                return _context4.abrupt(\"return\", templateProject);\n\n              case 4:\n              case \"end\":\n                return _context4.stop();\n            }\n          }\n        }, _callee4, this);\n      }));\n\n      function loadTemplateProject(_x3) {\n        return _loadTemplateProject.apply(this, arguments);\n      }\n\n      return loadTemplateProject;\n    }()\n  }, {\n    key: \"setProject\",\n    value: function setProject(project) {\n      this.setBrowserTitle(project.name);\n      project.state = JSON.parse(project.state); // AssetLibrary.loadAssetsFromScene(project.state.scene, () => {\n\n      this.props.setProject(project);\n      this.setState({\n        isLoading: false\n      }); // });\n    }\n  }, {\n    key: \"replaceToBuilderMain\",\n    value: function replaceToBuilderMain() {\n      var shouldAlert = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : false;\n\n      if (shouldAlert) {\n        alert(\"잘못된 접근입니다.\");\n      }\n\n      var history = this.props.history;\n      history.replace(\"/\" + PAGETYPE.BUILDER);\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var isLoading = this.state.isLoading;\n      return React.createElement(View, {\n        isLoading: isLoading,\n        pageType: PAGETYPE.BUILDER3D,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 105\n        },\n        __self: this\n      });\n    }\n  }]);\n\n  return Container;\n}(Component);\n\nexport default connect(function (state) {\n  return {\n    email: state.userinfo.email\n  };\n}, {\n  setProject: projectActions.setProject\n})(withRouter(Container));","map":{"version":3,"sources":["/Users/jimmy/Documents/Wizschool/wizlab_web2/src/Page/Builder3D/Container.js"],"names":["React","Component","withRouter","connect","projectActions","request","PAGETYPE","View","Container","props","setBrowserTitle","title","document","state","isLoading","pId","getPId","email","loadDevelopingProject","project","setProject","replaceToBuilderMain","templateId","getTemplateIdFromQueryParams","loadTemplateProject","templateProject","match","params","location","urlParams","URLSearchParams","search","get","getDevelopingProject","then","res","json","createDevelopingProject","name","type","getTemplateIdFromUrlParams","postDevelopingProject","getDefaultTemplateProject","id","JSON","parse","setState","shouldAlert","alert","history","replace","BUILDER","BUILDER3D","userinfo"],"mappings":"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","sourcesContent":["import React, { Component } from \"react\";\nimport { withRouter } from \"react-router-dom\";\nimport { connect } from \"react-redux\";\nimport * as projectActions from \"./Store/Reducer/project\";\nimport * as request from \"../../Common/Util/HTTPRequest\";\nimport { PAGETYPE } from \"../../Common/Util/Constant\";\nimport View from \"./View\";\n\nclass Container extends Component {\n  constructor(props) {\n    super(props);\n    this.state = { isLoading: true };\n  }\n  async componentDidMount() {\n    const pId = this.getPId();\n    const { email } = this.props;\n    if (pId) {\n      if (email) {\n        const project = await this.loadDevelopingProject(pId);\n        if (project.email === email) {\n          this.setProject(project);\n        } else {\n          this.replaceToBuilderMain(true);\n        }\n      } else {\n        this.replaceToBuilderMain(true);\n      }\n    } else {\n      if (email) {\n        this.replaceToBuilderMain();\n      } else {\n        const templateId = this.getTemplateIdFromQueryParams();\n        if (templateId) {\n          const templateProject = await this.loadTemplateProject(templateId);\n          this.setProject(templateProject);\n        } else {\n          this.replaceToBuilderMain();\n        }\n      }\n    }\n  }\n  getPId() {\n    const { match } = this.props;\n    return match.params.pId;\n  }\n  getTemplateIdFromQueryParams() {\n    const { location } = this.props;\n    const urlParams = new URLSearchParams(location.search);\n    const templateId = urlParams.get(\"t\");\n    return templateId;\n  }\n\n  async loadDevelopingProject(pId) {\n    let project = await request\n      .getDevelopingProject({ pId })\n      .then(res => res.json());\n    if (!project) {\n      project = await this.createDevelopingProject(pId);\n    }\n    return project;\n  }\n  async createDevelopingProject(pId) {\n    const { email } = this.props;\n    const name = \"새 3D 프로젝트\";\n    const type = \"js3d\";\n    const templateId = this.getTemplateIdFromUrlParams();\n    const params = { pId, email, name, type, templateId };\n    const project = await request\n      .postDevelopingProject(params)\n      .then(res => res.json());\n    return project;\n  }\n  getTemplateIdFromUrlParams() {\n    const { match } = this.props;\n    return match.params.templateId;\n  }\n  async loadTemplateProject(templateId) {\n    const templateProject = await request\n      .getDefaultTemplateProject({ id: templateId })\n      .then(res => res.json());\n    return templateProject;\n  }\n  setProject(project) {\n    this.setBrowserTitle(project.name);\n    project.state = JSON.parse(project.state);\n    // AssetLibrary.loadAssetsFromScene(project.state.scene, () => {\n    this.props.setProject(project);\n    this.setState({ isLoading: false });\n    // });\n  }\n  setBrowserTitle = title => {\n    document.title = `Dreamclass - Coding Party`;\n    if (title) document.title += ` - ${title}`;\n  };\n  replaceToBuilderMain(shouldAlert = false) {\n    if (shouldAlert) {\n      alert(\"잘못된 접근입니다.\");\n    }\n    const { history } = this.props;\n    history.replace(\"/\" + PAGETYPE.BUILDER);\n  }\n\n  render() {\n    const { isLoading } = this.state;\n    return <View isLoading={isLoading} pageType={PAGETYPE.BUILDER3D} />;\n  }\n}\n\nexport default connect(\n  state => ({ email: state.userinfo.email }),\n  { setProject: projectActions.setProject }\n)(withRouter(Container));\n"]},"metadata":{},"sourceType":"module"}