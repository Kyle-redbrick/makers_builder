{"ast":null,"code":"import _objectSpread from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread\";\nimport _regeneratorRuntime from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _classCallCheck from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";\nimport _possibleConstructorReturn from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";\nimport _inherits from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";\nvar _jsxFileName = \"/Users/jimmy/Documents/Wizschool/wizlab_web2/src/Page/Builder/Component/Home/Component/MyPublished/Container.js\";\nimport React, { Component } from \"react\";\nimport { injectIntl } from \"react-intl\";\nimport { withRouter } from \"react-router-dom\";\nimport { connect } from \"react-redux\";\nimport { showPopUp } from \"../../../../../../Common/Component/PopUp\";\nimport { PAGETYPE, URL } from \"../../../../../../Common/Util/Constant\";\nimport * as request from \"../../../../../../Common/Util/HTTPRequest\";\nimport View from \"./View\";\nimport PublishPopup from \"../../../../../../Common/Component/Publish\";\n\nvar Container =\n/*#__PURE__*/\nfunction (_Component) {\n  _inherits(Container, _Component);\n\n  function Container(props) {\n    var _this;\n\n    _classCallCheck(this, Container);\n\n    _this = _possibleConstructorReturn(this, _getPrototypeOf(Container).call(this, props));\n\n    _this.componentDidMount = function () {\n      if (!_this.props.email) return;\n    };\n\n    _this.fetchMyPublisheds =\n    /*#__PURE__*/\n    _asyncToGenerator(\n    /*#__PURE__*/\n    _regeneratorRuntime.mark(function _callee() {\n      var _this$state, currentPage, dataType, keyword, pageOffset, params, res, myPublisheds;\n\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              _this$state = _this.state, currentPage = _this$state.currentPage, dataType = _this$state.dataType, keyword = _this$state.keyword;\n              pageOffset = Math.ceil((currentPage - 1) * _this.pageSize);\n              params = {\n                type: dataType,\n                email: _this.props.email,\n                offset: pageOffset,\n                limit: _this.isFirstFetchData ? 60 : _this.pageSize,\n                keyword: keyword\n              };\n              _context.prev = 3;\n              _context.next = 6;\n              return request.getPublishedProjectsByType(params);\n\n            case 6:\n              res = _context.sent;\n              _context.next = 9;\n              return res.json();\n\n            case 9:\n              myPublisheds = _context.sent;\n              return _context.abrupt(\"return\", myPublisheds.rows.map(function (p) {\n                if (p.type === \"3D\") {\n                  return p;\n                } else {\n                  p.type = p.project.type;\n                  return p;\n                }\n              }));\n\n            case 13:\n              _context.prev = 13;\n              _context.t0 = _context[\"catch\"](3);\n              console.log(_context.t0);\n              return _context.abrupt(\"return\", []);\n\n            case 17:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee, this, [[3, 13]]);\n    }));\n\n    _this.isFirstFetchData = function () {\n      var currentPage = _this.state.currentPage;\n      return currentPage === 1;\n    };\n\n    _this.onClickShowProject = function (pId) {\n      if (!pId) return;\n\n      _this.props.history.push(\"?pId=\".concat(pId));\n    };\n\n    _this.onClickProject = function (pId, type) {\n      if (!pId) return;\n\n      if (type === \"3D\") {\n        window.open(URL.REDBRICK_3D_STUDIO + \"/?pid=\".concat(pId));\n        return;\n      }\n\n      ;\n\n      _this.props.history.replace({\n        pathname: \"/\".concat(type === \"js3d\" ? PAGETYPE.BUILDER3D : PAGETYPE.BUILDER, \"/\").concat(pId)\n      });\n\n      type !== \"js3d\" && window.location.reload();\n    };\n\n    _this.handleOnScroll = function () {\n      var container = _this.projectsRef.current;\n\n      if (container.offsetHeight + container.scrollTop >= container.scrollHeight) {\n        _this.setState(function (prev) {\n          return {\n            currentPage: prev.currentPage + 1\n          };\n        },\n        /*#__PURE__*/\n        _asyncToGenerator(\n        /*#__PURE__*/\n        _regeneratorRuntime.mark(function _callee2() {\n          var data;\n          return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n            while (1) {\n              switch (_context2.prev = _context2.next) {\n                case 0:\n                  _context2.next = 2;\n                  return _this.fetchMyPublisheds();\n\n                case 2:\n                  data = _context2.sent;\n\n                  _this.setState(function (prev) {\n                    return {\n                      myPublisheds: prev.myPublisheds.concat(data)\n                    };\n                  });\n\n                case 4:\n                case \"end\":\n                  return _context2.stop();\n              }\n            }\n          }, _callee2, this);\n        })));\n      }\n    };\n\n    _this.handleProjectLive =\n    /*#__PURE__*/\n    function () {\n      var _ref3 = _asyncToGenerator(\n      /*#__PURE__*/\n      _regeneratorRuntime.mark(function _callee3(published) {\n        return _regeneratorRuntime.wrap(function _callee3$(_context3) {\n          while (1) {\n            switch (_context3.prev = _context3.next) {\n              case 0:\n                published.live = !published.live;\n\n                if (!published.tags) {\n                  published.tags = [];\n                }\n\n                _context3.prev = 2;\n                _context3.next = 5;\n                return request.postPublishedProject(published);\n\n              case 5:\n                _this.updateItemInfo(published);\n\n                _context3.next = 11;\n                break;\n\n              case 8:\n                _context3.prev = 8;\n                _context3.t0 = _context3[\"catch\"](2);\n                console.error(_context3.t0);\n\n              case 11:\n              case \"end\":\n                return _context3.stop();\n            }\n          }\n        }, _callee3, this, [[2, 8]]);\n      }));\n\n      return function (_x) {\n        return _ref3.apply(this, arguments);\n      };\n    }();\n\n    _this.onClickProjectEdit = function (published) {\n      showPopUp(React.createElement(PublishPopup, {\n        pId: published.pId,\n        isDeveloping: false,\n        publishCallback: _this.updateItemInfo,\n        isBuilder: true,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 112\n        },\n        __self: this\n      }), {\n        defaultPadding: false,\n        scrollable: true\n      });\n    };\n\n    _this.updateItemInfo = function (params) {\n      _this.setState(function (state) {\n        return {\n          myPublisheds: state.myPublisheds.map(function (item) {\n            if (item.pId === params.pId) {\n              return _objectSpread({}, item, params);\n            } else {\n              return item;\n            }\n          })\n        };\n      });\n    };\n\n    _this.setFilteringData = function () {\n      var filteredType = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : [];\n      var keyword = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : \"\";\n\n      _this.setState({\n        currentPage: 1,\n        dataType: filteredType,\n        keyword: keyword\n      },\n      /*#__PURE__*/\n      _asyncToGenerator(\n      /*#__PURE__*/\n      _regeneratorRuntime.mark(function _callee4() {\n        var data;\n        return _regeneratorRuntime.wrap(function _callee4$(_context4) {\n          while (1) {\n            switch (_context4.prev = _context4.next) {\n              case 0:\n                _context4.next = 2;\n                return _this.fetchMyPublisheds();\n\n              case 2:\n                data = _context4.sent;\n\n                _this.setState({\n                  myPublisheds: data\n                });\n\n              case 4:\n              case \"end\":\n                return _context4.stop();\n            }\n          }\n        }, _callee4, this);\n      })));\n    };\n\n    _this.state = {\n      dataType: [],\n      keyword: \"\",\n      myPublisheds: [],\n      currentPage: 1\n    };\n    _this.pageSize = 10;\n    _this.projectsRef = React.createRef();\n    return _this;\n  }\n\n  _createClass(Container, [{\n    key: \"render\",\n    value: function render() {\n      var _this$props = this.props,\n          onClickProjectEdit = _this$props.onClickProjectEdit,\n          onClickDetailBtn = _this$props.onClickDetailBtn,\n          selectProject = _this$props.selectProject;\n      var onClickProject = this.onClickProject,\n          onClickShowProject = this.onClickShowProject,\n          handleOnScroll = this.handleOnScroll,\n          projectsRef = this.projectsRef,\n          handleProjectLive = this.handleProjectLive,\n          setFilteringData = this.setFilteringData;\n      var myPublisheds = this.state.myPublisheds;\n      return React.createElement(View, {\n        myPublisheds: myPublisheds,\n        setFilteringData: setFilteringData,\n        onClickProject: onClickProject,\n        onClickShowProject: onClickShowProject,\n        handleOnScroll: handleOnScroll,\n        projectsRef: projectsRef,\n        handleProjectLive: handleProjectLive,\n        onClickProjectEdit: onClickProjectEdit,\n        onClickDetailBtn: onClickDetailBtn,\n        selectProject: selectProject,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 158\n        },\n        __self: this\n      });\n    }\n  }]);\n\n  return Container;\n}(Component);\n\nexport default connect(function (state) {\n  return {\n    email: state.userinfo.email\n  };\n}, {})(injectIntl(withRouter(Container)));","map":{"version":3,"sources":["/Users/jimmy/Documents/Wizschool/wizlab_web2/src/Page/Builder/Component/Home/Component/MyPublished/Container.js"],"names":["React","Component","injectIntl","withRouter","connect","showPopUp","PAGETYPE","URL","request","View","PublishPopup","Container","props","componentDidMount","email","fetchMyPublisheds","state","currentPage","dataType","keyword","pageOffset","Math","ceil","pageSize","params","type","offset","limit","isFirstFetchData","getPublishedProjectsByType","res","json","myPublisheds","rows","map","p","project","console","log","onClickShowProject","pId","history","push","onClickProject","window","open","REDBRICK_3D_STUDIO","replace","pathname","BUILDER3D","BUILDER","location","reload","handleOnScroll","container","projectsRef","current","offsetHeight","scrollTop","scrollHeight","setState","prev","data","concat","handleProjectLive","published","live","tags","postPublishedProject","updateItemInfo","error","onClickProjectEdit","defaultPadding","scrollable","item","setFilteringData","filteredType","createRef","onClickDetailBtn","selectProject","userinfo"],"mappings":"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","sourcesContent":["import React, { Component } from \"react\";\nimport { injectIntl } from \"react-intl\";\nimport { withRouter } from \"react-router-dom\";\nimport { connect } from \"react-redux\";\nimport { showPopUp } from \"../../../../../../Common/Component/PopUp\";\nimport { PAGETYPE, URL } from \"../../../../../../Common/Util/Constant\";\nimport * as request from \"../../../../../../Common/Util/HTTPRequest\";\nimport View from \"./View\";\nimport PublishPopup from \"../../../../../../Common/Component/Publish\";\n\nclass Container extends Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      dataType: [],\n      keyword: \"\",\n      myPublisheds: [],\n      currentPage: 1\n    };\n    this.pageSize = 10;\n    this.projectsRef = React.createRef();\n  }\n\n  componentDidMount = () => {\n    if (!this.props.email) return;\n  };\n  fetchMyPublisheds = async () => {\n    let { currentPage, dataType, keyword } = this.state;\n    let pageOffset = Math.ceil((currentPage - 1) * this.pageSize);\n\n    let params = {\n      type: dataType,\n      email: this.props.email,\n      offset: pageOffset,\n      limit: this.isFirstFetchData ? 60 : this.pageSize,\n      keyword\n    };\n    try {\n      let res = await request.getPublishedProjectsByType(params);\n      let myPublisheds = await res.json();\n      return myPublisheds.rows.map(p => {\n        if (p.type === \"3D\") {\n          return p;\n        } else {\n          p.type = p.project.type;\n          return p;\n        }\n      });\n    } catch (error) {\n      console.log(error);\n      return [];\n    }\n  };\n\n  isFirstFetchData = () => {\n    let { currentPage } = this.state;\n    return currentPage === 1;\n  };\n  onClickShowProject = pId => {\n    if (!pId) return;\n    this.props.history.push(`?pId=${pId}`);\n  };\n  onClickProject = (pId, type) => {\n    if (!pId) return;\n\n    if (type === \"3D\") {\n      window.open(URL.REDBRICK_3D_STUDIO + `/?pid=${pId}`)\n      return;\n    };\n\n    this.props.history.replace({\n      pathname: `/${type === \"js3d\" ? PAGETYPE.BUILDER3D : PAGETYPE.BUILDER\n        }/${pId}`\n    });\n    type !== \"js3d\" && window.location.reload();\n  };\n  //TODO : have to refactoring\n  handleOnScroll = () => {\n    const container = this.projectsRef.current;\n    if (\n      container.offsetHeight + container.scrollTop >=\n      container.scrollHeight\n    ) {\n      this.setState(\n        prev => ({\n          currentPage: prev.currentPage + 1\n        }),\n        async () => {\n          let data = await this.fetchMyPublisheds();\n          this.setState(prev => ({\n            myPublisheds: prev.myPublisheds.concat(data)\n          }));\n        }\n      );\n    }\n  };\n  handleProjectLive = async published => {\n    published.live = !published.live;\n    if (!published.tags) {\n      published.tags = [];\n    }\n    try {\n      await request.postPublishedProject(published);\n      this.updateItemInfo(published);\n    } catch (e) {\n      console.error(e);\n    }\n  };\n\n  onClickProjectEdit = published => {\n    showPopUp(\n      <PublishPopup\n        pId={published.pId}\n        isDeveloping={false}\n        publishCallback={this.updateItemInfo}\n        isBuilder={true}\n      />,\n      { defaultPadding: false, scrollable: true }\n    );\n  };\n  updateItemInfo = params => {\n    this.setState(state => ({\n      myPublisheds: state.myPublisheds.map(item => {\n        if (item.pId === params.pId) {\n          return {\n            ...item,\n            ...params\n          };\n        } else {\n          return item;\n        }\n      })\n    }));\n  };\n\n  //TODO : have to refactoring\n  setFilteringData = (filteredType = [], keyword = \"\") => {\n    this.setState(\n      { currentPage: 1, dataType: filteredType, keyword },\n      async () => {\n        let data = await this.fetchMyPublisheds();\n        this.setState({ myPublisheds: data });\n      }\n    );\n  };\n  render() {\n    const { onClickProjectEdit, onClickDetailBtn, selectProject } = this.props;\n    const {\n      onClickProject,\n      onClickShowProject,\n      handleOnScroll,\n      projectsRef,\n      handleProjectLive,\n      setFilteringData\n    } = this;\n    const { myPublisheds } = this.state;\n    return (\n      <View\n        myPublisheds={myPublisheds}\n        setFilteringData={setFilteringData}\n        onClickProject={onClickProject}\n        onClickShowProject={onClickShowProject}\n        handleOnScroll={handleOnScroll}\n        projectsRef={projectsRef}\n        handleProjectLive={handleProjectLive}\n        onClickProjectEdit={onClickProjectEdit}\n        onClickDetailBtn={onClickDetailBtn}\n        selectProject={selectProject}\n      />\n    );\n  }\n}\nexport default connect(\n  state => ({ email: state.userinfo.email }),\n  {}\n)(injectIntl(withRouter(Container)));\n"]},"metadata":{},"sourceType":"module"}