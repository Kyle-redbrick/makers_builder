{"ast":null,"code":"import _objectSpread from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread\";\nimport _classCallCheck from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";\nimport _assertThisInitialized from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/assertThisInitialized\";\nimport _inherits from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";\nimport _possibleConstructorReturn from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";\nvar _jsxFileName = \"/Users/jimmy/Documents/Wizschool/wizlab_web2/src/Common/Component/DraftEditor/CustomBlockRenderer.js\";\n\nfunction _createSuper(Derived) { var hasNativeReflectConstruct = _isNativeReflectConstruct(); return function _createSuperInternal() { var Super = _getPrototypeOf(Derived), result; if (hasNativeReflectConstruct) { var NewTarget = _getPrototypeOf(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return _possibleConstructorReturn(this, result); }; }\n\nfunction _isNativeReflectConstruct() { if (typeof Reflect === \"undefined\" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === \"function\") return true; try { Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {})); return true; } catch (e) { return false; } }\n\nimport React, { Component } from \"react\";\nimport * as request from \"../../Util/HTTPRequest\";\nimport { EDITORMODE } from \"../../Util/Constant\";\nimport { showPopUp } from \"../PopUp\";\nimport GamePopUp from \"./GamePopUp\";\nimport \"./index.scss\";\n\nvar MediaComponent = /*#__PURE__*/function (_Component) {\n  _inherits(MediaComponent, _Component);\n\n  var _super = _createSuper(MediaComponent);\n\n  function MediaComponent(props) {\n    var _this;\n\n    _classCallCheck(this, MediaComponent);\n\n    _this = _super.call(this, props);\n\n    _this.setAceEditor = function () {\n      var _assertThisInitialize = _assertThisInitialized(_this),\n          key = _assertThisInitialize.key,\n          readonly = _assertThisInitialize.readonly;\n\n      var data = _this.state.data;\n      var editor = window.ace.edit(\"ace-editor-\".concat(key), {\n        maxLines: 50,\n        minLines: 5,\n        wrap: true,\n        autoScrollEditorIntoView: true\n      });\n      editor.session.setMode(\"ace/mode/\".concat(EDITORMODE.JAVASCRIPT));\n      editor.setTheme(\"ace/theme/wizschool-light\");\n      editor.setReadOnly(readonly);\n      editor.setValue(data.code, 1);\n      editor.on(\"blur\", _this.onEditorBlur);\n      editor.on(\"focus\", _this.onEditorFocus);\n      editor.on(\"change\", _this.onEditorChange);\n    };\n\n    _this.onEditorBlur = function () {\n      _this.onChangeAceFouced(false);\n    };\n\n    _this.onEditorFocus = function () {\n      _this.onChangeAceFouced(true);\n    };\n\n    _this.onEditorChange = function (event, editor) {\n      var _assertThisInitialize2 = _assertThisInitialized(_this),\n          readonly = _assertThisInitialize2.readonly,\n          onChangeMedia = _assertThisInitialize2.onChangeMedia,\n          onChangeAceFouced = _assertThisInitialize2.onChangeAceFouced;\n\n      var code = editor.getValue();\n      var _this$props = _this.props,\n          block = _this$props.block,\n          contentState = _this$props.contentState;\n      var entityKey = block.getEntityAt(0);\n      contentState.replaceEntityData(entityKey, {\n        code: code,\n        readonly: readonly,\n        onChangeMedia: onChangeMedia,\n        onChangeAceFouced: onChangeAceFouced\n      });\n      onChangeMedia();\n    };\n\n    _this.getGame = function () {\n      var data = _this.state.data;\n      request.getPublishedProject({\n        pId: data.pId\n      }).then(function (res) {\n        return res.json();\n      }).then(function (game) {\n        _this.setState({\n          game: game\n        });\n      });\n    };\n\n    _this.onClickMedia = function () {\n      var _assertThisInitialize3 = _assertThisInitialized(_this),\n          type = _assertThisInitialize3.type,\n          readonly = _assertThisInitialize3.readonly,\n          onChangeMedia = _assertThisInitialize3.onChangeMedia;\n\n      var data = _this.state.data;\n\n      switch (type) {\n        case \"game\":\n          if (readonly) {\n            window.open(\"\".concat(window.location.origin, \"?pId=\").concat(data.pId), \"_blank\");\n          } else {\n            showPopUp( /*#__PURE__*/React.createElement(GamePopUp, {\n              onChangeGame: function onChangeGame(pId) {\n                var _this$props2 = _this.props,\n                    block = _this$props2.block,\n                    contentState = _this$props2.contentState;\n                var entityKey = block.getEntityAt(0);\n                contentState.replaceEntityData(entityKey, {\n                  pId: pId,\n                  readonly: readonly,\n                  onChangeMedia: onChangeMedia\n                });\n\n                _this.setState(function (prevState) {\n                  return {\n                    data: _objectSpread({}, prevState.data, {\n                      pId: pId\n                    })\n                  };\n                }, function () {\n                  onChangeMedia();\n\n                  _this.getGame();\n                });\n              },\n              __self: _assertThisInitialized(_this),\n              __source: {\n                fileName: _jsxFileName,\n                lineNumber: 96,\n                columnNumber: 13\n              }\n            }), {\n              darkmode: true\n            });\n          }\n\n          break;\n\n        default:\n          break;\n      }\n    };\n\n    var _this$props3 = _this.props,\n        _block = _this$props3.block,\n        _contentState = _this$props3.contentState;\n\n    var _entityKey = _block.getEntityAt(0);\n\n    var entity = _contentState.getEntity(_entityKey);\n\n    var _data = entity.getData();\n\n    _this.key = _block.getKey();\n    _this.type = entity.getType();\n    _this.readonly = _data.readonly;\n    _this.onChangeMedia = _data.onChangeMedia;\n    _this.onChangeAceFouced = _data.onChangeAceFouced;\n    _this.state = {\n      data: _data\n    };\n    return _this;\n  }\n\n  _createClass(MediaComponent, [{\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      var type = this.type;\n\n      switch (type) {\n        case \"code\":\n          this.setAceEditor();\n          break;\n\n        case \"game\":\n          this.getGame();\n          break;\n\n        default:\n          break;\n      }\n    } // code\n\n  }, {\n    key: \"render\",\n    value: function render() {\n      var key = this.key,\n          type = this.type;\n      var _this$state = this.state,\n          data = _this$state.data,\n          game = _this$state.game;\n      var content;\n\n      switch (type) {\n        case \"image\":\n          content = /*#__PURE__*/React.createElement(\"img\", {\n            className: \"draftmedia_image\",\n            src: data.src,\n            alt: key,\n            __self: this,\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 131,\n              columnNumber: 19\n            }\n          });\n          break;\n\n        case \"code\":\n          content = /*#__PURE__*/React.createElement(\"div\", {\n            id: \"ace-editor-\".concat(key),\n            className: \"draftmedia_code\",\n            __self: this,\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 134,\n              columnNumber: 19\n            }\n          });\n          break;\n\n        case \"game\":\n          if (game) {\n            content = /*#__PURE__*/React.createElement(\"div\", {\n              className: \"draftmedia_game\",\n              __self: this,\n              __source: {\n                fileName: _jsxFileName,\n                lineNumber: 139,\n                columnNumber: 13\n              }\n            }, /*#__PURE__*/React.createElement(\"img\", {\n              className: \"draftmedia_game_image\",\n              src: game.icon,\n              alt: game.name,\n              __self: this,\n              __source: {\n                fileName: _jsxFileName,\n                lineNumber: 140,\n                columnNumber: 15\n              }\n            }), /*#__PURE__*/React.createElement(\"section\", {\n              className: \"draftmedia_game_section\",\n              __self: this,\n              __source: {\n                fileName: _jsxFileName,\n                lineNumber: 145,\n                columnNumber: 15\n              }\n            }, /*#__PURE__*/React.createElement(\"div\", {\n              className: \"draftmedia_game_title\",\n              __self: this,\n              __source: {\n                fileName: _jsxFileName,\n                lineNumber: 146,\n                columnNumber: 17\n              }\n            }, game.name), /*#__PURE__*/React.createElement(\"div\", {\n              className: \"draftmedia_game_desc\",\n              __self: this,\n              __source: {\n                fileName: _jsxFileName,\n                lineNumber: 147,\n                columnNumber: 17\n              }\n            }, game.description.length > 78 ? game.description.slice(0, 78) + \"...\" : game.description), /*#__PURE__*/React.createElement(\"div\", {\n              className: \"draftmedia_game_user\",\n              __self: this,\n              __source: {\n                fileName: _jsxFileName,\n                lineNumber: 152,\n                columnNumber: 17\n              }\n            }, /*#__PURE__*/React.createElement(\"img\", {\n              className: \"draftmedia_game_user_image\",\n              src: game.user.icon,\n              alt: game.user.name,\n              __self: this,\n              __source: {\n                fileName: _jsxFileName,\n                lineNumber: 153,\n                columnNumber: 19\n              }\n            }), /*#__PURE__*/React.createElement(\"div\", {\n              className: \"draftmedia_game_user_name\",\n              __self: this,\n              __source: {\n                fileName: _jsxFileName,\n                lineNumber: 158,\n                columnNumber: 19\n              }\n            }, game.user.name))));\n          }\n\n          break;\n\n        default:\n          break;\n      }\n\n      return /*#__PURE__*/React.createElement(\"div\", {\n        className: \"draftmedia\",\n        onClick: this.onClickMedia,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 171,\n          columnNumber: 7\n        }\n      }, content);\n    }\n  }]);\n\n  return MediaComponent;\n}(Component);\n\nvar CustomBlockRenderer = function CustomBlockRenderer(contentBlock) {\n  var type = contentBlock.getType();\n\n  switch (type) {\n    case \"atomic\":\n      if (isValidAtomicBlock(contentBlock)) {\n        return {\n          component: MediaComponent,\n          editable: false\n        };\n      }\n\n      break;\n\n    default:\n      // console.warn(\"unhandled content block type\", type);\n      return;\n  }\n};\n\nfunction isValidAtomicBlock(block) {\n  var entityKey = block.getEntityAt(0);\n  return !!entityKey;\n}\n\nexport default CustomBlockRenderer;","map":{"version":3,"sources":["/Users/jimmy/Documents/Wizschool/wizlab_web2/src/Common/Component/DraftEditor/CustomBlockRenderer.js"],"names":["React","Component","request","EDITORMODE","showPopUp","GamePopUp","MediaComponent","props","setAceEditor","key","readonly","data","state","editor","window","ace","edit","maxLines","minLines","wrap","autoScrollEditorIntoView","session","setMode","JAVASCRIPT","setTheme","setReadOnly","setValue","code","on","onEditorBlur","onEditorFocus","onEditorChange","onChangeAceFouced","event","onChangeMedia","getValue","block","contentState","entityKey","getEntityAt","replaceEntityData","getGame","getPublishedProject","pId","then","res","json","game","setState","onClickMedia","type","open","location","origin","prevState","darkmode","entity","getEntity","getData","getKey","getType","content","src","icon","name","description","length","slice","user","CustomBlockRenderer","contentBlock","isValidAtomicBlock","component","editable"],"mappings":"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","sourcesContent":["import React, { Component } from \"react\";\nimport * as request from \"../../Util/HTTPRequest\";\nimport { EDITORMODE } from \"../../Util/Constant\";\nimport { showPopUp } from \"../PopUp\";\nimport GamePopUp from \"./GamePopUp\";\nimport \"./index.scss\";\n\nclass MediaComponent extends Component {\n  constructor(props) {\n    super(props);\n    const { block, contentState } = this.props;\n    const entityKey = block.getEntityAt(0);\n    const entity = contentState.getEntity(entityKey);\n    const data = entity.getData();\n\n    this.key = block.getKey();\n    this.type = entity.getType();\n    this.readonly = data.readonly;\n    this.onChangeMedia = data.onChangeMedia;\n    this.onChangeAceFouced = data.onChangeAceFouced;\n\n    this.state = { data };\n  }\n  componentDidMount() {\n    const { type } = this;\n    switch (type) {\n      case \"code\":\n        this.setAceEditor();\n        break;\n      case \"game\":\n        this.getGame();\n        break;\n      default:\n        break;\n    }\n  }\n\n  // code\n  setAceEditor = () => {\n    const { key, readonly } = this;\n    const { data } = this.state;\n    const editor = window.ace.edit(`ace-editor-${key}`, {\n      maxLines: 50,\n      minLines: 5,\n      wrap: true,\n      autoScrollEditorIntoView: true\n    });\n    editor.session.setMode(`ace/mode/${EDITORMODE.JAVASCRIPT}`);\n    editor.setTheme(\"ace/theme/wizschool-light\");\n    editor.setReadOnly(readonly);\n    editor.setValue(data.code, 1);\n    editor.on(\"blur\", this.onEditorBlur);\n    editor.on(\"focus\", this.onEditorFocus);\n    editor.on(\"change\", this.onEditorChange);\n  };\n  onEditorBlur = () => {\n    this.onChangeAceFouced(false);\n  };\n  onEditorFocus = () => {\n    this.onChangeAceFouced(true);\n  };\n  onEditorChange = (event, editor) => {\n    const { readonly, onChangeMedia, onChangeAceFouced } = this;\n    const code = editor.getValue();\n    const { block, contentState } = this.props;\n    const entityKey = block.getEntityAt(0);\n    contentState.replaceEntityData(entityKey, {\n      code,\n      readonly,\n      onChangeMedia,\n      onChangeAceFouced\n    });\n    onChangeMedia();\n  };\n\n  // game\n  getGame = () => {\n    const { data } = this.state;\n    request\n      .getPublishedProject({ pId: data.pId })\n      .then(res => res.json())\n      .then(game => {\n        this.setState({ game });\n      });\n  };\n\n  onClickMedia = () => {\n    const { type, readonly, onChangeMedia } = this;\n    const { data } = this.state;\n    switch (type) {\n      case \"game\":\n        if (readonly) {\n          window.open(`${window.location.origin}?pId=${data.pId}`, \"_blank\");\n        } else {\n          showPopUp(\n            <GamePopUp\n              onChangeGame={pId => {\n                const { block, contentState } = this.props;\n                const entityKey = block.getEntityAt(0);\n                contentState.replaceEntityData(entityKey, {\n                  pId,\n                  readonly,\n                  onChangeMedia\n                });\n                this.setState(\n                  prevState => ({\n                    data: { ...prevState.data, pId }\n                  }),\n                  () => {\n                    onChangeMedia();\n                    this.getGame();\n                  }\n                );\n              }}\n            />,\n            { darkmode: true }\n          );\n        }\n        break;\n      default:\n        break;\n    }\n  };\n\n  render() {\n    const { key, type } = this;\n    const { data, game } = this.state;\n    let content;\n    switch (type) {\n      case \"image\":\n        content = <img className=\"draftmedia_image\" src={data.src} alt={key} />;\n        break;\n      case \"code\":\n        content = <div id={`ace-editor-${key}`} className=\"draftmedia_code\" />;\n        break;\n      case \"game\":\n        if (game) {\n          content = (\n            <div className=\"draftmedia_game\">\n              <img\n                className=\"draftmedia_game_image\"\n                src={game.icon}\n                alt={game.name}\n              />\n              <section className=\"draftmedia_game_section\">\n                <div className=\"draftmedia_game_title\">{game.name}</div>\n                <div className=\"draftmedia_game_desc\">\n                  {game.description.length > 78\n                    ? game.description.slice(0, 78) + \"...\"\n                    : game.description}\n                </div>\n                <div className=\"draftmedia_game_user\">\n                  <img\n                    className=\"draftmedia_game_user_image\"\n                    src={game.user.icon}\n                    alt={game.user.name}\n                  />\n                  <div className=\"draftmedia_game_user_name\">\n                    {game.user.name}\n                  </div>\n                </div>\n              </section>\n            </div>\n          );\n        }\n        break;\n      default:\n        break;\n    }\n    return (\n      <div className=\"draftmedia\" onClick={this.onClickMedia}>\n        {content}\n      </div>\n    );\n  }\n}\n\nconst CustomBlockRenderer = contentBlock => {\n  const type = contentBlock.getType();\n  switch (type) {\n    case \"atomic\":\n      if (isValidAtomicBlock(contentBlock)) {\n        return {\n          component: MediaComponent,\n          editable: false\n        };\n      }\n      break;\n    default:\n      // console.warn(\"unhandled content block type\", type);\n      return;\n  }\n};\n\nfunction isValidAtomicBlock(block) {\n  const entityKey = block.getEntityAt(0);\n  return !!entityKey;\n}\n\nexport default CustomBlockRenderer;\n"]},"metadata":{},"sourceType":"module"}