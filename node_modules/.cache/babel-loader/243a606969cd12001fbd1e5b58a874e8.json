{"ast":null,"code":"import _regeneratorRuntime from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _classCallCheck from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";\nimport _inherits from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";\nimport _possibleConstructorReturn from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";\nvar _jsxFileName = \"/Users/jimmy/Documents/Wizschool/wizlab_web2/src/Page/Gstar/Challenge/Component/ChallengeProject/index.js\";\n\nfunction _createSuper(Derived) { var hasNativeReflectConstruct = _isNativeReflectConstruct(); return function _createSuperInternal() { var Super = _getPrototypeOf(Derived), result; if (hasNativeReflectConstruct) { var NewTarget = _getPrototypeOf(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return _possibleConstructorReturn(this, result); }; }\n\nfunction _isNativeReflectConstruct() { if (typeof Reflect === \"undefined\" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === \"function\") return true; try { Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {})); return true; } catch (e) { return false; } }\n\nimport React, { Component } from \"react\";\nimport { FormattedMessage } from \"react-intl\";\nimport * as request from \"../../../../../Common/Util/HTTPRequest\";\nimport ChallengeProject from \"../ChallengeProjectItem\";\nimport \"./index.scss\";\n\nvar View = /*#__PURE__*/function (_Component) {\n  _inherits(View, _Component);\n\n  var _super = _createSuper(View);\n\n  function View(props) {\n    var _this;\n\n    _classCallCheck(this, View);\n\n    _this = _super.call(this, props);\n\n    _this.onWindowScroll = function (e) {\n      var target = document.documentElement;\n\n      if (target.scrollTop >= target.scrollHeight - target.clientHeight - 100 && !_this.isAllProjectsLoaded && !_this.isLoadingProjects) {\n        _this.loadMoreProjects();\n      }\n    };\n\n    _this.onClickTab = function (tab) {\n      _this.setState({\n        currentTab: tab\n      });\n    };\n\n    _this.state = {\n      currentTab: \"new\",\n      projects: []\n    };\n    return _this;\n  }\n\n  _createClass(View, [{\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      this.initProjects();\n      window.addEventListener(\"scroll\", this.onWindowScroll);\n    }\n  }, {\n    key: \"componentWillUnmount\",\n    value: function componentWillUnmount() {\n      window.removeEventListener(\"scroll\", this.onWindowScroll);\n    }\n  }, {\n    key: \"componentDidUpdate\",\n    value: function componentDidUpdate(prevProps, prevState) {\n      if (prevState.currentTab !== this.state.currentTab) {\n        this.didUpdateCurrentTab();\n      }\n    }\n  }, {\n    key: \"didUpdateCurrentTab\",\n    value: function didUpdateCurrentTab() {\n      this.initProjects();\n    }\n  }, {\n    key: \"initProjects\",\n    value: function () {\n      var _initProjects = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee() {\n        var projects;\n        return _regeneratorRuntime.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                this.isAllProjectsLoaded = false;\n                _context.next = 3;\n                return this.loadProjects({\n                  offset: 0,\n                  limit: 20\n                });\n\n              case 3:\n                projects = _context.sent;\n                this.setState({\n                  projects: projects\n                });\n\n              case 5:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee, this);\n      }));\n\n      function initProjects() {\n        return _initProjects.apply(this, arguments);\n      }\n\n      return initProjects;\n    }()\n  }, {\n    key: \"loadMoreProjects\",\n    value: function () {\n      var _loadMoreProjects = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2() {\n        var projects;\n        return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n          while (1) {\n            switch (_context2.prev = _context2.next) {\n              case 0:\n                _context2.next = 2;\n                return this.loadProjects({\n                  offset: this.state.projects.length,\n                  limit: 20\n                });\n\n              case 2:\n                projects = _context2.sent;\n                this.setState(function (prevState) {\n                  return {\n                    projects: [].concat(prevState.projects, projects)\n                  };\n                });\n\n              case 4:\n              case \"end\":\n                return _context2.stop();\n            }\n          }\n        }, _callee2, this);\n      }));\n\n      function loadMoreProjects() {\n        return _loadMoreProjects.apply(this, arguments);\n      }\n\n      return loadMoreProjects;\n    }()\n  }, {\n    key: \"loadProjects\",\n    value: function () {\n      var _loadProjects = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee3(options) {\n        var _this2 = this;\n\n        var projects;\n        return _regeneratorRuntime.wrap(function _callee3$(_context3) {\n          while (1) {\n            switch (_context3.prev = _context3.next) {\n              case 0:\n                if (!this.isLoadingProjects) {\n                  _context3.next = 2;\n                  break;\n                }\n\n                return _context3.abrupt(\"return\");\n\n              case 2:\n                this.isLoadingProjects = true;\n                _context3.next = 5;\n                return request.getCreatorChallenges({\n                  offset: options.offset,\n                  limit: options.limit,\n                  order: this.order,\n                  season: \"2\"\n                }).then(function (res) {\n                  return res.json();\n                }).finally(function () {\n                  _this2.isLoadingProjects = false;\n                });\n\n              case 5:\n                projects = _context3.sent;\n\n                if (projects.length < options.limit) {\n                  this.isAllProjectsLoaded = true;\n                }\n\n                return _context3.abrupt(\"return\", projects);\n\n              case 8:\n              case \"end\":\n                return _context3.stop();\n            }\n          }\n        }, _callee3, this);\n      }));\n\n      function loadProjects(_x) {\n        return _loadProjects.apply(this, arguments);\n      }\n\n      return loadProjects;\n    }()\n  }, {\n    key: \"order\",\n    get: function get() {\n      var tabToOrder = {\n        new: \"createdAt\",\n        popular: \"like\"\n      };\n      return tabToOrder[this.state.currentTab];\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _this3 = this;\n\n      var _this$state = this.state,\n          currentTab = _this$state.currentTab,\n          projects = _this$state.projects;\n      var onClickTab = this.onClickTab;\n      return /*#__PURE__*/React.createElement(\"div\", {\n        className: \"challenge__project\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 99,\n          columnNumber: 7\n        }\n      }, /*#__PURE__*/React.createElement(\"div\", {\n        className: \"challenge__project__tabs\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 100,\n          columnNumber: 9\n        }\n      }, /*#__PURE__*/React.createElement(\"div\", {\n        className: \"challenge__project__tab \".concat(currentTab === \"new\" && \"tab--active\"),\n        onClick: function onClick() {\n          return onClickTab(\"new\");\n        },\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 101,\n          columnNumber: 11\n        }\n      }, /*#__PURE__*/React.createElement(FormattedMessage, {\n        id: \"ID_CHALLENGE_PROJECT_TAB_NEW\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 105,\n          columnNumber: 13\n        }\n      })), /*#__PURE__*/React.createElement(\"div\", {\n        className: \"challenge__project__tab \".concat(currentTab === \"popular\" && \"tab--active\"),\n        onClick: function onClick() {\n          return onClickTab(\"popular\");\n        },\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 107,\n          columnNumber: 11\n        }\n      }, /*#__PURE__*/React.createElement(FormattedMessage, {\n        id: \"ID_CHALLENGE_PROJECT_TAB_POPULAR\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 111,\n          columnNumber: 13\n        }\n      }))), /*#__PURE__*/React.createElement(\"div\", {\n        className: \"challenge__project__list\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 114,\n          columnNumber: 9\n        }\n      }, projects.map(function (project) {\n        return /*#__PURE__*/React.createElement(ChallengeProject, {\n          key: project.id,\n          challengeProject: project,\n          __self: _this3,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 116,\n            columnNumber: 13\n          }\n        });\n      })));\n    }\n  }]);\n\n  return View;\n}(Component);\n\nexport { View as default };","map":{"version":3,"sources":["/Users/jimmy/Documents/Wizschool/wizlab_web2/src/Page/Gstar/Challenge/Component/ChallengeProject/index.js"],"names":["React","Component","FormattedMessage","request","ChallengeProject","View","props","onWindowScroll","e","target","document","documentElement","scrollTop","scrollHeight","clientHeight","isAllProjectsLoaded","isLoadingProjects","loadMoreProjects","onClickTab","tab","setState","currentTab","state","projects","initProjects","window","addEventListener","removeEventListener","prevProps","prevState","didUpdateCurrentTab","loadProjects","offset","limit","length","concat","options","getCreatorChallenges","order","season","then","res","json","finally","tabToOrder","new","popular","map","project","id"],"mappings":"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","sourcesContent":["import React, { Component } from \"react\";\nimport { FormattedMessage } from \"react-intl\";\nimport * as request from \"../../../../../Common/Util/HTTPRequest\";\nimport ChallengeProject from \"../ChallengeProjectItem\"\nimport \"./index.scss\";\n\nexport default class View extends Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      currentTab: \"new\",\n      projects: []\n    };\n  }\n  componentDidMount() {\n    this.initProjects();\n    window.addEventListener(\"scroll\", this.onWindowScroll);\n  }\n  componentWillUnmount() {\n    window.removeEventListener(\"scroll\", this.onWindowScroll);\n  }\n  componentDidUpdate(prevProps, prevState) {\n    if(prevState.currentTab !== this.state.currentTab) {\n      this.didUpdateCurrentTab()\n    }\n  }\n  didUpdateCurrentTab() {\n    this.initProjects();\n  }\n\n  async initProjects() {\n    this.isAllProjectsLoaded = false;\n    const projects = await this.loadProjects({\n      offset: 0,\n      limit: 20\n    });\n    this.setState({ projects });\n  }\n  async loadMoreProjects() {\n    const projects = await this.loadProjects({ \n      offset: this.state.projects.length,\n      limit: 20\n    });\n    this.setState(prevState => ({ \n      projects: [].concat(prevState.projects, projects)\n    }));\n  }\n  async loadProjects(options) {\n    if(this.isLoadingProjects) {\n      return;\n    }\n\n    this.isLoadingProjects = true;\n    const projects = await request\n      .getCreatorChallenges({\n        offset: options.offset,\n        limit: options.limit,\n        order: this.order,\n        season: \"2\"\n      })\n      .then(res => res.json())\n      .finally(() => {\n        this.isLoadingProjects = false;\n      });\n\n    if(projects.length < options.limit) {\n      this.isAllProjectsLoaded = true;\n    }\n\n    return projects;\n  }\n  get order() {\n    const tabToOrder = {\n      new: \"createdAt\",\n      popular: \"like\"\n    }\n    return tabToOrder[this.state.currentTab];\n  }\n\n  onWindowScroll = e => {\n    const target = document.documentElement;\n    if(\n      target.scrollTop >= target.scrollHeight - target.clientHeight - 100\n      && !this.isAllProjectsLoaded\n      && !this.isLoadingProjects\n    ) {\n      this.loadMoreProjects();\n    }\n  }\n\n  onClickTab = (tab) => {\n    this.setState({ currentTab : tab })\n  }\n\n  render() {\n    const { currentTab, projects } = this.state;\n    const { onClickTab } = this;\n    return (\n      <div className=\"challenge__project\">\n        <div className=\"challenge__project__tabs\">\n          <div \n            className={`challenge__project__tab ${currentTab === \"new\" && \"tab--active\"}`}\n            onClick={() => onClickTab(\"new\")}\n          >\n            <FormattedMessage id=\"ID_CHALLENGE_PROJECT_TAB_NEW\" />\n          </div>\n          <div \n            className={`challenge__project__tab ${currentTab === \"popular\" && \"tab--active\"}`}\n            onClick={() => onClickTab(\"popular\")}\n          >\n            <FormattedMessage id=\"ID_CHALLENGE_PROJECT_TAB_POPULAR\" />\n          </div>\n        </div>\n        <div className=\"challenge__project__list\">\n          {projects.map(project => (\n            <ChallengeProject key={project.id} challengeProject={project} />\n          ))}\n        </div>\n      </div>\n    );\n  }\n}\n"]},"metadata":{},"sourceType":"module"}