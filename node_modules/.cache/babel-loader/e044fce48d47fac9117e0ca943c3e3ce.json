{"ast":null,"code":"import _regeneratorRuntime from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _objectSpread from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread\";\nimport _classCallCheck from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";\nimport _assertThisInitialized from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/assertThisInitialized\";\nimport _inherits from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";\nimport _possibleConstructorReturn from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";\nvar _jsxFileName = \"/Users/jimmy/Documents/Wizschool/wizlab_web2/src/Page/Mypage/Components/Publish/index.js\";\n\nfunction _createSuper(Derived) { var hasNativeReflectConstruct = _isNativeReflectConstruct(); return function _createSuperInternal() { var Super = _getPrototypeOf(Derived), result; if (hasNativeReflectConstruct) { var NewTarget = _getPrototypeOf(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return _possibleConstructorReturn(this, result); }; }\n\nfunction _isNativeReflectConstruct() { if (typeof Reflect === \"undefined\" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === \"function\") return true; try { Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {})); return true; } catch (e) { return false; } }\n\nimport React from \"react\";\nimport { injectIntl } from \"react-intl\";\nimport * as request from \"../../../../Common/Util/HTTPRequest\";\nimport PublishPopup from \"../../../../Common/Component/Publish\";\nimport { showPopUp } from \"../../../../Common/Component/PopUp\";\nimport View from \"./View\";\n\nvar Publish = /*#__PURE__*/function (_React$Component) {\n  _inherits(Publish, _React$Component);\n\n  var _super = _createSuper(Publish);\n\n  function Publish(props) {\n    var _this;\n\n    _classCallCheck(this, Publish);\n\n    _this = _super.call(this, props);\n\n    _this.getPublishedProjects = function () {\n      _this.setState({\n        loading: true\n      }, function () {\n        var params = {\n          email: _this.props.targetEmail,\n          offset: _this.state.offset,\n          limit: _this.limit\n        };\n        request.getPublishedProjectsByLive(params).then(function (res) {\n          return res.json();\n        }).then(function (result) {\n          var rows = result.rows;\n\n          _this.setState(function (prev) {\n            return {\n              publisheds: [].concat(prev.publisheds, rows),\n              loading: false\n            };\n          }, function () {\n            if (rows.length < _this.limit) {\n              window.removeEventListener(\"scroll\", _this.onScroll);\n            }\n          });\n        }).catch(function (err) {\n          return console.error(err);\n        });\n      });\n    };\n\n    _this.onScroll = function (e) {\n      if (window.innerHeight + window.pageYOffset >= document.body.offsetHeight - 100) {\n        var _this$state = _this.state,\n            offset = _this$state.offset,\n            loading = _this$state.loading;\n\n        if (!loading) {\n          _this.setState({\n            offset: offset + _this.limit\n          }, _this.getPublishedProjects);\n        }\n      }\n    };\n\n    _this.onClickPublishedSetting = function (published) {\n      showPopUp( /*#__PURE__*/React.createElement(PublishPopup, {\n        pId: published.pId,\n        isDeveloping: false,\n        publishCallback: _this.updatePublishedInfo,\n        isBuilder: false,\n        __self: _assertThisInitialized(_this),\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 72,\n          columnNumber: 7\n        }\n      }), {\n        defaultPadding: false,\n        scrollable: true,\n        mobileFullscreen: window.innerWidth < 1170\n      });\n    };\n\n    _this.updatePublishedInfo = function (params) {\n      _this.setState(function (prev) {\n        return {\n          publisheds: prev.publisheds.map(function (item) {\n            if (item.pId === params.pId) {\n              return _objectSpread({}, item, params);\n            } else {\n              return item;\n            }\n          })\n        };\n      });\n    };\n\n    _this.handleProjectLive = /*#__PURE__*/function () {\n      var _ref = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(project) {\n        return _regeneratorRuntime.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                project.live = !project.live;\n\n                if (!project.tags) {\n                  project.tags = [];\n                }\n\n                _context.prev = 2;\n                _context.next = 5;\n                return request.postPublishedProject(project);\n\n              case 5:\n                _this.updatePublishedInfo(project);\n\n                _context.next = 11;\n                break;\n\n              case 8:\n                _context.prev = 8;\n                _context.t0 = _context[\"catch\"](2);\n                console.error(_context.t0);\n\n              case 11:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee, null, [[2, 8]]);\n      }));\n\n      return function (_x) {\n        return _ref.apply(this, arguments);\n      };\n    }();\n\n    _this.state = {\n      publisheds: [],\n      offset: 0,\n      loading: true\n    };\n    _this.limit = 40;\n    return _this;\n  }\n\n  _createClass(Publish, [{\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      this.getPublishedProjects();\n      window.addEventListener(\"scroll\", this.onScroll);\n    }\n  }, {\n    key: \"componentWillUnmount\",\n    value: function componentWillUnmount() {\n      window.removeEventListener(\"scroll\", this.onScroll);\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _this$props = this.props,\n          intl = _this$props.intl,\n          isMyPage = _this$props.isMyPage;\n      var publisheds = this.state.publisheds;\n      var onClickPublishedSetting = this.onClickPublishedSetting,\n          handleProjectLive = this.handleProjectLive;\n      return /*#__PURE__*/React.createElement(View, {\n        intl: intl,\n        isMyPage: isMyPage,\n        publisheds: publisheds,\n        onClickPublishedSetting: onClickPublishedSetting,\n        handleProjectLive: handleProjectLive,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 120,\n          columnNumber: 7\n        }\n      });\n    }\n  }]);\n\n  return Publish;\n}(React.Component);\n\n;\nexport default injectIntl(Publish);","map":{"version":3,"sources":["/Users/jimmy/Documents/Wizschool/wizlab_web2/src/Page/Mypage/Components/Publish/index.js"],"names":["React","injectIntl","request","PublishPopup","showPopUp","View","Publish","props","getPublishedProjects","setState","loading","params","email","targetEmail","offset","state","limit","getPublishedProjectsByLive","then","res","json","result","rows","prev","publisheds","concat","length","window","removeEventListener","onScroll","catch","err","console","error","e","innerHeight","pageYOffset","document","body","offsetHeight","onClickPublishedSetting","published","pId","updatePublishedInfo","defaultPadding","scrollable","mobileFullscreen","innerWidth","map","item","handleProjectLive","project","live","tags","postPublishedProject","addEventListener","intl","isMyPage","Component"],"mappings":"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","sourcesContent":["import React from \"react\";\nimport { injectIntl } from \"react-intl\";\nimport * as request from \"../../../../Common/Util/HTTPRequest\";\nimport PublishPopup from \"../../../../Common/Component/Publish\";\nimport { showPopUp } from \"../../../../Common/Component/PopUp\";\nimport View from \"./View\";\n\n\nclass Publish extends React.Component {\n  constructor(props){\n    super(props);\n    this.state = {\n      publisheds : [],\n      offset: 0,\n      loading: true\n    }\n    this.limit = 40;\n  }\n\n  componentDidMount() {\n    this.getPublishedProjects();\n    window.addEventListener(\"scroll\", this.onScroll);\n  }\n  componentWillUnmount() {\n    window.removeEventListener(\"scroll\", this.onScroll);\n  }\n\n  getPublishedProjects = () => {\n    this.setState(\n      {\n        loading: true\n      },\n      () => {\n        let params = {\n          email: this.props.targetEmail,\n          offset: this.state.offset,\n          limit: this.limit\n        };\n        request\n        .getPublishedProjectsByLive(params)\n        .then(res => res.json())\n        .then(result => {\n            const { rows } = result;\n            this.setState(\n              prev => ({\n                publisheds: [].concat(prev.publisheds, rows),\n                loading: false\n              }),\n              () => {\n                if (rows.length < this.limit) {\n                  window.removeEventListener(\"scroll\", this.onScroll);\n                }\n              }\n            );\n          })\n          .catch(err => console.error(err));\n      }\n    );\n  };\n\n  onScroll = e => {\n    if ( window.innerHeight + window.pageYOffset >= document.body.offsetHeight - 100 ) {\n      const { offset, loading } = this.state;\n      if(!loading){\n        this.setState({offset: offset + this.limit}, this.getPublishedProjects);\n      }\n    }\n  }\n\n  onClickPublishedSetting = published => {\n    showPopUp(\n      <PublishPopup\n        pId={published.pId}\n        isDeveloping={false}\n        publishCallback={this.updatePublishedInfo}\n        isBuilder={false}\n      />,\n      { \n        defaultPadding: false, \n        scrollable: true, \n        mobileFullscreen: window.innerWidth < 1170\n      }\n    );\n  };\n\n  updatePublishedInfo = params => {\n    this.setState(prev => ({\n      publisheds: prev.publisheds.map(item => {\n        if (item.pId === params.pId) {\n          return {\n            ...item,\n            ...params\n          };\n        } else {\n          return item;\n        }\n      })\n    }));\n  };\n\n  handleProjectLive = async project => {\n    project.live = !project.live;\n    if (!project.tags) {\n      project.tags = [];\n    }\n    try {\n      await request.postPublishedProject(project);\n      this.updatePublishedInfo(project);\n    } catch (e) {\n      console.error(e);\n    }\n  };\n\n  render() {\n    const { intl, isMyPage } = this.props;\n    const { publisheds } = this.state;\n    const { onClickPublishedSetting, handleProjectLive } = this;\n  \n    return (\n      <View\n        intl={intl}\n        isMyPage={isMyPage}\n        publisheds={publisheds}\n        onClickPublishedSetting={onClickPublishedSetting}\n        handleProjectLive={handleProjectLive}\n      />\n    );\n  }\n};\n\nexport default injectIntl(Publish);"]},"metadata":{},"sourceType":"module"}