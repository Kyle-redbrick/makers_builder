{"ast":null,"code":"import _classCallCheck from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/react-scripts/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/react-scripts/node_modules/@babel/runtime/helpers/esm/createClass\";\nimport _possibleConstructorReturn from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/react-scripts/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/react-scripts/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";\nimport _inherits from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/react-scripts/node_modules/@babel/runtime/helpers/esm/inherits\";\nimport React from \"react\";\nimport { connect } from \"react-redux\";\nimport * as dreamActions from \"../../../Store/Reducer/dream\";\nimport * as gameActions from \"../../../Store/Reducer/game\";\nimport Condition from \"./condition\";\n\nvar ConditionChecker =\n/*#__PURE__*/\nfunction (_React$Component) {\n  _inherits(ConditionChecker, _React$Component);\n\n  function ConditionChecker(props) {\n    var _this;\n\n    _classCallCheck(this, ConditionChecker);\n\n    _this = _possibleConstructorReturn(this, _getPrototypeOf(ConditionChecker).call(this, props));\n\n    _this.onKeydown = function (e) {\n      if (!_this.keyPressed) {\n        _this.keyPressed = {};\n      }\n\n      _this.keyPressed[e.key] = true;\n\n      if (_this.keyPressed[\"Shift\"] && _this.keyPressed[\"W\"] && _this.keyPressed[\"ArrowRight\"]) {\n        _this.forceClear();\n      }\n    };\n\n    _this.onKeyup = function (e) {\n      if (_this.keyPressed) {\n        delete _this.keyPressed[e.key];\n      }\n    };\n\n    _this.conditions = [];\n    return _this;\n  }\n\n  _createClass(ConditionChecker, [{\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      this.init();\n      document.addEventListener(\"keydown\", this.onKeydown);\n      document.addEventListener(\"keyup\", this.onKeyup);\n    }\n  }, {\n    key: \"componentWillUnmount\",\n    value: function componentWillUnmount() {\n      document.removeEventListener(\"keydown\", this.onKeydown);\n      document.removeEventListener(\"keyup\", this.onKeyup);\n    }\n  }, {\n    key: \"componentDidUpdate\",\n    value: function componentDidUpdate(prevProps) {\n      if (prevProps.mission !== this.props.mission) {\n        this.init();\n      }\n\n      if (this.enabled && this.isConditionStateUpdated(prevProps)) {\n        this.check();\n      }\n    }\n  }, {\n    key: \"init\",\n    value: function init() {\n      var rawConditions = this.props.mission && this.props.mission.conditions || [];\n      this.conditions = rawConditions.map(function (rawCondition) {\n        return Condition.create(rawCondition);\n      });\n      this.props.setLastGameEvent(null);\n      this.props.setIsClear(false);\n      this.props.setIsCodeClear(false);\n    }\n  }, {\n    key: \"isConditionStateUpdated\",\n    value: function isConditionStateUpdated(prevProps) {\n      return prevProps.game !== this.props.game || prevProps.scene !== this.props.scene || prevProps.preview !== this.props.preview || prevProps.interaction !== this.props.interaction;\n    }\n  }, {\n    key: \"check\",\n    value: function check() {\n      var _this2 = this;\n\n      this.conditions.forEach(function (condition) {\n        condition.check(_this2.conditionState);\n      });\n      this.checkClear();\n      this.conditions.forEach(function (condition) {\n        condition.dispose({\n          isPlaying: _this2.props.preview.isPlaying\n        });\n      });\n    }\n  }, {\n    key: \"checkClear\",\n    value: function checkClear() {\n      var isClear = true;\n      var isCodeClear = !this.conditions.find(function (condition) {\n        return condition.isCodeType;\n      });\n      var _iteratorNormalCompletion = true;\n      var _didIteratorError = false;\n      var _iteratorError = undefined;\n\n      try {\n        for (var _iterator = this.conditions[Symbol.iterator](), _step; !(_iteratorNormalCompletion = (_step = _iterator.next()).done); _iteratorNormalCompletion = true) {\n          var condition = _step.value;\n\n          if (isClear && !condition.isClear) {\n            isClear = false;\n          }\n\n          if (isCodeClear && condition.isCodeType && !condition.isClear) {\n            isCodeClear = false;\n          }\n        }\n      } catch (err) {\n        _didIteratorError = true;\n        _iteratorError = err;\n      } finally {\n        try {\n          if (!_iteratorNormalCompletion && _iterator.return != null) {\n            _iterator.return();\n          }\n        } finally {\n          if (_didIteratorError) {\n            throw _iteratorError;\n          }\n        }\n      }\n\n      if (isClear && isClear !== this.props.isClear) {\n        this.props.setIsClear(isClear);\n      }\n\n      if (isCodeClear && isCodeClear !== this.props.isCodeClear) {\n        this.props.setIsCodeClear(isCodeClear);\n      }\n    }\n  }, {\n    key: \"forceClear\",\n    value: function forceClear() {\n      this.props.setIsClear(true);\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      return null;\n    }\n  }, {\n    key: \"enabled\",\n    get: function get() {\n      return this.props.mission && (!this.props.mission.isCompleted || this.props.isReplaying);\n    }\n  }, {\n    key: \"conditionState\",\n    get: function get() {\n      return {\n        game: this.props.game,\n        scene: this.props.scene,\n        preview: this.props.preview,\n        interaction: this.props.interaction\n      };\n    }\n  }]);\n\n  return ConditionChecker;\n}(React.Component);\n\nexport default connect(function (state) {\n  return {\n    game: state.game,\n    scene: state.scene,\n    preview: state.preview,\n    interaction: state.interaction,\n    isReplaying: state.dream.isReplaying,\n    mission: state.dream.currentMission,\n    isClear: state.dream.isConditionsClear,\n    isCodeClear: state.dream.isCodeConditionsClear\n  };\n}, {\n  setLastGameEvent: gameActions.setLastGameEvent,\n  setIsClear: dreamActions.setIsConditionsClear,\n  setIsCodeClear: dreamActions.setIsCodeConditionsClear\n})(ConditionChecker);","map":{"version":3,"sources":["/Users/jimmy/Documents/Wizschool/wizlab_web2/src/Page/Builder/Component/DreamBuilder/ConditionChecker/index.js"],"names":["React","connect","dreamActions","gameActions","Condition","ConditionChecker","props","onKeydown","e","keyPressed","key","forceClear","onKeyup","conditions","init","document","addEventListener","removeEventListener","prevProps","mission","enabled","isConditionStateUpdated","check","rawConditions","map","rawCondition","create","setLastGameEvent","setIsClear","setIsCodeClear","game","scene","preview","interaction","forEach","condition","conditionState","checkClear","dispose","isPlaying","isClear","isCodeClear","find","isCodeType","isCompleted","isReplaying","Component","state","dream","currentMission","isConditionsClear","isCodeConditionsClear","setIsConditionsClear","setIsCodeConditionsClear"],"mappings":"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","sourcesContent":["import React from \"react\";\nimport { connect } from \"react-redux\";\nimport * as dreamActions from \"../../../Store/Reducer/dream\"\nimport * as gameActions from \"../../../Store/Reducer/game\";\nimport Condition from \"./condition\";\n\nclass ConditionChecker extends React.Component {\n  constructor(props) {\n    super(props);\n    this.conditions = [];\n  }\n\n  componentDidMount() {\n    this.init();\n    document.addEventListener(\"keydown\", this.onKeydown);\n    document.addEventListener(\"keyup\", this.onKeyup);\n  }\n  componentWillUnmount() {\n    document.removeEventListener(\"keydown\", this.onKeydown);\n    document.removeEventListener(\"keyup\", this.onKeyup);\n  }\n  componentDidUpdate(prevProps) {\n    if(prevProps.mission !== this.props.mission) {\n      this.init();\n    }\n    if(this.enabled && this.isConditionStateUpdated(prevProps)) {\n      this.check();\n    }\n  }\n\n  init() {\n    const rawConditions = (this.props.mission && this.props.mission.conditions) || [];\n    this.conditions = rawConditions.map(rawCondition => Condition.create(rawCondition));\n    this.props.setLastGameEvent(null);\n    this.props.setIsClear(false);\n    this.props.setIsCodeClear(false);\n  }\n\n  isConditionStateUpdated(prevProps) {\n    return (\n      prevProps.game !== this.props.game\n      || prevProps.scene !== this.props.scene\n      || prevProps.preview !== this.props.preview\n      || prevProps.interaction !== this.props.interaction\n    );\n  }\n  get enabled() {\n    return this.props.mission\n      && (!this.props.mission.isCompleted || this.props.isReplaying);\n  }\n\n  check() {\n    this.conditions.forEach(condition => {\n      condition.check(this.conditionState);\n    })\n\n    this.checkClear();\n\n    this.conditions.forEach(condition => {\n      condition.dispose({ isPlaying: this.props.preview.isPlaying });\n    })\n  }\n  checkClear() {\n    let isClear = true;\n    let isCodeClear = !this.conditions.find(condition => condition.isCodeType);\n\n    for(let condition of this.conditions) {\n      if(isClear && !condition.isClear) {\n        isClear = false\n      }\n      if(isCodeClear && condition.isCodeType && !condition.isClear) {\n        isCodeClear = false\n      }\n    }\n\n    if(isClear && isClear !== this.props.isClear) {\n      this.props.setIsClear(isClear);\n    }\n    if(isCodeClear && isCodeClear !== this.props.isCodeClear) {\n      this.props.setIsCodeClear(isCodeClear);\n    }\n  }\n  get conditionState() {\n    return  {\n      game: this.props.game,\n      scene: this.props.scene,\n      preview: this.props.preview,\n      interaction: this.props.interaction\n    }\n  }\n\n  onKeydown = e => {\n    if(!this.keyPressed) {\n      this.keyPressed = {};\n    }\n\n    this.keyPressed[e.key] = true;\n    if (\n      this.keyPressed[\"Shift\"] &&\n      this.keyPressed[\"W\"] &&\n      this.keyPressed[\"ArrowRight\"]\n    ) {\n      this.forceClear();\n    }\n  }\n  onKeyup = e => {\n    if(this.keyPressed) {\n      delete this.keyPressed[e.key];\n    }\n  }\n  forceClear() {\n    this.props.setIsClear(true);\n  }\n\n  render() {\n    return null;\n  }\n}\n\nexport default connect(\n  state => ({\n    game: state.game,\n    scene: state.scene,\n    preview: state.preview,\n    interaction: state.interaction,\n    isReplaying: state.dream.isReplaying,\n    mission: state.dream.currentMission,\n    isClear: state.dream.isConditionsClear,\n    isCodeClear: state.dream.isCodeConditionsClear\n  }),\n  {\n    setLastGameEvent: gameActions.setLastGameEvent,\n    setIsClear: dreamActions.setIsConditionsClear,\n    setIsCodeClear: dreamActions.setIsCodeConditionsClear\n  }\n)(ConditionChecker);\n"]},"metadata":{},"sourceType":"module"}