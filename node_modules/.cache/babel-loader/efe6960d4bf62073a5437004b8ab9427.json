{"ast":null,"code":"import _regeneratorRuntime from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/react-scripts/node_modules/@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/react-scripts/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _classCallCheck from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/react-scripts/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/react-scripts/node_modules/@babel/runtime/helpers/esm/createClass\";\nimport _possibleConstructorReturn from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/react-scripts/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/react-scripts/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";\nimport _inherits from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/react-scripts/node_modules/@babel/runtime/helpers/esm/inherits\";\nvar _jsxFileName = \"/Users/jimmy/Documents/Wizschool/wizlab_web2/src/Page/Builder/Component/Preload/Container.js\";\nimport React, { Component } from \"react\";\nimport { connect } from \"react-redux\";\nimport generatePreloadPage from \"../../utils/preloadPageGenerator\";\nimport \"./index.scss\";\n\nvar Container =\n/*#__PURE__*/\nfunction (_Component) {\n  _inherits(Container, _Component);\n\n  function Container(props) {\n    var _this;\n\n    _classCallCheck(this, Container);\n\n    _this = _possibleConstructorReturn(this, _getPrototypeOf(Container).call(this, props));\n    _this.preload =\n    /*#__PURE__*/\n    _asyncToGenerator(\n    /*#__PURE__*/\n    _regeneratorRuntime.mark(function _callee2() {\n      return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n        while (1) {\n          switch (_context2.prev = _context2.next) {\n            case 0:\n              if (_this.timer) {\n                clearTimeout(_this.timer);\n              }\n\n              _this.timer = setTimeout(\n              /*#__PURE__*/\n              _asyncToGenerator(\n              /*#__PURE__*/\n              _regeneratorRuntime.mark(function _callee() {\n                var scene, scenes, sceneIds, soundIds, soundNames, state, page;\n                return _regeneratorRuntime.wrap(function _callee$(_context) {\n                  while (1) {\n                    switch (_context.prev = _context.next) {\n                      case 0:\n                        scene = _this.props.scene;\n                        scenes = scene.scenes, sceneIds = scene.sceneIds, soundIds = scene.soundIds, soundNames = scene.soundNames;\n                        state = {\n                          scene: {\n                            scenes: scenes,\n                            sceneIds: sceneIds,\n                            soundIds: soundIds,\n                            soundNames: soundNames\n                          }\n                        };\n                        _context.next = 5;\n                        return generatePreloadPage(state, true);\n\n                      case 5:\n                        page = _context.sent;\n\n                        if (_this.state.iframeSrcDoc !== page) {\n                          _this.setState({\n                            iframeSrcDoc: page\n                          });\n                        }\n\n                      case 7:\n                      case \"end\":\n                        return _context.stop();\n                    }\n                  }\n                }, _callee, this);\n              })), 1000);\n\n            case 2:\n            case \"end\":\n              return _context2.stop();\n          }\n        }\n      }, _callee2, this);\n    }));\n    _this.state = {\n      iframeSrcDoc: null\n    };\n    _this.timer = undefined;\n    return _this;\n  }\n\n  _createClass(Container, [{\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      this.preload();\n    }\n  }, {\n    key: \"componentDidUpdate\",\n    value: function componentDidUpdate() {\n      this.preload();\n    }\n  }, {\n    key: \"shouldComponentUpdate\",\n    value: function shouldComponentUpdate(nextProps, nextState) {\n      // check srcDoc change\n      if (this.state.iframeSrcDoc !== nextState.iframeSrcDoc) {\n        return true;\n      } // check sprites change\n\n\n      var oldScene = this.props.scene;\n      var oldSprites = [];\n\n      for (var i in oldScene.scenes) {\n        var spriteIds = oldScene.scenes[i].spriteIds;\n\n        for (var j in spriteIds) {\n          if (oldSprites.indexOf(spriteIds[j]) < 0) {\n            oldSprites.push(spriteIds[j]);\n          }\n        }\n      }\n\n      var newScene = nextProps.scene;\n\n      for (var _i in newScene.scenes) {\n        var _spriteIds = newScene.scenes[_i].spriteIds;\n\n        for (var _j in _spriteIds) {\n          if (oldSprites.indexOf(_spriteIds[_j]) < 0) {\n            return true;\n          }\n        }\n      } // check sounds change\n\n\n      for (var _i2 in newScene.soundIds) {\n        if (oldScene.soundIds.indexOf(newScene.soundIds[_i2]) < 0) {\n          return true;\n        }\n      }\n\n      return false;\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var iframeSrcDoc = this.state.iframeSrcDoc;\n      return React.createElement(\"div\", {\n        className: \"preload\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 80\n        },\n        __self: this\n      }, iframeSrcDoc && React.createElement(\"iframe\", {\n        title: \"wizlab\",\n        srcDoc: iframeSrcDoc,\n        onLoad: function onLoad() {// if (this.props.editor && !this.props.isPlaying) {\n          //   this.props.editor.focus();\n          // }\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 82\n        },\n        __self: this\n      }));\n    }\n  }]);\n\n  return Container;\n}(Component);\n\nexport default connect(function (state) {\n  return {\n    scene: state.scene,\n    isPlaying: state.preview.isPlaying\n  };\n}, {})(Container);","map":{"version":3,"sources":["/Users/jimmy/Documents/Wizschool/wizlab_web2/src/Page/Builder/Component/Preload/Container.js"],"names":["React","Component","connect","generatePreloadPage","Container","props","preload","timer","clearTimeout","setTimeout","scene","scenes","sceneIds","soundIds","soundNames","state","page","iframeSrcDoc","setState","undefined","nextProps","nextState","oldScene","oldSprites","i","spriteIds","j","indexOf","push","newScene","isPlaying","preview"],"mappings":"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","sourcesContent":["import React, { Component } from \"react\";\nimport { connect } from \"react-redux\";\nimport generatePreloadPage from \"../../utils/preloadPageGenerator\";\nimport \"./index.scss\";\n\nclass Container extends Component {\n  constructor(props) {\n    super(props);\n    this.state = { iframeSrcDoc: null };\n    this.timer = undefined;\n  }\n  componentDidMount() {\n    this.preload();\n  }\n  componentDidUpdate() {\n    this.preload();\n  }\n  shouldComponentUpdate(nextProps, nextState) {\n    // check srcDoc change\n    if (this.state.iframeSrcDoc !== nextState.iframeSrcDoc) {\n      return true;\n    }\n\n    // check sprites change\n    const oldScene = this.props.scene;\n    let oldSprites = [];\n    for (let i in oldScene.scenes) {\n      const spriteIds = oldScene.scenes[i].spriteIds;\n      for (let j in spriteIds) {\n        if (oldSprites.indexOf(spriteIds[j]) < 0) {\n          oldSprites.push(spriteIds[j]);\n        }\n      }\n    }\n    const newScene = nextProps.scene;\n    for (let i in newScene.scenes) {\n      const spriteIds = newScene.scenes[i].spriteIds;\n      for (let j in spriteIds) {\n        if (oldSprites.indexOf(spriteIds[j]) < 0) {\n          return true;\n        }\n      }\n    }\n\n    // check sounds change\n    for (let i in newScene.soundIds) {\n      if (oldScene.soundIds.indexOf(newScene.soundIds[i]) < 0) {\n        return true;\n      }\n    }\n\n    return false;\n  }\n\n  preload = async () => {\n    if (this.timer) {\n      clearTimeout(this.timer);\n    }\n    this.timer = setTimeout(async () => {\n      const { scene } = this.props;\n      const { scenes, sceneIds, soundIds, soundNames } = scene;\n      const state = {\n        scene: {\n          scenes,\n          sceneIds,\n          soundIds,\n          soundNames\n        }\n      };\n      const page = await generatePreloadPage(state, true);\n      if (this.state.iframeSrcDoc !== page) {\n        this.setState({ iframeSrcDoc: page });\n      }\n    }, 1000);\n  };\n\n  render() {\n    const { iframeSrcDoc } = this.state;\n    return (\n      <div className=\"preload\">\n        {iframeSrcDoc && (\n          <iframe\n            title=\"wizlab\"\n            srcDoc={iframeSrcDoc}\n            onLoad={() => {\n              // if (this.props.editor && !this.props.isPlaying) {\n              //   this.props.editor.focus();\n              // }\n            }}\n          />\n        )}\n      </div>\n    );\n  }\n}\n\nexport default connect(\n  state => ({\n    scene: state.scene,\n    isPlaying: state.preview.isPlaying\n  }),\n  {}\n)(Container);\n"]},"metadata":{},"sourceType":"module"}