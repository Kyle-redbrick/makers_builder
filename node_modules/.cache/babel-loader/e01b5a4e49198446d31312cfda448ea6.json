{"ast":null,"code":"import _regeneratorRuntime from \"/Users/jimmy/Documents/Wizschool/astroboy/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"/Users/jimmy/Documents/Wizschool/astroboy/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _classCallCheck from \"/Users/jimmy/Documents/Wizschool/astroboy/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"/Users/jimmy/Documents/Wizschool/astroboy/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";\nimport _inherits from \"/Users/jimmy/Documents/Wizschool/astroboy/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";\nimport _possibleConstructorReturn from \"/Users/jimmy/Documents/Wizschool/astroboy/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"/Users/jimmy/Documents/Wizschool/astroboy/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";\nvar _jsxFileName = \"/Users/jimmy/Documents/Wizschool/astroboy/src/Page/Builder/Component/OCP/Container.js\";\n\nfunction _createSuper(Derived) { var hasNativeReflectConstruct = _isNativeReflectConstruct(); return function _createSuperInternal() { var Super = _getPrototypeOf(Derived), result; if (hasNativeReflectConstruct) { var NewTarget = _getPrototypeOf(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return _possibleConstructorReturn(this, result); }; }\n\nfunction _isNativeReflectConstruct() { if (typeof Reflect === \"undefined\" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === \"function\") return true; try { Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {})); return true; } catch (e) { return false; } }\n\nimport React, { Component } from \"react\";\nimport { withRouter } from \"react-router-dom\";\nimport { connect } from \"react-redux\";\nimport Videoclass from \"../Videoclass\";\nimport * as request from \"../../../../Common/Util/HTTPRequest\";\nimport { showPopUp } from \"../../../../Common/Component/PopUp\";\nimport * as userInfoActions from \"../../../../Common/Store/Reducer/UserInfo\";\nimport store from \"../../Store\"; // import Print from \"../../../../Common/Component/OCPCertification\";\n// import { getColorTheme } from \"../../utils/colorThemeUtil\";\n\nimport SignUp from \"../../../../Common/Component/SignUp\"; // import eventImg from \"../../../../Image/event5_popup.png\";\n// import { showBingoPopup } from \"../../../../Common/Component/PopUp/BingoPopup\";\n\nimport * as TrackingUtil from \"../../../../Common/Util/TrackingUtil\";\nimport * as OcpToken from \"../../../../Common/Util/OcpToken\";\n\nvar Container = /*#__PURE__*/function (_Component) {\n  _inherits(Container, _Component);\n\n  var _super = _createSuper(Container);\n\n  function Container(props) {\n    var _this;\n\n    _classCallCheck(this, Container);\n\n    _this = _super.call(this, props);\n    _this.componentDidMount = /*#__PURE__*/_asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee() {\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              _context.prev = 0;\n              _context.next = 3;\n              return _this.getMyOcp();\n\n            case 3:\n              if (_this.state.maxOcpLevel < _this.props.videoclass.level) {\n                _this.onClickChangeLevel(_this.state.maxOcpLevel);\n              }\n\n              _context.next = 9;\n              break;\n\n            case 6:\n              _context.prev = 6;\n              _context.t0 = _context[\"catch\"](0);\n              console.error(_context.t0);\n\n            case 9:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee, null, [[0, 6]]);\n    }));\n\n    _this.componentDidUpdate = /*#__PURE__*/function () {\n      var _ref2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2(prevProps, prevState) {\n        return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n          while (1) {\n            switch (_context2.prev = _context2.next) {\n              case 0:\n                if (!(_this.props.userinfo.email && !prevProps.userinfo.email)) {\n                  _context2.next = 5;\n                  break;\n                }\n\n                _context2.next = 3;\n                return _this.getMyOcp();\n\n              case 3:\n                _context2.next = 8;\n                break;\n\n              case 5:\n                if (!(!_this.props.userinfo.email && prevProps.userinfo.email)) {\n                  _context2.next = 8;\n                  break;\n                }\n\n                _context2.next = 8;\n                return _this.getMyOcp();\n\n              case 8:\n              case \"end\":\n                return _context2.stop();\n            }\n          }\n        }, _callee2);\n      }));\n\n      return function (_x, _x2) {\n        return _ref2.apply(this, arguments);\n      };\n    }();\n\n    _this.getMyOcp = /*#__PURE__*/_asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee3() {\n      var res, json, data;\n      return _regeneratorRuntime.wrap(function _callee3$(_context3) {\n        while (1) {\n          switch (_context3.prev = _context3.next) {\n            case 0:\n              if (!(_this.props.userinfo.email || _this.guest)) {\n                _context3.next = 10;\n                break;\n              }\n\n              _context3.next = 3;\n              return request.getMyOcp(_this.props.userinfo.email ? {\n                email: _this.props.userinfo.email\n              } : {\n                guestId: _this.guest.id\n              });\n\n            case 3:\n              res = _context3.sent;\n              _context3.next = 6;\n              return res.json();\n\n            case 6:\n              json = _context3.sent;\n\n              if (!json) {\n                _this.setState({\n                  maxOcpLevel: 1\n                });\n              } else {\n                data = {};\n                json.forEach(function (element) {\n                  data[element.grade] = element.level;\n                });\n\n                _this.setState({\n                  maxOcpLevel: Number(data[_this.grade]) + 1\n                });\n\n                if (!data[_this.grade]) {\n                  _this.setState({\n                    maxOcpLevel: 1\n                  });\n                }\n              }\n\n              _context3.next = 11;\n              break;\n\n            case 10:\n              _this.setState({\n                maxOcpLevel: 1\n              });\n\n            case 11:\n            case \"end\":\n              return _context3.stop();\n          }\n        }\n      }, _callee3);\n    }));\n\n    _this.onClickChangeLevel = function (level) {\n      _this.props.history.replace({\n        pathname: \"/ocp/\".concat(_this.grade, \"/\").concat(level)\n      });\n\n      window.location.reload();\n    };\n\n    _this.onEndStage = /*#__PURE__*/_asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee4() {\n      var res, json, path;\n      return _regeneratorRuntime.wrap(function _callee4$(_context4) {\n        while (1) {\n          switch (_context4.prev = _context4.next) {\n            case 0:\n              if (!(_this.state.maxOcpLevel < _this.props.videoclass.level + 1)) {\n                _context4.next = 18;\n                break;\n              }\n\n              if (!_this.props.userinfo.email) {\n                _context4.next = 7;\n                break;\n              }\n\n              _context4.next = 4;\n              return request.updateMyOcpLevel({\n                email: _this.props.userinfo.email,\n                level: _this.props.videoclass.level,\n                grade: _this.grade\n              });\n\n            case 4:\n              res = _context4.sent;\n              _context4.next = 14;\n              break;\n\n            case 7:\n              if (_this.guest) {\n                _context4.next = 11;\n                break;\n              }\n\n              _context4.next = 10;\n              return OcpToken.addOcpUser(_this.props.userinfo.email, _this.grade);\n\n            case 10:\n              _this.guest = localStorage.getItem(\"ocpId\") && JSON.parse(localStorage.getItem(\"ocpId\"));\n\n            case 11:\n              _context4.next = 13;\n              return request.updateMyOcpLevel({\n                guestId: _this.guest && _this.guest.id,\n                level: _this.props.videoclass.level,\n                grade: _this.grade\n              });\n\n            case 13:\n              res = _context4.sent;\n\n            case 14:\n              _context4.next = 16;\n              return res.json();\n\n            case 16:\n              json = _context4.sent;\n              _this.bingoType = json.bingoType;\n\n            case 18:\n              // if (this.props.videoclass.level === 10) {\n              //   this.showPrintPopup();\n              // }\n              path = window.location.pathname;\n              TrackingUtil.sendGTMEvent(\"OCP Clear\", path);\n\n            case 20:\n            case \"end\":\n              return _context4.stop();\n          }\n        }\n      }, _callee4);\n    }));\n\n    _this.endStageButtonAction = function () {\n      _this.onClickChangeLevel(_this.props.videoclass.level + 1);\n    };\n\n    _this.handleSignup = function () {\n      showPopUp(React.createElement(SignUp, {\n        store: store,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 249\n        },\n        __self: this\n      }), {\n        store: store,\n        mobileFullscreen: true,\n        darkmode: true\n      });\n    };\n\n    _this.guest = localStorage.getItem(\"ocpId\") && JSON.parse(localStorage.getItem(\"ocpId\"));\n    _this.step = _this.props.match.params.step;\n    _this.grade = _this.props.match.params.grade;\n    _this.state = {\n      maxOcpLevel: undefined\n    };\n    return _this;\n  }\n\n  _createClass(Container, [{\n    key: \"render\",\n    value: function render() {\n      var _this$props = this.props,\n          handleSelectTab = _this$props.handleSelectTab,\n          _handleChangeZIndex = _this$props.handleChangeZIndex,\n          zIndex = _this$props.zIndex;\n      return React.createElement(Videoclass, {\n        setRef: this.props.setVideoclassRef,\n        maxOcpLevel: this.state.maxOcpLevel,\n        videoclass: this.props.videoclass,\n        showModal: this.props.showModal,\n        handleSelectTab: handleSelectTab,\n        handleChangeZIndex: function handleChangeZIndex() {\n          _handleChangeZIndex(\"ocp\");\n        },\n        zIndex: zIndex,\n        onEndStage: this.onEndStage,\n        endStageButtonAction: this.props.videoclass.level < 10 ? this.endStageButtonAction : undefined,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 259\n        },\n        __self: this\n      });\n    }\n  }]);\n\n  return Container;\n}(Component);\n\nexport default connect(function (state) {\n  return {\n    userinfo: state.userinfo,\n    videoclass: state.project.videoclass\n  };\n}, {\n  updateUserInfo: userInfoActions.updateUserInfo\n})(withRouter(Container));","map":{"version":3,"sources":["/Users/jimmy/Documents/Wizschool/astroboy/src/Page/Builder/Component/OCP/Container.js"],"names":["React","Component","withRouter","connect","Videoclass","request","showPopUp","userInfoActions","store","SignUp","TrackingUtil","OcpToken","Container","props","componentDidMount","getMyOcp","state","maxOcpLevel","videoclass","level","onClickChangeLevel","console","error","componentDidUpdate","prevProps","prevState","userinfo","email","guest","guestId","id","res","json","setState","data","forEach","element","grade","Number","history","replace","pathname","window","location","reload","onEndStage","updateMyOcpLevel","addOcpUser","localStorage","getItem","JSON","parse","bingoType","path","sendGTMEvent","endStageButtonAction","handleSignup","mobileFullscreen","darkmode","step","match","params","undefined","handleSelectTab","handleChangeZIndex","zIndex","setVideoclassRef","showModal","project","updateUserInfo"],"mappings":"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","sourcesContent":["import React, { Component } from \"react\";\nimport { withRouter } from \"react-router-dom\";\nimport { connect } from \"react-redux\";\nimport Videoclass from \"../Videoclass\";\nimport * as request from \"../../../../Common/Util/HTTPRequest\";\nimport { showPopUp } from \"../../../../Common/Component/PopUp\";\nimport * as userInfoActions from \"../../../../Common/Store/Reducer/UserInfo\";\nimport store from \"../../Store\";\n// import Print from \"../../../../Common/Component/OCPCertification\";\n// import { getColorTheme } from \"../../utils/colorThemeUtil\";\nimport SignUp from \"../../../../Common/Component/SignUp\";\n// import eventImg from \"../../../../Image/event5_popup.png\";\n// import { showBingoPopup } from \"../../../../Common/Component/PopUp/BingoPopup\";\nimport * as TrackingUtil from \"../../../../Common/Util/TrackingUtil\";\nimport * as OcpToken from \"../../../../Common/Util/OcpToken\";\n\nclass Container extends Component {\n  constructor(props) {\n    super(props);\n    this.guest =\n      localStorage.getItem(\"ocpId\") &&\n      JSON.parse(localStorage.getItem(\"ocpId\"));\n    this.step = this.props.match.params.step;\n    this.grade = this.props.match.params.grade;\n    this.state = { maxOcpLevel: undefined };\n  }\n\n  componentDidMount = async () => {\n    try {\n      /** check my stage  && set max level */\n      await this.getMyOcp();\n\n      if (this.state.maxOcpLevel < this.props.videoclass.level) {\n        this.onClickChangeLevel(this.state.maxOcpLevel);\n      }\n    } catch (e) {\n      console.error(e);\n    }\n  };\n\n  componentDidUpdate = async (prevProps, prevState) => {\n    if (this.props.userinfo.email && !prevProps.userinfo.email) {\n      await this.getMyOcp();\n    } else if (!this.props.userinfo.email && prevProps.userinfo.email) {\n      await this.getMyOcp();\n    }\n  };\n\n  getMyOcp = async () => {\n    if (this.props.userinfo.email || this.guest) {\n      let res = await request.getMyOcp(\n        this.props.userinfo.email\n          ? { email: this.props.userinfo.email }\n          : { guestId: this.guest.id }\n      );\n      let json = await res.json();\n      if (!json) {\n        this.setState({\n          maxOcpLevel: 1\n        });\n      } else {\n        let data = {};\n        json.forEach(element => {\n          data[element.grade] = element.level;\n        });\n\n        this.setState({\n          maxOcpLevel: Number(data[this.grade]) + 1\n        });\n\n        if (!data[this.grade]) {\n          this.setState({\n            maxOcpLevel: 1\n          });\n        }\n      }\n    } else {\n      this.setState({\n        maxOcpLevel: 1\n      });\n    }\n  };\n\n  onClickChangeLevel = level => {\n    this.props.history.replace({ pathname: `/ocp/${this.grade}/${level}` });\n    window.location.reload();\n  };\n\n  onEndStage = async () => {\n    if (this.state.maxOcpLevel < this.props.videoclass.level + 1) {\n      let res;\n      if (this.props.userinfo.email) {\n        res = await request.updateMyOcpLevel({\n          email: this.props.userinfo.email,\n          level: this.props.videoclass.level,\n          grade: this.grade\n        });\n      } else {\n        if (!this.guest) {\n          await OcpToken.addOcpUser(this.props.userinfo.email, this.grade);\n          this.guest =\n            localStorage.getItem(\"ocpId\") &&\n            JSON.parse(localStorage.getItem(\"ocpId\"));\n        }\n        res = await request.updateMyOcpLevel({\n          guestId: this.guest && this.guest.id,\n          level: this.props.videoclass.level,\n          grade: this.grade\n        });\n      }\n      const json = await res.json();\n      this.bingoType = json.bingoType;\n    }\n\n    // if (this.props.videoclass.level === 10) {\n    //   this.showPrintPopup();\n    // }\n    const path = window.location.pathname;\n    TrackingUtil.sendGTMEvent(\"OCP Clear\", path);\n  };\n\n  // showPrintPopup = () => {\n  //   showPopUp(\n  //     <Popup.TwoButton\n  //       title=\"인증서를 출력하시겠습니까?\"\n  //       subtitle=\"나중에도 출력가능합니다.\"\n  //       cancelButtonName=\"아니오\"\n  //       confirmButtonName=\"네\"\n  //       confirmAction={() => this.handleCertification()}\n  //       cancelAction={this.printCallback}\n  //     />,\n  //     { store, dismissOverlay: true }\n  //   );\n  // };\n  endStageButtonAction = () => {\n    this.onClickChangeLevel(this.props.videoclass.level + 1);\n  };\n\n  // handleCertification = async () => {\n  //   let name, organization;\n  //   if (this.props.userinfo.email) {\n  //     if (this.props.userinfo.organization) {\n  //       name = this.props.userinfo.name;\n  //       organization = this.props.userinfo.organization;\n  //     } else {\n  //       showPopUp(\n  //         <Popup.OneInput\n  //           title=\"학교를 입력해주세요\"\n  //           buttonName=\"확인\"\n  //           inputLimit={10}\n  //           buttonAction={org => callback(org)}\n  //         />,\n  //         { store, dismissOverlay: true }\n  //       );\n  //     }\n  //   } else {\n  //     const res = await request.getOcpUser({\n  //       guestId: this.guest && this.guest.id\n  //     });\n  //     const guest = await res.json();\n  //     if (guest) {\n  //       if (!(guest.name && guest.organization)) {\n  //         showPopUp(\n  //           <Popup.TwoInput\n  //             title=\"학교를 입력해주세요\"\n  //             buttonName=\"확인\"\n  //             inputTitle1=\"이름\"\n  //             inputTitle2=\"학교\"\n  //             inputLimit1={4}\n  //             inputLimit2={10}\n  //             buttonAction={(org, name) => callback(org, name)}\n  //           />,\n  //           { store, dismissOverlay: true }\n  //         );\n  //       } else {\n  //         name = guest.name;\n  //         organization = guest.organization;\n  //       }\n  //     }\n  //   }\n\n  //   if (name && organization) {\n  //     showPopUp(\n  //       <Print\n  //         organization={organization.substring(0, 10)}\n  //         grade={this.grade}\n  //         name={name.substring(0, 4)}\n  //         callback={this.printCallback}\n  //       />,\n  //       { store }\n  //     );\n  //   }\n  //   const callback = (org, name = this.props.userinfo.name) => {\n  //     showPopUp(\n  //       <Print\n  //         organization={org}\n  //         grade={this.grade}\n  //         name={name}\n  //         callback={this.printCallback}\n  //       />,\n  //       { store }\n  //     );\n\n  //     request.updateOcpUser({\n  //       guestId: this.guest && this.guest.id,\n  //       email: this.props.userinfo.email,\n  //       name: name,\n  //       organization: org\n  //     });\n  //     this.props.updateUserInfo();\n  //   };\n  // };\n\n  // printCallback = () => {\n  //   request.updateMyOcpPrint(\n  //     this.props.userinfo.email\n  //       ? { email: this.props.userinfo.email, grade: this.grade }\n  //       : { guestId: this.guest && this.guest.id, grade: this.grade }\n  //   );\n  //   setTimeout(() => {\n  //     if (this.props.userinfo.email) {\n  //       if (this.bingoType) {\n  //         showBingoPopup(this.props.userinfo.email, this.bingoType);\n  //       }\n  //     } else {\n  //       // showPopUp(\n  //       //   <Popup.TwoButton\n  //       //     titleId=\"ID_CERT_POPUP_TITLE\"\n  //       //     cancelButtonNameId=\"ID_CERT_POPUP_CANCEL\"\n  //       //     confirmButtonNameId=\"ID_CERT_POPUP_SIGNUP\"\n  //       //     confirmAction={this.handleSignup}\n  //       //     content={\n  //       //       <div>\n  //       //         <img\n  //       //           style={{ width: \"100%\", marginTop: \"30px\" }}\n  //       //           src={eventImg}\n  //       //           alt=\"event\"\n  //       //         />\n  //       //       </div>\n  //       //     }\n  //       //   />,\n  //       //   { store, darkmode: getColorTheme() === \"darkMode\" }\n  //       // );\n  //     }\n  //   }, 1000);\n  // };\n\n  handleSignup = () => {\n    showPopUp(<SignUp store={store} />, {\n      store,\n      mobileFullscreen: true,\n      darkmode: true\n    });\n  };\n\n  render() {\n    const { handleSelectTab, handleChangeZIndex, zIndex } = this.props;\n    return (\n      <Videoclass\n        setRef={this.props.setVideoclassRef}\n        maxOcpLevel={this.state.maxOcpLevel}\n        videoclass={this.props.videoclass}\n        showModal={this.props.showModal}\n        handleSelectTab={handleSelectTab}\n        handleChangeZIndex={() => {\n          handleChangeZIndex(\"ocp\");\n        }}\n        zIndex={zIndex}\n        onEndStage={this.onEndStage}\n        endStageButtonAction={\n          this.props.videoclass.level < 10\n            ? this.endStageButtonAction\n            : undefined\n        }\n      />\n    );\n  }\n}\n\nexport default connect(\n  state => ({\n    userinfo: state.userinfo,\n    videoclass: state.project.videoclass\n  }),\n  { updateUserInfo: userInfoActions.updateUserInfo }\n)(withRouter(Container));\n"]},"metadata":{},"sourceType":"module"}