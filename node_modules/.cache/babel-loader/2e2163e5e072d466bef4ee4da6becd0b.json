{"ast":null,"code":"import _regeneratorRuntime from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/react-scripts/node_modules/@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/react-scripts/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _defineProperty from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/react-scripts/node_modules/@babel/runtime/helpers/esm/defineProperty\";\nimport _toConsumableArray from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/react-scripts/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";\nimport _classCallCheck from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/react-scripts/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/react-scripts/node_modules/@babel/runtime/helpers/esm/createClass\";\nimport _possibleConstructorReturn from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/react-scripts/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/react-scripts/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";\nimport _inherits from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/react-scripts/node_modules/@babel/runtime/helpers/esm/inherits\";\nvar _jsxFileName = \"/Users/jimmy/Documents/Wizschool/wizlab_web2/src/Page/Builder/Component/SpriteBox/Component/CustomSprite/index.js\";\nimport React from \"react\";\nimport { connect } from \"react-redux\";\nimport { fabric } from \"fabric\";\nimport { mergeImages, compress, toBlob } from \"./ImageUtil\";\nimport * as sceneActions from \"../../../../Store/Reducer/scene\";\nimport AssetLibrary from \"../../../../utils/assetLibrary\";\nimport { SpriteType, URL } from \"../../../../../../Common/Util/Constant\";\nimport * as request from \"../../../../../../Common/Util/HTTPRequest\";\nimport View from \"./View\";\n\nvar CustomSprite =\n/*#__PURE__*/\nfunction (_React$Component) {\n  _inherits(CustomSprite, _React$Component);\n\n  function CustomSprite(props) {\n    var _this;\n\n    _classCallCheck(this, CustomSprite);\n\n    _this = _possibleConstructorReturn(this, _getPrototypeOf(CustomSprite).call(this, props));\n\n    _this.drawCanvas = function (dataURL, callback) {\n      fabric.Image.fromURL(dataURL, function (img) {\n        _this.frameCanvas.clear();\n\n        _this.frameCanvas.add(img);\n\n        _this.frameCanvas.renderAll();\n\n        var frame = {\n          thumb: _this.frameCanvas.toDataURL(\"image/png\"),\n          data: _this.frameCanvas.toDatalessJSON()\n        };\n        callback(frame);\n      });\n    };\n\n    _this.addFrame = function (dataURL) {\n      _this.drawCanvas(dataURL, function (frame) {\n        _this.setState({\n          frames: [].concat(_toConsumableArray(_this.state.frames), [frame]),\n          selectedFrameIndex: _this.state.frames.length\n        });\n      });\n    };\n\n    _this.changeFrame = function (index, dataURL) {\n      _this.drawCanvas(dataURL, function (frame) {\n        _this.setState({\n          frames: _this.state.frames.map(function (_frame, _index) {\n            if (_index === index) {\n              return frame;\n            } else {\n              return _frame;\n            }\n          })\n        });\n      });\n    };\n\n    _this.resetActions = function () {\n      _this.endEditingBodySize();\n\n      _this.stopAnimation();\n\n      _this.setState({\n        isPlaying: false\n      });\n    };\n\n    _this.redrawThumbs = function () {\n      var frames = _this.state.frames;\n      var _frames = [];\n\n      var redraw = function redraw(index) {\n        var frame = frames[index];\n\n        _this.frameCanvas.loadFromJSON(frame.data, function () {\n          _frames.push({\n            thumb: _this.frameCanvas.toDataURL(\"image/png\"),\n            data: _this.frameCanvas.toDatalessJSON()\n          });\n\n          if (frames.length > index + 1) {\n            redraw(index + 1);\n          } else {\n            _this.setState({\n              frames: _frames\n            });\n          }\n        });\n      };\n\n      if (frames.length > 0) redraw(0);\n    };\n\n    _this.startEditingBodySize = function () {\n      _this.setState({\n        isEditingBodySize: true\n      });\n\n      _this.frameCanvas.discardActiveObject();\n\n      _this.frameCanvas.getObjects().forEach(function (obj) {\n        return obj.selectable = false;\n      });\n\n      _this.frameCanvas.add(_this.bodyFrameRect);\n\n      _this.frameCanvas.renderAll();\n\n      _this.frameCanvas.setActiveObject(_this.bodyFrameRect);\n    };\n\n    _this.endEditingBodySize = function () {\n      _this.setState({\n        isEditingBodySize: false\n      });\n\n      _this.frameCanvas.getObjects().forEach(function (obj) {\n        return obj.selectable = true;\n      });\n\n      _this.frameCanvas.remove(_this.bodyFrameRect);\n    };\n\n    _this.onChangeCanvas = function (e) {\n      var isEditingBodySize = _this.state.isEditingBodySize;\n\n      if (isEditingBodySize) {\n        return;\n      }\n\n      var _this$state = _this.state,\n          frames = _this$state.frames,\n          selectedFrameIndex = _this$state.selectedFrameIndex;\n\n      _this.setState({\n        frames: frames.map(function (frame, i) {\n          if (selectedFrameIndex === i) {\n            frame.thumb = _this.frameCanvas.toDataURL(\"image/png\");\n            frame.data = _this.frameCanvas.toDatalessJSON();\n          }\n\n          return frame;\n        })\n      });\n    };\n\n    _this.playAnimation = function () {\n      _this.animationRef.current.start(_this.state.isLoop);\n    };\n\n    _this.stopAnimation = function () {\n      _this.animationRef.current.stop();\n    };\n\n    _this.onClickToggleAnimation = function () {\n      _this.resetActions();\n\n      var isPlaying = _this.state.isPlaying;\n\n      _this.setState({\n        isPlaying: !isPlaying\n      }, function () {\n        if (isPlaying) {\n          _this.stopAnimation();\n        } else {\n          _this.playAnimation();\n        }\n      });\n    };\n\n    _this.onClickLoopAnimation = function () {\n      _this.resetActions();\n\n      var isLoop = _this.state.isLoop;\n\n      _this.setState({\n        isLoop: !isLoop\n      });\n    };\n\n    _this.onChangeFrameSize = function (e) {\n      _this.resetActions();\n\n      var _e$target = e.target,\n          name = _e$target.name,\n          value = _e$target.value;\n\n      if (Number(value) > 300) {\n        value = 300;\n      }\n\n      _this.setState(_defineProperty({}, name, Number(value)), function () {\n        if (name === \"frameWidth\") {\n          _this.frameCanvas.setWidth(_this.state.frameWidth);\n        } else if (name === \"frameHeight\") {\n          _this.frameCanvas.setHeight(_this.state.frameHeight);\n        }\n\n        _this.redrawThumbs();\n      });\n    };\n\n    _this.checkIsValid = function (name) {\n      var regex = /^[a-z](?:_?[a-z0-9]+)*$/;\n      return regex.test(name);\n    };\n\n    _this.onChangeDefaultName = function (e) {\n      var value = e.target.value;\n      if (value.length > 12) value = value.substr(0, 12);\n\n      _this.setState({\n        defaultName: value,\n        isDefaultNameValid: _this.checkIsValid(value)\n      });\n    };\n\n    _this.onChangeAnimationName = function (e) {\n      var value = e.target.value;\n      if (value.length > 12) value = value.substr(0, 12);\n\n      _this.setState({\n        animationName: value,\n        isAnimationNameValid: _this.checkIsValid(value)\n      });\n    };\n\n    _this.onChangeFrameRate = function (e) {\n      var frameRate = Number(e.target.value);\n\n      if (frameRate !== _this.state.frameRate) {\n        _this.resetActions();\n\n        _this.setState({\n          frameRate: frameRate\n        });\n      }\n    };\n\n    _this.onChangeFile = function (e) {\n      var file = e.target.files[0];\n\n      if (!file) {\n        return;\n      }\n\n      var fr = new FileReader();\n\n      fr.onload = function () {\n        if (_this.editingFrameIndex === -1) {\n          _this.addFrame(fr.result);\n        } else {\n          _this.changeFrame(_this.editingFrameIndex, fr.result);\n\n          _this.editingFrameIndex = -1;\n        }\n      };\n\n      fr.readAsDataURL(file); //file input value 초기화\n\n      e.target.type = \"\";\n      e.target.type = \"file\";\n    };\n\n    _this.onClickFrame = function (index) {\n      _this.resetActions();\n\n      var frames = _this.state.frames;\n\n      if (!frames[index]) {\n        _this.frameCanvas.clear();\n\n        return;\n      }\n\n      _this.frameCanvas.loadFromJSON(frames[index].data);\n\n      _this.setState({\n        selectedFrameIndex: index\n      });\n    };\n\n    _this.onClickEditBodySize = function () {\n      _this.animationRef.current.stop();\n\n      var isEditingBodySize = _this.state.isEditingBodySize;\n\n      if (isEditingBodySize) {\n        _this.endEditingBodySize();\n      } else {\n        _this.startEditingBodySize();\n      }\n    };\n\n    _this.onClickAddFrame = function () {\n      _this.resetActions();\n\n      _this.inputFileRef.current.click();\n    };\n\n    _this.onClickDeleteFrame = function (index) {\n      _this.resetActions();\n\n      var frames = _this.state.frames;\n\n      _this.setState({\n        frames: frames.filter(function (frame, i) {\n          return i !== index;\n        })\n      }, function () {\n        return _this.onClickFrame(0);\n      });\n    };\n\n    _this.onClickEditFrame = function (index) {\n      _this.resetActions();\n\n      _this.editingFrameIndex = index;\n\n      _this.onClickFrame(index);\n\n      _this.inputFileRef.current.click();\n    };\n\n    _this.onSubmit =\n    /*#__PURE__*/\n    _asyncToGenerator(\n    /*#__PURE__*/\n    _regeneratorRuntime.mark(function _callee() {\n      var _this$state2, defaultName, animationName, selectedSceneId, isValidate, firstFrameUrl, spriteSheetUrl, asset, sprite;\n\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              _this.resetActions();\n\n              _this$state2 = _this.state, defaultName = _this$state2.defaultName, animationName = _this$state2.animationName;\n              selectedSceneId = _this.props.selectedSceneId;\n              isValidate = _this.checkValidate();\n\n              if (isValidate) {\n                _context.next = 6;\n                break;\n              }\n\n              return _context.abrupt(\"return\");\n\n            case 6:\n              if (!_this.isUploading) {\n                _context.next = 8;\n                break;\n              }\n\n              return _context.abrupt(\"return\");\n\n            case 8:\n              _context.prev = 8;\n              _this.isUploading = true; //upload images & asset to server\n\n              _context.next = 12;\n              return _this.uploadFirstFrame();\n\n            case 12:\n              firstFrameUrl = _context.sent;\n              _context.next = 15;\n              return _this.uploadSpriteSheet();\n\n            case 15:\n              spriteSheetUrl = _context.sent;\n              asset = _this.createAsset(firstFrameUrl, spriteSheetUrl, defaultName, animationName);\n              _context.next = 19;\n              return request.addAsset(asset);\n\n            case 19:\n              //add asset to assetLibrary\n              AssetLibrary.addAsset(asset); //add sprite to project\n\n              sprite = {\n                assetId: asset.assetId,\n                type: asset.type,\n                name: _this.props.countUpSameName(defaultName)\n              };\n\n              _this.props.addSprites(selectedSceneId, [sprite]);\n\n              _this.props.dismiss();\n\n              _context.next = 29;\n              break;\n\n            case 25:\n              _context.prev = 25;\n              _context.t0 = _context[\"catch\"](8);\n              _this.isUploading = false;\n              console.error(_context.t0);\n\n            case 29:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee, this, [[8, 25]]);\n    }));\n\n    _this.checkValidate = function () {\n      var _this$state3 = _this.state,\n          frames = _this$state3.frames,\n          defaultName = _this$state3.defaultName,\n          animationName = _this$state3.animationName;\n\n      if (frames.length === 0) {\n        return false;\n      }\n\n      if (!defaultName || defaultName.length < 1) {\n        return false;\n      }\n\n      if (!animationName || animationName.length < 1) {\n        return false;\n      }\n\n      return true;\n    };\n\n    _this.uploadFirstFrame =\n    /*#__PURE__*/\n    _asyncToGenerator(\n    /*#__PURE__*/\n    _regeneratorRuntime.mark(function _callee2() {\n      var frames, blob;\n      return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n        while (1) {\n          switch (_context2.prev = _context2.next) {\n            case 0:\n              _context2.prev = 0;\n              frames = _this.state.frames;\n              blob = toBlob(frames[0].thumb);\n              _context2.next = 5;\n              return _this.uploadImage(blob);\n\n            case 5:\n              return _context2.abrupt(\"return\", _context2.sent);\n\n            case 8:\n              _context2.prev = 8;\n              _context2.t0 = _context2[\"catch\"](0);\n              console.error(_context2.t0);\n\n            case 11:\n            case \"end\":\n              return _context2.stop();\n          }\n        }\n      }, _callee2, this, [[0, 8]]);\n    }));\n    _this.uploadSpriteSheet =\n    /*#__PURE__*/\n    _asyncToGenerator(\n    /*#__PURE__*/\n    _regeneratorRuntime.mark(function _callee3() {\n      var _this$state4, frameWidth, frameHeight, frames, images, blob;\n\n      return _regeneratorRuntime.wrap(function _callee3$(_context3) {\n        while (1) {\n          switch (_context3.prev = _context3.next) {\n            case 0:\n              _context3.prev = 0;\n              _this$state4 = _this.state, frameWidth = _this$state4.frameWidth, frameHeight = _this$state4.frameHeight, frames = _this$state4.frames;\n              images = frames.map(function (frame) {\n                return frame.thumb;\n              });\n              _context3.next = 5;\n              return mergeImages(images, frameWidth, frameHeight);\n\n            case 5:\n              blob = _context3.sent;\n              _context3.next = 8;\n              return _this.uploadImage(blob);\n\n            case 8:\n              return _context3.abrupt(\"return\", _context3.sent);\n\n            case 11:\n              _context3.prev = 11;\n              _context3.t0 = _context3[\"catch\"](0);\n              console.error(_context3.t0);\n\n            case 14:\n            case \"end\":\n              return _context3.stop();\n          }\n        }\n      }, _callee3, this, [[0, 11]]);\n    }));\n\n    _this.uploadImage =\n    /*#__PURE__*/\n    function () {\n      var _ref4 = _asyncToGenerator(\n      /*#__PURE__*/\n      _regeneratorRuntime.mark(function _callee4(blob) {\n        var compressedBlob, data, res, json;\n        return _regeneratorRuntime.wrap(function _callee4$(_context4) {\n          while (1) {\n            switch (_context4.prev = _context4.next) {\n              case 0:\n                _context4.prev = 0;\n                _context4.next = 3;\n                return compress(blob);\n\n              case 3:\n                compressedBlob = _context4.sent;\n                data = new FormData();\n                data.append(\"file\", compressedBlob);\n                _context4.next = 8;\n                return request.uploadAsset(data);\n\n              case 8:\n                res = _context4.sent;\n                _context4.next = 11;\n                return res.json();\n\n              case 11:\n                json = _context4.sent;\n                return _context4.abrupt(\"return\", json.url.replace(URL.ASSET_BASE_URL, \"\"));\n\n              case 15:\n                _context4.prev = 15;\n                _context4.t0 = _context4[\"catch\"](0);\n                console.error(_context4.t0);\n\n              case 18:\n              case \"end\":\n                return _context4.stop();\n            }\n          }\n        }, _callee4, this, [[0, 15]]);\n      }));\n\n      return function (_x) {\n        return _ref4.apply(this, arguments);\n      };\n    }();\n\n    _this.createAsset = function (firstFrameUrl, spriteSheetUrl, defaultName, animationName) {\n      var _this$state5 = _this.state,\n          frameWidth = _this$state5.frameWidth,\n          frameHeight = _this$state5.frameHeight,\n          frameRate = _this$state5.frameRate,\n          frames = _this$state5.frames;\n      var assetId = firstFrameUrl.replace(\"/custom/\", \"\").replace(\".png\", \"\");\n      var type = SpriteType.CUSTOM;\n      var spriteSize = JSON.stringify([frameWidth, frameHeight]);\n      var bodySize = JSON.stringify([_this.bodyFrameRect.width * _this.bodyFrameRect.scaleX, _this.bodyFrameRect.height * _this.bodyFrameRect.scaleY, _this.bodyFrameRect.left, _this.bodyFrameRect.top]);\n      var spriteAnimations = JSON.stringify(_defineProperty({}, animationName, {\n        frameRate: frameRate,\n        indexes: _toConsumableArray(new Array(frames.length)).map(function (_i, i) {\n          return i;\n        })\n      }));\n      return {\n        assetId: assetId,\n        type: type,\n        defaultName: defaultName,\n        path: firstFrameUrl,\n        thumb: firstFrameUrl,\n        spritePath: spriteSheetUrl,\n        spriteSize: spriteSize,\n        bodySize: bodySize,\n        spriteAnimations: spriteAnimations\n      };\n    };\n\n    _this.onClickGuide = function () {\n      _this.setState({\n        isGuideOpen: !_this.state.isGuideOpen\n      });\n    };\n\n    _this.onClickPrev = function () {\n      _this.setState({\n        currentStep: 1\n      });\n    };\n\n    _this.onClickNext = function () {\n      if (_this.state.frames.length > 0) {\n        _this.setState({\n          currentStep: 2\n        });\n      }\n    };\n\n    _this.onStopAnimation = function () {\n      _this.setState({\n        isPlaying: false\n      });\n    };\n\n    _this.state = {\n      defaultName: \"custom\",\n      animationName: \"idle\",\n      frames: [],\n      frameRate: 5,\n      frameWidth: 200,\n      frameHeight: 200,\n      selectedFrameIndex: 0,\n      isEditingBodySize: false,\n      isGuideOpen: false,\n      currentStep: 1,\n      isLoop: true,\n      isPlaying: false,\n      isDefaultNameValid: true,\n      isAnimationNameValid: true\n    };\n    _this.frameCanvas = undefined;\n    _this.animationRef = React.createRef();\n    _this.inputFileRef = React.createRef();\n    _this.editingFrameIndex = -1;\n    _this.bodyFrameRect = new fabric.Rect({\n      left: 10,\n      top: 10,\n      width: 180,\n      height: 180,\n      fill: \"#77777777\"\n    });\n\n    _this.bodyFrameRect.setControlVisible(\"mtr\", false);\n\n    _this.isUploading = false;\n    return _this;\n  }\n\n  _createClass(CustomSprite, [{\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      this.initCanvas();\n    }\n  }, {\n    key: \"initCanvas\",\n    value: function initCanvas() {\n      this.frameCanvas = new fabric.Canvas(\"frameCanvas\");\n      this.frameCanvas.setWidth(this.state.frameWidth);\n      this.frameCanvas.setHeight(this.state.frameHeight);\n      this.frameCanvas.setDimensions({\n        width: \"100%\",\n        height: \"100%\"\n      }, {\n        cssOnly: true\n      });\n      this.frameCanvas.on(\"object:modified\", this.onChangeCanvas);\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _this$state6 = this.state,\n          defaultName = _this$state6.defaultName,\n          animationName = _this$state6.animationName,\n          frames = _this$state6.frames,\n          frameWidth = _this$state6.frameWidth,\n          frameHeight = _this$state6.frameHeight,\n          frameRate = _this$state6.frameRate,\n          selectedFrameIndex = _this$state6.selectedFrameIndex,\n          isGuideOpen = _this$state6.isGuideOpen,\n          isEditingBodySize = _this$state6.isEditingBodySize,\n          currentStep = _this$state6.currentStep,\n          isLoop = _this$state6.isLoop,\n          isPlaying = _this$state6.isPlaying,\n          isDefaultNameValid = _this$state6.isDefaultNameValid,\n          isAnimationNameValid = _this$state6.isAnimationNameValid;\n      var animationRef = this.animationRef,\n          inputFileRef = this.inputFileRef,\n          onClickLoopAnimation = this.onClickLoopAnimation,\n          onClickToggleAnimation = this.onClickToggleAnimation,\n          onChangeFrameSize = this.onChangeFrameSize,\n          onChangeDefaultName = this.onChangeDefaultName,\n          onChangeAnimationName = this.onChangeAnimationName,\n          onChangeFrameRate = this.onChangeFrameRate,\n          onChangeFile = this.onChangeFile,\n          onClickFrame = this.onClickFrame,\n          onClickEditBodySize = this.onClickEditBodySize,\n          onClickAddFrame = this.onClickAddFrame,\n          onClickDeleteFrame = this.onClickDeleteFrame,\n          onClickEditFrame = this.onClickEditFrame,\n          onClickGuide = this.onClickGuide,\n          onSubmit = this.onSubmit,\n          onClickPrev = this.onClickPrev,\n          onClickNext = this.onClickNext,\n          onStopAnimation = this.onStopAnimation;\n      return React.createElement(View, {\n        animationRef: animationRef,\n        inputFileRef: inputFileRef,\n        defaultName: defaultName,\n        animationName: animationName,\n        frames: frames,\n        frameWidth: frameWidth,\n        frameHeight: frameHeight,\n        frameRate: frameRate,\n        selectedFrameIndex: selectedFrameIndex,\n        currentStep: currentStep,\n        isLoop: isLoop,\n        isPlaying: isPlaying,\n        isGuideOpen: currentStep === 1 && isGuideOpen,\n        isEditingBodySize: isEditingBodySize,\n        isDefaultNameValid: isDefaultNameValid,\n        isAnimationNameValid: isAnimationNameValid,\n        onClickLoopAnimation: onClickLoopAnimation,\n        onClickToggleAnimation: onClickToggleAnimation,\n        onChangeFrameSize: onChangeFrameSize,\n        onChangeDefaultName: onChangeDefaultName,\n        onChangeAnimationName: onChangeAnimationName,\n        onChangeFrameRate: onChangeFrameRate,\n        onChangeFile: onChangeFile,\n        onClickFrame: onClickFrame,\n        onClickEditBodySize: onClickEditBodySize,\n        onClickAddFrame: onClickAddFrame,\n        onClickDeleteFrame: onClickDeleteFrame,\n        onClickEditFrame: onClickEditFrame,\n        onClickGuide: onClickGuide,\n        onSubmit: onSubmit,\n        onClickPrev: onClickPrev,\n        onClickNext: onClickNext,\n        onStopAnimation: onStopAnimation,\n        dismiss: this.props.dismiss,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 462\n        },\n        __self: this\n      });\n    }\n  }]);\n\n  return CustomSprite;\n}(React.Component);\n\nexport default connect(function (state) {\n  return {\n    selectedSceneId: state.interaction.selected.scene\n  };\n}, {\n  addSprites: sceneActions.addSprites\n})(CustomSprite);","map":{"version":3,"sources":["/Users/jimmy/Documents/Wizschool/wizlab_web2/src/Page/Builder/Component/SpriteBox/Component/CustomSprite/index.js"],"names":["React","connect","fabric","mergeImages","compress","toBlob","sceneActions","AssetLibrary","SpriteType","URL","request","View","CustomSprite","props","drawCanvas","dataURL","callback","Image","fromURL","img","frameCanvas","clear","add","renderAll","frame","thumb","toDataURL","data","toDatalessJSON","addFrame","setState","frames","state","selectedFrameIndex","length","changeFrame","index","map","_frame","_index","resetActions","endEditingBodySize","stopAnimation","isPlaying","redrawThumbs","_frames","redraw","loadFromJSON","push","startEditingBodySize","isEditingBodySize","discardActiveObject","getObjects","forEach","obj","selectable","bodyFrameRect","setActiveObject","remove","onChangeCanvas","e","i","playAnimation","animationRef","current","start","isLoop","stop","onClickToggleAnimation","onClickLoopAnimation","onChangeFrameSize","target","name","value","Number","setWidth","frameWidth","setHeight","frameHeight","checkIsValid","regex","test","onChangeDefaultName","substr","defaultName","isDefaultNameValid","onChangeAnimationName","animationName","isAnimationNameValid","onChangeFrameRate","frameRate","onChangeFile","file","files","fr","FileReader","onload","editingFrameIndex","result","readAsDataURL","type","onClickFrame","onClickEditBodySize","onClickAddFrame","inputFileRef","click","onClickDeleteFrame","filter","onClickEditFrame","onSubmit","selectedSceneId","isValidate","checkValidate","isUploading","uploadFirstFrame","firstFrameUrl","uploadSpriteSheet","spriteSheetUrl","asset","createAsset","addAsset","sprite","assetId","countUpSameName","addSprites","dismiss","console","error","blob","uploadImage","images","compressedBlob","FormData","append","uploadAsset","res","json","url","replace","ASSET_BASE_URL","CUSTOM","spriteSize","JSON","stringify","bodySize","width","scaleX","height","scaleY","left","top","spriteAnimations","indexes","Array","_i","path","spritePath","onClickGuide","isGuideOpen","onClickPrev","currentStep","onClickNext","onStopAnimation","undefined","createRef","Rect","fill","setControlVisible","initCanvas","Canvas","setDimensions","cssOnly","on","Component","interaction","selected","scene"],"mappings":";;;;;;;;;;AAAA,OAAOA,KAAP,MAAkB,OAAlB;AACA,SAASC,OAAT,QAAwB,aAAxB;AACA,SAASC,MAAT,QAAuB,QAAvB;AACA,SAASC,WAAT,EAAsBC,QAAtB,EAAgCC,MAAhC,QAA8C,aAA9C;AACA,OAAO,KAAKC,YAAZ,MAA8B,iCAA9B;AACA,OAAOC,YAAP,MAAyB,gCAAzB;AACA,SAASC,UAAT,EAAqBC,GAArB,QAAgC,wCAAhC;AACA,OAAO,KAAKC,OAAZ,MAAyB,2CAAzB;AACA,OAAOC,IAAP,MAAiB,QAAjB;;IAEMC,Y;;;;;AACJ,wBAAYC,KAAZ,EAAmB;AAAA;;AAAA;;AACjB,sFAAMA,KAAN;;AADiB,UA6CnBC,UA7CmB,GA6CN,UAACC,OAAD,EAAUC,QAAV,EAAuB;AAClCd,MAAAA,MAAM,CAACe,KAAP,CAAaC,OAAb,CAAqBH,OAArB,EAA8B,UAAAI,GAAG,EAAI;AACnC,cAAKC,WAAL,CAAiBC,KAAjB;;AACA,cAAKD,WAAL,CAAiBE,GAAjB,CAAqBH,GAArB;;AACA,cAAKC,WAAL,CAAiBG,SAAjB;;AAEA,YAAMC,KAAK,GAAG;AACZC,UAAAA,KAAK,EAAE,MAAKL,WAAL,CAAiBM,SAAjB,CAA2B,WAA3B,CADK;AAEZC,UAAAA,IAAI,EAAE,MAAKP,WAAL,CAAiBQ,cAAjB;AAFM,SAAd;AAIAZ,QAAAA,QAAQ,CAACQ,KAAD,CAAR;AACD,OAVD;AAWD,KAzDkB;;AAAA,UA2DnBK,QA3DmB,GA2DR,UAAAd,OAAO,EAAI;AACpB,YAAKD,UAAL,CAAgBC,OAAhB,EAAyB,UAAAS,KAAK,EAAE;AAC9B,cAAKM,QAAL,CAAc;AACZC,UAAAA,MAAM,+BAAM,MAAKC,KAAL,CAAWD,MAAjB,IAAyBP,KAAzB,EADM;AAEZS,UAAAA,kBAAkB,EAAE,MAAKD,KAAL,CAAWD,MAAX,CAAkBG;AAF1B,SAAd;AAID,OALD;AAMD,KAlEkB;;AAAA,UAoEnBC,WApEmB,GAoEL,UAACC,KAAD,EAAQrB,OAAR,EAAoB;AAChC,YAAKD,UAAL,CAAgBC,OAAhB,EAAyB,UAAAS,KAAK,EAAE;AAC9B,cAAKM,QAAL,CAAc;AACZC,UAAAA,MAAM,EAAE,MAAKC,KAAL,CAAWD,MAAX,CAAkBM,GAAlB,CAAsB,UAACC,MAAD,EAAQC,MAAR,EAAiB;AAC7C,gBAAIA,MAAM,KAAGH,KAAb,EAAoB;AAClB,qBAAOZ,KAAP;AACD,aAFD,MAEO;AACL,qBAAOc,MAAP;AACD;AACF,WANO;AADI,SAAd;AASD,OAVD;AAWD,KAhFkB;;AAAA,UAkFnBE,YAlFmB,GAkFJ,YAAM;AACnB,YAAKC,kBAAL;;AACA,YAAKC,aAAL;;AACA,YAAKZ,QAAL,CAAc;AAACa,QAAAA,SAAS,EAAE;AAAZ,OAAd;AACD,KAtFkB;;AAAA,UAwFnBC,YAxFmB,GAwFJ,YAAM;AAAA,UACXb,MADW,GACA,MAAKC,KADL,CACXD,MADW;AAEnB,UAAIc,OAAO,GAAG,EAAd;;AAEA,UAAMC,MAAM,GAAG,SAATA,MAAS,CAAAV,KAAK,EAAI;AACtB,YAAMZ,KAAK,GAAGO,MAAM,CAACK,KAAD,CAApB;;AACA,cAAKhB,WAAL,CAAiB2B,YAAjB,CAA8BvB,KAAK,CAACG,IAApC,EAAyC,YAAI;AAC3CkB,UAAAA,OAAO,CAACG,IAAR,CAAa;AACXvB,YAAAA,KAAK,EAAE,MAAKL,WAAL,CAAiBM,SAAjB,CAA2B,WAA3B,CADI;AAEXC,YAAAA,IAAI,EAAE,MAAKP,WAAL,CAAiBQ,cAAjB;AAFK,WAAb;;AAKA,cAAGG,MAAM,CAACG,MAAP,GAAgBE,KAAK,GAAC,CAAzB,EAA2B;AACzBU,YAAAA,MAAM,CAACV,KAAK,GAAG,CAAT,CAAN;AACD,WAFD,MAEM;AACJ,kBAAKN,QAAL,CAAc;AAACC,cAAAA,MAAM,EAAEc;AAAT,aAAd;AACD;AACF,SAXD;AAYD,OAdD;;AAgBA,UAAGd,MAAM,CAACG,MAAP,GAAc,CAAjB,EAAoBY,MAAM,CAAC,CAAD,CAAN;AACrB,KA7GkB;;AAAA,UA+GnBG,oBA/GmB,GA+GI,YAAM;AAC3B,YAAKnB,QAAL,CAAc;AAACoB,QAAAA,iBAAiB,EAAE;AAApB,OAAd;;AACA,YAAK9B,WAAL,CAAiB+B,mBAAjB;;AACA,YAAK/B,WAAL,CAAiBgC,UAAjB,GAA8BC,OAA9B,CAAsC,UAAAC,GAAG;AAAA,eAAGA,GAAG,CAACC,UAAJ,GAAiB,KAApB;AAAA,OAAzC;;AACA,YAAKnC,WAAL,CAAiBE,GAAjB,CAAqB,MAAKkC,aAA1B;;AACA,YAAKpC,WAAL,CAAiBG,SAAjB;;AACA,YAAKH,WAAL,CAAiBqC,eAAjB,CAAiC,MAAKD,aAAtC;AACD,KAtHkB;;AAAA,UAwHnBf,kBAxHmB,GAwHE,YAAM;AACzB,YAAKX,QAAL,CAAc;AAACoB,QAAAA,iBAAiB,EAAE;AAApB,OAAd;;AACA,YAAK9B,WAAL,CAAiBgC,UAAjB,GAA8BC,OAA9B,CAAsC,UAAAC,GAAG;AAAA,eAAGA,GAAG,CAACC,UAAJ,GAAiB,IAApB;AAAA,OAAzC;;AACA,YAAKnC,WAAL,CAAiBsC,MAAjB,CAAwB,MAAKF,aAA7B;AACD,KA5HkB;;AAAA,UA8HnBG,cA9HmB,GA8HF,UAAAC,CAAC,EAAI;AAAA,UACZV,iBADY,GACU,MAAKlB,KADf,CACZkB,iBADY;;AAEpB,UAAGA,iBAAH,EAAqB;AACnB;AACD;;AAJmB,wBAMmB,MAAKlB,KANxB;AAAA,UAMZD,MANY,eAMZA,MANY;AAAA,UAMJE,kBANI,eAMJA,kBANI;;AAOpB,YAAKH,QAAL,CAAc;AACZC,QAAAA,MAAM,EAAEA,MAAM,CAACM,GAAP,CAAW,UAACb,KAAD,EAAOqC,CAAP,EAAW;AAC5B,cAAG5B,kBAAkB,KAAK4B,CAA1B,EAA6B;AAC3BrC,YAAAA,KAAK,CAACC,KAAN,GAAc,MAAKL,WAAL,CAAiBM,SAAjB,CAA2B,WAA3B,CAAd;AACAF,YAAAA,KAAK,CAACG,IAAN,GAAa,MAAKP,WAAL,CAAiBQ,cAAjB,EAAb;AACD;;AACD,iBAAOJ,KAAP;AACD,SANO;AADI,OAAd;AASD,KA9IkB;;AAAA,UAgJnBsC,aAhJmB,GAgJH,YAAM;AACpB,YAAKC,YAAL,CAAkBC,OAAlB,CAA0BC,KAA1B,CAAgC,MAAKjC,KAAL,CAAWkC,MAA3C;AACD,KAlJkB;;AAAA,UAoJnBxB,aApJmB,GAoJH,YAAM;AACpB,YAAKqB,YAAL,CAAkBC,OAAlB,CAA0BG,IAA1B;AACD,KAtJkB;;AAAA,UAwJnBC,sBAxJmB,GAwJM,YAAM;AAC7B,YAAK5B,YAAL;;AAD6B,UAErBG,SAFqB,GAEP,MAAKX,KAFE,CAErBW,SAFqB;;AAG7B,YAAKb,QAAL,CAAc;AAAEa,QAAAA,SAAS,EAAE,CAACA;AAAd,OAAd,EAAwC,YAAM;AAC5C,YAAGA,SAAH,EAAc;AACZ,gBAAKD,aAAL;AACD,SAFD,MAEK;AACH,gBAAKoB,aAAL;AACD;AACF,OAND;AAOD,KAlKkB;;AAAA,UAoKnBO,oBApKmB,GAoKI,YAAM;AAC3B,YAAK7B,YAAL;;AAD2B,UAEnB0B,MAFmB,GAER,MAAKlC,KAFG,CAEnBkC,MAFmB;;AAG3B,YAAKpC,QAAL,CAAc;AAAEoC,QAAAA,MAAM,EAAE,CAACA;AAAX,OAAd;AACD,KAxKkB;;AAAA,UA0KnBI,iBA1KmB,GA0KC,UAAAV,CAAC,EAAI;AACvB,YAAKpB,YAAL;;AADuB,sBAEDoB,CAAC,CAACW,MAFD;AAAA,UAEjBC,IAFiB,aAEjBA,IAFiB;AAAA,UAEXC,KAFW,aAEXA,KAFW;;AAGvB,UAAGC,MAAM,CAACD,KAAD,CAAN,GAAgB,GAAnB,EAAuB;AACrBA,QAAAA,KAAK,GAAG,GAAR;AACD;;AACD,YAAK3C,QAAL,qBAAiB0C,IAAjB,EAAwBE,MAAM,CAACD,KAAD,CAA9B,GAAwC,YAAI;AAC1C,YAAGD,IAAI,KAAK,YAAZ,EAAyB;AACvB,gBAAKpD,WAAL,CAAiBuD,QAAjB,CAA0B,MAAK3C,KAAL,CAAW4C,UAArC;AACD,SAFD,MAEM,IAAGJ,IAAI,KAAK,aAAZ,EAA0B;AAC9B,gBAAKpD,WAAL,CAAiByD,SAAjB,CAA2B,MAAK7C,KAAL,CAAW8C,WAAtC;AACD;;AACD,cAAKlC,YAAL;AACD,OAPD;AAQD,KAxLkB;;AAAA,UA0LnBmC,YA1LmB,GA0LJ,UAAAP,IAAI,EAAI;AACrB,UAAMQ,KAAK,GAAG,yBAAd;AACA,aAAOA,KAAK,CAACC,IAAN,CAAWT,IAAX,CAAP;AACD,KA7LkB;;AAAA,UA+LnBU,mBA/LmB,GA+LG,UAAAtB,CAAC,EAAI;AACzB,UAAIa,KAAK,GAAGb,CAAC,CAACW,MAAF,CAASE,KAArB;AACA,UAAGA,KAAK,CAACvC,MAAN,GAAe,EAAlB,EAAsBuC,KAAK,GAAGA,KAAK,CAACU,MAAN,CAAa,CAAb,EAAgB,EAAhB,CAAR;;AACtB,YAAKrD,QAAL,CAAc;AAAEsD,QAAAA,WAAW,EAAEX,KAAf;AAAsBY,QAAAA,kBAAkB,EAAE,MAAKN,YAAL,CAAkBN,KAAlB;AAA1C,OAAd;AACD,KAnMkB;;AAAA,UAqMnBa,qBArMmB,GAqMK,UAAA1B,CAAC,EAAI;AAC3B,UAAIa,KAAK,GAAGb,CAAC,CAACW,MAAF,CAASE,KAArB;AACA,UAAGA,KAAK,CAACvC,MAAN,GAAe,EAAlB,EAAsBuC,KAAK,GAAGA,KAAK,CAACU,MAAN,CAAa,CAAb,EAAgB,EAAhB,CAAR;;AACtB,YAAKrD,QAAL,CAAc;AAAEyD,QAAAA,aAAa,EAAEd,KAAjB;AAAwBe,QAAAA,oBAAoB,EAAE,MAAKT,YAAL,CAAkBN,KAAlB;AAA9C,OAAd;AACD,KAzMkB;;AAAA,UA2MnBgB,iBA3MmB,GA2MC,UAAA7B,CAAC,EAAI;AACvB,UAAM8B,SAAS,GAAGhB,MAAM,CAACd,CAAC,CAACW,MAAF,CAASE,KAAV,CAAxB;;AACA,UAAGiB,SAAS,KAAK,MAAK1D,KAAL,CAAW0D,SAA5B,EAAsC;AACpC,cAAKlD,YAAL;;AACA,cAAKV,QAAL,CAAc;AAAE4D,UAAAA,SAAS,EAATA;AAAF,SAAd;AACD;AACF,KAjNkB;;AAAA,UAmNnBC,YAnNmB,GAmNJ,UAAA/B,CAAC,EAAI;AAClB,UAAMgC,IAAI,GAAGhC,CAAC,CAACW,MAAF,CAASsB,KAAT,CAAe,CAAf,CAAb;;AACA,UAAG,CAACD,IAAJ,EAAU;AACR;AACD;;AAED,UAAME,EAAE,GAAG,IAAIC,UAAJ,EAAX;;AACAD,MAAAA,EAAE,CAACE,MAAH,GAAY,YAAM;AAChB,YAAG,MAAKC,iBAAL,KAA2B,CAAC,CAA/B,EAAkC;AAChC,gBAAKpE,QAAL,CAAciE,EAAE,CAACI,MAAjB;AACD,SAFD,MAEM;AACJ,gBAAK/D,WAAL,CAAiB,MAAK8D,iBAAtB,EAAyCH,EAAE,CAACI,MAA5C;;AACA,gBAAKD,iBAAL,GAAyB,CAAC,CAA1B;AACD;AACF,OAPD;;AAQAH,MAAAA,EAAE,CAACK,aAAH,CAAiBP,IAAjB,EAfkB,CAiBlB;;AACAhC,MAAAA,CAAC,CAACW,MAAF,CAAS6B,IAAT,GAAgB,EAAhB;AACAxC,MAAAA,CAAC,CAACW,MAAF,CAAS6B,IAAT,GAAgB,MAAhB;AACD,KAvOkB;;AAAA,UAyOnBC,YAzOmB,GAyOJ,UAAAjE,KAAK,EAAI;AACtB,YAAKI,YAAL;;AADsB,UAEdT,MAFc,GAEH,MAAKC,KAFF,CAEdD,MAFc;;AAGtB,UAAG,CAACA,MAAM,CAACK,KAAD,CAAV,EAAmB;AACjB,cAAKhB,WAAL,CAAiBC,KAAjB;;AACA;AACD;;AACD,YAAKD,WAAL,CAAiB2B,YAAjB,CAA8BhB,MAAM,CAACK,KAAD,CAAN,CAAcT,IAA5C;;AACA,YAAKG,QAAL,CAAc;AAAEG,QAAAA,kBAAkB,EAAEG;AAAtB,OAAd;AACD,KAlPkB;;AAAA,UAoPnBkE,mBApPmB,GAoPG,YAAM;AAC1B,YAAKvC,YAAL,CAAkBC,OAAlB,CAA0BG,IAA1B;;AAD0B,UAElBjB,iBAFkB,GAEI,MAAKlB,KAFT,CAElBkB,iBAFkB;;AAG1B,UAAGA,iBAAH,EAAsB;AACpB,cAAKT,kBAAL;AACD,OAFD,MAEO;AACL,cAAKQ,oBAAL;AACD;AACF,KA5PkB;;AAAA,UA8PnBsD,eA9PmB,GA8PD,YAAM;AACtB,YAAK/D,YAAL;;AACA,YAAKgE,YAAL,CAAkBxC,OAAlB,CAA0ByC,KAA1B;AACD,KAjQkB;;AAAA,UAmQnBC,kBAnQmB,GAmQE,UAAAtE,KAAK,EAAI;AAC5B,YAAKI,YAAL;;AAD4B,UAEpBT,MAFoB,GAET,MAAKC,KAFI,CAEpBD,MAFoB;;AAG5B,YAAKD,QAAL,CAAc;AACZC,QAAAA,MAAM,EAAEA,MAAM,CAAC4E,MAAP,CAAc,UAACnF,KAAD,EAAOqC,CAAP;AAAA,iBAAaA,CAAC,KAAGzB,KAAjB;AAAA,SAAd;AADI,OAAd,EAEE;AAAA,eAAM,MAAKiE,YAAL,CAAkB,CAAlB,CAAN;AAAA,OAFF;AAGD,KAzQkB;;AAAA,UA2QnBO,gBA3QmB,GA2QA,UAAAxE,KAAK,EAAI;AAC1B,YAAKI,YAAL;;AACA,YAAKyD,iBAAL,GAAyB7D,KAAzB;;AACA,YAAKiE,YAAL,CAAkBjE,KAAlB;;AACA,YAAKoE,YAAL,CAAkBxC,OAAlB,CAA0ByC,KAA1B;AACD,KAhRkB;;AAAA,UAkRnBI,QAlRmB;AAAA;AAAA;AAAA;AAAA,6BAkRR;AAAA;;AAAA;AAAA;AAAA;AAAA;AACT,oBAAKrE,YAAL;;AADS,6BAE8B,MAAKR,KAFnC,EAEDoD,WAFC,gBAEDA,WAFC,EAEYG,aAFZ,gBAEYA,aAFZ;AAGDuB,cAAAA,eAHC,GAGmB,MAAKjG,KAHxB,CAGDiG,eAHC;AAIHC,cAAAA,UAJG,GAIU,MAAKC,aAAL,EAJV;;AAAA,kBAMLD,UANK;AAAA;AAAA;AAAA;;AAAA;;AAAA;AAAA,mBAUN,MAAKE,WAVC;AAAA;AAAA;AAAA;;AAAA;;AAAA;AAAA;AAcP,oBAAKA,WAAL,GAAmB,IAAnB,CAdO,CAeP;;AAfO;AAAA,qBAgBqB,MAAKC,gBAAL,EAhBrB;;AAAA;AAgBDC,cAAAA,aAhBC;AAAA;AAAA,qBAiBsB,MAAKC,iBAAL,EAjBtB;;AAAA;AAiBDC,cAAAA,cAjBC;AAkBDC,cAAAA,KAlBC,GAkBO,MAAKC,WAAL,CAAiBJ,aAAjB,EAAgCE,cAAhC,EAAgDjC,WAAhD,EAA6DG,aAA7D,CAlBP;AAAA;AAAA,qBAmBD7E,OAAO,CAAC8G,QAAR,CAAiBF,KAAjB,CAnBC;;AAAA;AAqBP;AACA/G,cAAAA,YAAY,CAACiH,QAAb,CAAsBF,KAAtB,EAtBO,CAwBP;;AACMG,cAAAA,MAzBC,GAyBQ;AACbC,gBAAAA,OAAO,EAAEJ,KAAK,CAACI,OADF;AAEbtB,gBAAAA,IAAI,EAAEkB,KAAK,CAAClB,IAFC;AAGb5B,gBAAAA,IAAI,EAAE,MAAK3D,KAAL,CAAW8G,eAAX,CAA2BvC,WAA3B;AAHO,eAzBR;;AA8BP,oBAAKvE,KAAL,CAAW+G,UAAX,CAAsBd,eAAtB,EAAuC,CAACW,MAAD,CAAvC;;AACA,oBAAK5G,KAAL,CAAWgH,OAAX;;AA/BO;AAAA;;AAAA;AAAA;AAAA;AAiCP,oBAAKZ,WAAL,GAAmB,KAAnB;AACAa,cAAAA,OAAO,CAACC,KAAR;;AAlCO;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KAlRQ;;AAAA,UAwTnBf,aAxTmB,GAwTH,YAAM;AAAA,yBAC2B,MAAKhF,KADhC;AAAA,UACZD,MADY,gBACZA,MADY;AAAA,UACJqD,WADI,gBACJA,WADI;AAAA,UACSG,aADT,gBACSA,aADT;;AAEpB,UAAGxD,MAAM,CAACG,MAAP,KAAkB,CAArB,EAAwB;AACtB,eAAO,KAAP;AACD;;AACD,UAAG,CAACkD,WAAD,IAAgBA,WAAW,CAAClD,MAAZ,GAAqB,CAAxC,EAA2C;AACzC,eAAO,KAAP;AACD;;AACD,UAAG,CAACqD,aAAD,IAAkBA,aAAa,CAACrD,MAAd,GAAuB,CAA5C,EAA+C;AAC7C,eAAO,KAAP;AACD;;AACD,aAAO,IAAP;AACD,KApUkB;;AAAA,UAsUnBgF,gBAtUmB;AAAA;AAAA;AAAA;AAAA,6BAsUA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAEPnF,cAAAA,MAFO,GAEI,MAAKC,KAFT,CAEPD,MAFO;AAGTiG,cAAAA,IAHS,GAGF3H,MAAM,CAAC0B,MAAM,CAAC,CAAD,CAAN,CAAUN,KAAX,CAHJ;AAAA;AAAA,qBAIF,MAAKwG,WAAL,CAAiBD,IAAjB,CAJE;;AAAA;AAAA;;AAAA;AAAA;AAAA;AAMfF,cAAAA,OAAO,CAACC,KAAR;;AANe;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KAtUA;AAAA,UAgVnBX,iBAhVmB;AAAA;AAAA;AAAA;AAAA,6BAgVC;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,6BAE4B,MAAKpF,KAFjC,EAER4C,UAFQ,gBAERA,UAFQ,EAEIE,WAFJ,gBAEIA,WAFJ,EAEiB/C,MAFjB,gBAEiBA,MAFjB;AAGVmG,cAAAA,MAHU,GAGDnG,MAAM,CAACM,GAAP,CAAW,UAAAb,KAAK;AAAA,uBAAIA,KAAK,CAACC,KAAV;AAAA,eAAhB,CAHC;AAAA;AAAA,qBAIGtB,WAAW,CAAC+H,MAAD,EAAStD,UAAT,EAAqBE,WAArB,CAJd;;AAAA;AAIVkD,cAAAA,IAJU;AAAA;AAAA,qBAKH,MAAKC,WAAL,CAAiBD,IAAjB,CALG;;AAAA;AAAA;;AAAA;AAAA;AAAA;AAOhBF,cAAAA,OAAO,CAACC,KAAR;;AAPgB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KAhVD;;AAAA,UA2VnBE,WA3VmB;AAAA;AAAA;AAAA;AAAA;AAAA,+BA2VL,kBAAMD,IAAN;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,uBAEmB5H,QAAQ,CAAC4H,IAAD,CAF3B;;AAAA;AAEJG,gBAAAA,cAFI;AAGJxG,gBAAAA,IAHI,GAGG,IAAIyG,QAAJ,EAHH;AAIVzG,gBAAAA,IAAI,CAAC0G,MAAL,CAAY,MAAZ,EAAoBF,cAApB;AAJU;AAAA,uBAMMzH,OAAO,CAAC4H,WAAR,CAAoB3G,IAApB,CANN;;AAAA;AAMN4G,gBAAAA,GANM;AAAA;AAAA,uBAOOA,GAAG,CAACC,IAAJ,EAPP;;AAAA;AAONA,gBAAAA,IAPM;AAAA,kDAQHA,IAAI,CAACC,GAAL,CAASC,OAAT,CAAiBjI,GAAG,CAACkI,cAArB,EAAqC,EAArC,CARG;;AAAA;AAAA;AAAA;AAUVb,gBAAAA,OAAO,CAACC,KAAR;;AAVU;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,OA3VK;;AAAA;AAAA;AAAA;AAAA;;AAAA,UAyWnBR,WAzWmB,GAyWL,UAACJ,aAAD,EAAgBE,cAAhB,EAAgCjC,WAAhC,EAA6CG,aAA7C,EAA+D;AAAA,yBACpB,MAAKvD,KADe;AAAA,UACnE4C,UADmE,gBACnEA,UADmE;AAAA,UACvDE,WADuD,gBACvDA,WADuD;AAAA,UAC1CY,SAD0C,gBAC1CA,SAD0C;AAAA,UAC/B3D,MAD+B,gBAC/BA,MAD+B;AAE3E,UAAM2F,OAAO,GAAGP,aAAa,CAACuB,OAAd,CAAsB,UAAtB,EAAiC,EAAjC,EAAqCA,OAArC,CAA6C,MAA7C,EAAoD,EAApD,CAAhB;AACA,UAAMtC,IAAI,GAAG5F,UAAU,CAACoI,MAAxB;AACA,UAAMC,UAAU,GAAGC,IAAI,CAACC,SAAL,CAAe,CAACnE,UAAD,EAAaE,WAAb,CAAf,CAAnB;AACA,UAAMkE,QAAQ,GAAGF,IAAI,CAACC,SAAL,CAAe,CAC9B,MAAKvF,aAAL,CAAmByF,KAAnB,GAA2B,MAAKzF,aAAL,CAAmB0F,MADhB,EAE9B,MAAK1F,aAAL,CAAmB2F,MAAnB,GAA4B,MAAK3F,aAAL,CAAmB4F,MAFjB,EAG9B,MAAK5F,aAAL,CAAmB6F,IAHW,EAI9B,MAAK7F,aAAL,CAAmB8F,GAJW,CAAf,CAAjB;AAMA,UAAMC,gBAAgB,GAAGT,IAAI,CAACC,SAAL,qBACtBxD,aADsB,EACN;AACfG,QAAAA,SAAS,EAAEA,SADI;AAEf8D,QAAAA,OAAO,EAAE,mBAAI,IAAIC,KAAJ,CAAU1H,MAAM,CAACG,MAAjB,CAAJ,EAA8BG,GAA9B,CAAkC,UAACqH,EAAD,EAAI7F,CAAJ;AAAA,iBAASA,CAAT;AAAA,SAAlC;AAFM,OADM,EAAzB;AAOA,aAAO;AACL6D,QAAAA,OAAO,EAAPA,OADK;AAELtB,QAAAA,IAAI,EAAJA,IAFK;AAGLhB,QAAAA,WAAW,EAAXA,WAHK;AAILuE,QAAAA,IAAI,EAAExC,aAJD;AAKL1F,QAAAA,KAAK,EAAE0F,aALF;AAMLyC,QAAAA,UAAU,EAAEvC,cANP;AAOLwB,QAAAA,UAAU,EAAVA,UAPK;AAQLG,QAAAA,QAAQ,EAARA,QARK;AASLO,QAAAA,gBAAgB,EAAhBA;AATK,OAAP;AAWD,KAtYkB;;AAAA,UAwYnBM,YAxYmB,GAwYJ,YAAM;AACnB,YAAK/H,QAAL,CAAc;AAACgI,QAAAA,WAAW,EAAE,CAAC,MAAK9H,KAAL,CAAW8H;AAA1B,OAAd;AACD,KA1YkB;;AAAA,UA4YnBC,WA5YmB,GA4YL,YAAM;AAClB,YAAKjI,QAAL,CAAc;AAACkI,QAAAA,WAAW,EAAE;AAAd,OAAd;AACD,KA9YkB;;AAAA,UAgZnBC,WAhZmB,GAgZL,YAAM;AAClB,UAAG,MAAKjI,KAAL,CAAWD,MAAX,CAAkBG,MAAlB,GAA2B,CAA9B,EAAiC;AAC/B,cAAKJ,QAAL,CAAc;AAACkI,UAAAA,WAAW,EAAE;AAAd,SAAd;AACD;AACF,KApZkB;;AAAA,UAsZnBE,eAtZmB,GAsZD,YAAM;AACtB,YAAKpI,QAAL,CAAc;AAAEa,QAAAA,SAAS,EAAE;AAAb,OAAd;AACD,KAxZkB;;AAEjB,UAAKX,KAAL,GAAW;AACToD,MAAAA,WAAW,EAAE,QADJ;AAETG,MAAAA,aAAa,EAAE,MAFN;AAGTxD,MAAAA,MAAM,EAAE,EAHC;AAIT2D,MAAAA,SAAS,EAAE,CAJF;AAKTd,MAAAA,UAAU,EAAE,GALH;AAMTE,MAAAA,WAAW,EAAE,GANJ;AAOT7C,MAAAA,kBAAkB,EAAE,CAPX;AAQTiB,MAAAA,iBAAiB,EAAE,KARV;AAST4G,MAAAA,WAAW,EAAE,KATJ;AAUTE,MAAAA,WAAW,EAAE,CAVJ;AAWT9F,MAAAA,MAAM,EAAE,IAXC;AAYTvB,MAAAA,SAAS,EAAE,KAZF;AAaT0C,MAAAA,kBAAkB,EAAE,IAbX;AAcTG,MAAAA,oBAAoB,EAAE;AAdb,KAAX;AAgBA,UAAKpE,WAAL,GAAmB+I,SAAnB;AACA,UAAKpG,YAAL,GAAoB/D,KAAK,CAACoK,SAAN,EAApB;AACA,UAAK5D,YAAL,GAAoBxG,KAAK,CAACoK,SAAN,EAApB;AACA,UAAKnE,iBAAL,GAAyB,CAAC,CAA1B;AACA,UAAKzC,aAAL,GAAqB,IAAItD,MAAM,CAACmK,IAAX,CAAgB;AACnChB,MAAAA,IAAI,EAAE,EAD6B;AAEnCC,MAAAA,GAAG,EAAE,EAF8B;AAGnCL,MAAAA,KAAK,EAAE,GAH4B;AAInCE,MAAAA,MAAM,EAAE,GAJ2B;AAKnCmB,MAAAA,IAAI,EAAE;AAL6B,KAAhB,CAArB;;AAOA,UAAK9G,aAAL,CAAmB+G,iBAAnB,CAAqC,KAArC,EAA4C,KAA5C;;AACA,UAAKtD,WAAL,GAAmB,KAAnB;AA9BiB;AA+BlB;;;;wCAEmB;AAClB,WAAKuD,UAAL;AACD;;;iCAEY;AACX,WAAKpJ,WAAL,GAAmB,IAAIlB,MAAM,CAACuK,MAAX,CAAkB,aAAlB,CAAnB;AACA,WAAKrJ,WAAL,CAAiBuD,QAAjB,CAA0B,KAAK3C,KAAL,CAAW4C,UAArC;AACA,WAAKxD,WAAL,CAAiByD,SAAjB,CAA2B,KAAK7C,KAAL,CAAW8C,WAAtC;AACA,WAAK1D,WAAL,CAAiBsJ,aAAjB,CAAgC;AAAEzB,QAAAA,KAAK,EAAE,MAAT;AAAiBE,QAAAA,MAAM,EAAE;AAAzB,OAAhC,EAAmE;AAAEwB,QAAAA,OAAO,EAAE;AAAX,OAAnE;AACA,WAAKvJ,WAAL,CAAiBwJ,EAAjB,CAAoB,iBAApB,EAAuC,KAAKjH,cAA5C;AACD;;;6BA+WQ;AAAA,yBAgBH,KAAK3B,KAhBF;AAAA,UAELoD,WAFK,gBAELA,WAFK;AAAA,UAGLG,aAHK,gBAGLA,aAHK;AAAA,UAILxD,MAJK,gBAILA,MAJK;AAAA,UAKL6C,UALK,gBAKLA,UALK;AAAA,UAMLE,WANK,gBAMLA,WANK;AAAA,UAOLY,SAPK,gBAOLA,SAPK;AAAA,UAQLzD,kBARK,gBAQLA,kBARK;AAAA,UASL6H,WATK,gBASLA,WATK;AAAA,UAUL5G,iBAVK,gBAULA,iBAVK;AAAA,UAWL8G,WAXK,gBAWLA,WAXK;AAAA,UAYL9F,MAZK,gBAYLA,MAZK;AAAA,UAaLvB,SAbK,gBAaLA,SAbK;AAAA,UAcL0C,kBAdK,gBAcLA,kBAdK;AAAA,UAeLG,oBAfK,gBAeLA,oBAfK;AAAA,UAkBLzB,YAlBK,GAqCH,IArCG,CAkBLA,YAlBK;AAAA,UAmBLyC,YAnBK,GAqCH,IArCG,CAmBLA,YAnBK;AAAA,UAoBLnC,oBApBK,GAqCH,IArCG,CAoBLA,oBApBK;AAAA,UAqBLD,sBArBK,GAqCH,IArCG,CAqBLA,sBArBK;AAAA,UAsBLE,iBAtBK,GAqCH,IArCG,CAsBLA,iBAtBK;AAAA,UAuBLY,mBAvBK,GAqCH,IArCG,CAuBLA,mBAvBK;AAAA,UAwBLI,qBAxBK,GAqCH,IArCG,CAwBLA,qBAxBK;AAAA,UAyBLG,iBAzBK,GAqCH,IArCG,CAyBLA,iBAzBK;AAAA,UA0BLE,YA1BK,GAqCH,IArCG,CA0BLA,YA1BK;AAAA,UA2BLU,YA3BK,GAqCH,IArCG,CA2BLA,YA3BK;AAAA,UA4BLC,mBA5BK,GAqCH,IArCG,CA4BLA,mBA5BK;AAAA,UA6BLC,eA7BK,GAqCH,IArCG,CA6BLA,eA7BK;AAAA,UA8BLG,kBA9BK,GAqCH,IArCG,CA8BLA,kBA9BK;AAAA,UA+BLE,gBA/BK,GAqCH,IArCG,CA+BLA,gBA/BK;AAAA,UAgCLiD,YAhCK,GAqCH,IArCG,CAgCLA,YAhCK;AAAA,UAiCLhD,QAjCK,GAqCH,IArCG,CAiCLA,QAjCK;AAAA,UAkCLkD,WAlCK,GAqCH,IArCG,CAkCLA,WAlCK;AAAA,UAmCLE,WAnCK,GAqCH,IArCG,CAmCLA,WAnCK;AAAA,UAoCLC,eApCK,GAqCH,IArCG,CAoCLA,eApCK;AAuCP,aACE,oBAAC,IAAD;AACE,QAAA,YAAY,EAAEnG,YADhB;AAEE,QAAA,YAAY,EAAEyC,YAFhB;AAGE,QAAA,WAAW,EAAEpB,WAHf;AAIE,QAAA,aAAa,EAAEG,aAJjB;AAKE,QAAA,MAAM,EAAExD,MALV;AAME,QAAA,UAAU,EAAE6C,UANd;AAOE,QAAA,WAAW,EAAEE,WAPf;AAQE,QAAA,SAAS,EAAEY,SARb;AASE,QAAA,kBAAkB,EAAEzD,kBATtB;AAUE,QAAA,WAAW,EAAE+H,WAVf;AAWE,QAAA,MAAM,EAAE9F,MAXV;AAYE,QAAA,SAAS,EAAEvB,SAZb;AAaE,QAAA,WAAW,EAAEqH,WAAW,KAAK,CAAhB,IAAqBF,WAbpC;AAcE,QAAA,iBAAiB,EAAE5G,iBAdrB;AAeE,QAAA,kBAAkB,EAAEmC,kBAftB;AAgBE,QAAA,oBAAoB,EAAEG,oBAhBxB;AAiBE,QAAA,oBAAoB,EAAEnB,oBAjBxB;AAkBE,QAAA,sBAAsB,EAAED,sBAlB1B;AAmBE,QAAA,iBAAiB,EAAEE,iBAnBrB;AAoBE,QAAA,mBAAmB,EAAEY,mBApBvB;AAqBE,QAAA,qBAAqB,EAAEI,qBArBzB;AAsBE,QAAA,iBAAiB,EAAEG,iBAtBrB;AAuBE,QAAA,YAAY,EAAEE,YAvBhB;AAwBE,QAAA,YAAY,EAAEU,YAxBhB;AAyBE,QAAA,mBAAmB,EAAEC,mBAzBvB;AA0BE,QAAA,eAAe,EAAEC,eA1BnB;AA2BE,QAAA,kBAAkB,EAAEG,kBA3BtB;AA4BE,QAAA,gBAAgB,EAAEE,gBA5BpB;AA6BE,QAAA,YAAY,EAAEiD,YA7BhB;AA8BE,QAAA,QAAQ,EAAEhD,QA9BZ;AA+BE,QAAA,WAAW,EAAEkD,WA/Bf;AAgCE,QAAA,WAAW,EAAEE,WAhCf;AAiCE,QAAA,eAAe,EAAEC,eAjCnB;AAkCE,QAAA,OAAO,EAAE,KAAKrJ,KAAL,CAAWgH,OAlCtB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,QADF;AAsCD;;;;EAxewB7H,KAAK,CAAC6K,S;;AA2ejC,eAAe5K,OAAO,CACpB,UAAA+B,KAAK;AAAA,SAAK;AACR8E,IAAAA,eAAe,EAAE9E,KAAK,CAAC8I,WAAN,CAAkBC,QAAlB,CAA2BC;AADpC,GAAL;AAAA,CADe,EAIpB;AACEpD,EAAAA,UAAU,EAAEtH,YAAY,CAACsH;AAD3B,CAJoB,CAAP,CAObhH,YAPa,CAAf","sourcesContent":["import React from \"react\";\nimport { connect } from \"react-redux\";\nimport { fabric } from \"fabric\";\nimport { mergeImages, compress, toBlob } from \"./ImageUtil\";\nimport * as sceneActions from \"../../../../Store/Reducer/scene\";\nimport AssetLibrary from \"../../../../utils/assetLibrary\";\nimport { SpriteType, URL } from \"../../../../../../Common/Util/Constant\";\nimport * as request from \"../../../../../../Common/Util/HTTPRequest\";\nimport View from \"./View\";\n\nclass CustomSprite extends React.Component {\n  constructor(props) {\n    super(props);\n    this.state={\n      defaultName: \"custom\",\n      animationName: \"idle\",\n      frames: [],\n      frameRate: 5,\n      frameWidth: 200,\n      frameHeight: 200,\n      selectedFrameIndex: 0,\n      isEditingBodySize: false,\n      isGuideOpen: false,\n      currentStep: 1,\n      isLoop: true,\n      isPlaying: false,\n      isDefaultNameValid: true,\n      isAnimationNameValid: true\n    }\n    this.frameCanvas = undefined;\n    this.animationRef = React.createRef();\n    this.inputFileRef = React.createRef();\n    this.editingFrameIndex = -1;\n    this.bodyFrameRect = new fabric.Rect({\n      left: 10,\n      top: 10,\n      width: 180,\n      height: 180,\n      fill: \"#77777777\"\n    });\n    this.bodyFrameRect.setControlVisible(\"mtr\", false);\n    this.isUploading = false;\n  }\n\n  componentDidMount() {\n    this.initCanvas();\n  }\n\n  initCanvas() {\n    this.frameCanvas = new fabric.Canvas(\"frameCanvas\");\n    this.frameCanvas.setWidth(this.state.frameWidth);\n    this.frameCanvas.setHeight(this.state.frameHeight);\n    this.frameCanvas.setDimensions( { width: \"100%\", height: \"100%\" }, { cssOnly: true });\n    this.frameCanvas.on(\"object:modified\", this.onChangeCanvas);\n  }\n\n  drawCanvas = (dataURL, callback) => {\n    fabric.Image.fromURL(dataURL, img => {\n      this.frameCanvas.clear();\n      this.frameCanvas.add(img);\n      this.frameCanvas.renderAll();\n\n      const frame = {\n        thumb: this.frameCanvas.toDataURL(\"image/png\"),\n        data: this.frameCanvas.toDatalessJSON()\n      }\n      callback(frame);\n    });\n  }\n\n  addFrame = dataURL => {\n    this.drawCanvas(dataURL, frame=>{\n      this.setState({ \n        frames: [...this.state.frames, frame],\n        selectedFrameIndex: this.state.frames.length\n      });\n    });\n  }\n\n  changeFrame = (index, dataURL) => {\n    this.drawCanvas(dataURL, frame=>{\n      this.setState({ \n        frames: this.state.frames.map((_frame,_index)=>{\n          if (_index===index) {\n            return frame;\n          } else {\n            return _frame;\n          }\n        })\n      });\n    });\n  }\n\n  resetActions = () => {\n    this.endEditingBodySize();\n    this.stopAnimation();\n    this.setState({isPlaying: false});\n  }\n\n  redrawThumbs = () => {\n    const { frames } = this.state;\n    let _frames = [];\n    \n    const redraw = index => {\n      const frame = frames[index];\n      this.frameCanvas.loadFromJSON(frame.data,()=>{\n        _frames.push({\n          thumb: this.frameCanvas.toDataURL(\"image/png\"),\n          data: this.frameCanvas.toDatalessJSON()\n        });\n\n        if(frames.length > index+1){\n          redraw(index + 1);\n        }else {\n          this.setState({frames: _frames});\n        }\n      });\n    }\n\n    if(frames.length>0) redraw(0);\n  }\n\n  startEditingBodySize = () => {\n    this.setState({isEditingBodySize: true});\n    this.frameCanvas.discardActiveObject();\n    this.frameCanvas.getObjects().forEach(obj=> obj.selectable = false);\n    this.frameCanvas.add(this.bodyFrameRect);\n    this.frameCanvas.renderAll();\n    this.frameCanvas.setActiveObject(this.bodyFrameRect);\n  }\n\n  endEditingBodySize = () => {\n    this.setState({isEditingBodySize: false});\n    this.frameCanvas.getObjects().forEach(obj=> obj.selectable = true);\n    this.frameCanvas.remove(this.bodyFrameRect);\n  }\n\n  onChangeCanvas = e => {\n    const { isEditingBodySize } = this.state;\n    if(isEditingBodySize){\n      return;\n    }\n    \n    const { frames, selectedFrameIndex } = this.state;\n    this.setState({\n      frames: frames.map((frame,i)=>{\n        if(selectedFrameIndex === i) {\n          frame.thumb = this.frameCanvas.toDataURL(\"image/png\");\n          frame.data = this.frameCanvas.toDatalessJSON();\n        }\n        return frame;\n      })\n    })\n  }\n  \n  playAnimation = () => {\n    this.animationRef.current.start(this.state.isLoop);\n  }\n\n  stopAnimation = () => {\n    this.animationRef.current.stop();\n  }\n\n  onClickToggleAnimation = () => {\n    this.resetActions();\n    const { isPlaying } = this.state;\n    this.setState({ isPlaying: !isPlaying}, () => {\n      if(isPlaying) {\n        this.stopAnimation();\n      }else{\n        this.playAnimation();\n      }\n    })\n  }\n\n  onClickLoopAnimation = () => {\n    this.resetActions();\n    const { isLoop } = this.state;\n    this.setState({ isLoop: !isLoop});\n  }\n\n  onChangeFrameSize = e => {\n    this.resetActions();\n    let { name, value } = e.target;\n    if(Number(value) > 300){\n      value = 300;\n    }\n    this.setState({ [name]: Number(value) },()=>{\n      if(name === \"frameWidth\"){\n        this.frameCanvas.setWidth(this.state.frameWidth);\n      }else if(name === \"frameHeight\"){\n        this.frameCanvas.setHeight(this.state.frameHeight);\n      }\n      this.redrawThumbs();\n    });\n  }\n\n  checkIsValid = name => {\n    const regex = /^[a-z](?:_?[a-z0-9]+)*$/;\n    return regex.test(name);\n  }\n\n  onChangeDefaultName = e => {\n    let value = e.target.value;\n    if(value.length > 12) value = value.substr(0, 12);\n    this.setState({ defaultName: value, isDefaultNameValid: this.checkIsValid(value) });\n  }\n  \n  onChangeAnimationName = e => {\n    let value = e.target.value;\n    if(value.length > 12) value = value.substr(0, 12);\n    this.setState({ animationName: value, isAnimationNameValid: this.checkIsValid(value) });\n  }\n\n  onChangeFrameRate = e => {\n    const frameRate = Number(e.target.value);\n    if(frameRate !== this.state.frameRate){\n      this.resetActions();\n      this.setState({ frameRate });\n    }\n  }\n\n  onChangeFile = e => {\n    const file = e.target.files[0];\n    if(!file) {\n      return;\n    }\n    \n    const fr = new FileReader();\n    fr.onload = () => {\n      if(this.editingFrameIndex === -1) {\n        this.addFrame(fr.result);\n      }else {\n        this.changeFrame(this.editingFrameIndex, fr.result);\n        this.editingFrameIndex = -1;\n      }\n    };\n    fr.readAsDataURL(file);\n    \n    //file input value 초기화\n    e.target.type = \"\";\n    e.target.type = \"file\";\n  }\n\n  onClickFrame = index => {\n    this.resetActions();\n    const { frames } = this.state;\n    if(!frames[index]) {\n      this.frameCanvas.clear();\n      return;\n    }\n    this.frameCanvas.loadFromJSON(frames[index].data);\n    this.setState({ selectedFrameIndex: index });\n  }\n\n  onClickEditBodySize = () => {\n    this.animationRef.current.stop();\n    const { isEditingBodySize } = this.state;\n    if(isEditingBodySize) {\n      this.endEditingBodySize();\n    } else {\n      this.startEditingBodySize();\n    }\n  }\n\n  onClickAddFrame = () => {\n    this.resetActions();\n    this.inputFileRef.current.click();\n  }\n  \n  onClickDeleteFrame = index => {\n    this.resetActions();\n    const { frames } = this.state;\n    this.setState({\n      frames: frames.filter((frame,i) => i!==index)\n    },() => this.onClickFrame(0));\n  }\n  \n  onClickEditFrame = index => {\n    this.resetActions();\n    this.editingFrameIndex = index;\n    this.onClickFrame(index);\n    this.inputFileRef.current.click();\n  }\n\n  onSubmit = async () => {\n    this.resetActions();\n    const { defaultName, animationName } = this.state;\n    const { selectedSceneId } = this.props;\n    const isValidate = this.checkValidate();\n\n    if(!isValidate) {\n      return;\n    }\n\n    if(this.isUploading) {\n      return;\n    }\n    try {\n      this.isUploading = true;\n      //upload images & asset to server\n      const firstFrameUrl = await this.uploadFirstFrame();\n      const spriteSheetUrl = await this.uploadSpriteSheet();\n      const asset = this.createAsset(firstFrameUrl, spriteSheetUrl, defaultName, animationName);\n      await request.addAsset(asset);\n\n      //add asset to assetLibrary\n      AssetLibrary.addAsset(asset);\n\n      //add sprite to project\n      const sprite = {\n        assetId: asset.assetId,\n        type: asset.type,\n        name: this.props.countUpSameName(defaultName)\n      };\n      this.props.addSprites(selectedSceneId, [sprite]);\n      this.props.dismiss();\n    } catch(e) {\n      this.isUploading = false;\n      console.error(e);\n    }\n  }\n\n  checkValidate = () => {\n    const { frames, defaultName, animationName } = this.state;\n    if(frames.length === 0) {\n      return false;\n    }\n    if(!defaultName || defaultName.length < 1) {\n      return false;\n    }\n    if(!animationName || animationName.length < 1) {\n      return false;\n    }\n    return true;\n  }\n\n  uploadFirstFrame = async () => {\n    try{\n      const { frames } = this.state;\n      const blob = toBlob(frames[0].thumb);\n      return await this.uploadImage(blob);\n    } catch(e) {\n      console.error(e);\n    }\n  }\n\n  uploadSpriteSheet = async () => {\n    try{\n      const { frameWidth, frameHeight, frames } = this.state;\n      const images = frames.map(frame => frame.thumb);\n      const blob = await mergeImages(images, frameWidth, frameHeight);\n      return await this.uploadImage(blob);\n    } catch(e) {\n      console.error(e);\n    }\n  }\n\n  uploadImage = async blob => {\n    try{\n      const compressedBlob = await compress(blob);\n      const data = new FormData();\n      data.append(\"file\", compressedBlob);\n      \n      let res = await request.uploadAsset(data);\n      let json = await res.json();\n      return json.url.replace(URL.ASSET_BASE_URL, \"\");\n    } catch(e) {\n      console.error(e);\n    }\n  }\n\n  createAsset = (firstFrameUrl, spriteSheetUrl, defaultName, animationName) => {\n    const { frameWidth, frameHeight, frameRate, frames } = this.state;\n    const assetId = firstFrameUrl.replace(\"/custom/\",\"\").replace(\".png\",\"\");\n    const type = SpriteType.CUSTOM;\n    const spriteSize = JSON.stringify([frameWidth, frameHeight]);\n    const bodySize = JSON.stringify([\n      this.bodyFrameRect.width * this.bodyFrameRect.scaleX,\n      this.bodyFrameRect.height * this.bodyFrameRect.scaleY,\n      this.bodyFrameRect.left,\n      this.bodyFrameRect.top\n    ]);\n    const spriteAnimations = JSON.stringify({\n      [animationName]: {\n        frameRate: frameRate,\n        indexes: [...new Array(frames.length)].map((_i,i)=> i)\n      }\n    });\n\n    return {\n      assetId,\n      type,\n      defaultName,\n      path: firstFrameUrl,\n      thumb: firstFrameUrl,\n      spritePath: spriteSheetUrl,\n      spriteSize,\n      bodySize,\n      spriteAnimations\n    };\n  };\n\n  onClickGuide = () => {\n    this.setState({isGuideOpen: !this.state.isGuideOpen});\n  }\n\n  onClickPrev = () => {\n    this.setState({currentStep: 1});\n  }\n\n  onClickNext = () => {\n    if(this.state.frames.length > 0) {\n      this.setState({currentStep: 2});\n    }\n  }\n\n  onStopAnimation = () => {\n    this.setState({ isPlaying: false });\n  }\n\n  render() {\n    const { \n      defaultName,\n      animationName,\n      frames, \n      frameWidth, \n      frameHeight, \n      frameRate,\n      selectedFrameIndex,\n      isGuideOpen,\n      isEditingBodySize,\n      currentStep,\n      isLoop,\n      isPlaying,\n      isDefaultNameValid,\n      isAnimationNameValid\n    } = this.state;\n    const {\n      animationRef,\n      inputFileRef,\n      onClickLoopAnimation,\n      onClickToggleAnimation,\n      onChangeFrameSize,\n      onChangeDefaultName,\n      onChangeAnimationName,\n      onChangeFrameRate,\n      onChangeFile,\n      onClickFrame,\n      onClickEditBodySize,\n      onClickAddFrame,\n      onClickDeleteFrame,\n      onClickEditFrame,\n      onClickGuide,\n      onSubmit,\n      onClickPrev,\n      onClickNext,\n      onStopAnimation\n    } = this;\n    \n    return (\n      <View\n        animationRef={animationRef}\n        inputFileRef={inputFileRef}\n        defaultName={defaultName}\n        animationName={animationName}\n        frames={frames}\n        frameWidth={frameWidth}\n        frameHeight={frameHeight}\n        frameRate={frameRate}\n        selectedFrameIndex={selectedFrameIndex}\n        currentStep={currentStep}\n        isLoop={isLoop}\n        isPlaying={isPlaying}\n        isGuideOpen={currentStep === 1 && isGuideOpen}\n        isEditingBodySize={isEditingBodySize}\n        isDefaultNameValid={isDefaultNameValid}\n        isAnimationNameValid={isAnimationNameValid}\n        onClickLoopAnimation={onClickLoopAnimation}\n        onClickToggleAnimation={onClickToggleAnimation}\n        onChangeFrameSize={onChangeFrameSize}\n        onChangeDefaultName={onChangeDefaultName}\n        onChangeAnimationName={onChangeAnimationName}\n        onChangeFrameRate={onChangeFrameRate} \n        onChangeFile={onChangeFile}\n        onClickFrame={onClickFrame}\n        onClickEditBodySize={onClickEditBodySize}\n        onClickAddFrame={onClickAddFrame}\n        onClickDeleteFrame={onClickDeleteFrame}\n        onClickEditFrame={onClickEditFrame}\n        onClickGuide={onClickGuide}\n        onSubmit={onSubmit}\n        onClickPrev={onClickPrev}\n        onClickNext={onClickNext}\n        onStopAnimation={onStopAnimation}\n        dismiss={this.props.dismiss}\n      />\n    );\n  }\n}\n\nexport default connect(\n  state => ({\n    selectedSceneId: state.interaction.selected.scene\n  }),\n  {\n    addSprites: sceneActions.addSprites\n  }\n)(CustomSprite);"]},"metadata":{},"sourceType":"module"}