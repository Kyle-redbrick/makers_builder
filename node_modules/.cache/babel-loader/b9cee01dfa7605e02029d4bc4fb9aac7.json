{"ast":null,"code":"import _regeneratorRuntime from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _objectSpread from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread\";\nimport _classCallCheck from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";\nimport _possibleConstructorReturn from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";\nimport _inherits from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";\nvar _jsxFileName = \"/Users/jimmy/Documents/Wizschool/wizlab_web2/src/Common/Component/WizAppDetail/Container.js\";\nimport React, { Component } from \"react\";\nimport View from \"./View\";\nimport { connect } from \"react-redux\";\nimport { withRouter } from \"react-router-dom\";\nimport { injectIntl } from \"react-intl\";\nimport QueryString from \"query-string\";\nimport generatePID from \"../../Util/PIDGenerator\";\nimport * as request from \"../../Util/HTTPRequest\";\nimport Publish from \"../../../Common/Component/Publish\";\nimport store from \"../../Store\";\nimport QRPopup from \"../QRPopup\";\nimport PopUp, { showPopUp } from \"../../../Common/Component/PopUp\";\nimport SignIn from \"../../../Common/Component/SignIn\";\nimport Report from \"../report\";\nimport \"./index.scss\";\n\nvar Container =\n/*#__PURE__*/\nfunction (_Component) {\n  _inherits(Container, _Component);\n\n  function Container(props) {\n    var _this;\n\n    _classCallCheck(this, Container);\n\n    _this = _possibleConstructorReturn(this, _getPrototypeOf(Container).call(this, props));\n\n    _this.componentWillUnmount = function () {\n      window.removeEventListener(\"resize\", _this.handleRandomProjectCount); //뒷 페이지 스크롤 막기\n\n      var rootElement = document.documentElement;\n      if (rootElement) rootElement.style.overflow = \"initial\";\n    };\n\n    _this.setProject = function (pId) {\n      var email = _this.props.userinfo.email;\n      pId = pId ? pId : _this.props.pId;\n      request.getPublishedProjectV2({\n        pId: pId,\n        isReview: _this.props.isReview\n      }).then(function (res) {\n        return res.json();\n      }).then(function (json) {\n        if (!json || !json.live) {\n          showPopUp(React.createElement(PopUp.OneButton, {\n            title: _this.props.intl.formatMessage({\n              id: \"PLAY_DETAIL_CANNOT_ACCESS\"\n            }),\n            buttonName: _this.props.intl.formatMessage({\n              id: \"ID_WIZLIVE_CLASS_MESSAGE_SUCCESS_OK\"\n            }),\n            buttonAction: function buttonAction() {\n              _this.props.history.replace({\n                pathname: \"/game\"\n              });\n            },\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 66\n            },\n            __self: this\n          }), {\n            darkmode: true\n          });\n        } else {\n          json.viewCount += 1;\n\n          _this.setState({\n            project: json,\n            allCommentCount: json.commentCount\n          }, function () {\n            _this.getRandomProjects();\n\n            _this.getCreator();\n\n            _this.setState({\n              isDescFold: _this.state.project.description.length > 180 || _this.state.project.description.split(\"\\n\").length > 5\n            });\n\n            var curElement = document.querySelector(\".wizappDetail__inner\"); //scroll top\n\n            if (curElement) {\n              curElement.scrollTop = 0;\n            }\n          });\n        }\n      }).catch(function (e) {\n        return console.error(e);\n      });\n      request.getPublishedLike({\n        pId: pId,\n        email: email\n      }).then(function (res) {\n        return res.json();\n      }).then(function (json) {\n        return _this.setState({\n          isLiked: json.isLiked\n        });\n      }).catch(function (e) {\n        return console.error(e);\n      });\n      request.updatePublishedProjectsViewCount({\n        pId: pId\n      });\n    };\n\n    _this.getCreator = function () {\n      var project = _this.state.project;\n      request.userProfile({\n        email: project.user.email\n      }).then(function (res) {\n        return res.json();\n      }).then(function (json) {\n        var creator = json;\n        creator.email = project.user.email;\n\n        _this.setState({\n          creator: creator,\n          subscribeCount: creator.subscribeCount\n        }, function () {\n          var creator = _this.state.creator;\n          request.isSubscribe({\n            email: _this.props.userinfo.email,\n            creatorEmail: creator.email\n          }).then(function (res) {\n            return res.json();\n          }).then(function (json) {\n            var isSubscribe = json.isSubscribe;\n\n            _this.setState({\n              isSubscribed: isSubscribe\n            });\n          });\n        });\n      }).catch(function (e) {\n        return console.error(e);\n      });\n    };\n\n    _this.getRandomProjects = function () {\n      request.getProjectsByType({\n        type: \"random\",\n        limit: 6,\n        offset: 0\n      }).then(function (res) {\n        return res.json();\n      }).then(function (json) {\n        _this.setState({\n          randomGames: json\n        });\n      });\n    };\n\n    _this.handleRandomProjectCount = function () {\n      if (window.innerWidth <= 1080 && !_this.state.isMobile) {\n        _this.setState({\n          isMobile: true\n        });\n      }\n\n      if (window.innerWidth > 1080 && _this.state.isMobile) {\n        _this.setState({\n          isMobile: false\n        });\n      }\n    };\n\n    _this.handleClose = function () {\n      _this.pushWithQuery(_this.props.location.pathname, {\n        pId: undefined\n      }); //뒷 페이지 스크롤 풀기\n\n\n      var rootElement = document.documentElement;\n      if (rootElement) rootElement.style.overflow = \"initial\";\n    };\n\n    _this.handleLikeToggle = function (e) {\n      e.preventDefault();\n\n      if (_this.props.userinfo.email) {\n        var _this$state = _this.state,\n            isLiked = _this$state.isLiked,\n            project = _this$state.project;\n        request.updatePublishedLike({\n          email: _this.props.userinfo.email,\n          pId: _this.props.pId,\n          ownerEmail: project.user.email\n        }).then(function (res) {\n          return res.json();\n        }).then(function (json) {\n          if (json.success) {\n            var likeCount = isLiked ? project.likeCount - 1 : project.likeCount + 1;\n\n            _this.setState({\n              isLiked: !isLiked,\n              project: _objectSpread({}, project, {\n                likeCount: likeCount\n              })\n            });\n          } else {\n            showPopUp(React.createElement(PopUp.OneButton, {\n              title: _this.props.intl.formatMessage({\n                id: \"ID_POPUP_WARNING_REPEAT_CLICK_TITLE\"\n              }),\n              buttonName: _this.props.intl.formatMessage({\n                id: \"ID_POPUP_WARNING_REPEAT_CLICK_BTN\"\n              }),\n              __source: {\n                fileName: _jsxFileName,\n                lineNumber: 196\n              },\n              __self: this\n            }), {\n              darkmode: true\n            });\n          }\n        }).catch(function (e) {\n          return console.error(e);\n        });\n      } else {\n        showPopUp(React.createElement(SignIn, {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 210\n          },\n          __self: this\n        }), {\n          darkmode: true,\n          mobileFullscreen: true\n        });\n      }\n    };\n\n    _this.handleSubscribe = function (creatorEmail) {\n      if (_this.lastLikeTime) {\n        if (new Date().getTime() - _this.lastLikeTime < 1200) {\n          _this.lastLikeTime = new Date().getTime();\n          showPopUp(React.createElement(PopUp.OneButton, {\n            title: _this.props.intl.formatMessage({\n              id: \"ID_POPUP_WARNING_REPEAT_CLICK_TITLE\"\n            }),\n            buttonName: _this.props.intl.formatMessage({\n              id: \"ID_POPUP_WARNING_REPEAT_CLICK_BTN\"\n            }),\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 222\n            },\n            __self: this\n          }), {\n            darkmode: true\n          });\n          return;\n        }\n      }\n\n      _this.lastLikeTime = new Date().getTime();\n      var _this$props = _this.props,\n          userinfo = _this$props.userinfo,\n          intl = _this$props.intl;\n      var params = {\n        creatorEmail: creatorEmail,\n        email: userinfo.email\n      };\n\n      if (!userinfo.email) {\n        showPopUp(React.createElement(SignIn, {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 240\n          },\n          __self: this\n        }), {\n          darkmode: true,\n          mobileFullscreen: true\n        });\n        return;\n      }\n\n      if (!_this.state.isSubscribed) {\n        request.addSubscribe(params).then(function (res) {\n          return res.json();\n        }).then(function (json) {\n          if (json) {\n            _this.setState({\n              isSubscribed: true,\n              subscribeCount: _this.state.subscribeCount + 1\n            });\n          } else {\n            showPopUp(React.createElement(PopUp.OneButton, {\n              title: intl.formatMessage({\n                id: \"ID_POPUP_WARNING_REPEAT_CLICK_TITLE\"\n              }),\n              buttonName: intl.formatMessage({\n                id: \"ID_POPUP_WARNING_REPEAT_CLICK_BTN\"\n              }),\n              __source: {\n                fileName: _jsxFileName,\n                lineNumber: 258\n              },\n              __self: this\n            }), {\n              darkmode: true\n            });\n          }\n        });\n      } else {\n        request.removeSubscribe(params).then(function (res) {\n          return res.json();\n        }).then(function (json) {\n          if (json.success) {\n            _this.setState({\n              isSubscribed: false,\n              subscribeCount: _this.state.subscribeCount - 1\n            });\n          } else {\n            showPopUp(React.createElement(PopUp.OneButton, {\n              title: intl.formatMessage({\n                id: \"ID_POPUP_WARNING_REPEAT_CLICK_TITLE\"\n              }),\n              buttonName: intl.formatMessage({\n                id: \"ID_POPUP_WARNING_REPEAT_CLICK_BTN\"\n              }),\n              __source: {\n                fileName: _jsxFileName,\n                lineNumber: 282\n              },\n              __self: this\n            }), {\n              darkmode: true\n            });\n          }\n        });\n      }\n    };\n\n    _this.moveToComment = function () {\n      _this.commentRef.current.scrollIntoView({\n        behavior: \"smooth\"\n      });\n    };\n\n    _this.handleShareProject = function (e) {\n      e.preventDefault();\n      showPopUp(React.createElement(QRPopup, {\n        project: _this.state.project,\n        isBuilder: false,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 303\n        },\n        __self: this\n      }), {\n        store: store,\n        defaultPadding: false,\n        dismissOverlay: false,\n        overflow: true,\n        darkmode: true\n      });\n    };\n\n    _this.handleEditProject = function (e) {\n      var project = _this.state.project;\n      e.preventDefault();\n      showPopUp(React.createElement(Publish, {\n        pId: project.pId,\n        isDeveloping: false,\n        isBuilder: false,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 315\n        },\n        __self: this\n      }), {\n        store: store,\n        dismissOverlay: false,\n        defaultPadding: false,\n        scrollable: true\n      });\n    };\n\n    _this.handleCopyProject =\n    /*#__PURE__*/\n    function () {\n      var _ref = _asyncToGenerator(\n      /*#__PURE__*/\n      _regeneratorRuntime.mark(function _callee(e) {\n        var project, _ref2, type, params, builderURL, newWindow, formatMessage;\n\n        return _regeneratorRuntime.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                e.preventDefault();\n                project = _this.state.project;\n                _context.next = 4;\n                return _this.getDevProject(project.pId);\n\n              case 4:\n                _ref2 = _context.sent;\n                type = _ref2.type;\n\n                if (!_this.props.userinfo.email) {\n                  _context.next = 29;\n                  break;\n                }\n\n                params = _objectSpread({}, project, {\n                  type: type,\n                  email: _this.props.userinfo.email,\n                  pId: generatePID(_this.props.userinfo.email),\n                  targetPID: project.pId\n                });\n                delete params[\"createdAt\"];\n                delete params[\"updatedAt\"];\n                _context.prev = 10;\n                _context.next = 13;\n                return request.postDevelopingProject(params);\n\n              case 13:\n                _context.t0 = type;\n                _context.next = _context.t0 === \"js3d\" ? 16 : 18;\n                break;\n\n              case 16:\n                builderURL = \"/builder3d/\".concat(params.pId);\n                return _context.abrupt(\"break\", 20);\n\n              case 18:\n                builderURL = \"/builder/\".concat(params.pId);\n                return _context.abrupt(\"break\", 20);\n\n              case 20:\n                newWindow = window.open(builderURL, \"_blank\");\n                newWindow.focus();\n                _context.next = 27;\n                break;\n\n              case 24:\n                _context.prev = 24;\n                _context.t1 = _context[\"catch\"](10);\n                console.error(_context.t1);\n\n              case 27:\n                _context.next = 31;\n                break;\n\n              case 29:\n                formatMessage = _this.props.intl.formatMessage;\n                showPopUp(React.createElement(PopUp.OneButton, {\n                  title: formatMessage({\n                    id: \"ID_LOGIN_ALERT_TITLE\"\n                  }),\n                  subtitle: formatMessage({\n                    id: \"ID_LOGIN_ALERT_MSG\"\n                  }),\n                  buttonName: formatMessage({\n                    id: \"ID_LOGIN_ALERT_LOGINBTN\"\n                  }),\n                  buttonAction: function buttonAction() {\n                    showPopUp(React.createElement(SignIn, {\n                      __source: {\n                        fileName: _jsxFileName,\n                        lineNumber: 365\n                      },\n                      __self: this\n                    }), {\n                      darkmode: true,\n                      mobileFullscreen: true\n                    });\n                  },\n                  __source: {\n                    fileName: _jsxFileName,\n                    lineNumber: 360\n                  },\n                  __self: this\n                }), {\n                  darkmode: true\n                });\n\n              case 31:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee, this, [[10, 24]]);\n      }));\n\n      return function (_x) {\n        return _ref.apply(this, arguments);\n      };\n    }();\n\n    _this.handleFold = function () {\n      _this.setState({\n        isDescFold: !_this.state.isDescFold\n      });\n    };\n\n    _this.handleProjectCommentCount = function (count) {\n      _this.setState({\n        allCommentCount: count\n      });\n    };\n\n    _this.handleRandomGame = function (pId) {\n      _this.setState({\n        project: undefined,\n        isLiked: undefined,\n        creator: undefined,\n        subscribeCount: undefined,\n        isSubscribed: undefined,\n        randomGames: [],\n        isMobile: window.innerWidth <= 1080,\n        isDescFold: undefined,\n        allCommentCount: 0\n      }, function () {\n        _this.pushWithQuery(_this.props.location.pathname, {\n          pId: pId\n        });\n\n        _this.setProject(pId);\n      });\n    };\n\n    _this.handleReport = function () {\n      if (_this.props.userinfo.email) {\n        showPopUp(React.createElement(Report, {\n          email: _this.props.userinfo.email,\n          target: {\n            PublishedPId: _this.props.pId\n          },\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 403\n          },\n          __self: this\n        }), {\n          darkmode: true,\n          mobileFullscreen: true\n        });\n      } else {\n        showPopUp(React.createElement(SignIn, {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 413\n          },\n          __self: this\n        }), {\n          darkmode: true,\n          mobileFullscreen: true\n        });\n      }\n    };\n\n    _this.state = {\n      project: undefined,\n      isLiked: undefined,\n      creator: undefined,\n      subscribeCount: undefined,\n      isSubscribed: undefined,\n      randomGames: [],\n      isMobile: window.innerWidth <= 1080,\n      isDescFold: undefined,\n      allCommentCount: 0\n    };\n    _this.commentRef = React.createRef();\n    return _this;\n  }\n\n  _createClass(Container, [{\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      if (!this.props.pId) {\n        this.handleClose();\n        return;\n      }\n\n      this.setProject();\n      window.addEventListener(\"resize\", this.handleRandomProjectCount); //뒷 페이지 스크롤 막기\n\n      var rootElement = document.documentElement;\n      if (rootElement) rootElement.style.overflow = \"hidden\";\n    }\n  }, {\n    key: \"componentDidUpdate\",\n    value: function componentDidUpdate(prevProps) {\n      if (prevProps.pId !== this.props.pId) {\n        this.setProject();\n      }\n    }\n  }, {\n    key: \"getDevProject\",\n    value: function () {\n      var _getDevProject = _asyncToGenerator(\n      /*#__PURE__*/\n      _regeneratorRuntime.mark(function _callee2(pId) {\n        return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n          while (1) {\n            switch (_context2.prev = _context2.next) {\n              case 0:\n                _context2.next = 2;\n                return request.getDevelopingProjectInfo({\n                  pId: pId\n                }).then(function (res) {\n                  return res.json();\n                }).catch(function (e) {\n                  return console.error(e);\n                });\n\n              case 2:\n                return _context2.abrupt(\"return\", _context2.sent);\n\n              case 3:\n              case \"end\":\n                return _context2.stop();\n            }\n          }\n        }, _callee2, this);\n      }));\n\n      function getDevProject(_x2) {\n        return _getDevProject.apply(this, arguments);\n      }\n\n      return getDevProject;\n    }()\n  }, {\n    key: \"pushWithQuery\",\n    value: function pushWithQuery(pathname, query) {\n      this.props.history.push({\n        pathname: pathname,\n        search: QueryString.stringify(_objectSpread({}, QueryString.parse(this.props.location.search), query))\n      });\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _this$props2 = this.props,\n          pId = _this$props2.pId,\n          userinfo = _this$props2.userinfo;\n      var _this$state2 = this.state,\n          project = _this$state2.project,\n          randomGames = _this$state2.randomGames,\n          isLiked = _this$state2.isLiked,\n          creator = _this$state2.creator,\n          isSubscribed = _this$state2.isSubscribed,\n          subscribeCount = _this$state2.subscribeCount,\n          isDescFold = _this$state2.isDescFold,\n          isMobile = _this$state2.isMobile,\n          allCommentCount = _this$state2.allCommentCount;\n      var handleClose = this.handleClose,\n          handleLikeToggle = this.handleLikeToggle,\n          handleSubscribe = this.handleSubscribe,\n          commentRef = this.commentRef,\n          moveToComment = this.moveToComment,\n          handleReport = this.handleReport,\n          handleEditProject = this.handleEditProject,\n          handleShareProject = this.handleShareProject,\n          handleCopyProject = this.handleCopyProject,\n          handleFold = this.handleFold,\n          handleProjectCommentCount = this.handleProjectCommentCount,\n          handleRandomGame = this.handleRandomGame;\n\n      if (!project) {\n        return React.createElement(\"div\", {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 458\n          },\n          __self: this\n        });\n      }\n\n      return React.createElement(View, {\n        project: project,\n        randomGames: randomGames,\n        handleLikeToggle: handleLikeToggle,\n        handleShareProject: handleShareProject,\n        handleEditProject: handleEditProject,\n        handleCopyProject: handleCopyProject,\n        isLiked: isLiked,\n        creator: creator,\n        isSubscribed: isSubscribed,\n        subscribeCount: subscribeCount,\n        handleSubscribe: handleSubscribe,\n        commentRef: commentRef,\n        moveToComment: moveToComment,\n        pId: pId,\n        userinfo: userinfo,\n        handleClose: handleClose,\n        isDescFold: isDescFold,\n        handleFold: handleFold,\n        isMobile: isMobile,\n        handleProjectCommentCount: handleProjectCommentCount,\n        allCommentCount: allCommentCount,\n        handleRandomGame: handleRandomGame,\n        handleReport: handleReport,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 461\n        },\n        __self: this\n      });\n    }\n  }]);\n\n  return Container;\n}(Component);\n\nexport default connect(function (state) {\n  return {\n    userinfo: state.userinfo\n  };\n}, {})(withRouter(injectIntl(Container)));","map":{"version":3,"sources":["/Users/jimmy/Documents/Wizschool/wizlab_web2/src/Common/Component/WizAppDetail/Container.js"],"names":["React","Component","View","connect","withRouter","injectIntl","QueryString","generatePID","request","Publish","store","QRPopup","PopUp","showPopUp","SignIn","Report","Container","props","componentWillUnmount","window","removeEventListener","handleRandomProjectCount","rootElement","document","documentElement","style","overflow","setProject","pId","email","userinfo","getPublishedProjectV2","isReview","then","res","json","live","intl","formatMessage","id","history","replace","pathname","darkmode","viewCount","setState","project","allCommentCount","commentCount","getRandomProjects","getCreator","isDescFold","state","description","length","split","curElement","querySelector","scrollTop","catch","e","console","error","getPublishedLike","isLiked","updatePublishedProjectsViewCount","userProfile","user","creator","subscribeCount","isSubscribe","creatorEmail","isSubscribed","getProjectsByType","type","limit","offset","randomGames","innerWidth","isMobile","handleClose","pushWithQuery","location","undefined","handleLikeToggle","preventDefault","updatePublishedLike","ownerEmail","success","likeCount","mobileFullscreen","handleSubscribe","lastLikeTime","Date","getTime","params","addSubscribe","removeSubscribe","moveToComment","commentRef","current","scrollIntoView","behavior","handleShareProject","defaultPadding","dismissOverlay","handleEditProject","scrollable","handleCopyProject","getDevProject","targetPID","postDevelopingProject","builderURL","newWindow","open","focus","handleFold","handleProjectCommentCount","count","handleRandomGame","handleReport","PublishedPId","createRef","addEventListener","prevProps","getDevelopingProjectInfo","query","push","search","stringify","parse"],"mappings":"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","sourcesContent":["import React, { Component } from \"react\";\nimport View from \"./View\";\nimport { connect } from \"react-redux\";\nimport { withRouter } from \"react-router-dom\";\nimport { injectIntl } from \"react-intl\";\nimport QueryString from \"query-string\";\nimport generatePID from \"../../Util/PIDGenerator\";\nimport * as request from \"../../Util/HTTPRequest\";\nimport Publish from \"../../../Common/Component/Publish\";\nimport store from \"../../Store\";\nimport QRPopup from \"../QRPopup\";\nimport PopUp, { showPopUp } from \"../../../Common/Component/PopUp\";\nimport SignIn from \"../../../Common/Component/SignIn\";\nimport Report from \"../report\";\nimport \"./index.scss\";\n\nclass Container extends Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      project: undefined,\n      isLiked: undefined,\n      creator: undefined,\n      subscribeCount: undefined,\n      isSubscribed: undefined,\n      randomGames: [],\n      isMobile: window.innerWidth <= 1080,\n      isDescFold: undefined,\n      allCommentCount: 0\n    };\n    this.commentRef = React.createRef();\n  }\n\n  componentDidMount() {\n    if (!this.props.pId) {\n      this.handleClose();\n      return;\n    }\n    this.setProject();\n    window.addEventListener(\"resize\", this.handleRandomProjectCount);\n    //뒷 페이지 스크롤 막기\n    const rootElement = document.documentElement;\n    if (rootElement) rootElement.style.overflow = \"hidden\";\n  }\n  componentWillUnmount = () => {\n    window.removeEventListener(\"resize\", this.handleRandomProjectCount);\n    //뒷 페이지 스크롤 막기\n    const rootElement = document.documentElement;\n    if (rootElement) rootElement.style.overflow = \"initial\";\n  };\n  componentDidUpdate(prevProps) {\n    if (prevProps.pId !== this.props.pId) {\n      this.setProject();\n    }\n  }\n  setProject = pId => {\n    const email = this.props.userinfo.email;\n    pId = pId ? pId : this.props.pId;\n\n    request\n      .getPublishedProjectV2({ pId, isReview : this.props.isReview })\n      .then(res => res.json())\n      .then(json => {\n        if (!json || !json.live) {\n          showPopUp(\n            <PopUp.OneButton\n              title={this.props.intl.formatMessage({\n                id: \"PLAY_DETAIL_CANNOT_ACCESS\"\n              })}\n              buttonName={this.props.intl.formatMessage({\n                id: \"ID_WIZLIVE_CLASS_MESSAGE_SUCCESS_OK\"\n              })}\n              buttonAction={() => {\n                this.props.history.replace({\n                  pathname: \"/game\"\n                });\n              }}\n            />,\n            { darkmode: true }\n          );\n        } else {\n          json.viewCount += 1;\n          this.setState(\n            { project: json, allCommentCount: json.commentCount },\n            () => {\n              this.getRandomProjects();\n              this.getCreator();\n\n              this.setState({\n                isDescFold:\n                  this.state.project.description.length > 180 ||\n                  this.state.project.description.split(\"\\n\").length > 5\n              });\n\n              const curElement = document.querySelector(\".wizappDetail__inner\");\n              //scroll top\n              if (curElement) {\n                curElement.scrollTop = 0;\n              }\n            }\n          );\n        }\n      })\n      .catch(e => console.error(e));\n    request\n      .getPublishedLike({ pId, email })\n      .then(res => res.json())\n      .then(json => this.setState({ isLiked: json.isLiked }))\n      .catch(e => console.error(e));\n\n    request.updatePublishedProjectsViewCount({ pId });\n  };\n  getCreator = () => {\n    const { project } = this.state;\n    request\n      .userProfile({ email: project.user.email })\n      .then(res => res.json())\n      .then(json => {\n        const creator = json;\n        creator.email = project.user.email;\n        this.setState(\n          { creator: creator, subscribeCount: creator.subscribeCount },\n          () => {\n            const { creator } = this.state;\n            request\n              .isSubscribe({\n                email: this.props.userinfo.email,\n                creatorEmail: creator.email\n              })\n              .then(res => res.json())\n              .then(json => {\n                const { isSubscribe } = json;\n                this.setState({ isSubscribed: isSubscribe });\n              });\n          }\n        );\n      })\n      .catch(e => console.error(e));\n  };\n  async getDevProject(pId) {\n    return await request\n      .getDevelopingProjectInfo({ pId })\n      .then(res => res.json())\n      .catch(e => console.error(e));\n  }\n\n  getRandomProjects = () => {\n    request\n      .getProjectsByType({\n        type: \"random\",\n        limit: 6,\n        offset: 0\n      })\n      .then(res => res.json())\n      .then(json => {\n        this.setState({ randomGames: json });\n      });\n  };\n  handleRandomProjectCount = () => {\n    if (window.innerWidth <= 1080 && !this.state.isMobile) {\n      this.setState({ isMobile: true });\n    }\n    if (window.innerWidth > 1080 && this.state.isMobile) {\n      this.setState({ isMobile: false });\n    }\n  };\n  handleClose = () => {\n    this.pushWithQuery(this.props.location.pathname, { pId: undefined });\n    //뒷 페이지 스크롤 풀기\n    const rootElement = document.documentElement;\n    if (rootElement) rootElement.style.overflow = \"initial\";\n  };\n\n  handleLikeToggle = e => {\n    e.preventDefault();\n    if (this.props.userinfo.email) {\n      const { isLiked, project } = this.state;\n      request\n        .updatePublishedLike({\n          email: this.props.userinfo.email,\n          pId: this.props.pId,\n          ownerEmail: project.user.email\n        })\n        .then(res => res.json())\n        .then(json => {\n          if (json.success) {\n            const likeCount = isLiked\n              ? project.likeCount - 1\n              : project.likeCount + 1;\n            this.setState({\n              isLiked: !isLiked,\n              project: { ...project, likeCount: likeCount }\n            });\n          } else {\n            showPopUp(\n              <PopUp.OneButton\n                title={this.props.intl.formatMessage({\n                  id: \"ID_POPUP_WARNING_REPEAT_CLICK_TITLE\"\n                })}\n                buttonName={this.props.intl.formatMessage({\n                  id: \"ID_POPUP_WARNING_REPEAT_CLICK_BTN\"\n                })}\n              />,\n              { darkmode: true }\n            );\n          }\n        })\n        .catch(e => console.error(e));\n    } else {\n      showPopUp(<SignIn />, {\n        darkmode: true,\n        mobileFullscreen: true\n      });\n    }\n  };\n\n  handleSubscribe = creatorEmail => {\n    if (this.lastLikeTime) {\n      if (new Date().getTime() - this.lastLikeTime < 1200) {\n        this.lastLikeTime = new Date().getTime();\n        showPopUp(\n          <PopUp.OneButton\n            title={this.props.intl.formatMessage({\n              id: \"ID_POPUP_WARNING_REPEAT_CLICK_TITLE\"\n            })}\n            buttonName={this.props.intl.formatMessage({\n              id: \"ID_POPUP_WARNING_REPEAT_CLICK_BTN\"\n            })}\n          />,\n          { darkmode: true }\n        );\n        return;\n      }\n    }\n    this.lastLikeTime = new Date().getTime();\n\n    const { userinfo, intl } = this.props;\n    const params = { creatorEmail, email: userinfo.email };\n    if (!userinfo.email) {\n      showPopUp(<SignIn />, {\n        darkmode: true,\n        mobileFullscreen: true\n      });\n      return;\n    }\n    if (!this.state.isSubscribed) {\n      request\n        .addSubscribe(params)\n        .then(res => res.json())\n        .then(json => {\n          if (json) {\n            this.setState({\n              isSubscribed: true,\n              subscribeCount: this.state.subscribeCount + 1\n            });\n          } else {\n            showPopUp(\n              <PopUp.OneButton\n                title={intl.formatMessage({\n                  id: \"ID_POPUP_WARNING_REPEAT_CLICK_TITLE\"\n                })}\n                buttonName={intl.formatMessage({\n                  id: \"ID_POPUP_WARNING_REPEAT_CLICK_BTN\"\n                })}\n              />,\n              { darkmode: true }\n            );\n          }\n        });\n    } else {\n      request\n        .removeSubscribe(params)\n        .then(res => res.json())\n        .then(json => {\n          if (json.success) {\n            this.setState({\n              isSubscribed: false,\n              subscribeCount: this.state.subscribeCount - 1\n            });\n          } else {\n            showPopUp(\n              <PopUp.OneButton\n                title={intl.formatMessage({\n                  id: \"ID_POPUP_WARNING_REPEAT_CLICK_TITLE\"\n                })}\n                buttonName={intl.formatMessage({\n                  id: \"ID_POPUP_WARNING_REPEAT_CLICK_BTN\"\n                })}\n              />,\n              { darkmode: true }\n            );\n          }\n        });\n    }\n  };\n\n  moveToComment = () => {\n    this.commentRef.current.scrollIntoView({ behavior: \"smooth\" });\n  };\n\n  handleShareProject = e => {\n    e.preventDefault();\n    showPopUp(<QRPopup project={this.state.project} isBuilder={false} />, {\n      store,\n      defaultPadding: false,\n      dismissOverlay: false,\n      overflow: true,\n      darkmode: true\n    });\n  };\n  handleEditProject = e => {\n    const { project } = this.state;\n    e.preventDefault();\n    showPopUp(\n      <Publish pId={project.pId} isDeveloping={false} isBuilder={false} />,\n      {\n        store,\n        dismissOverlay: false,\n        defaultPadding: false,\n        scrollable: true\n      }\n    );\n  };\n\n  handleCopyProject = async e => {\n    e.preventDefault();\n    const { project } = this.state;\n    const { type } = await this.getDevProject(project.pId);\n\n    if (this.props.userinfo.email) {\n      const params = {\n        ...project,\n        type,\n        email: this.props.userinfo.email,\n        pId: generatePID(this.props.userinfo.email),\n        targetPID: project.pId\n      };\n      delete params[\"createdAt\"];\n      delete params[\"updatedAt\"];\n\n      try {\n        await request.postDevelopingProject(params);\n        let builderURL;\n        switch (type) {\n          case \"js3d\":\n            builderURL = `/builder3d/${params.pId}`;\n            break;\n          default:\n            builderURL = `/builder/${params.pId}`;\n            break;\n        }\n        var newWindow = window.open(builderURL, \"_blank\");\n        newWindow.focus();\n      } catch (e) {\n        console.error(e);\n      }\n    } else {\n      const { formatMessage } = this.props.intl;\n      showPopUp(\n        <PopUp.OneButton\n          title={formatMessage({ id: \"ID_LOGIN_ALERT_TITLE\" })}\n          subtitle={formatMessage({ id: \"ID_LOGIN_ALERT_MSG\" })}\n          buttonName={formatMessage({ id: \"ID_LOGIN_ALERT_LOGINBTN\" })}\n          buttonAction={() => {\n            showPopUp(<SignIn />, {\n              darkmode: true,\n              mobileFullscreen: true\n            });\n          }}\n        />,\n        { darkmode: true }\n      );\n    }\n  };\n  handleFold = () => {\n    this.setState({ isDescFold: !this.state.isDescFold });\n  };\n  handleProjectCommentCount = count => {\n    this.setState({ allCommentCount: count });\n  };\n  handleRandomGame = pId => {\n    this.setState(\n      {\n        project: undefined,\n        isLiked: undefined,\n        creator: undefined,\n        subscribeCount: undefined,\n        isSubscribed: undefined,\n        randomGames: [],\n        isMobile: window.innerWidth <= 1080,\n        isDescFold: undefined,\n        allCommentCount: 0\n      },\n      () => {\n        this.pushWithQuery(this.props.location.pathname, { pId });\n        this.setProject(pId);\n      }\n    );\n  };\n  handleReport = () => {\n    if (this.props.userinfo.email) {\n      showPopUp(\n        <Report\n          email={this.props.userinfo.email}\n          target={{ PublishedPId: this.props.pId }}\n        />,\n        {\n          darkmode: true,\n          mobileFullscreen: true\n        }\n      );\n    } else {\n      showPopUp(<SignIn />, {\n        darkmode: true,\n        mobileFullscreen: true\n      });\n    }\n  };\n\n  pushWithQuery(pathname, query) {\n    this.props.history.push({\n      pathname,\n      search: QueryString.stringify({\n        ...QueryString.parse(this.props.location.search),\n        ...query\n      })\n    });\n  }\n\n  render() {\n    const { pId, userinfo } = this.props;\n    const {\n      project,\n      randomGames,\n      isLiked,\n      creator,\n      isSubscribed,\n      subscribeCount,\n      isDescFold,\n      isMobile,\n      allCommentCount\n    } = this.state;\n    const {\n      handleClose,\n      handleLikeToggle,\n      handleSubscribe,\n      commentRef,\n      moveToComment,\n      handleReport,\n      handleEditProject,\n      handleShareProject,\n      handleCopyProject,\n      handleFold,\n      handleProjectCommentCount,\n      handleRandomGame\n    } = this;\n    if (!project) {\n      return <div />;\n    }\n    return (\n      <View\n        project={project}\n        randomGames={randomGames}\n        handleLikeToggle={handleLikeToggle}\n        handleShareProject={handleShareProject}\n        handleEditProject={handleEditProject}\n        handleCopyProject={handleCopyProject}\n        isLiked={isLiked}\n        creator={creator}\n        isSubscribed={isSubscribed}\n        subscribeCount={subscribeCount}\n        handleSubscribe={handleSubscribe}\n        commentRef={commentRef}\n        moveToComment={moveToComment}\n        pId={pId}\n        userinfo={userinfo}\n        handleClose={handleClose}\n        isDescFold={isDescFold}\n        handleFold={handleFold}\n        isMobile={isMobile}\n        handleProjectCommentCount={handleProjectCommentCount}\n        allCommentCount={allCommentCount}\n        handleRandomGame={handleRandomGame}\n        handleReport={handleReport}\n      />\n    );\n  }\n}\n\nexport default connect(\n  state => ({\n    userinfo: state.userinfo\n  }),\n  {}\n)(withRouter(injectIntl(Container)));\n"]},"metadata":{},"sourceType":"module"}