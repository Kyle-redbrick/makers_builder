{"ast":null,"code":"import _toConsumableArray from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";\nimport _objectSpread from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread\";\nimport _classCallCheck from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";\nimport _inherits from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";\nimport _possibleConstructorReturn from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";\nvar _jsxFileName = \"/Users/jimmy/Documents/Wizschool/wizlab_web2/src/Page/Social/Container.js\";\n\nfunction _createSuper(Derived) { var hasNativeReflectConstruct = _isNativeReflectConstruct(); return function _createSuperInternal() { var Super = _getPrototypeOf(Derived), result; if (hasNativeReflectConstruct) { var NewTarget = _getPrototypeOf(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return _possibleConstructorReturn(this, result); }; }\n\nfunction _isNativeReflectConstruct() { if (typeof Reflect === \"undefined\" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === \"function\") return true; try { Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {})); return true; } catch (e) { return false; } }\n\nimport React, { Component } from \"react\";\nimport { connect } from \"react-redux\";\nimport { withRouter } from \"react-router-dom\";\nimport { injectIntl } from \"react-intl\";\nimport PopUp, { showPopUp } from \"../../Common/Component/PopUp\";\nimport * as request from \"../../Common/Util/HTTPRequest\";\nimport * as TrackingUtil from \"../../Common/Util/TrackingUtil\";\nimport { dateFormatter } from \"./Util/DateFormatter\";\nimport SignIn from \"../../Common/Component/SignIn\";\nimport View from \"./View\";\nimport checkBlockedUser from \"../../Common/Util/CheckBlockedUser\";\n\nvar Container = /*#__PURE__*/function (_Component) {\n  _inherits(Container, _Component);\n\n  var _super = _createSuper(Container);\n\n  function Container(props) {\n    var _this;\n\n    _classCallCheck(this, Container);\n\n    _this = _super.call(this, props);\n\n    _this.getActivities = function () {\n      switch (_this.state.currentCategory) {\n        case \"recent\":\n          _this.getRecents();\n\n          break;\n\n        case \"trend\":\n          _this.getTrends();\n\n          break;\n\n        case \"subscribe\":\n          _this.getSubscribeActivities();\n\n          break;\n\n        default:\n          break;\n      }\n    };\n\n    _this.getRecents = function () {\n      var _this$state = _this.state,\n          keywords = _this$state.keywords,\n          offset = _this$state.offset,\n          limit = _this$state.limit;\n      var param = {\n        email: _this.props.userinfo.email,\n        offset: offset,\n        limit: limit,\n        keywords: keywords\n      };\n      request.getSocialArticles(param).then(function (res) {\n        return res.json();\n      }).then(function (json) {\n        _this.setState(function (prevState) {\n          var newActivities = [];\n          json.articles.forEach(function (article) {\n            try {\n              newActivities.push({\n                type: \"socialArticle\",\n                article: _objectSpread({}, article, {\n                  contents: JSON.parse(article.contents),\n                  createdAt: dateFormatter(article.createdAt)\n                })\n              });\n            } catch (_unused) {}\n          });\n          return {\n            activities: [].concat(prevState.activities, newActivities),\n            total: json.total,\n            loading: false\n          };\n        });\n      });\n    };\n\n    _this.getTrends = function () {\n      var _this$state2 = _this.state,\n          keywords = _this$state2.keywords,\n          offset = _this$state2.offset,\n          limit = _this$state2.limit;\n      var param = {\n        email: _this.props.userinfo.email,\n        offset: offset,\n        limit: limit,\n        keywords: keywords\n      };\n      request.getSocialTrends(param).then(function (res) {\n        return res.json();\n      }).then(function (json) {\n        _this.setState(function (prevState) {\n          var newActivities = [];\n\n          if (json.articles && json.articles.length) {\n            json.articles.forEach(function (article) {\n              try {\n                newActivities.push({\n                  type: \"socialArticle\",\n                  article: _objectSpread({}, article, {\n                    contents: JSON.parse(article.contents),\n                    createdAt: dateFormatter(article.createdAt)\n                  })\n                });\n              } catch (_unused2) {}\n            });\n          }\n\n          return {\n            activities: [].concat(prevState.activities, newActivities),\n            total: json.total,\n            loading: false\n          };\n        });\n      });\n    };\n\n    _this.getSubscribeActivities = function () {\n      _this.setState({\n        loading: true\n      }, function () {});\n    };\n\n    _this.onScroll = function (e) {\n      if (window.innerHeight + window.pageYOffset >= document.body.offsetHeight - 1000) {\n        var _this$state3 = _this.state,\n            offset = _this$state3.offset,\n            limit = _this$state3.limit,\n            total = _this$state3.total,\n            loading = _this$state3.loading;\n\n        if (total > limit && !loading) {\n          _this.setState({\n            offset: offset + _this.pageLength,\n            loading: true\n          }, function () {\n            _this.getActivities();\n          });\n        }\n      }\n    };\n\n    _this.onClickCategory = function (category) {\n      if (category !== _this.state.currentCategory) {\n        _this.props.history.push(\"/social/\".concat(category));\n      }\n    };\n\n    _this.onClickWrite = function () {\n      var isBlocked = checkBlockedUser(_this.props.userinfo);\n\n      if (isBlocked) {\n        return;\n      }\n\n      if (_this.props.userinfo.email) {\n        _this.props.history.push(\"/socialwrite\");\n      } else {\n        showPopUp(React.createElement(SignIn, {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 185\n          },\n          __self: this\n        }), {\n          darkmode: true,\n          mobileFullscreen: true\n        });\n      }\n    };\n\n    _this.onSearchKeyDown = function (e) {\n      var keywords = _this.state.keywords;\n      var keyword = e.target.value;\n\n      if (e.keyCode === 13 && keyword !== \"\") {\n        e.target.value = \"\";\n\n        _this.onAddKeyword(keyword);\n\n        TrackingUtil.sendGTMEvent(\"SocialSearch\", \"Social - Search Terms\", keyword);\n      } else if (e.keyCode === 8 && keyword === \"\" && keywords.length > 0) {\n        _this.onDeleteKeyword(keywords.length - 1);\n      }\n    };\n\n    _this.onAddKeyword = function (keyword) {\n      var keywords = _this.state.keywords;\n\n      if (keywords.length <= 10 && keywords.indexOf(keyword) < 0) {\n        _this.setState({\n          keywords: [].concat(keywords, keyword)\n        }, function () {\n          _this.onChangeKeyword();\n        });\n      }\n    };\n\n    _this.onDeleteKeyword = function (index) {\n      var keywords = _toConsumableArray(_this.state.keywords);\n\n      keywords.splice(index, 1);\n\n      _this.setState({\n        keywords: keywords\n      }, function () {\n        _this.onChangeKeyword();\n      });\n    };\n\n    _this.onResetKeyword = function () {\n      _this.setState({\n        keywords: []\n      }, function () {\n        _this.onChangeKeyword();\n      });\n    };\n\n    _this.onChangeKeyword = function () {\n      _this.setState({\n        activities: [],\n        offset: 0,\n        limit: _this.pageLength,\n        total: 0,\n        loading: true\n      }, function () {\n        _this.getActivities();\n      });\n    };\n\n    _this.onClickArticleTag = function (tag) {\n      _this.onAddKeyword(tag);\n    };\n\n    _this.onClickArticleDelete = function (index) {\n      var activities = _toConsumableArray(_this.state.activities);\n\n      activities.splice(index, 1);\n\n      _this.setState({\n        activities: activities\n      });\n    };\n\n    _this.onClickArticleSubscribe = function (user) {\n      if (_this.lastLikeTime) {\n        if (new Date().getTime() - _this.lastLikeTime < 1200) {\n          _this.lastLikeTime = new Date().getTime();\n          showPopUp(React.createElement(PopUp.OneButton, {\n            title: _this.props.intl.formatMessage({\n              id: \"ID_POPUP_WARNING_REPEAT_CLICK_TITLE\"\n            }),\n            buttonName: _this.props.intl.formatMessage({\n              id: \"ID_POPUP_WARNING_REPEAT_CLICK_BTN\"\n            }),\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 256\n            },\n            __self: this\n          }), {\n            darkmode: true\n          });\n          return;\n        }\n      }\n\n      _this.lastLikeTime = new Date().getTime();\n      var email = _this.props.userinfo.email;\n\n      if (email) {\n        try {\n          var isSubscribed = user.isSubscribed;\n          var params = {\n            email: email,\n            creatorEmail: user.email\n          };\n\n          if (isSubscribed) {\n            request.removeSubscribe(params).then(function (res) {\n              return res.json();\n            }).then(function (json) {\n              if (json.success) {\n                var activities = JSON.parse(JSON.stringify(_this.state.activities));\n                activities.forEach(function (activity) {\n                  if (activity.type === \"socialArticle\") {\n                    var article = activity.article;\n\n                    if (article.user.email === user.email) {\n                      article.user.isSubscribed = !isSubscribed;\n                    }\n                  }\n                });\n\n                _this.setState({\n                  activities: activities\n                });\n              } else {\n                showPopUp(React.createElement(PopUp.OneButton, {\n                  title: _this.props.intl.formatMessage({\n                    id: \"ID_POPUP_WARNING_REPEAT_CLICK_TITLE\"\n                  }),\n                  buttonName: _this.props.intl.formatMessage({\n                    id: \"ID_POPUP_WARNING_REPEAT_CLICK_BTN\"\n                  }),\n                  __source: {\n                    fileName: _jsxFileName,\n                    lineNumber: 296\n                  },\n                  __self: this\n                }), {\n                  darkmode: true\n                });\n              }\n            });\n          } else {\n            request.addSubscribe(params).then(function (res) {\n              return res.json();\n            }).then(function (json) {\n              if (json) {\n                var activities = JSON.parse(JSON.stringify(_this.state.activities));\n                activities.forEach(function (activity) {\n                  if (activity.type === \"socialArticle\") {\n                    var article = activity.article;\n\n                    if (article.user.email === user.email) {\n                      article.user.isSubscribed = !isSubscribed;\n                    }\n                  }\n                });\n\n                _this.setState({\n                  activities: activities\n                });\n              } else {\n                showPopUp(React.createElement(PopUp.OneButton, {\n                  title: _this.props.intl.formatMessage({\n                    id: \"ID_POPUP_WARNING_REPEAT_CLICK_TITLE\"\n                  }),\n                  buttonName: _this.props.intl.formatMessage({\n                    id: \"ID_POPUP_WARNING_REPEAT_CLICK_BTN\"\n                  }),\n                  __source: {\n                    fileName: _jsxFileName,\n                    lineNumber: 328\n                  },\n                  __self: this\n                }), {\n                  darkmode: true\n                });\n              }\n            });\n          }\n        } catch (err) {\n          console.error(err);\n        }\n      } else {\n        showPopUp(React.createElement(SignIn, {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 345\n          },\n          __self: this\n        }), {\n          darkmode: true,\n          mobileFullscreen: true\n        });\n      }\n    };\n\n    _this.categories = [\"recent\", \"trend\"]; // this.categories = [\"recent\", \"trend\", \"subscribe\"];\n\n    _this.pageLength = 5;\n    _this.state = {\n      currentCategory: props.match.params.category || _this.categories[0],\n      keywords: [],\n      activities: [],\n      offset: 0,\n      limit: _this.pageLength,\n      total: 0,\n      loading: false\n    };\n    return _this;\n  }\n\n  _createClass(Container, [{\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      window.addEventListener(\"scroll\", this.onScroll);\n\n      if (this.props.match.params.category) {\n        // TrackingUtil.sendPageEvent(\n        //   this.props.location.pathname,\n        //   this.props.email\n        // );\n        this.getActivities();\n      } else {\n        this.props.history.replace(\"/social/\".concat(this.categories[0]));\n        this.getActivities();\n      }\n    }\n  }, {\n    key: \"componentWillUnmount\",\n    value: function componentWillUnmount() {\n      window.removeEventListener(\"scroll\", this.onScroll);\n    }\n  }, {\n    key: \"componentDidUpdate\",\n    value: function componentDidUpdate() {\n      var _this2 = this;\n\n      var currentCategory = this.props.match.params.category;\n\n      if (currentCategory !== this.state.currentCategory) {\n        // TrackingUtil.sendPageEvent(\n        //   this.props.location.pathname,\n        //   this.props.email\n        // );\n        this.setState({\n          currentCategory: currentCategory,\n          keywords: [],\n          activities: [],\n          offset: 0,\n          limit: this.pageLength,\n          total: 0,\n          loading: false\n        }, function () {\n          _this2.getActivities();\n        });\n      }\n    } // request\n\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _this$props = this.props,\n          intl = _this$props.intl,\n          userinfo = _this$props.userinfo;\n      var _this$state4 = this.state,\n          currentCategory = _this$state4.currentCategory,\n          keywords = _this$state4.keywords,\n          activities = _this$state4.activities;\n      return React.createElement(View, {\n        intl: intl,\n        userinfo: userinfo,\n        currentCategory: currentCategory,\n        keywords: keywords,\n        activities: activities,\n        categories: this.categories,\n        onClickCategory: this.onClickCategory,\n        onClickWrite: this.onClickWrite,\n        onSearchKeyDown: this.onSearchKeyDown,\n        onDeleteKeyword: this.onDeleteKeyword,\n        onResetKeyword: this.onResetKeyword,\n        onClickArticleTag: this.onClickArticleTag,\n        onClickArticleDelete: this.onClickArticleDelete,\n        onClickArticleSubscribe: this.onClickArticleSubscribe,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 353\n        },\n        __self: this\n      });\n    }\n  }]);\n\n  return Container;\n}(Component);\n\nexport default connect(function (state) {\n  return {\n    userinfo: state.userinfo\n  };\n})(withRouter(injectIntl(Container)));","map":{"version":3,"sources":["/Users/jimmy/Documents/Wizschool/wizlab_web2/src/Page/Social/Container.js"],"names":["React","Component","connect","withRouter","injectIntl","PopUp","showPopUp","request","TrackingUtil","dateFormatter","SignIn","View","checkBlockedUser","Container","props","getActivities","state","currentCategory","getRecents","getTrends","getSubscribeActivities","keywords","offset","limit","param","email","userinfo","getSocialArticles","then","res","json","setState","prevState","newActivities","articles","forEach","article","push","type","contents","JSON","parse","createdAt","activities","concat","total","loading","getSocialTrends","length","onScroll","e","window","innerHeight","pageYOffset","document","body","offsetHeight","pageLength","onClickCategory","category","history","onClickWrite","isBlocked","darkmode","mobileFullscreen","onSearchKeyDown","keyword","target","value","keyCode","onAddKeyword","sendGTMEvent","onDeleteKeyword","indexOf","onChangeKeyword","index","splice","onResetKeyword","onClickArticleTag","tag","onClickArticleDelete","onClickArticleSubscribe","user","lastLikeTime","Date","getTime","intl","formatMessage","id","isSubscribed","params","creatorEmail","removeSubscribe","success","stringify","activity","addSubscribe","err","console","error","categories","match","addEventListener","replace","removeEventListener"],"mappings":"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","sourcesContent":["import React, { Component } from \"react\";\nimport { connect } from \"react-redux\";\nimport { withRouter } from \"react-router-dom\";\nimport { injectIntl } from \"react-intl\";\nimport PopUp, { showPopUp } from \"../../Common/Component/PopUp\";\nimport * as request from \"../../Common/Util/HTTPRequest\";\nimport * as TrackingUtil from \"../../Common/Util/TrackingUtil\";\nimport { dateFormatter } from \"./Util/DateFormatter\";\nimport SignIn from \"../../Common/Component/SignIn\";\nimport View from \"./View\";\nimport checkBlockedUser from \"../../Common/Util/CheckBlockedUser\";\n\nclass Container extends Component {\n  constructor(props) {\n    super(props);\n    this.categories = [\"recent\", \"trend\"];\n    // this.categories = [\"recent\", \"trend\", \"subscribe\"];\n    this.pageLength = 5;\n    this.state = {\n      currentCategory: props.match.params.category || this.categories[0],\n      keywords: [],\n      activities: [],\n      offset: 0,\n      limit: this.pageLength,\n      total: 0,\n      loading: false\n    };\n  }\n  componentDidMount() {\n    window.addEventListener(\"scroll\", this.onScroll);\n    if (this.props.match.params.category) {\n      // TrackingUtil.sendPageEvent(\n      //   this.props.location.pathname,\n      //   this.props.email\n      // );\n      this.getActivities();\n    } else {\n      this.props.history.replace(`/social/${this.categories[0]}`);\n      this.getActivities();\n    }\n  }\n  componentWillUnmount() {\n    window.removeEventListener(\"scroll\", this.onScroll);\n  }\n  componentDidUpdate() {\n    const currentCategory = this.props.match.params.category;\n    if (currentCategory !== this.state.currentCategory) {\n      // TrackingUtil.sendPageEvent(\n      //   this.props.location.pathname,\n      //   this.props.email\n      // );\n      this.setState(\n        {\n          currentCategory,\n          keywords: [],\n          activities: [],\n          offset: 0,\n          limit: this.pageLength,\n          total: 0,\n          loading: false\n        },\n        () => {\n          this.getActivities();\n        }\n      );\n    }\n  }\n\n  // request\n  getActivities = () => {\n    switch (this.state.currentCategory) {\n      case \"recent\":\n        this.getRecents();\n        break;\n      case \"trend\":\n        this.getTrends();\n        break;\n      case \"subscribe\":\n        this.getSubscribeActivities();\n        break;\n      default:\n        break;\n    }\n  };\n  getRecents = () => {\n    const { keywords, offset, limit } = this.state;\n    const param = { email: this.props.userinfo.email, offset, limit, keywords };\n    request\n      .getSocialArticles(param)\n      .then(res => res.json())\n      .then(json => {\n        this.setState(prevState => {\n          const newActivities = [];\n          json.articles.forEach(article => {\n            try {\n              newActivities.push({\n                type: \"socialArticle\",\n                article: {\n                  ...article,\n                  contents: JSON.parse(article.contents),\n                  createdAt: dateFormatter(article.createdAt)\n                }\n              });\n            } catch {}\n          });\n          return {\n            activities: [].concat(prevState.activities, newActivities),\n            total: json.total,\n            loading: false\n          };\n        });\n      });\n  };\n  getTrends = () => {\n    const { keywords, offset, limit } = this.state;\n    const param = { email: this.props.userinfo.email, offset, limit, keywords };\n    request\n      .getSocialTrends(param)\n      .then(res => res.json())\n      .then(json => {\n        this.setState(prevState => {\n          const newActivities = [];\n          if(json.articles && json.articles.length){\n            json.articles.forEach(article => {\n              try {\n                newActivities.push({\n                  type: \"socialArticle\",\n                  article: {\n                    ...article,\n                    contents: JSON.parse(article.contents),\n                    createdAt: dateFormatter(article.createdAt)\n                  }\n                });\n              } catch {}})\n            }\n          return {\n            activities: [].concat(prevState.activities, newActivities),\n            total: json.total,\n            loading: false\n          };\n        });\n      });\n  };\n  getSubscribeActivities = () => {\n    this.setState({ loading: true }, () => {});\n  };\n\n  // scroll\n  onScroll = e => {\n    if (\n      window.innerHeight + window.pageYOffset >=\n      document.body.offsetHeight - 1000\n    ) {\n      const { offset, limit, total, loading } = this.state;\n      if (total > limit && !loading) {\n        this.setState(\n          {\n            offset: offset + this.pageLength,\n            loading: true\n          },\n          () => {\n            this.getActivities();\n          }\n        );\n      }\n    }\n  };\n\n  // category\n  onClickCategory = category => {\n    if (category !== this.state.currentCategory) {\n      this.props.history.push(`/social/${category}`);\n    }\n  };\n\n  // write\n  onClickWrite = () => {\n    const isBlocked = checkBlockedUser(this.props.userinfo);\n    if (isBlocked) {\n      return;\n    }\n    if (this.props.userinfo.email) {\n      this.props.history.push(`/socialwrite`);\n    } else {\n      showPopUp(<SignIn />, { darkmode: true, mobileFullscreen: true });\n    }\n  };\n\n  // search\n  onSearchKeyDown = e => {\n    const { keywords } = this.state;\n    const keyword = e.target.value;\n    if (e.keyCode === 13 && keyword !== \"\") {\n      e.target.value = \"\";\n      this.onAddKeyword(keyword);\n      TrackingUtil.sendGTMEvent(\n        \"SocialSearch\",\n        \"Social - Search Terms\",\n        keyword\n      );\n    } else if (e.keyCode === 8 && keyword === \"\" && keywords.length > 0) {\n      this.onDeleteKeyword(keywords.length - 1);\n    }\n  };\n\n  // keyword\n  onAddKeyword = keyword => {\n    const { keywords } = this.state;\n    if (keywords.length <= 10 && keywords.indexOf(keyword) < 0) {\n      this.setState({ keywords: [].concat(keywords, keyword) }, () => {\n        this.onChangeKeyword();\n      });\n    }\n  };\n  onDeleteKeyword = index => {\n    const keywords = [...this.state.keywords];\n    keywords.splice(index, 1);\n    this.setState({ keywords }, () => {\n      this.onChangeKeyword();\n    });\n  };\n  onResetKeyword = () => {\n    this.setState({ keywords: [] }, () => {\n      this.onChangeKeyword();\n    });\n  };\n  onChangeKeyword = () => {\n    this.setState(\n      {\n        activities: [],\n        offset: 0,\n        limit: this.pageLength,\n        total: 0,\n        loading: true\n      },\n      () => {\n        this.getActivities();\n      }\n    );\n  };\n\n  // article\n  onClickArticleTag = tag => {\n    this.onAddKeyword(tag);\n  };\n  onClickArticleDelete = index => {\n    const activities = [...this.state.activities];\n    activities.splice(index, 1);\n    this.setState({ activities });\n  };\n  onClickArticleSubscribe = user => {\n    if (this.lastLikeTime) {\n      if (new Date().getTime() - this.lastLikeTime < 1200) {\n        this.lastLikeTime = new Date().getTime();\n        showPopUp(\n          <PopUp.OneButton\n            title={this.props.intl.formatMessage({\n              id: \"ID_POPUP_WARNING_REPEAT_CLICK_TITLE\"\n            })}\n            buttonName={this.props.intl.formatMessage({\n              id: \"ID_POPUP_WARNING_REPEAT_CLICK_BTN\"\n            })}\n          />,\n          { darkmode: true }\n        );\n        return;\n      }\n    }\n    this.lastLikeTime = new Date().getTime();\n\n    const { email } = this.props.userinfo;\n    if (email) {\n      try {\n        const isSubscribed = user.isSubscribed;\n        const params = { email, creatorEmail: user.email };\n        if (isSubscribed) {\n          request\n            .removeSubscribe(params)\n            .then(res => res.json())\n            .then(json => {\n              if (json.success) {\n                const activities = JSON.parse(\n                  JSON.stringify(this.state.activities)\n                );\n                activities.forEach(activity => {\n                  if (activity.type === \"socialArticle\") {\n                    const article = activity.article;\n                    if (article.user.email === user.email) {\n                      article.user.isSubscribed = !isSubscribed;\n                    }\n                  }\n                });\n                this.setState({ activities });\n              } else {\n                showPopUp(\n                  <PopUp.OneButton\n                    title={this.props.intl.formatMessage({\n                      id: \"ID_POPUP_WARNING_REPEAT_CLICK_TITLE\"\n                    })}\n                    buttonName={this.props.intl.formatMessage({\n                      id: \"ID_POPUP_WARNING_REPEAT_CLICK_BTN\"\n                    })}\n                  />,\n                  { darkmode: true }\n                );\n              }\n            });\n        } else {\n          request\n            .addSubscribe(params)\n            .then(res => res.json())\n            .then(json => {\n              if (json) {\n                const activities = JSON.parse(\n                  JSON.stringify(this.state.activities)\n                );\n                activities.forEach(activity => {\n                  if (activity.type === \"socialArticle\") {\n                    const article = activity.article;\n                    if (article.user.email === user.email) {\n                      article.user.isSubscribed = !isSubscribed;\n                    }\n                  }\n                });\n                this.setState({ activities });\n              } else {\n                showPopUp(\n                  <PopUp.OneButton\n                    title={this.props.intl.formatMessage({\n                      id: \"ID_POPUP_WARNING_REPEAT_CLICK_TITLE\"\n                    })}\n                    buttonName={this.props.intl.formatMessage({\n                      id: \"ID_POPUP_WARNING_REPEAT_CLICK_BTN\"\n                    })}\n                  />,\n                  { darkmode: true }\n                );\n              }\n            });\n        }\n      } catch (err) {\n        console.error(err);\n      }\n    } else {\n      showPopUp(<SignIn />, { darkmode: true, mobileFullscreen: true });\n    }\n  };\n\n  render() {\n    const { intl, userinfo } = this.props;\n    const { currentCategory, keywords, activities } = this.state;\n    return (\n      <View\n        intl={intl}\n        userinfo={userinfo}\n        currentCategory={currentCategory}\n        keywords={keywords}\n        activities={activities}\n        categories={this.categories}\n        onClickCategory={this.onClickCategory}\n        onClickWrite={this.onClickWrite}\n        onSearchKeyDown={this.onSearchKeyDown}\n        onDeleteKeyword={this.onDeleteKeyword}\n        onResetKeyword={this.onResetKeyword}\n        onClickArticleTag={this.onClickArticleTag}\n        onClickArticleDelete={this.onClickArticleDelete}\n        onClickArticleSubscribe={this.onClickArticleSubscribe}\n      />\n    );\n  }\n}\n\nexport default connect(state => ({ userinfo: state.userinfo }))(\n  withRouter(injectIntl(Container))\n);\n"]},"metadata":{},"sourceType":"module"}