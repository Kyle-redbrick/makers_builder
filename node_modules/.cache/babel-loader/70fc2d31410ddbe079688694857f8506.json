{"ast":null,"code":"import _objectWithoutProperties from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectWithoutProperties\";\nimport _regeneratorRuntime from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _toConsumableArray from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";\nimport _objectSpread from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread\";\nimport _classCallCheck from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";\nimport _assertThisInitialized from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/assertThisInitialized\";\nimport _inherits from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";\nimport _possibleConstructorReturn from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";\nvar _jsxFileName = \"/Users/jimmy/Documents/Wizschool/wizlab_web2/src/Page/Builder/Component/MultiLive/Container.js\";\n\nfunction _createSuper(Derived) { var hasNativeReflectConstruct = _isNativeReflectConstruct(); return function _createSuperInternal() { var Super = _getPrototypeOf(Derived), result; if (hasNativeReflectConstruct) { var NewTarget = _getPrototypeOf(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return _possibleConstructorReturn(this, result); }; }\n\nfunction _isNativeReflectConstruct() { if (typeof Reflect === \"undefined\" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === \"function\") return true; try { Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {})); return true; } catch (e) { return false; } }\n\nimport React, { Component } from \"react\";\nimport { connect } from \"react-redux\";\nimport Popup, { showPopUp } from \"../../../../Common/Component/PopUp\";\nimport { URL } from \"../../../../Common/Util/Constant\";\nimport * as request from \"../../../../Common/Util/HTTPRequest\";\nimport * as projectActions from \"../../Store/Reducer/project\";\nimport * as tabActions from \"../../Store/Reducer/tabs\";\nimport RndWrapper from \"../../utils/RndWrapper\";\nimport FreeTrialSurveyPopup from \"../Live/Component/FreeTrialSurveyPopup\";\nimport { socketUtil } from \"../Socket/Container\";\nimport View from \"./View\";\nvar Janus = window.Janus;\n\nvar Container = /*#__PURE__*/function (_Component) {\n  _inherits(Container, _Component);\n\n  var _super = _createSuper(Container);\n\n  function Container(props) {\n    var _this;\n\n    _classCallCheck(this, Container);\n\n    _this = _super.call(this, props);\n\n    _this.setup = function () {\n      Janus.init({\n        debug: \"all\",\n        callback: _this.setupJanus\n      });\n    };\n\n    _this.setupJanus = function () {\n      _this.janus = new Janus({\n        server: _this.janusServerURL,\n        success: function success() {\n          _this.janus.attach({\n            plugin: \"janus.plugin.videoroom\",\n            opaqueId: _this.opaqueId,\n            success: function success(pluginHandle) {\n              _this.sfutest = pluginHandle;\n              Janus.log(\"Plugin attached! (\" + _this.sfutest.getPlugin() + \", id=\" + _this.sfutest.getId() + \")\");\n\n              _this.checkRoom();\n            },\n            error: function error(_error) {\n              Janus.error(\"  -- Error attaching plugin...\", _error);\n              alert(\"Error attaching plugin... \" + _error);\n            },\n            consentDialog: function consentDialog(on) {\n              Janus.debug(\"Consent dialog should be \" + (on ? \"on\" : \"off\") + \" now\");\n            },\n            iceState: function iceState(state) {\n              Janus.log(\"ICE state changed to \" + state);\n            },\n            mediaState: function mediaState(medium, on) {\n              Janus.log(\"Janus \" + (on ? \"started\" : \"stopped\") + \" receiving our \" + medium);\n            },\n            webrtcState: function webrtcState(on) {\n              Janus.log(\"Janus says our WebRTC PeerConnection is \" + (on ? \"up\" : \"down\") + \" now\");\n            },\n            onmessage: function onmessage(msg, jsep) {\n              Janus.debug(\" ::: Got a message (publisher) :::\", msg);\n              var event = msg[\"videoroom\"];\n              Janus.debug(\"Event: \" + event);\n\n              if (event) {\n                if (event === \"joined\") {\n                  // Publisher/manager created, negotiate WebRTC and attach to existing feeds, if any\n                  _this.myid = msg[\"id\"];\n                  _this.mypvtid = msg[\"private_id\"];\n                  Janus.log(\"Successfully joined room \" + msg[\"room\"] + \" with ID \" + _this.myid);\n\n                  _this.publishOwnFeed(true);\n\n                  if (msg[\"publishers\"] && msg[\"publishers\"].length) {\n                    var _list = msg[\"publishers\"];\n                    Janus.debug(\"Got a list of available publishers/feeds:\", _list);\n\n                    for (var f in _list) {\n                      var id = _list[f][\"id\"];\n                      var display = _list[f][\"display\"];\n                      var _audio = _list[f][\"audio_codec\"];\n                      var _video = _list[f][\"video_codec\"];\n                      display = JSON.parse(display);\n                      Janus.debug(\"  >> [\" + id + \"] \" + display.email + \" (audio: \" + _audio + \", video: \" + _video + \")\");\n\n                      if (display.email !== _this.props.email) {\n                        console.log(1111, \"I joined: remote email - \".concat(display.email));\n\n                        _this.newRemoteFeed(id, display, _audio, _video);\n                      } else {\n                        _this.sfutest.send({\n                          message: {\n                            request: \"kick\",\n                            room: _this.props.roomId,\n                            id: id\n                          },\n                          success: function success(data) {\n                            Janus.debug(data);\n                          }\n                        });\n                      }\n                    }\n                  }\n\n                  if (_this.state.roomStatus === \"connecting\") {\n                    _this.setState({\n                      roomStatus: \"ready\"\n                    });\n                  }\n                } else if (event === \"destroyed\") {\n                  Janus.warn(\"The room has been destroyed!\");\n                } else if (event === \"event\") {\n                  if (msg[\"publishers\"] && msg[\"publishers\"].length) {\n                    var list = msg[\"publishers\"];\n                    Janus.debug(\"Got a list of available publishers/feeds:\", list);\n\n                    for (var _f in list) {\n                      var _id = list[_f][\"id\"];\n                      var _display = list[_f][\"display\"];\n                      var _audio2 = list[_f][\"audio_codec\"];\n                      var _video2 = list[_f][\"video_codec\"];\n                      _display = JSON.parse(_display);\n                      Janus.debug(\"  >> [\" + _id + \"] \" + _display + \" (audio: \" + _audio2 + \", video: \" + _video2 + \")\");\n\n                      if (_display.email !== _this.props.email) {\n                        console.log(1111, \"someone joined: remote email - \".concat(_display.email));\n\n                        _this.newRemoteFeed(_id, _display, _audio2, _video2);\n                      }\n                    }\n                  } else if (msg[\"leaving\"]) {\n                    var leaving = msg[\"leaving\"];\n                    Janus.log(\"Publisher left leaving: \" + leaving);\n\n                    for (var i = 0; i < 4; i++) {\n                      if (_this.feeds[i] && _this.feeds[i].rfid === leaving) {\n                        _this.feeds[i].detach();\n\n                        _this.feeds[i] = null; // this.studentName[feed.rfindex] = null;\n\n                        console.log(1111, \"student is leaving index: \" + i);\n                        break;\n                      }\n                    }\n                  } else if (msg[\"unpublished\"]) {\n                    var unpublished = msg[\"unpublished\"];\n                    Janus.log(\"Publisher left unpublished: \" + unpublished);\n\n                    if (unpublished === \"ok\") {\n                      _this.sfutest.hangup();\n\n                      return;\n                    } // unpublished 됐을 때 오디오 아이콘 리셋\n\n\n                    var _loop = function _loop(_i) {\n                      if (_this.feeds[_i] && _this.feeds[_i].rfid === unpublished) {\n                        _this.setState({\n                          attendees: _this.state.attendees.map(function (attendee) {\n                            if (attendee.email === _this.feeds[_i].rfdisplay) {\n                              return _objectSpread({}, attendee, {\n                                audioEnabled: true\n                              });\n                            } else {\n                              return attendee;\n                            }\n                          })\n                        }, function () {\n                          // broadcast\n                          socketUtil.sendSocketEvent(\"audioChanged\", {\n                            roomId: _this.props.roomId,\n                            email: _this.feeds[_i].rfdisplay,\n                            audioEnabled: true\n                          });\n                        });\n\n                        _this.feeds[_i].detach();\n\n                        _this.feeds[_i] = null; // this.studentName[feed.rfindex] = null;\n\n                        console.log(1111, \"student is unpublishing index: \" + _i);\n                        return \"break\";\n                      }\n                    };\n\n                    for (var _i = 0; _i < 4; _i++) {\n                      var _ret = _loop(_i);\n\n                      if (_ret === \"break\") break;\n                    }\n                  } else if (msg[\"error\"]) {\n                    if (msg[\"error_code\"] === 426) {// no such room error\n                    } else {// other errors\n                      }\n                  }\n                }\n              }\n\n              if (jsep) {\n                Janus.debug(\"Handling SDP as well...\", jsep);\n\n                _this.sfutest.handleRemoteJsep({\n                  jsep: jsep\n                }); // Check if any of the media we wanted to publish has\n                // been rejected (e.g., wrong or unsupported codec)\n\n\n                var audio = msg[\"audio_codec\"];\n\n                if (_this.mystream && _this.mystream.getAudioTracks() && _this.mystream.getAudioTracks().length > 0 && !audio) {// Audio has been rejected\n                }\n\n                var video = msg[\"video_codec\"];\n\n                if (_this.mystream && _this.mystream.getVideoTracks() && _this.mystream.getVideoTracks().length > 0 && !video) {// Video has been rejected\n                }\n              }\n            },\n            onlocalstream: function onlocalstream(stream) {\n              Janus.debug(\" ::: Got a local stream :::\", stream);\n              console.log(\"benjamin --- stream \", stream);\n              _this.mystream = stream;\n\n              if (_this.props.isTutor) {\n                Janus.attachMediaStream(_this.tutorVideo, stream); // Janus.attachMediaStream(this.localVideo, stream);\n                // console.log(\n                //   1111,\n                //   `onlocalstream - I am a tutor with email: ${this.props.email}`\n                // );\n              } else {\n                var index = _this.state.attendees.findIndex(function (_ref) {\n                  var email = _ref.email;\n                  return email === _this.props.email;\n                });\n\n                console.log(1111, \"localStream attendees index \".concat(index, \", \").concat(_this.props.email));\n                Janus.attachMediaStream(_this.studentVideos[index], stream); // Janus.attachMediaStream(this.localVideo, stream);\n                // console.log(\n                //   1111,\n                //   `onlocalstream - I am a student with email: ${this.props.email}`\n                // );\n\n                _this.setState(function (prevState) {\n                  return {\n                    students: [{\n                      email: _this.props.email,\n                      pId: _this.props.pId,\n                      name: _this.props.name\n                    }].concat(_toConsumableArray(prevState.students))\n                  };\n                });\n              }\n\n              var videoTracks = stream.getVideoTracks();\n\n              if (!videoTracks || videoTracks.length === 0) {// No webcam\n              }\n            },\n            onremotestream: function onremotestream(stream) {// The publisher stream is sendonly, we don't expect anything here\n            },\n            oncleanup: function oncleanup() {\n              Janus.log(\" ::: Got a cleanup notification: we are unpublished now :::\");\n              _this.mystream = null;\n            }\n          });\n        },\n        error: function error(_error2) {\n          Janus.error(_error2);\n        },\n        destroyed: function destroyed() {\n          window.location.reload();\n        }\n      });\n    };\n\n    _this.checkRoom = function () {\n      Janus.debug(\"is room exist...?\");\n\n      _this.sfutest.send({\n        message: {\n          request: \"exists\",\n          room: _this.props.roomId\n        },\n        success: function success(data) {\n          if (data.exists) {\n            _this.registerUsername();\n          } else {\n            Janus.debug(\"Room is creating...\");\n\n            _this.sfutest.send({\n              message: {\n                request: \"create\",\n                // bitrate: this.maximumBitrate / 2,\n                publishers: 30,\n                // bitrate_cap: true,\n                room: _this.props.roomId,\n                is_private: true\n              },\n              success: _this.registerUsername\n            });\n          }\n        }\n      });\n    };\n\n    _this.registerUsername = function () {\n      var register = {\n        request: \"join\",\n        room: _this.props.roomId,\n        ptype: \"publisher\",\n        display: JSON.stringify({\n          email: _this.props.email,\n          pId: _this.props.pId,\n          name: _this.props.name\n        })\n      };\n\n      _this.sfutest.send({\n        message: register\n      });\n    };\n\n    _this.unpublish = function () {\n      var message = {\n        request: \"unpublish\"\n      };\n\n      _this.sfutest.send({\n        message: message\n      });\n    };\n\n    _this.setTutorVideo = function (video) {\n      _this.tutorVideo = video;\n    };\n\n    _this.setStudentVideo = function (video, index) {\n      _this.studentVideos[index] = video;\n    };\n\n    _this.refreshVideos = function () {\n      _this.setState({\n        roomStatus: \"connected\"\n      });\n\n      if (_this.tutorVideo.paused) _this.tutorVideo.play();\n\n      _this.studentVideos.forEach(function (v) {\n        return v.paused && v.play();\n      });\n    };\n\n    _this.handleVoiceToggleButton = function (email, audioEnabled) {\n      var _this$props = _this.props,\n          isTutor = _this$props.isTutor,\n          roomId = _this$props.roomId;\n      if (!isTutor) return;\n      if (_this.feeds.length === 0) return;\n\n      for (var i = 0; i < _this.feeds.length; i++) {\n        var remoteFeed = _this.feeds[i];\n\n        if (remoteFeed.rfdisplay === email) {\n          // TODO: setState me\n          _this.setState({\n            attendees: _this.state.attendees.map(function (attendee) {\n              if (attendee.email === email) {\n                return _objectSpread({}, attendee, {\n                  audioEnabled: audioEnabled\n                });\n              } else {\n                return attendee;\n              }\n            })\n          }, function () {\n            // braodcast\n            socketUtil.sendSocketEvent(\"audioChanged\", {\n              roomId: roomId,\n              email: email,\n              audioEnabled: !audioEnabled\n            }); // TODO remove\n            // this.state.attendees.map(attend => {\n            //   console.log(attend);\n            // });\n          });\n\n          break;\n        }\n      }\n    };\n\n    _this.handleExitBtn = function () {\n      _this.showExitConfirmAlert();\n    };\n\n    _this.showExitConfirmAlert = function () {\n      var callback = function callback() {\n        request.setComplete1v4Reservation(); // this.sendData(this.DATA_TYPE_EXIT, null);\n\n        socketUtil.sendSocketEvent(\"lectureExit\", {\n          roomId: _this.props.roomId\n        });\n\n        _this.unpublish();\n\n        _this.setState({\n          isEnd: true\n        });\n\n        _this.showExitAlert();\n      };\n\n      showPopUp( /*#__PURE__*/React.createElement(Popup.TwoButton, {\n        confirmAction: callback,\n        intl: _this.props.intl,\n        titleId: \"ID_WIZLIVE_EXIT_CONFIRM\",\n        confirmButtonNameId: \"ID_WIZLIVE_EXIT\",\n        cancelButtonNameId: \"ID_WIZLIVE_CANCEL\",\n        __self: _assertThisInitialized(_this),\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 790,\n          columnNumber: 7\n        }\n      }));\n    };\n\n    _this.showExitAlert = function () {\n      var callback = function callback() {\n        var _this$props2 = _this.props,\n            studentEmail = _this$props2.studentEmail,\n            reservationId = _this$props2.reservationId;\n        var url = \"\".concat(URL.WIZLIVE, \"/tutor/feedback/\").concat(studentEmail, \"/\").concat(reservationId, \"/false\");\n        window.open(url, \"_blank\");\n      };\n\n      showPopUp( /*#__PURE__*/React.createElement(Popup.TwoButton, {\n        confirmAction: callback,\n        intl: _this.props.intl,\n        titleId: \"ID_WIZLIVE_EXIT_COMPLETE\",\n        subtitleId: \"ID_WIZLIVE_FEEDBACK_REQUEST\",\n        confirmButtonNameId: \"ID_WIZLIVE_FEEDBACK_GO\",\n        cancelButtonNameId: \"ID_WIZLIVE_FEEDBACK_NEXTTIME\",\n        __self: _assertThisInitialized(_this),\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 810,\n          columnNumber: 7\n        }\n      }));\n    };\n\n    _this.handleFreeTrialSurvey = function (isOn) {\n      _this.setState({\n        isShowSurveyPopup: isOn\n      });\n    };\n\n    _this.showFeedbackAlert = function () {\n      _this.handleFreeTrialSurvey(true);\n    };\n\n    _this.showFeedbackResultAlert = function (success) {\n      var title = success ? \"ID_WIZLIVE_FEEDBACK_COMPLETE\" : \"ID_WIZLIVE_FEEDBACK_FAIL\";\n      var subtitle = success ? \"\" : \"ID_WIZLIVE_FEEDBACK_FAIL_ADMIN\";\n      showPopUp( /*#__PURE__*/React.createElement(Popup.OneButton, {\n        intl: _this.props.intl,\n        titleId: title,\n        subtitleId: subtitle,\n        buttonNameId: \"ID_WIZLIVE_COMFIRM\",\n        __self: _assertThisInitialized(_this),\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 835,\n          columnNumber: 7\n        }\n      }));\n    };\n\n    _this.janus = null;\n    _this.sfutest = null;\n    _this.myid = null;\n    _this.mypvtid = null;\n    _this.feeds = [];\n    _this.mystream = null;\n    _this.opaqueId = \"wizlive-\" + Janus.randomString(12); // this.currentUser = null;\n    // this.hasTutor = false;\n\n    _this.tutorVideo = undefined;\n    _this.localVideo = undefined;\n    _this.studentVideos = [];\n    _this.remoteVideos = [];\n    _this.email = _this.opaqueId;\n    _this.tutorName = \"\";\n    _this.janusServerURL = URL.JANUS_SERVER;\n    _this.localStreamEmail = _this.props.isTutor ? _this.props.tutorEmail : _this.props.email;\n    _this.attendees = [];\n    _this.state = {\n      attendees: [],\n      students: [],\n      tutor: [],\n      isShowSurveyPopup: false,\n      isEnd: false,\n      roomStatus: \"connecting\"\n    };\n    return _this;\n  }\n\n  _createClass(Container, [{\n    key: \"getReservationStudents\",\n    value: function () {\n      var _getReservationStudents = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee() {\n        var attendees, tutor;\n        return _regeneratorRuntime.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                _context.prev = 0;\n                _context.next = 3;\n                return request.getReservationStudents(this.props.roomId).then(function (res) {\n                  return res.json();\n                });\n\n              case 3:\n                attendees = _context.sent;\n\n                if (attendees.length) {\n                  this.setState({\n                    attendees: attendees.map(function (attendee) {\n                      return _objectSpread({}, attendee, {\n                        audioEnabled: true\n                      });\n                    })\n                  });\n                  tutor = attendees[attendees.length - 1];\n                  this.tutorName = tutor.name;\n                }\n\n                _context.next = 10;\n                break;\n\n              case 7:\n                _context.prev = 7;\n                _context.t0 = _context[\"catch\"](0);\n                console.error(_context.t0);\n\n              case 10:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee, this, [[0, 7]]);\n      }));\n\n      function getReservationStudents() {\n        return _getReservationStudents.apply(this, arguments);\n      }\n\n      return getReservationStudents;\n    }()\n  }, {\n    key: \"updateWizLiveEntrance\",\n    value: function () {\n      var _updateWizLiveEntrance = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2() {\n        var _this$props3, tutorEmail, email, reservationId, pId, roomId, json;\n\n        return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n          while (1) {\n            switch (_context2.prev = _context2.next) {\n              case 0:\n                _this$props3 = this.props, tutorEmail = _this$props3.tutorEmail, email = _this$props3.email, reservationId = _this$props3.reservationId, pId = _this$props3.pId, roomId = _this$props3.roomId;\n                _context2.prev = 1;\n                _context2.next = 4;\n                return request.postWizLive1v4Entrance({\n                  id: reservationId,\n                  isTutor: email === tutorEmail,\n                  pId: pId,\n                  roomId: roomId\n                }).then(function (res) {\n                  return res.json();\n                });\n\n              case 4:\n                json = _context2.sent;\n                if (!json.success) console.error(json.reason);\n                _context2.next = 11;\n                break;\n\n              case 8:\n                _context2.prev = 8;\n                _context2.t0 = _context2[\"catch\"](1);\n                console.error(_context2.t0);\n\n              case 11:\n              case \"end\":\n                return _context2.stop();\n            }\n          }\n        }, _callee2, this, [[1, 8]]);\n      }));\n\n      function updateWizLiveEntrance() {\n        return _updateWizLiveEntrance.apply(this, arguments);\n      }\n\n      return updateWizLiveEntrance;\n    }()\n  }, {\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      var _this2 = this;\n\n      this.setup(); // 수업 명단\n\n      this.getReservationStudents(); // 입장 시간 및 pId 업데이트\n\n      this.updateWizLiveEntrance(); // 수업 퇴장\n\n      socketUtil.socket.on(\"lectureExit\", function (data) {\n        if (!_this2.props.isTutor) {\n          _this2.unpublish();\n\n          _this2.setState({\n            isEnd: true\n          });\n\n          _this2.showFeedbackAlert();\n        }\n      }); // 오디오 on/offt\n\n      socketUtil.socket.on(\"audioChanged\", function (data) {\n        var email = data.email,\n            audioEnabled = data.audioEnabled;\n        var mutedUserEmail = email;\n        var myEmail = _this2.props.email;\n\n        if (mutedUserEmail === myEmail) {\n          var media = audioEnabled ? {\n            addAudio: true\n          } : {\n            removeAudio: true\n          };\n\n          _this2.sfutest.createOffer({\n            media: media,\n            error: function error(_error3) {\n              console.log(\"WebRTC error... \" + JSON.stringify(_error3));\n            }\n          });\n        }\n\n        _this2.setState({\n          attendees: _this2.state.attendees.map(function (attendee) {\n            if (attendee.email === email) {\n              return _objectSpread({}, attendee, {\n                audioEnabled: audioEnabled\n              });\n            } else {\n              return attendee;\n            }\n          })\n        });\n      });\n    }\n  }, {\n    key: \"publishOwnFeed\",\n    value: function publishOwnFeed(useAudio) {\n      var _this3 = this;\n\n      // Publish our stream\n      this.sfutest.createOffer({\n        // Add data:true here if you want to publish datachannels as well\n        media: {\n          audioRecv: false,\n          videoRecv: false,\n          audioSend: useAudio,\n          videoSend: true\n        },\n        // Publishers are sendonly\n        // If you want to test simulcasting (Chrome and Firefox only), then\n        // pass a ?simulcast=true when opening this demo page: it will turn\n        // the following 'simulcast' property to pass to janus.js to true\n        // simulcast: true,\n        // simulcast2: true,\n        success: function success(jsep) {\n          Janus.debug(\"Got publisher SDP!\", jsep);\n          var publish = {\n            request: \"configure\",\n            audio: useAudio,\n            video: true\n          }; // You can force a specific codec to use when publishing by using the\n          // audiocodec and videocodec properties, for instance:\n          // \t\tpublish[\"audiocodec\"] = \"opus\"\n          // to force Opus as the audio codec to use, or:\n          // \t\tpublish[\"videocodec\"] = \"vp9\"\n          // to force VP9 as the videocodec to use. In both case, though, forcing\n          // a codec will only work if: (1) the codec is actually in the SDP (and\n          // so the browser supports it), and (2) the codec is in the list of\n          // allowed codecs in a room. With respect to the point (2) above,\n          // refer to the text in janus.plugin.videoroom.jcfg for more details.\n          // We allow people to specify a codec via query string, for demo purposes\n          // if (acodec) publish[\"audiocodec\"] = acodec;\n          // if (vcodec) publish[\"videocodec\"] = vcodec;\n\n          _this3.sfutest.send({\n            message: publish,\n            jsep: jsep\n          });\n        },\n        error: function error(_error4) {\n          Janus.error(\"WebRTC error:\", _error4);\n\n          if (useAudio) {\n            _this3.publishOwnFeed(false);\n          }\n        }\n      });\n    } // remoteFeed\n\n  }, {\n    key: \"newRemoteFeed\",\n    value: function newRemoteFeed(id, display, audio, video) {\n      var _this4 = this;\n\n      var remoteFeed = null;\n      this.janus.attach({\n        plugin: \"janus.plugin.videoroom\",\n        opaqueId: this.opaqueId,\n        success: function success(pluginHandle) {\n          // console.log(1111, \"--------- remote feed attach janus ok ----------\");\n          remoteFeed = pluginHandle;\n          remoteFeed.simulcastStarted = false;\n          Janus.log(\"Plugin attached! (\" + remoteFeed.getPlugin() + \", id=\" + remoteFeed.getId() + \" as a subscriber)\"); // We wait for the plugin to send us an offer\n\n          var subscribe = {\n            request: \"join\",\n            room: _this4.props.roomId,\n            ptype: \"subscriber\",\n            feed: id,\n            private_id: _this4.mypvtid\n          }; // In case you don't want to receive audio, video or data, even if the\n          // publisher is sending them, set the 'offer_audio', 'offer_video' or\n          // 'offer_data' properties to false (they're true by default), e.g.:\n          // \t\tsubscribe[\"offer_video\"] = false;\n          // For example, if the publisher is VP8 and this is Safari, let's avoid video\n\n          if (Janus.webRTCAdapter.browserDetails.browser === \"safari\" && (video === \"vp9\" || video === \"vp8\" && !Janus.safariVp8)) {\n            if (video) video = video.toUpperCase();\n            subscribe[\"offer_video\"] = false;\n          }\n\n          remoteFeed.videoCodec = video;\n          remoteFeed.send({\n            message: subscribe\n          });\n        },\n        error: function error(_error5) {\n          Janus.error(\"  -- Error attaching plugin...\", _error5);\n        },\n        onmessage: function onmessage(msg, jsep) {\n          Janus.debug(\" ::: Got a message (subscriber) :::\", msg);\n          var event = msg[\"videoroom\"];\n          Janus.debug(\"Event: \" + event);\n\n          if (msg[\"error\"]) {// handle error if needed\n          } else if (event) {\n            if (event === \"attached\") {\n              // console.log(\n              //   1111,\n              //   display.email + \": --------- remote attached ----------\"\n              // );\n              // Subscriber created and attached\n              for (var i = 0; i < 4; i++) {\n                if (!_this4.feeds[i]) {\n                  _this4.feeds[i] = remoteFeed;\n                  remoteFeed.rfindex = i;\n                  console.log(1111, \"display: \" + display.email + \" tutorEmail : \" + _this4.props.tutorEmail); // add student name when we got now feed\n                  // this.students[i] = JSON.parse(display).email;\n\n                  break;\n                }\n              }\n\n              remoteFeed.rfid = msg[\"id\"]; // remoteFeed.rfdisplay = msg[\"display\"];\n\n              remoteFeed.rfdisplay = display.email;\n              remoteFeed.name = display.name; // remoteFeed.pId = display.pId;\n\n              console.log(1111, \"remote.rfdisplay : ----\" + remoteFeed.rfdisplay);\n              Janus.log(\"Successfully attached to feed \" + remoteFeed.rfid + \" (\" + remoteFeed.rfdisplay + \") in room \" + msg[\"room\"]);\n            }\n\n            if (jsep) {\n              Janus.debug(\"Handling SDP as well...\", jsep); // Answer and attach\n\n              remoteFeed.createAnswer({\n                jsep: jsep,\n                // Add data:true here if you want to subscribe to datachannels as well\n                media: {\n                  audioSend: false,\n                  videoSend: false\n                },\n                // We want recvonly audio/video\n                success: function success(jsep) {\n                  Janus.debug(\"Got SDP!\", jsep);\n                  var body = {\n                    request: \"start\",\n                    room: _this4.props.roomId\n                  };\n                  remoteFeed.send({\n                    message: body,\n                    jsep: jsep\n                  });\n                },\n                error: function error(_error6) {\n                  Janus.error(\"WebRTC error:\", _error6);\n                }\n              });\n            }\n          }\n        },\n        iceState: function iceState(state) {\n          Janus.log(\"ICE state of this WebRTC PeerConnection (feed #\" + remoteFeed.rfindex + \") changed to \" + state);\n        },\n        webrtcState: function webrtcState(on) {\n          Janus.log(\"Janus says this WebRTC PeerConnection (feed #\" + remoteFeed.rfindex + \") is \" + (on ? \"up\" : \"down\") + \" now\");\n        },\n        onlocalstream: function onlocalstream(stream) {// The subscriber stream is recvonly, we don't expect anything here\n        },\n        onremotestream: function onremotestream(stream) {\n          Janus.debug(\"Remote feed #\" + remoteFeed.rfindex + \", stream:\", stream);\n\n          if (display.email === _this4.props.tutorEmail) {\n            console.log(1111, \"someone has attached as tutor - display: \".concat(display.email, \", tutorEmail: \").concat(_this4.props.tutorEmail));\n            Janus.attachMediaStream(_this4.tutorVideo, stream);\n\n            var tutorMap = function tutorMap(data) {\n              return data.reduce(function (acc, cur) {\n                var email = cur.email,\n                    pId = cur.pId,\n                    name = cur.name;\n                return acc.set(cur.email, {\n                  email: email,\n                  pId: pId,\n                  name: name\n                });\n              }, new Map());\n            };\n\n            _this4.setState(function (prevState) {\n              return {\n                tutor: _toConsumableArray(tutorMap([].concat(_toConsumableArray(prevState.tutor), [display])).values())\n              };\n            }, function () {\n              return _this4.props.setTutor(_this4.state.tutor);\n            });\n          } else {\n            console.log(1111, \"**** someone has attached as student - display: \".concat(display.email, \" rfindex: \") // remoteFeed.rfindex\n            );\n\n            var index = _this4.state.attendees.findIndex(function (_ref2) {\n              var email = _ref2.email;\n              return email === display.email;\n            });\n\n            console.log(1111, \"onremoteStream index: \".concat(index, \", \").concat(display.email));\n            Janus.attachMediaStream(_this4.studentVideos[index], stream);\n\n            var studentsMap = function studentsMap(data) {\n              return data.reduce(function (acc, cur) {\n                var email = cur.email,\n                    pId = cur.pId,\n                    name = cur.name;\n                return acc.set(cur.email, {\n                  email: email,\n                  pId: pId,\n                  name: name\n                });\n              }, new Map());\n            };\n\n            _this4.setState(function (prevState) {\n              return {\n                students: _toConsumableArray(studentsMap([].concat(_toConsumableArray(prevState.students), [display])).values())\n              };\n            }, function () {\n              return _this4.props.setStudents(_this4.state.students);\n            });\n          }\n\n          var videoTracks = stream.getVideoTracks();\n\n          if (!videoTracks || videoTracks.length === 0) {// No remote video\n          }\n        },\n        oncleanup: function oncleanup() {\n          Janus.log(\" ::: Got a cleanup notification (remote feed \" + id + \") :::\");\n        }\n      });\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _this$props4 = this.props,\n          isTutor = _this$props4.isTutor,\n          handleChangeZIndex = _this$props4.handleChangeZIndex,\n          zIndex = _this$props4.zIndex,\n          email = _this$props4.email,\n          tutorEmail = _this$props4.tutorEmail,\n          reservationId = _this$props4.reservationId,\n          isFreeTrial = _this$props4.isFreeTrial;\n      var _this$state = this.state,\n          students = _this$state.students,\n          audioEnabled = _this$state.audioEnabled,\n          isShowSurveyPopup = _this$state.isShowSurveyPopup,\n          attendees = _this$state.attendees,\n          roomStatus = _this$state.roomStatus;\n      var tutorName = this.tutorName,\n          setTutorVideo = this.setTutorVideo,\n          setStudentVideo = this.setStudentVideo,\n          feeds = this.feeds,\n          handleVoiceToggleButton = this.handleVoiceToggleButton,\n          handleExitBtn = this.handleExitBtn,\n          handleFreeTrialSurvey = this.handleFreeTrialSurvey,\n          refreshVideos = this.refreshVideos;\n      return /*#__PURE__*/React.createElement(React.Fragment, {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 880,\n          columnNumber: 7\n        }\n      }, /*#__PURE__*/React.createElement(RndWrapper, {\n        id: \"live\",\n        style: {\n          zIndex: zIndex\n        },\n        defaultWidth: 300,\n        defaultHeight: 300 * 9 / 16 * 2 + 35,\n        defaultX: document.body.clientWidth - 365,\n        defaultY: 0,\n        minWidth: 300,\n        minHeight: 300 * 9 / 16 * 2 + 35,\n        lockAspectRatio: 16 / 9 / 2,\n        lockAspectRatioExtraHeight: 35,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 881,\n          columnNumber: 9\n        }\n      }, /*#__PURE__*/React.createElement(View // addStudentVideo={this.addStudentVideo}\n      // addTutorVideo={this.addTutorVideo}\n      , {\n        setTutorVideo: setTutorVideo,\n        setStudentVideo: setStudentVideo // tutorEmail={tutorEmail}\n        ,\n        tutorName: tutorName,\n        students: students,\n        isTutor: isTutor,\n        handleChangeZIndex: handleChangeZIndex,\n        feeds: feeds,\n        attendees: attendees,\n        email: email,\n        handleVoiceToggleButton: handleVoiceToggleButton,\n        audioEnabled: audioEnabled,\n        tutorEmail: tutorEmail,\n        handleExitBtn: handleExitBtn,\n        refreshVideos: refreshVideos,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 893,\n          columnNumber: 11\n        }\n      })), isShowSurveyPopup && /*#__PURE__*/React.createElement(FreeTrialSurveyPopup, {\n        reservationId: reservationId,\n        tutorEmail: tutorEmail,\n        handleFreeTrialSurvey: handleFreeTrialSurvey,\n        isFreeTrial: isFreeTrial,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 914,\n          columnNumber: 11\n        }\n      }), isShowSurveyPopup && /*#__PURE__*/React.createElement(FreeTrialSurveyPopup, {\n        reservationId: reservationId,\n        tutorEmail: tutorEmail,\n        handleFreeTrialSurvey: handleFreeTrialSurvey,\n        isFreeTrial: isFreeTrial,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 922,\n          columnNumber: 11\n        }\n      }), roomStatus !== \"connected\" && /*#__PURE__*/React.createElement(\"div\", {\n        className: \"roomStatusPopup\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 930,\n          columnNumber: 11\n        }\n      }, /*#__PURE__*/React.createElement(\"div\", {\n        className: \"roomStatusPopupContent\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 931,\n          columnNumber: 13\n        }\n      }, roomStatus === \"connecting\" && /*#__PURE__*/React.createElement(React.Fragment, {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 933,\n          columnNumber: 17\n        }\n      }, /*#__PURE__*/React.createElement(\"div\", {\n        className: \"roomStatusPopupMessage\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 934,\n          columnNumber: 19\n        }\n      }, \"\\uC811\\uC18D \\uC911\\uC785\\uB2C8\\uB2E4..\"), /*#__PURE__*/React.createElement(\"div\", {\n        className: \"roomStatusPopupProgress\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 935,\n          columnNumber: 19\n        }\n      })), roomStatus === \"ready\" && /*#__PURE__*/React.createElement(React.Fragment, {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 939,\n          columnNumber: 17\n        }\n      }, /*#__PURE__*/React.createElement(\"div\", {\n        className: \"roomStatusPopupMessage\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 940,\n          columnNumber: 19\n        }\n      }, \"\\uC811\\uC18D \\uB418\\uC5C8\\uC2B5\\uB2C8\\uB2E4.\"), /*#__PURE__*/React.createElement(\"div\", {\n        className: \"roomStatusPopupBtn\",\n        onClick: refreshVideos,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 941,\n          columnNumber: 19\n        }\n      }, \"\\uC2DC\\uC791\\uD558\\uAE30\")))));\n    }\n  }]);\n\n  return Container;\n}(Component);\n\nexport default connect(function (state) {\n  var _state$scene = state.scene,\n      history = _state$scene.history,\n      historyIndex = _state$scene.historyIndex,\n      _scene = _objectWithoutProperties(_state$scene, [\"history\", \"historyIndex\"]);\n\n  return {\n    selectedSceneId: state.interaction.selected.scene,\n    selectedObject: state.interaction.selected.objects[state.interaction.selected.scene],\n    pId: state.project.pId,\n    scene: _scene,\n    interaction: _objectSpread({}, state.interaction, {\n      jukebox: {\n        isPlaying: false\n      },\n      addSoundsTimeStamp: undefined\n    }),\n    preview: state.preview,\n    currentUser: state.tabs.currentUser\n  };\n}, {\n  setStudents: tabActions.setStudents,\n  setTutor: tabActions.setTutor,\n  setProject: projectActions.setProject\n})(Container);","map":{"version":3,"sources":["/Users/jimmy/Documents/Wizschool/wizlab_web2/src/Page/Builder/Component/MultiLive/Container.js"],"names":["React","Component","connect","Popup","showPopUp","URL","request","projectActions","tabActions","RndWrapper","FreeTrialSurveyPopup","socketUtil","View","Janus","window","Container","props","setup","init","debug","callback","setupJanus","janus","server","janusServerURL","success","attach","plugin","opaqueId","pluginHandle","sfutest","log","getPlugin","getId","checkRoom","error","alert","consentDialog","on","iceState","state","mediaState","medium","webrtcState","onmessage","msg","jsep","event","myid","mypvtid","publishOwnFeed","length","list","f","id","display","audio","video","JSON","parse","email","console","newRemoteFeed","send","message","room","roomId","data","roomStatus","setState","warn","leaving","i","feeds","rfid","detach","unpublished","hangup","attendees","map","attendee","rfdisplay","audioEnabled","sendSocketEvent","handleRemoteJsep","mystream","getAudioTracks","getVideoTracks","onlocalstream","stream","isTutor","attachMediaStream","tutorVideo","index","findIndex","studentVideos","prevState","students","pId","name","videoTracks","onremotestream","oncleanup","destroyed","location","reload","exists","registerUsername","publishers","is_private","register","ptype","stringify","unpublish","setTutorVideo","setStudentVideo","refreshVideos","paused","play","forEach","v","handleVoiceToggleButton","remoteFeed","handleExitBtn","showExitConfirmAlert","setComplete1v4Reservation","isEnd","showExitAlert","intl","studentEmail","reservationId","url","WIZLIVE","open","handleFreeTrialSurvey","isOn","isShowSurveyPopup","showFeedbackAlert","showFeedbackResultAlert","title","subtitle","randomString","undefined","localVideo","remoteVideos","tutorName","JANUS_SERVER","localStreamEmail","tutorEmail","tutor","getReservationStudents","then","res","json","postWizLive1v4Entrance","reason","updateWizLiveEntrance","socket","mutedUserEmail","myEmail","media","addAudio","removeAudio","createOffer","useAudio","audioRecv","videoRecv","audioSend","videoSend","publish","simulcastStarted","subscribe","feed","private_id","webRTCAdapter","browserDetails","browser","safariVp8","toUpperCase","videoCodec","rfindex","createAnswer","body","tutorMap","reduce","acc","cur","set","Map","values","setTutor","studentsMap","setStudents","handleChangeZIndex","zIndex","isFreeTrial","document","clientWidth","scene","history","historyIndex","_scene","selectedSceneId","interaction","selected","selectedObject","objects","project","jukebox","isPlaying","addSoundsTimeStamp","preview","currentUser","tabs","setProject"],"mappings":"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","sourcesContent":["import React, { Component } from \"react\";\nimport { connect } from \"react-redux\";\nimport Popup, { showPopUp } from \"../../../../Common/Component/PopUp\";\nimport { URL } from \"../../../../Common/Util/Constant\";\nimport * as request from \"../../../../Common/Util/HTTPRequest\";\nimport * as projectActions from \"../../Store/Reducer/project\";\nimport * as tabActions from \"../../Store/Reducer/tabs\";\nimport RndWrapper from \"../../utils/RndWrapper\";\nimport FreeTrialSurveyPopup from \"../Live/Component/FreeTrialSurveyPopup\";\nimport { socketUtil } from \"../Socket/Container\";\nimport View from \"./View\";\n\nconst Janus = window.Janus;\n\nclass Container extends Component {\n  constructor(props) {\n    super(props);\n    this.janus = null;\n    this.sfutest = null;\n    this.myid = null;\n    this.mypvtid = null;\n    this.feeds = [];\n    this.mystream = null;\n    this.opaqueId = \"wizlive-\" + Janus.randomString(12);\n    // this.currentUser = null;\n    // this.hasTutor = false;\n    this.tutorVideo = undefined;\n    this.localVideo = undefined;\n    this.studentVideos = [];\n    this.remoteVideos = [];\n    this.email = this.opaqueId;\n    this.tutorName = \"\";\n    this.janusServerURL = URL.JANUS_SERVER;\n    this.localStreamEmail = this.props.isTutor\n      ? this.props.tutorEmail\n      : this.props.email;\n    this.attendees = [];\n    this.state = {\n      attendees: [],\n      students: [],\n      tutor: [],\n      isShowSurveyPopup: false,\n      isEnd: false,\n      roomStatus: \"connecting\"\n    };\n  }\n\n  async getReservationStudents() {\n    try {\n      const attendees = await request\n        .getReservationStudents(this.props.roomId)\n        .then(res => res.json());\n\n      if (attendees.length) {\n        this.setState({\n          attendees: attendees.map(attendee => ({\n            ...attendee,\n            audioEnabled: true\n          }))\n        });\n\n        const tutor = attendees[attendees.length - 1];\n        this.tutorName = tutor.name;\n      }\n    } catch (err) {\n      console.error(err);\n    }\n  }\n\n  async updateWizLiveEntrance() {\n    const { tutorEmail, email, reservationId, pId, roomId } = this.props;\n\n    try {\n      const json = await request\n        .postWizLive1v4Entrance({\n          id: reservationId,\n          isTutor: email === tutorEmail,\n          pId,\n          roomId\n        })\n        .then(res => res.json());\n\n      if (!json.success) console.error(json.reason);\n    } catch (err) {\n      console.error(err);\n    }\n  }\n\n  componentDidMount() {\n    this.setup();\n    // 수업 명단\n    this.getReservationStudents();\n\n    // 입장 시간 및 pId 업데이트\n    this.updateWizLiveEntrance();\n\n    // 수업 퇴장\n    socketUtil.socket.on(\"lectureExit\", data => {\n      if (!this.props.isTutor) {\n        this.unpublish();\n        this.setState({ isEnd: true });\n        this.showFeedbackAlert();\n      }\n    });\n\n    // 오디오 on/offt\n    socketUtil.socket.on(\"audioChanged\", data => {\n      const { email, audioEnabled } = data;\n      const mutedUserEmail = email;\n      const myEmail = this.props.email;\n\n      if (mutedUserEmail === myEmail) {\n        const media = audioEnabled ? { addAudio: true } : { removeAudio: true };\n        this.sfutest.createOffer({\n          media: media,\n          error: function (error) {\n            console.log(\"WebRTC error... \" + JSON.stringify(error));\n          }\n        });\n      }\n\n      this.setState({\n        attendees: this.state.attendees.map(attendee => {\n          if (attendee.email === email) {\n            return { ...attendee, audioEnabled };\n          } else {\n            return attendee;\n          }\n        })\n      });\n    });\n  }\n\n  setup = () => {\n    Janus.init({ debug: \"all\", callback: this.setupJanus });\n  };\n\n  setupJanus = () => {\n    this.janus = new Janus({\n      server: this.janusServerURL,\n      success: () => {\n        this.janus.attach({\n          plugin: \"janus.plugin.videoroom\",\n          opaqueId: this.opaqueId,\n          success: pluginHandle => {\n            this.sfutest = pluginHandle;\n            Janus.log(\n              \"Plugin attached! (\" +\n              this.sfutest.getPlugin() +\n              \", id=\" +\n              this.sfutest.getId() +\n              \")\"\n            );\n            this.checkRoom();\n          },\n          error: error => {\n            Janus.error(\"  -- Error attaching plugin...\", error);\n            alert(\"Error attaching plugin... \" + error);\n          },\n          consentDialog: on => {\n            Janus.debug(\n              \"Consent dialog should be \" + (on ? \"on\" : \"off\") + \" now\"\n            );\n          },\n          iceState: state => {\n            Janus.log(\"ICE state changed to \" + state);\n          },\n          mediaState: (medium, on) => {\n            Janus.log(\n              \"Janus \" +\n              (on ? \"started\" : \"stopped\") +\n              \" receiving our \" +\n              medium\n            );\n          },\n          webrtcState: on => {\n            Janus.log(\n              \"Janus says our WebRTC PeerConnection is \" +\n              (on ? \"up\" : \"down\") +\n              \" now\"\n            );\n          },\n          onmessage: (msg, jsep) => {\n            Janus.debug(\" ::: Got a message (publisher) :::\", msg);\n            var event = msg[\"videoroom\"];\n            Janus.debug(\"Event: \" + event);\n\n            if (event) {\n              if (event === \"joined\") {\n                // Publisher/manager created, negotiate WebRTC and attach to existing feeds, if any\n                this.myid = msg[\"id\"];\n                this.mypvtid = msg[\"private_id\"];\n                Janus.log(\n                  \"Successfully joined room \" +\n                  msg[\"room\"] +\n                  \" with ID \" +\n                  this.myid\n                );\n\n                this.publishOwnFeed(true);\n\n                if (msg[\"publishers\"] && msg[\"publishers\"].length) {\n                  const list = msg[\"publishers\"];\n                  Janus.debug(\n                    \"Got a list of available publishers/feeds:\",\n                    list\n                  );\n                  for (let f in list) {\n                    let id = list[f][\"id\"];\n                    let display = list[f][\"display\"];\n                    let audio = list[f][\"audio_codec\"];\n                    let video = list[f][\"video_codec\"];\n                    display = JSON.parse(display);\n                    Janus.debug(\n                      \"  >> [\" +\n                      id +\n                      \"] \" +\n                      display.email +\n                      \" (audio: \" +\n                      audio +\n                      \", video: \" +\n                      video +\n                      \")\"\n                    );\n                    if (display.email !== this.props.email) {\n                      console.log(\n                        1111,\n                        `I joined: remote email - ${display.email}`\n                      );\n                      this.newRemoteFeed(id, display, audio, video);\n                    } else {\n                      this.sfutest.send({\n                        message: {\n                          request: \"kick\",\n                          room: this.props.roomId,\n                          id: id\n                        },\n                        success: data => {\n                          Janus.debug(data);\n                        }\n                      });\n                    }\n                  }\n                }\n                if (this.state.roomStatus === \"connecting\") {\n                  this.setState({ roomStatus: \"ready\" });\n                }\n              } else if (event === \"destroyed\") {\n                Janus.warn(\"The room has been destroyed!\");\n              } else if (event === \"event\") {\n                if (msg[\"publishers\"] && msg[\"publishers\"].length) {\n                  var list = msg[\"publishers\"];\n                  Janus.debug(\n                    \"Got a list of available publishers/feeds:\",\n                    list\n                  );\n                  for (let f in list) {\n                    let id = list[f][\"id\"];\n                    let display = list[f][\"display\"];\n                    let audio = list[f][\"audio_codec\"];\n                    let video = list[f][\"video_codec\"];\n                    display = JSON.parse(display);\n                    Janus.debug(\n                      \"  >> [\" +\n                      id +\n                      \"] \" +\n                      display +\n                      \" (audio: \" +\n                      audio +\n                      \", video: \" +\n                      video +\n                      \")\"\n                    );\n                    if (display.email !== this.props.email) {\n                      console.log(\n                        1111,\n                        `someone joined: remote email - ${display.email}`\n                      );\n                      this.newRemoteFeed(id, display, audio, video);\n                    }\n                  }\n                } else if (msg[\"leaving\"]) {\n                  let leaving = msg[\"leaving\"];\n                  Janus.log(\"Publisher left leaving: \" + leaving);\n\n                  for (var i = 0; i < 4; i++) {\n                    if (this.feeds[i] && this.feeds[i].rfid === leaving) {\n                      this.feeds[i].detach();\n                      this.feeds[i] = null;\n                      // this.studentName[feed.rfindex] = null;\n                      console.log(1111, \"student is leaving index: \" + i);\n                      break;\n                    }\n                  }\n                } else if (msg[\"unpublished\"]) {\n                  var unpublished = msg[\"unpublished\"];\n                  Janus.log(\"Publisher left unpublished: \" + unpublished);\n                  if (unpublished === \"ok\") {\n                    this.sfutest.hangup();\n                    return;\n                  }\n\n                  // unpublished 됐을 때 오디오 아이콘 리셋\n                  for (let i = 0; i < 4; i++) {\n                    if (this.feeds[i] && this.feeds[i].rfid === unpublished) {\n                      this.setState(\n                        {\n                          attendees: this.state.attendees.map(attendee => {\n                            if (attendee.email === this.feeds[i].rfdisplay) {\n                              return { ...attendee, audioEnabled: true };\n                            } else {\n                              return attendee;\n                            }\n                          })\n                        },\n                        () => {\n                          // broadcast\n                          socketUtil.sendSocketEvent(\"audioChanged\", {\n                            roomId: this.props.roomId,\n                            email: this.feeds[i].rfdisplay,\n                            audioEnabled: true\n                          });\n                        }\n                      );\n                      this.feeds[i].detach();\n                      this.feeds[i] = null;\n                      // this.studentName[feed.rfindex] = null;\n                      console.log(1111, \"student is unpublishing index: \" + i);\n                      break;\n                    }\n                  }\n                } else if (msg[\"error\"]) {\n                  if (msg[\"error_code\"] === 426) {\n                    // no such room error\n                  } else {\n                    // other errors\n                  }\n                }\n              }\n            }\n            if (jsep) {\n              Janus.debug(\"Handling SDP as well...\", jsep);\n              this.sfutest.handleRemoteJsep({ jsep: jsep });\n              // Check if any of the media we wanted to publish has\n              // been rejected (e.g., wrong or unsupported codec)\n              var audio = msg[\"audio_codec\"];\n              if (\n                this.mystream &&\n                this.mystream.getAudioTracks() &&\n                this.mystream.getAudioTracks().length > 0 &&\n                !audio\n              ) {\n                // Audio has been rejected\n              }\n              var video = msg[\"video_codec\"];\n              if (\n                this.mystream &&\n                this.mystream.getVideoTracks() &&\n                this.mystream.getVideoTracks().length > 0 &&\n                !video\n              ) {\n                // Video has been rejected\n              }\n            }\n          },\n          onlocalstream: stream => {\n            Janus.debug(\" ::: Got a local stream :::\", stream);\n            console.log(\"benjamin --- stream \", stream);\n            this.mystream = stream;\n\n            if (this.props.isTutor) {\n              Janus.attachMediaStream(this.tutorVideo, stream);\n              // Janus.attachMediaStream(this.localVideo, stream);\n              // console.log(\n              //   1111,\n              //   `onlocalstream - I am a tutor with email: ${this.props.email}`\n              // );\n            } else {\n              const index = this.state.attendees.findIndex(\n                ({ email }) => email === this.props.email\n              );\n\n              console.log(\n                1111,\n                `localStream attendees index ${index}, ${this.props.email}`\n              );\n\n              Janus.attachMediaStream(this.studentVideos[index], stream);\n              // Janus.attachMediaStream(this.localVideo, stream);\n              // console.log(\n              //   1111,\n              //   `onlocalstream - I am a student with email: ${this.props.email}`\n              // );\n              this.setState(prevState => ({\n                students: [\n                  {\n                    email: this.props.email,\n                    pId: this.props.pId,\n                    name: this.props.name\n                  },\n                  ...prevState.students\n                ]\n              }));\n            }\n\n            var videoTracks = stream.getVideoTracks();\n            if (!videoTracks || videoTracks.length === 0) {\n              // No webcam\n            }\n          },\n          onremotestream: stream => {\n            // The publisher stream is sendonly, we don't expect anything here\n          },\n          oncleanup: () => {\n            Janus.log(\n              \" ::: Got a cleanup notification: we are unpublished now :::\"\n            );\n            this.mystream = null;\n          }\n        });\n      },\n      error: error => {\n        Janus.error(error);\n      },\n      destroyed: () => {\n        window.location.reload();\n      }\n    });\n  };\n\n  checkRoom = () => {\n    Janus.debug(\"is room exist...?\");\n    this.sfutest.send({\n      message: { request: \"exists\", room: this.props.roomId },\n      success: data => {\n        if (data.exists) {\n          this.registerUsername();\n        } else {\n          Janus.debug(\"Room is creating...\");\n          this.sfutest.send({\n            message: {\n              request: \"create\",\n              // bitrate: this.maximumBitrate / 2,\n              publishers: 30,\n              // bitrate_cap: true,\n              room: this.props.roomId,\n              is_private: true\n            },\n            success: this.registerUsername\n          });\n        }\n      }\n    });\n  };\n\n  registerUsername = () => {\n    const register = {\n      request: \"join\",\n      room: this.props.roomId,\n      ptype: \"publisher\",\n      display: JSON.stringify({\n        email: this.props.email,\n        pId: this.props.pId,\n        name: this.props.name\n      })\n    };\n    this.sfutest.send({ message: register });\n  };\n\n  unpublish = () => {\n    const message = {\n      request: \"unpublish\"\n    };\n    this.sfutest.send({ message: message });\n  };\n\n  publishOwnFeed(useAudio) {\n    // Publish our stream\n    this.sfutest.createOffer({\n      // Add data:true here if you want to publish datachannels as well\n      media: {\n        audioRecv: false,\n        videoRecv: false,\n        audioSend: useAudio,\n        videoSend: true\n      }, // Publishers are sendonly\n      // If you want to test simulcasting (Chrome and Firefox only), then\n      // pass a ?simulcast=true when opening this demo page: it will turn\n      // the following 'simulcast' property to pass to janus.js to true\n      // simulcast: true,\n      // simulcast2: true,\n      success: jsep => {\n        Janus.debug(\"Got publisher SDP!\", jsep);\n        var publish = { request: \"configure\", audio: useAudio, video: true };\n        // You can force a specific codec to use when publishing by using the\n        // audiocodec and videocodec properties, for instance:\n        // \t\tpublish[\"audiocodec\"] = \"opus\"\n        // to force Opus as the audio codec to use, or:\n        // \t\tpublish[\"videocodec\"] = \"vp9\"\n        // to force VP9 as the videocodec to use. In both case, though, forcing\n        // a codec will only work if: (1) the codec is actually in the SDP (and\n        // so the browser supports it), and (2) the codec is in the list of\n        // allowed codecs in a room. With respect to the point (2) above,\n        // refer to the text in janus.plugin.videoroom.jcfg for more details.\n        // We allow people to specify a codec via query string, for demo purposes\n        // if (acodec) publish[\"audiocodec\"] = acodec;\n        // if (vcodec) publish[\"videocodec\"] = vcodec;\n        this.sfutest.send({ message: publish, jsep: jsep });\n      },\n      error: error => {\n        Janus.error(\"WebRTC error:\", error);\n        if (useAudio) {\n          this.publishOwnFeed(false);\n        }\n      }\n    });\n  }\n\n  // remoteFeed\n  newRemoteFeed(id, display, audio, video) {\n    let remoteFeed = null;\n    this.janus.attach({\n      plugin: \"janus.plugin.videoroom\",\n      opaqueId: this.opaqueId,\n      success: pluginHandle => {\n        // console.log(1111, \"--------- remote feed attach janus ok ----------\");\n        remoteFeed = pluginHandle;\n        remoteFeed.simulcastStarted = false;\n        Janus.log(\n          \"Plugin attached! (\" +\n          remoteFeed.getPlugin() +\n          \", id=\" +\n          remoteFeed.getId() +\n          \" as a subscriber)\"\n        );\n        // We wait for the plugin to send us an offer\n        const subscribe = {\n          request: \"join\",\n          room: this.props.roomId,\n          ptype: \"subscriber\",\n          feed: id,\n          private_id: this.mypvtid\n        };\n        // In case you don't want to receive audio, video or data, even if the\n        // publisher is sending them, set the 'offer_audio', 'offer_video' or\n        // 'offer_data' properties to false (they're true by default), e.g.:\n        // \t\tsubscribe[\"offer_video\"] = false;\n        // For example, if the publisher is VP8 and this is Safari, let's avoid video\n        if (\n          Janus.webRTCAdapter.browserDetails.browser === \"safari\" &&\n          (video === \"vp9\" || (video === \"vp8\" && !Janus.safariVp8))\n        ) {\n          if (video) video = video.toUpperCase();\n          subscribe[\"offer_video\"] = false;\n        }\n        remoteFeed.videoCodec = video;\n        remoteFeed.send({ message: subscribe });\n      },\n      error: error => {\n        Janus.error(\"  -- Error attaching plugin...\", error);\n      },\n      onmessage: (msg, jsep) => {\n        Janus.debug(\" ::: Got a message (subscriber) :::\", msg);\n        var event = msg[\"videoroom\"];\n        Janus.debug(\"Event: \" + event);\n        if (msg[\"error\"]) {\n          // handle error if needed\n        } else if (event) {\n          if (event === \"attached\") {\n            // console.log(\n            //   1111,\n            //   display.email + \": --------- remote attached ----------\"\n            // );\n            // Subscriber created and attached\n\n            for (let i = 0; i < 4; i++) {\n              if (!this.feeds[i]) {\n                this.feeds[i] = remoteFeed;\n                remoteFeed.rfindex = i;\n                console.log(\n                  1111,\n                  \"display: \" +\n                  display.email +\n                  \" tutorEmail : \" +\n                  this.props.tutorEmail\n                );\n                // add student name when we got now feed\n                // this.students[i] = JSON.parse(display).email;\n                break;\n              }\n            }\n\n            remoteFeed.rfid = msg[\"id\"];\n            // remoteFeed.rfdisplay = msg[\"display\"];\n            remoteFeed.rfdisplay = display.email;\n            remoteFeed.name = display.name;\n            // remoteFeed.pId = display.pId;\n            console.log(1111, \"remote.rfdisplay : ----\" + remoteFeed.rfdisplay);\n\n            Janus.log(\n              \"Successfully attached to feed \" +\n              remoteFeed.rfid +\n              \" (\" +\n              remoteFeed.rfdisplay +\n              \") in room \" +\n              msg[\"room\"]\n            );\n          }\n          if (jsep) {\n            Janus.debug(\"Handling SDP as well...\", jsep);\n            // Answer and attach\n            remoteFeed.createAnswer({\n              jsep: jsep,\n              // Add data:true here if you want to subscribe to datachannels as well\n              media: { audioSend: false, videoSend: false }, // We want recvonly audio/video\n              success: jsep => {\n                Janus.debug(\"Got SDP!\", jsep);\n                var body = { request: \"start\", room: this.props.roomId };\n                remoteFeed.send({ message: body, jsep: jsep });\n              },\n              error: error => {\n                Janus.error(\"WebRTC error:\", error);\n              }\n            });\n          }\n        }\n      },\n      iceState: state => {\n        Janus.log(\n          \"ICE state of this WebRTC PeerConnection (feed #\" +\n          remoteFeed.rfindex +\n          \") changed to \" +\n          state\n        );\n      },\n      webrtcState: on => {\n        Janus.log(\n          \"Janus says this WebRTC PeerConnection (feed #\" +\n          remoteFeed.rfindex +\n          \") is \" +\n          (on ? \"up\" : \"down\") +\n          \" now\"\n        );\n      },\n      onlocalstream: stream => {\n        // The subscriber stream is recvonly, we don't expect anything here\n      },\n      onremotestream: stream => {\n        Janus.debug(\"Remote feed #\" + remoteFeed.rfindex + \", stream:\", stream);\n        if (display.email === this.props.tutorEmail) {\n          console.log(\n            1111,\n            `someone has attached as tutor - display: ${\n              display.email\n            }, tutorEmail: ${this.props.tutorEmail}`\n          );\n\n          Janus.attachMediaStream(this.tutorVideo, stream);\n\n          const tutorMap = data => {\n            return data.reduce((acc, cur) => {\n              const { email, pId, name } = cur;\n              return acc.set(cur.email, { email, pId, name });\n            }, new Map());\n          };\n\n          this.setState(\n            prevState => ({\n              tutor: [...tutorMap([...prevState.tutor, display]).values()]\n            }),\n            () => this.props.setTutor(this.state.tutor)\n          );\n        } else {\n          console.log(\n            1111,\n            `**** someone has attached as student - display: ${\n              display.email\n            } rfindex: `\n            // remoteFeed.rfindex\n          );\n\n          const index = this.state.attendees.findIndex(\n            ({ email }) => email === display.email\n          );\n\n          console.log(1111, `onremoteStream index: ${index}, ${display.email}`);\n\n          Janus.attachMediaStream(this.studentVideos[index], stream);\n\n          const studentsMap = data => {\n            return data.reduce((acc, cur) => {\n              const { email, pId, name } = cur;\n              return acc.set(cur.email, { email, pId, name });\n            }, new Map());\n          };\n\n          this.setState(\n            prevState => ({\n              students: [\n                ...studentsMap([...prevState.students, display]).values()\n              ]\n            }),\n            () => this.props.setStudents(this.state.students)\n          );\n        }\n\n        var videoTracks = stream.getVideoTracks();\n        if (!videoTracks || videoTracks.length === 0) {\n          // No remote video\n        }\n      },\n      oncleanup: () => {\n        Janus.log(\n          \" ::: Got a cleanup notification (remote feed \" + id + \") :::\"\n        );\n      }\n    });\n  }\n\n  setTutorVideo = video => {\n    this.tutorVideo = video;\n  };\n\n  setStudentVideo = (video, index) => {\n    this.studentVideos[index] = video;\n  };\n\n  refreshVideos = () => {\n    this.setState({ roomStatus: \"connected\" });\n    if (this.tutorVideo.paused) this.tutorVideo.play();\n    this.studentVideos.forEach(v => v.paused && v.play());\n  };\n\n  // 튜터만 마이크 제어\n  handleVoiceToggleButton = (email, audioEnabled) => {\n    const { isTutor, roomId } = this.props;\n    if (!isTutor) return;\n    if (this.feeds.length === 0) return;\n\n    for (let i = 0; i < this.feeds.length; i++) {\n      const remoteFeed = this.feeds[i];\n      if (remoteFeed.rfdisplay === email) {\n        // TODO: setState me\n        this.setState(\n          {\n            attendees: this.state.attendees.map(attendee => {\n              if (attendee.email === email) {\n                return { ...attendee, audioEnabled };\n              } else {\n                return attendee;\n              }\n            })\n          },\n          () => {\n            // braodcast\n            socketUtil.sendSocketEvent(\"audioChanged\", {\n              roomId: roomId,\n              email: email,\n              audioEnabled: !audioEnabled\n            });\n            // TODO remove\n            // this.state.attendees.map(attend => {\n            //   console.log(attend);\n            // });\n          }\n        );\n        break;\n      }\n    }\n  };\n\n  handleExitBtn = () => {\n    this.showExitConfirmAlert();\n  };\n\n  showExitConfirmAlert = () => {\n    const callback = () => {\n      request.setComplete1v4Reservation();\n      // this.sendData(this.DATA_TYPE_EXIT, null);\n      socketUtil.sendSocketEvent(\"lectureExit\", {\n        roomId: this.props.roomId\n      });\n\n      this.unpublish();\n      this.setState({ isEnd: true });\n      this.showExitAlert();\n    };\n\n    showPopUp(\n      <Popup.TwoButton\n        confirmAction={callback}\n        intl={this.props.intl}\n        titleId=\"ID_WIZLIVE_EXIT_CONFIRM\"\n        confirmButtonNameId=\"ID_WIZLIVE_EXIT\"\n        cancelButtonNameId=\"ID_WIZLIVE_CANCEL\"\n      />\n    );\n  };\n\n  showExitAlert = () => {\n    const callback = () => {\n      const { studentEmail, reservationId } = this.props;\n      const url = `${\n        URL.WIZLIVE\n      }/tutor/feedback/${studentEmail}/${reservationId}/false`;\n      window.open(url, \"_blank\");\n    };\n\n    showPopUp(\n      <Popup.TwoButton\n        confirmAction={callback}\n        intl={this.props.intl}\n        titleId=\"ID_WIZLIVE_EXIT_COMPLETE\"\n        subtitleId=\"ID_WIZLIVE_FEEDBACK_REQUEST\"\n        confirmButtonNameId=\"ID_WIZLIVE_FEEDBACK_GO\"\n        cancelButtonNameId=\"ID_WIZLIVE_FEEDBACK_NEXTTIME\"\n      />\n    );\n  };\n\n  handleFreeTrialSurvey = isOn => {\n    this.setState({ isShowSurveyPopup: isOn });\n  };\n\n  showFeedbackAlert = () => {\n    this.handleFreeTrialSurvey(true);\n  };\n\n  showFeedbackResultAlert = success => {\n    let title = success\n      ? \"ID_WIZLIVE_FEEDBACK_COMPLETE\"\n      : \"ID_WIZLIVE_FEEDBACK_FAIL\";\n    let subtitle = success ? \"\" : \"ID_WIZLIVE_FEEDBACK_FAIL_ADMIN\";\n    showPopUp(\n      <Popup.OneButton\n        intl={this.props.intl}\n        titleId={title}\n        subtitleId={subtitle}\n        buttonNameId=\"ID_WIZLIVE_COMFIRM\"\n      />\n    );\n  };\n\n  render() {\n    const {\n      // isDrawingBoardOn,\n      isTutor,\n      // lectureVideos,\n      // lectureSlides,\n      // reservationId,\n      // isFreeTrial,\n      // handleSelectTab,\n      handleChangeZIndex,\n      zIndex,\n      email,\n      tutorEmail,\n      reservationId,\n      isFreeTrial\n    } = this.props;\n    const {\n      students,\n      audioEnabled,\n      isShowSurveyPopup,\n      attendees,\n      roomStatus\n    } = this.state;\n    const {\n      tutorName,\n      setTutorVideo,\n      setStudentVideo,\n      feeds,\n      // attendees,\n      handleVoiceToggleButton,\n      handleExitBtn,\n      handleFreeTrialSurvey,\n      refreshVideos\n    } = this;\n\n    return (\n      <React.Fragment>\n        <RndWrapper\n          id=\"live\"\n          style={{ zIndex }}\n          defaultWidth={300}\n          defaultHeight={((300 * 9) / 16) * 2 + 35}\n          defaultX={document.body.clientWidth - 365}\n          defaultY={0}\n          minWidth={300}\n          minHeight={((300 * 9) / 16) * 2 + 35}\n          lockAspectRatio={16 / 9 / 2}\n          lockAspectRatioExtraHeight={35}\n        >\n          <View\n            // addStudentVideo={this.addStudentVideo}\n            // addTutorVideo={this.addTutorVideo}\n            setTutorVideo={setTutorVideo}\n            setStudentVideo={setStudentVideo}\n            // tutorEmail={tutorEmail}\n            tutorName={tutorName}\n            students={students}\n            isTutor={isTutor}\n            handleChangeZIndex={handleChangeZIndex}\n            feeds={feeds}\n            attendees={attendees}\n            email={email}\n            handleVoiceToggleButton={handleVoiceToggleButton}\n            audioEnabled={audioEnabled}\n            tutorEmail={tutorEmail}\n            handleExitBtn={handleExitBtn}\n            refreshVideos={refreshVideos}\n          />\n        </RndWrapper>\n        {isShowSurveyPopup && (\n          <FreeTrialSurveyPopup\n            reservationId={reservationId}\n            tutorEmail={tutorEmail}\n            handleFreeTrialSurvey={handleFreeTrialSurvey}\n            isFreeTrial={isFreeTrial}\n          />\n        )}\n        {isShowSurveyPopup && (\n          <FreeTrialSurveyPopup\n            reservationId={reservationId}\n            tutorEmail={tutorEmail}\n            handleFreeTrialSurvey={handleFreeTrialSurvey}\n            isFreeTrial={isFreeTrial}\n          />\n        )}\n        {roomStatus !== \"connected\" && (\n          <div className=\"roomStatusPopup\">\n            <div className=\"roomStatusPopupContent\">\n              {roomStatus === \"connecting\" && (\n                <React.Fragment>\n                  <div className=\"roomStatusPopupMessage\">접속 중입니다..</div>\n                  <div className=\"roomStatusPopupProgress\" />\n                </React.Fragment>\n              )}\n              {roomStatus === \"ready\" && (\n                <React.Fragment>\n                  <div className=\"roomStatusPopupMessage\">접속 되었습니다.</div>\n                  <div className=\"roomStatusPopupBtn\" onClick={refreshVideos}>\n                    시작하기\n                  </div>\n                </React.Fragment>\n              )}\n            </div>\n          </div>\n        )}\n      </React.Fragment>\n    );\n  }\n}\n\nexport default connect(\n  state => {\n    const { history, historyIndex, ..._scene } = state.scene;\n\n    return {\n      selectedSceneId: state.interaction.selected.scene,\n      selectedObject:\n        state.interaction.selected.objects[state.interaction.selected.scene],\n      pId: state.project.pId,\n      scene: _scene,\n      interaction: {\n        ...state.interaction,\n        jukebox: {\n          isPlaying: false\n        },\n        addSoundsTimeStamp: undefined\n      },\n      preview: state.preview,\n      currentUser: state.tabs.currentUser\n    };\n  },\n  {\n    setStudents: tabActions.setStudents,\n    setTutor: tabActions.setTutor,\n    setProject: projectActions.setProject\n  }\n)(Container);\n"]},"metadata":{},"sourceType":"module"}