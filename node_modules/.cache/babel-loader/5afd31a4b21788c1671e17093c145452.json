{"ast":null,"code":"import _regeneratorRuntime from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";\nimport _toConsumableArray from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";\nimport _asyncToGenerator from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _classCallCheck from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";\nimport _possibleConstructorReturn from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";\nimport _inherits from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";\nvar _jsxFileName = \"/Users/jimmy/Documents/Wizschool/wizlab_web2/src/Page/Game/Container.js\";\nimport React, { Component } from \"react\";\nimport { connect } from \"react-redux\";\nimport ReactHtmlParser from \"react-html-parser\";\nimport * as request from \"../../Common/Util/HTTPRequest\";\nimport * as Constant from \"../../Common/Util/Constant\";\nimport * as TrackingUtil from \"../../Common/Util/TrackingUtil\";\nimport View from \"./View\";\n\nvar Container =\n/*#__PURE__*/\nfunction (_Component) {\n  _inherits(Container, _Component);\n\n  function Container(props) {\n    var _this;\n\n    _classCallCheck(this, Container);\n\n    _this = _possibleConstructorReturn(this, _getPrototypeOf(Container).call(this, props));\n\n    _this.getProjects =\n    /*#__PURE__*/\n    function () {\n      var _ref = _asyncToGenerator(\n      /*#__PURE__*/\n      _regeneratorRuntime.mark(function _callee(type, limit) {\n        var res, json, projects;\n        return _regeneratorRuntime.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                _this.isLoading = true;\n                _context.prev = 1;\n                _context.t0 = type;\n                _context.next = _context.t0 === \"recommend\" ? 5 : _context.t0 === \"weekly\" ? 14 : _context.t0 === \"editor\" ? 23 : _context.t0 === \"views\" ? 32 : _context.t0 === \"news\" ? 41 : 50;\n                break;\n\n              case 5:\n                projects = _this.state.recommendProjects;\n                _context.next = 8;\n                return request.getProjectsByType({\n                  type: \"recommend\",\n                  limit: limit,\n                  offset: projects.length\n                });\n\n              case 8:\n                res = _context.sent;\n                _context.next = 11;\n                return res.json();\n\n              case 11:\n                json = _context.sent;\n\n                _this.setState({\n                  recommendProjects: [].concat(_toConsumableArray(projects), _toConsumableArray(json))\n                });\n\n                return _context.abrupt(\"break\", 51);\n\n              case 14:\n                projects = _this.state.weeklyProjects;\n                _context.next = 17;\n                return request.getWeeklyProjectsByType({\n                  type: \"like\",\n                  limit: limit,\n                  offset: projects.length\n                });\n\n              case 17:\n                res = _context.sent;\n                _context.next = 20;\n                return res.json();\n\n              case 20:\n                json = _context.sent;\n\n                _this.setState({\n                  weeklyProjects: [].concat(_toConsumableArray(projects), _toConsumableArray(json))\n                });\n\n                return _context.abrupt(\"break\", 51);\n\n              case 23:\n                projects = _this.state.editorsProjects;\n                _context.next = 26;\n                return request.getEditorRecommends({\n                  limit: limit,\n                  offset: projects.length\n                });\n\n              case 26:\n                res = _context.sent;\n                _context.next = 29;\n                return res.json();\n\n              case 29:\n                json = _context.sent;\n\n                _this.setState({\n                  editorsProjects: [].concat(_toConsumableArray(projects), _toConsumableArray(json))\n                });\n\n                return _context.abrupt(\"break\", 51);\n\n              case 32:\n                projects = _this.state.viewProjects;\n                _context.next = 35;\n                return request.getGameInfo({\n                  limit: limit,\n                  offset: projects.length\n                });\n\n              case 35:\n                res = _context.sent;\n                _context.next = 38;\n                return res.json();\n\n              case 38:\n                json = _context.sent;\n\n                _this.setState({\n                  viewProjects: [].concat(_toConsumableArray(projects), _toConsumableArray(json.views))\n                });\n\n                return _context.abrupt(\"break\", 51);\n\n              case 41:\n                projects = _this.state.newProjects;\n                _context.next = 44;\n                return request.getProjectsByType({\n                  type: \"news\",\n                  limit: limit,\n                  offset: projects.length\n                });\n\n              case 44:\n                res = _context.sent;\n                _context.next = 47;\n                return res.json();\n\n              case 47:\n                json = _context.sent;\n\n                _this.setState({\n                  newProjects: [].concat(_toConsumableArray(projects), _toConsumableArray(json))\n                });\n\n                return _context.abrupt(\"break\", 51);\n\n              case 50:\n                return _context.abrupt(\"break\", 51);\n\n              case 51:\n                _context.next = 56;\n                break;\n\n              case 53:\n                _context.prev = 53;\n                _context.t1 = _context[\"catch\"](1);\n                console.error(_context.t1);\n\n              case 56:\n                _this.isLoading = false;\n\n              case 57:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee, this, [[1, 53]]);\n      }));\n\n      return function (_x, _x2) {\n        return _ref.apply(this, arguments);\n      };\n    }();\n\n    _this.infiniteScroll = function () {\n      var currentScrollPosition = document.documentElement.scrollTop + document.documentElement.clientHeight;\n      var scrollBottomPosition = document.documentElement.scrollHeight;\n\n      if (currentScrollPosition + 300 >= scrollBottomPosition) {\n        if (!_this.isLoading) {\n          _this.getProjects(\"news\", 20);\n        }\n      }\n    };\n\n    _this.handleMoreWeeklyViewProject = function () {\n      _this.getProjects(\"weekly\", 10);\n    };\n\n    _this.highlightString = function (text, query) {\n      if (!text || !query) return text;\n      var re = new RegExp(\"\".concat(query), \"ig\");\n      var result = text.replace(re, \"<strong class='Search__highlight'>$&</strong>\");\n      result = ReactHtmlParser(result);\n      return result;\n    };\n\n    _this.handleModeChange = function (mode) {\n      var pageMode = _this.state.pageMode;\n\n      if (pageMode !== mode) {\n        _this.setState({\n          pageMode: mode,\n          searchValue: \"\",\n          isGame: mode === Constant.GAMEPAGE_MODE.NORMAL\n        });\n      }\n    };\n\n    _this.handleSearchChange = function (e) {\n      _this.setState({\n        searchValue: e.target.value\n      });\n    };\n\n    _this.handleSearchSubmit = function () {\n      var searchValue = _this.state.searchValue;\n\n      _this.setState({\n        isGame: false,\n        pageMode: Constant.GAMEPAGE_MODE.SEARCH,\n        searchedValue: searchValue\n      },\n      /*#__PURE__*/\n      _asyncToGenerator(\n      /*#__PURE__*/\n      _regeneratorRuntime.mark(function _callee2() {\n        var keyword, response, result, resultText;\n        return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n          while (1) {\n            switch (_context2.prev = _context2.next) {\n              case 0:\n                _context2.prev = 0;\n                keyword = encodeURIComponent(searchValue);\n                _context2.next = 4;\n                return request.getPublishedProjectByKeyword({\n                  keyword: keyword\n                });\n\n              case 4:\n                response = _context2.sent;\n                _context2.next = 7;\n                return response.json();\n\n              case 7:\n                result = _context2.sent;\n                resultText = _this.state.searchValue;\n                TrackingUtil.sendGTMEvent(\"PlaySearch\", \"Play - Search Terms\", resultText);\n                result = result.map(function (item) {\n                  item.name = _this.highlightString(item.name, resultText);\n                  item.user.name = _this.highlightString(item.user.name, resultText);\n                  return item;\n                });\n\n                _this.setState({\n                  searchResults: result\n                }, function () {\n                  return window.scrollTo(0, 0);\n                });\n\n                _context2.next = 17;\n                break;\n\n              case 14:\n                _context2.prev = 14;\n                _context2.t0 = _context2[\"catch\"](0);\n                console.error(_context2.t0);\n\n              case 17:\n              case \"end\":\n                return _context2.stop();\n            }\n          }\n        }, _callee2, this, [[0, 14]]);\n      })));\n    };\n\n    _this.state = {\n      pageMode: Constant.GAMEPAGE_MODE.NORMAL,\n      searchValue: \"\",\n      searchedValue: \"\",\n      searchResults: [],\n      isGame: true,\n      recommendProjects: [],\n      weeklyProjects: [],\n      editorsProjects: [],\n      viewProjects: [],\n      newProjects: []\n    };\n    _this.isLoading = true;\n    return _this;\n  }\n\n  _createClass(Container, [{\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      // TrackingUtil.sendPageEvent(\"/game\", this.props.email);\n      this.getProjects(\"recommend\", 20);\n      this.getProjects(\"weekly\", 5);\n      this.getProjects(\"editor\", 4);\n      this.getProjects(\"views\", 15);\n      this.getProjects(\"news\", 20);\n      window.addEventListener(\"scroll\", this.infiniteScroll);\n    }\n  }, {\n    key: \"componentWillUnmount\",\n    value: function componentWillUnmount() {\n      window.removeEventListener(\"scroll\", this.infiniteScroll);\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _this$state = this.state,\n          pageMode = _this$state.pageMode,\n          viewProjects = _this$state.viewProjects,\n          searchValue = _this$state.searchValue,\n          searchResults = _this$state.searchResults,\n          searchedValue = _this$state.searchedValue,\n          isGame = _this$state.isGame,\n          editorsProjects = _this$state.editorsProjects,\n          recommendProjects = _this$state.recommendProjects,\n          newProjects = _this$state.newProjects,\n          weeklyProjects = _this$state.weeklyProjects;\n      var handleModeChange = this.handleModeChange,\n          handleSearchChange = this.handleSearchChange,\n          handleSearchSubmit = this.handleSearchSubmit,\n          handleMoreWeeklyViewProject = this.handleMoreWeeklyViewProject;\n      return React.createElement(View, {\n        recommendProjects: recommendProjects,\n        weeklyProjects: weeklyProjects,\n        editorsProjects: editorsProjects,\n        viewProjects: viewProjects,\n        newProjects: newProjects,\n        searchResults: searchResults,\n        searchedValue: searchedValue,\n        searchValue: searchValue,\n        pageMode: pageMode,\n        isGame: isGame,\n        handleModeChange: handleModeChange,\n        handleSearchChange: handleSearchChange,\n        handleSearchSubmit: handleSearchSubmit,\n        handleMoreWeeklyViewProject: handleMoreWeeklyViewProject,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 178\n        },\n        __self: this\n      });\n    }\n  }]);\n\n  return Container;\n}(Component);\n\nexport default connect(function (state) {\n  return {\n    email: state.userinfo.email\n  };\n}, {})(Container);","map":{"version":3,"sources":["/Users/jimmy/Documents/Wizschool/wizlab_web2/src/Page/Game/Container.js"],"names":["React","Component","connect","ReactHtmlParser","request","Constant","TrackingUtil","View","Container","props","getProjects","type","limit","isLoading","projects","state","recommendProjects","getProjectsByType","offset","length","res","json","setState","weeklyProjects","getWeeklyProjectsByType","editorsProjects","getEditorRecommends","viewProjects","getGameInfo","views","newProjects","console","error","infiniteScroll","currentScrollPosition","document","documentElement","scrollTop","clientHeight","scrollBottomPosition","scrollHeight","handleMoreWeeklyViewProject","highlightString","text","query","re","RegExp","result","replace","handleModeChange","mode","pageMode","searchValue","isGame","GAMEPAGE_MODE","NORMAL","handleSearchChange","e","target","value","handleSearchSubmit","SEARCH","searchedValue","keyword","encodeURIComponent","getPublishedProjectByKeyword","response","resultText","sendGTMEvent","map","item","name","user","searchResults","window","scrollTo","addEventListener","removeEventListener","email","userinfo"],"mappings":"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","sourcesContent":["import React, { Component } from \"react\";\nimport { connect } from \"react-redux\";\nimport ReactHtmlParser from \"react-html-parser\";\nimport * as request from \"../../Common/Util/HTTPRequest\";\nimport * as Constant from \"../../Common/Util/Constant\";\nimport * as TrackingUtil from \"../../Common/Util/TrackingUtil\";\nimport View from \"./View\";\n\nclass Container extends Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      pageMode: Constant.GAMEPAGE_MODE.NORMAL,\n      searchValue: \"\",\n      searchedValue: \"\",\n      searchResults: [],\n      isGame: true,\n      recommendProjects: [],\n      weeklyProjects: [],\n      editorsProjects: [],\n      viewProjects: [],\n      newProjects: []\n    };\n    this.isLoading = true;\n  }\n\n  componentDidMount() {\n    // TrackingUtil.sendPageEvent(\"/game\", this.props.email);\n    this.getProjects(\"recommend\", 20);\n    this.getProjects(\"weekly\", 5);\n    this.getProjects(\"editor\", 4);\n    this.getProjects(\"views\", 15);\n    this.getProjects(\"news\", 20);\n    window.addEventListener(\"scroll\", this.infiniteScroll);\n  };\n\n  componentWillUnmount() {\n    window.removeEventListener(\"scroll\", this.infiniteScroll);\n  }\n\n  getProjects = async (type, limit) => {\n    this.isLoading = true;\n    \n    let res, json, projects;\n    try {\n      switch(type) {\n        case \"recommend\":\n          projects = this.state.recommendProjects;\n          res = await request.getProjectsByType({ type: \"recommend\", limit, offset: projects.length });\n          json = await res.json();\n          this.setState({ recommendProjects: [...projects, ...json] });\n          break;\n        case \"weekly\":\n          projects = this.state.weeklyProjects;\n          res = await request.getWeeklyProjectsByType({ type: \"like\", limit, offset: projects.length });\n          json = await res.json();\n          this.setState({ weeklyProjects: [...projects, ...json] });\n          break;\n        case \"editor\":\n          projects = this.state.editorsProjects;\n          res = await request.getEditorRecommends({ limit, offset: projects.length });\n          json = await res.json();\n          this.setState({ editorsProjects: [...projects, ...json] });\n          break;\n        case \"views\":\n          projects = this.state.viewProjects;\n          res = await request.getGameInfo({ limit, offset: projects.length });\n          json = await res.json();\n          this.setState({ viewProjects: [...projects, ...json.views] });\n          break;\n        case \"news\":\n          projects = this.state.newProjects;\n          res = await request.getProjectsByType({ type: \"news\", limit, offset: projects.length });\n          json = await res.json();\n          this.setState({ newProjects: [...projects, ...json] });\n          break;\n        default: \n          break;\n      }\n    } catch(e) {\n      console.error(e);\n    }\n    this.isLoading = false;\n  }\n\n  infiniteScroll = () => {\n    const currentScrollPosition = document.documentElement.scrollTop + document.documentElement.clientHeight;\n    const scrollBottomPosition = document.documentElement.scrollHeight;\n    \n    if (currentScrollPosition + 300 >= scrollBottomPosition) {\n      if(!this.isLoading) {\n        this.getProjects(\"news\", 20);\n      }\n    }\n  };\n\n  handleMoreWeeklyViewProject = () => {\n    this.getProjects(\"weekly\", 10);\n  };\n\n  highlightString = (text, query) => {\n    if (!text || !query) return text;\n\n    const re = new RegExp(`${query}`, \"ig\");\n    let result = text.replace(re, \"<strong class='Search__highlight'>$&</strong>\");\n    result = ReactHtmlParser(result);\n    return result;\n  };\n\n  handleModeChange = mode => {\n    const { pageMode } = this.state;\n    if (pageMode !== mode) {\n      this.setState({\n        pageMode: mode,\n        searchValue: \"\",\n        isGame: mode === Constant.GAMEPAGE_MODE.NORMAL\n      });\n    }\n  };\n\n  handleSearchChange = e => {\n    this.setState({ searchValue: e.target.value });\n  };\n\n  handleSearchSubmit = () => {\n    const { searchValue } = this.state;\n    this.setState(\n      {\n        isGame: false,\n        pageMode: Constant.GAMEPAGE_MODE.SEARCH,\n        searchedValue: searchValue\n      },\n      async () => {\n        try {\n          const keyword = encodeURIComponent(searchValue);\n          const response = await request.getPublishedProjectByKeyword({keyword});\n          let result = await response.json();\n          const resultText = this.state.searchValue;\n\n          TrackingUtil.sendGTMEvent(\"PlaySearch\", \"Play - Search Terms\", resultText);\n\n          result = result.map(item => {\n            item.name = this.highlightString(item.name, resultText);\n            item.user.name = this.highlightString(item.user.name, resultText);\n            return item;\n          });\n\n          this.setState({ searchResults: result }, () => window.scrollTo(0, 0));\n        } catch (err) {\n          console.error(err);\n        }\n      }\n    );\n  };\n\n  render() {\n    const {\n      pageMode,\n      viewProjects,\n      searchValue,\n      searchResults,\n      searchedValue,\n      isGame,\n      editorsProjects,\n      recommendProjects,\n      newProjects,\n      weeklyProjects\n    } = this.state;\n\n    const {\n      handleModeChange,\n      handleSearchChange,\n      handleSearchSubmit,\n      handleMoreWeeklyViewProject\n    } = this;\n\n    return (\n      <View\n        recommendProjects={recommendProjects}\n        weeklyProjects={weeklyProjects}\n        editorsProjects={editorsProjects}\n        viewProjects={viewProjects}\n        newProjects={newProjects}\n        searchResults={searchResults}\n        searchedValue={searchedValue}\n        searchValue={searchValue}\n        pageMode={pageMode}\n        isGame={isGame}\n        handleModeChange={handleModeChange}\n        handleSearchChange={handleSearchChange}\n        handleSearchSubmit={handleSearchSubmit}\n        handleMoreWeeklyViewProject={handleMoreWeeklyViewProject}\n      />\n    );\n  }\n}\n\nexport default connect(\n  state => ({\n    email: state.userinfo.email\n  }),\n  {}\n)(Container);\n"]},"metadata":{},"sourceType":"module"}