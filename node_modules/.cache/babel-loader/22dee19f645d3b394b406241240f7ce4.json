{"ast":null,"code":"import _regeneratorRuntime from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";\nimport _toConsumableArray from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";\nimport _asyncToGenerator from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _classCallCheck from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";\nimport _possibleConstructorReturn from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";\nimport _inherits from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";\nvar _jsxFileName = \"/Users/jimmy/Documents/Wizschool/wizlab_web2/src/Page/Play/Component/SearchResult/Container.js\";\nimport React from \"react\";\nimport QueryString from \"query-string\";\nimport { withRouter } from \"react-router-dom\";\nimport * as request from \"../../../../Common/Util/HTTPRequest\";\nimport View from \"./View\";\n\nvar Container =\n/*#__PURE__*/\nfunction (_React$Component) {\n  _inherits(Container, _React$Component);\n\n  function Container(props) {\n    var _this;\n\n    _classCallCheck(this, Container);\n\n    _this = _possibleConstructorReturn(this, _getPrototypeOf(Container).call(this, props));\n\n    _this.loadResults =\n    /*#__PURE__*/\n    function () {\n      var _ref = _asyncToGenerator(\n      /*#__PURE__*/\n      _regeneratorRuntime.mark(function _callee(beforeResults) {\n        var limit;\n        return _regeneratorRuntime.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                if (!_this.isLoading) {\n                  _context.next = 2;\n                  break;\n                }\n\n                return _context.abrupt(\"return\");\n\n              case 2:\n                _this.isLoading = true;\n                limit = 20;\n                request.getPublishedProjectByKeyword({\n                  offset: beforeResults.length,\n                  limit: limit,\n                  keyword: _this.keyword\n                }).then(function (res) {\n                  return res.json();\n                }).then(function (json) {\n                  _this.setState({\n                    total: json.count,\n                    results: [].concat(_toConsumableArray(beforeResults), _toConsumableArray(json.rows))\n                  });\n\n                  if (json.rows < limit) {\n                    _this.isAllLoaded = true;\n                  }\n\n                  _this.isLoading = false;\n                }).catch(function (e) {\n                  console.error(e);\n                });\n\n              case 5:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee, this);\n      }));\n\n      return function (_x) {\n        return _ref.apply(this, arguments);\n      };\n    }();\n\n    _this.onWindowScroll = function (e) {\n      var target = document.documentElement;\n\n      if (target.scrollTop >= target.scrollHeight - target.clientHeight - 100 && !_this.isAllLoaded && !_this.isLoading) {\n        _this.loadMore();\n      }\n    };\n\n    _this.state = {\n      total: 0,\n      results: []\n    };\n    return _this;\n  }\n\n  _createClass(Container, [{\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      this.initAndLoad();\n      window.addEventListener(\"scroll\", this.onWindowScroll);\n    }\n  }, {\n    key: \"componentWillUnmount\",\n    value: function componentWillUnmount() {\n      window.removeEventListener(\"scroll\", this.onWindowScroll);\n    }\n  }, {\n    key: \"componentDidUpdate\",\n    value: function componentDidUpdate(prevProps) {\n      if (prevProps.location.search !== this.props.location.search) {\n        this.initAndLoad();\n      }\n    }\n  }, {\n    key: \"initAndLoad\",\n    value: function () {\n      var _initAndLoad = _asyncToGenerator(\n      /*#__PURE__*/\n      _regeneratorRuntime.mark(function _callee2() {\n        return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n          while (1) {\n            switch (_context2.prev = _context2.next) {\n              case 0:\n                this.isAllLoaded = false;\n                _context2.next = 3;\n                return this.loadResults([]);\n\n              case 3:\n              case \"end\":\n                return _context2.stop();\n            }\n          }\n        }, _callee2, this);\n      }));\n\n      function initAndLoad() {\n        return _initAndLoad.apply(this, arguments);\n      }\n\n      return initAndLoad;\n    }()\n  }, {\n    key: \"loadMore\",\n    value: function () {\n      var _loadMore = _asyncToGenerator(\n      /*#__PURE__*/\n      _regeneratorRuntime.mark(function _callee3() {\n        return _regeneratorRuntime.wrap(function _callee3$(_context3) {\n          while (1) {\n            switch (_context3.prev = _context3.next) {\n              case 0:\n                _context3.next = 2;\n                return this.loadResults(this.state.results);\n\n              case 2:\n              case \"end\":\n                return _context3.stop();\n            }\n          }\n        }, _callee3, this);\n      }));\n\n      function loadMore() {\n        return _loadMore.apply(this, arguments);\n      }\n\n      return loadMore;\n    }()\n  }, {\n    key: \"render\",\n    value: function render() {\n      return React.createElement(View, Object.assign({}, this.state, {\n        keyword: this.keyword,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 83\n        },\n        __self: this\n      }));\n    }\n  }, {\n    key: \"keyword\",\n    get: function get() {\n      var query = QueryString.parse(this.props.location.search);\n      return query.search;\n    }\n  }]);\n\n  return Container;\n}(React.Component);\n\nexport default withRouter(Container);","map":{"version":3,"sources":["/Users/jimmy/Documents/Wizschool/wizlab_web2/src/Page/Play/Component/SearchResult/Container.js"],"names":["React","QueryString","withRouter","request","View","Container","props","loadResults","beforeResults","isLoading","limit","getPublishedProjectByKeyword","offset","length","keyword","then","res","json","setState","total","count","results","rows","isAllLoaded","catch","e","console","error","onWindowScroll","target","document","documentElement","scrollTop","scrollHeight","clientHeight","loadMore","state","initAndLoad","window","addEventListener","removeEventListener","prevProps","location","search","query","parse","Component"],"mappings":"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","sourcesContent":["import React from \"react\";\nimport QueryString from \"query-string\";\nimport { withRouter } from \"react-router-dom\";\nimport * as request from \"../../../../Common/Util/HTTPRequest\";\nimport View from \"./View\";\n\nclass Container extends React.Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      total: 0,\n      results: []\n    }\n  }\n  componentDidMount() {\n    this.initAndLoad();\n    window.addEventListener(\"scroll\", this.onWindowScroll);\n  }\n  componentWillUnmount() {\n    window.removeEventListener(\"scroll\", this.onWindowScroll);\n  }\n  componentDidUpdate(prevProps) {\n    if(prevProps.location.search !== this.props.location.search) {\n      this.initAndLoad();\n    }\n  }\n\n  async initAndLoad() {\n    this.isAllLoaded = false;\n    await this.loadResults([]);\n  }\n  async loadMore() {\n    await this.loadResults(this.state.results);\n  }\n\n  loadResults = async beforeResults => {\n    if(this.isLoading) {\n      return;\n    }\n    this.isLoading = true;\n\n    const limit = 20;\n    request\n      .getPublishedProjectByKeyword({\n        offset: beforeResults.length,\n        limit: limit,\n        keyword: this.keyword\n      })\n      .then(res => res.json())\n      .then(json => {\n        this.setState({\n          total: json.count,\n          results: [...beforeResults, ...json.rows]\n        });\n\n        if(json.rows < limit) {\n          this.isAllLoaded = true;\n        }\n        this.isLoading = false;\n      })\n      .catch(e => {\n        console.error(e);\n      })\n  }\n  get keyword() {\n    const query = QueryString.parse(this.props.location.search);\n    return query.search;\n  }\n\n  onWindowScroll = e => {\n    const target = document.documentElement;\n    if(\n      target.scrollTop >= target.scrollHeight - target.clientHeight - 100\n      && !this.isAllLoaded\n      && !this.isLoading\n    ) {\n      this.loadMore();\n    }\n  }\n\n  render() {\n    return (\n      <View\n        {...this.state}\n        keyword={this.keyword}\n      />\n    );\n  }\n}\n\nexport default withRouter(Container);\n"]},"metadata":{},"sourceType":"module"}