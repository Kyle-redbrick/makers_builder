{"ast":null,"code":"import _classCallCheck from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";\nimport _inherits from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";\nimport _possibleConstructorReturn from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";\nvar _jsxFileName = \"/Users/jimmy/Documents/Wizschool/wizlab_web2/src/Common/Util/PageStatus.js\";\n\nfunction _createSuper(Derived) { var hasNativeReflectConstruct = _isNativeReflectConstruct(); return function _createSuperInternal() { var Super = _getPrototypeOf(Derived), result; if (hasNativeReflectConstruct) { var NewTarget = _getPrototypeOf(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return _possibleConstructorReturn(this, result); }; }\n\nfunction _isNativeReflectConstruct() { if (typeof Reflect === \"undefined\" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === \"function\") return true; try { Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {})); return true; } catch (e) { return false; } }\n\nimport React from \"react\";\n\nvar PageStatus = /*#__PURE__*/function (_React$Component) {\n  _inherits(PageStatus, _React$Component);\n\n  var _super = _createSuper(PageStatus);\n\n  function PageStatus(props) {\n    var _this;\n\n    _classCallCheck(this, PageStatus);\n\n    _this = _super.call(this, props);\n\n    _this.getDuration = function () {\n      return Date.now() - _this.startedAt - _this.pausedTime;\n    };\n\n    _this.sendCallback = function (isVisible) {\n      if (!_this.props.onChange) return;\n\n      _this.props.onChange({\n        isVisible: isVisible,\n        willClose: _this.willClose,\n        duration: _this.getDuration()\n      });\n    };\n\n    _this.onBeforeUnload = function () {\n      _this.willClose = true;\n\n      _this.sendCallback(false);\n    };\n\n    _this.onVisibilityChanged = function () {\n      var _visibility;\n\n      if (!visibility) {\n        _visibility = true;\n      } else {\n        var hidden = visibility.hidden;\n        _visibility = !document[hidden];\n      }\n\n      if (_visibility) {\n        if (_this.pausedAt !== 0) {\n          //탭이 비활성화 -> 활성화가 되었다면 비활성화유지 시간을 기록\n          _this.pausedTime += Date.now() - _this.pausedAt;\n          _this.pausedAt = 0;\n        }\n      } else {\n        _this.pausedAt = Date.now();\n      }\n\n      _this.sendCallback(_visibility);\n    };\n\n    _this.startedAt = Date.now();\n    _this.pausedAt = 0;\n    _this.pausedTime = 0;\n    _this.willClose = false;\n    return _this;\n  }\n\n  _createClass(PageStatus, [{\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      document.addEventListener(visibility.event, this.onVisibilityChanged);\n      window.addEventListener(\"beforeunload\", this.onBeforeUnload);\n    }\n  }, {\n    key: \"componentWillUnmount\",\n    value: function componentWillUnmount() {\n      document.removeEventListener(visibility.event, this.onVisibilityChanged);\n      window.removeEventListener(\"beforeunload\", this.onBeforeUnload);\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      return React.createElement(React.Fragment, {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 64\n        },\n        __self: this\n      }, this.props.children);\n    }\n  }]);\n\n  return PageStatus;\n}(React.Component); // 브라우저별로 visibility관련 이벤트 포맷이 다름\n// https://developer.mozilla.org/en-US/docs/Web/API/Document/visibilitychange_event\n\n\nexport { PageStatus as default };\nvar vendorEvents = [{\n  hidden: 'hidden',\n  event: 'visibilitychange',\n  state: 'visibilityState'\n}, {\n  hidden: 'webkitHidden',\n  event: 'webkitvisibilitychange',\n  state: 'webkitVisibilityState'\n}, {\n  hidden: 'mozHidden',\n  event: 'mozvisibilitychange',\n  state: 'mozVisibilityState'\n}, {\n  hidden: 'msHidden',\n  event: 'msvisibilitychange',\n  state: 'msVisibilityState'\n}, {\n  hidden: 'oHidden',\n  event: 'ovisibilitychange',\n  state: 'oVisibilityState'\n}];\n\nvar visibility = function () {\n  var _iteratorNormalCompletion = true;\n  var _didIteratorError = false;\n  var _iteratorError = undefined;\n\n  try {\n    for (var _iterator = vendorEvents[Symbol.iterator](), _step; !(_iteratorNormalCompletion = (_step = _iterator.next()).done); _iteratorNormalCompletion = true) {\n      var event = _step.value;\n\n      if (event.hidden in document) {\n        return event;\n      }\n    } // otherwise it's not supported\n\n  } catch (err) {\n    _didIteratorError = true;\n    _iteratorError = err;\n  } finally {\n    try {\n      if (!_iteratorNormalCompletion && _iterator.return != null) {\n        _iterator.return();\n      }\n    } finally {\n      if (_didIteratorError) {\n        throw _iteratorError;\n      }\n    }\n  }\n\n  return null;\n}();","map":{"version":3,"sources":["/Users/jimmy/Documents/Wizschool/wizlab_web2/src/Common/Util/PageStatus.js"],"names":["React","PageStatus","props","getDuration","Date","now","startedAt","pausedTime","sendCallback","isVisible","onChange","willClose","duration","onBeforeUnload","onVisibilityChanged","_visibility","visibility","hidden","document","pausedAt","addEventListener","event","window","removeEventListener","children","Component","vendorEvents","state"],"mappings":"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","sourcesContent":["import React from \"react\";\n\nexport default class PageStatus extends React.Component {\n  constructor(props) {\n    super(props);\n    this.startedAt = Date.now();\n    this.pausedAt = 0;\n    this.pausedTime = 0;\n    this.willClose = false;\n  }\n\n  componentDidMount() {\n    document.addEventListener(visibility.event, this.onVisibilityChanged);\n    window.addEventListener(\"beforeunload\", this.onBeforeUnload);\n  }\n\n  componentWillUnmount() {\n    document.removeEventListener(visibility.event, this.onVisibilityChanged);\n    window.removeEventListener(\"beforeunload\", this.onBeforeUnload);\n  }\n\n  getDuration = () => {\n    return Date.now() - this.startedAt - this.pausedTime;\n  }\n\n  sendCallback = isVisible => {\n    if (!this.props.onChange) return;\n\n    this.props.onChange({\n      isVisible: isVisible, \n      willClose: this.willClose,\n      duration: this.getDuration()\n    });\n  }\n\n  onBeforeUnload = () => {\n    this.willClose = true;\n    this.sendCallback(false);\n  }\n\n  onVisibilityChanged = () => {\n    let _visibility;\n    if (!visibility) {\n      _visibility = true;\n    } else {\n      const { hidden } = visibility;\n      _visibility = !document[hidden];\n    }\n\n    if(_visibility) {\n      if(this.pausedAt !== 0) {\n        //탭이 비활성화 -> 활성화가 되었다면 비활성화유지 시간을 기록\n        this.pausedTime += Date.now() - this.pausedAt;\n        this.pausedAt = 0;\n      }\n    } else {\n      this.pausedAt = Date.now();\n    }   \n    this.sendCallback(_visibility);\n  }\n\n  render() {\n    return (\n      <React.Fragment>{this.props.children}</React.Fragment>\n    );\n  }\n}\n\n// 브라우저별로 visibility관련 이벤트 포맷이 다름\n// https://developer.mozilla.org/en-US/docs/Web/API/Document/visibilitychange_event\nconst vendorEvents = [\n  {\n    hidden: 'hidden',\n    event: 'visibilitychange',\n    state: 'visibilityState',\n  },\n  {\n    hidden: 'webkitHidden',\n    event: 'webkitvisibilitychange',\n    state: 'webkitVisibilityState',\n  },\n  {\n    hidden: 'mozHidden',\n    event: 'mozvisibilitychange',\n    state: 'mozVisibilityState',\n  },\n  {\n    hidden: 'msHidden',\n    event: 'msvisibilitychange',\n    state: 'msVisibilityState',\n  },\n  {\n    hidden: 'oHidden',\n    event: 'ovisibilitychange',\n    state: 'oVisibilityState',\n  },\n];\n\nconst visibility = (() => {\n  for (let event of vendorEvents) {\n    if (event.hidden in document) {\n      return event;\n    }\n  }\n  // otherwise it's not supported\n  return null;\n})();"]},"metadata":{},"sourceType":"module"}