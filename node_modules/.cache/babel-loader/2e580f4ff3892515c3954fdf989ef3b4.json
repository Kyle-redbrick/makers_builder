{"ast":null,"code":"import _regeneratorRuntime from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/react-scripts/node_modules/@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/react-scripts/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _classCallCheck from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/react-scripts/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/react-scripts/node_modules/@babel/runtime/helpers/esm/createClass\";\nimport _possibleConstructorReturn from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/react-scripts/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/react-scripts/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";\nimport _inherits from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/react-scripts/node_modules/@babel/runtime/helpers/esm/inherits\";\nvar _jsxFileName = \"/Users/jimmy/Documents/Wizschool/wizlab_web2/src/Page/Challenge/Component/ChallengeProject/index.js\";\nimport React, { Component } from \"react\";\nimport { FormattedMessage } from \"react-intl\";\nimport * as request from \"../../../../Common/Util/HTTPRequest\";\nimport ChallengeProject from \"../ChallengeProjectItem\";\nimport \"./index.scss\";\n\nvar View =\n/*#__PURE__*/\nfunction (_Component) {\n  _inherits(View, _Component);\n\n  function View(props) {\n    var _this;\n\n    _classCallCheck(this, View);\n\n    _this = _possibleConstructorReturn(this, _getPrototypeOf(View).call(this, props));\n\n    _this.onWindowScroll = function (e) {\n      var target = document.documentElement;\n\n      if (target.scrollTop >= target.scrollHeight - target.clientHeight - 100 && !_this.isAllProjectsLoaded && !_this.isLoadingProjects) {\n        _this.loadMoreProjects();\n      }\n    };\n\n    _this.onClickTab = function (tab) {\n      _this.setState({\n        currentTab: tab\n      });\n    };\n\n    _this.state = {\n      currentTab: \"new\",\n      projects: []\n    };\n    return _this;\n  }\n\n  _createClass(View, [{\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      this.initProjects();\n      window.addEventListener(\"scroll\", this.onWindowScroll);\n    }\n  }, {\n    key: \"componentWillUnmount\",\n    value: function componentWillUnmount() {\n      window.removeEventListener(\"scroll\", this.onWindowScroll);\n    }\n  }, {\n    key: \"componentDidUpdate\",\n    value: function componentDidUpdate(prevProps, prevState) {\n      if (prevState.currentTab !== this.state.currentTab) {\n        this.didUpdateCurrentTab();\n      }\n    }\n  }, {\n    key: \"didUpdateCurrentTab\",\n    value: function didUpdateCurrentTab() {\n      this.initProjects();\n    }\n  }, {\n    key: \"initProjects\",\n    value: function () {\n      var _initProjects = _asyncToGenerator(\n      /*#__PURE__*/\n      _regeneratorRuntime.mark(function _callee() {\n        var projects;\n        return _regeneratorRuntime.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                this.isAllProjectsLoaded = false;\n                _context.next = 3;\n                return this.loadProjects({\n                  offset: 0,\n                  limit: 20\n                });\n\n              case 3:\n                projects = _context.sent;\n                this.setState({\n                  projects: projects\n                });\n\n              case 5:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee, this);\n      }));\n\n      function initProjects() {\n        return _initProjects.apply(this, arguments);\n      }\n\n      return initProjects;\n    }()\n  }, {\n    key: \"loadMoreProjects\",\n    value: function () {\n      var _loadMoreProjects = _asyncToGenerator(\n      /*#__PURE__*/\n      _regeneratorRuntime.mark(function _callee2() {\n        var projects;\n        return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n          while (1) {\n            switch (_context2.prev = _context2.next) {\n              case 0:\n                _context2.next = 2;\n                return this.loadProjects({\n                  offset: this.state.projects.length,\n                  limit: 20\n                });\n\n              case 2:\n                projects = _context2.sent;\n                this.setState(function (prevState) {\n                  return {\n                    projects: [].concat(prevState.projects, projects)\n                  };\n                });\n\n              case 4:\n              case \"end\":\n                return _context2.stop();\n            }\n          }\n        }, _callee2, this);\n      }));\n\n      function loadMoreProjects() {\n        return _loadMoreProjects.apply(this, arguments);\n      }\n\n      return loadMoreProjects;\n    }()\n  }, {\n    key: \"loadProjects\",\n    value: function () {\n      var _loadProjects = _asyncToGenerator(\n      /*#__PURE__*/\n      _regeneratorRuntime.mark(function _callee3(options) {\n        var _this2 = this;\n\n        var projects;\n        return _regeneratorRuntime.wrap(function _callee3$(_context3) {\n          while (1) {\n            switch (_context3.prev = _context3.next) {\n              case 0:\n                if (!this.isLoadingProjects) {\n                  _context3.next = 2;\n                  break;\n                }\n\n                return _context3.abrupt(\"return\");\n\n              case 2:\n                this.isLoadingProjects = true;\n                _context3.next = 5;\n                return request.getCreatorChallenges({\n                  offset: options.offset,\n                  limit: options.limit,\n                  order: this.order\n                }).then(function (res) {\n                  return res.json();\n                }).finally(function () {\n                  _this2.isLoadingProjects = false;\n                });\n\n              case 5:\n                projects = _context3.sent;\n\n                if (projects.length < options.limit) {\n                  this.isAllProjectsLoaded = true;\n                }\n\n                return _context3.abrupt(\"return\", projects);\n\n              case 8:\n              case \"end\":\n                return _context3.stop();\n            }\n          }\n        }, _callee3, this);\n      }));\n\n      function loadProjects(_x) {\n        return _loadProjects.apply(this, arguments);\n      }\n\n      return loadProjects;\n    }()\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _this$state = this.state,\n          currentTab = _this$state.currentTab,\n          projects = _this$state.projects;\n      var onClickTab = this.onClickTab;\n      return React.createElement(\"div\", {\n        className: \"challenge__project\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 98\n        },\n        __self: this\n      }, React.createElement(\"div\", {\n        className: \"challenge__project__tabs\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 99\n        },\n        __self: this\n      }, React.createElement(\"div\", {\n        className: \"challenge__project__tab \".concat(currentTab === \"new\" && \"tab--active\"),\n        onClick: function onClick() {\n          return onClickTab(\"new\");\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 100\n        },\n        __self: this\n      }, React.createElement(FormattedMessage, {\n        id: \"ID_CHALLENGE_PROJECT_TAB_NEW\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 104\n        },\n        __self: this\n      })), React.createElement(\"div\", {\n        className: \"challenge__project__tab \".concat(currentTab === \"popular\" && \"tab--active\"),\n        onClick: function onClick() {\n          return onClickTab(\"popular\");\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 106\n        },\n        __self: this\n      }, React.createElement(FormattedMessage, {\n        id: \"ID_CHALLENGE_PROJECT_TAB_POPULAR\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 110\n        },\n        __self: this\n      }))), React.createElement(\"div\", {\n        className: \"challenge__project__list\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 113\n        },\n        __self: this\n      }, projects.map(function (project) {\n        return React.createElement(ChallengeProject, {\n          key: project.id,\n          challengeProject: project,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 115\n          },\n          __self: this\n        });\n      })));\n    }\n  }, {\n    key: \"order\",\n    get: function get() {\n      var tabToOrder = {\n        new: \"createdAt\",\n        popular: \"like\"\n      };\n      return tabToOrder[this.state.currentTab];\n    }\n  }]);\n\n  return View;\n}(Component);\n\nexport { View as default };","map":{"version":3,"sources":["/Users/jimmy/Documents/Wizschool/wizlab_web2/src/Page/Challenge/Component/ChallengeProject/index.js"],"names":["React","Component","FormattedMessage","request","ChallengeProject","View","props","onWindowScroll","e","target","document","documentElement","scrollTop","scrollHeight","clientHeight","isAllProjectsLoaded","isLoadingProjects","loadMoreProjects","onClickTab","tab","setState","currentTab","state","projects","initProjects","window","addEventListener","removeEventListener","prevProps","prevState","didUpdateCurrentTab","loadProjects","offset","limit","length","concat","options","getCreatorChallenges","order","then","res","json","finally","map","project","id","tabToOrder","new","popular"],"mappings":"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","sourcesContent":["import React, { Component } from \"react\";\nimport { FormattedMessage } from \"react-intl\";\nimport * as request from \"../../../../Common/Util/HTTPRequest\";\nimport ChallengeProject from \"../ChallengeProjectItem\"\nimport \"./index.scss\";\n\nexport default class View extends Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      currentTab: \"new\",\n      projects: []\n    };\n  }\n  componentDidMount() {\n    this.initProjects();\n    window.addEventListener(\"scroll\", this.onWindowScroll);\n  }\n  componentWillUnmount() {\n    window.removeEventListener(\"scroll\", this.onWindowScroll);\n  }\n  componentDidUpdate(prevProps, prevState) {\n    if(prevState.currentTab !== this.state.currentTab) {\n      this.didUpdateCurrentTab()\n    }\n  }\n  didUpdateCurrentTab() {\n    this.initProjects();\n  }\n\n  async initProjects() {\n    this.isAllProjectsLoaded = false;\n    const projects = await this.loadProjects({\n      offset: 0,\n      limit: 20\n    });\n    this.setState({ projects });\n  }\n  async loadMoreProjects() {\n    const projects = await this.loadProjects({ \n      offset: this.state.projects.length,\n      limit: 20\n    });\n    this.setState(prevState => ({ \n      projects: [].concat(prevState.projects, projects)\n    }));\n  }\n  async loadProjects(options) {\n    if(this.isLoadingProjects) {\n      return;\n    }\n\n    this.isLoadingProjects = true;\n    const projects = await request\n      .getCreatorChallenges({\n        offset: options.offset,\n        limit: options.limit,\n        order: this.order\n      })\n      .then(res => res.json())\n      .finally(() => {\n        this.isLoadingProjects = false;\n      });\n\n    if(projects.length < options.limit) {\n      this.isAllProjectsLoaded = true;\n    }\n\n    return projects;\n  }\n  get order() {\n    const tabToOrder = {\n      new: \"createdAt\",\n      popular: \"like\"\n    }\n    return tabToOrder[this.state.currentTab];\n  }\n\n  onWindowScroll = e => {\n    const target = document.documentElement;\n    if(\n      target.scrollTop >= target.scrollHeight - target.clientHeight - 100\n      && !this.isAllProjectsLoaded\n      && !this.isLoadingProjects\n    ) {\n      this.loadMoreProjects();\n    }\n  }\n\n  onClickTab = (tab) => {\n    this.setState({ currentTab : tab })\n  }\n\n  render() {\n    const { currentTab, projects } = this.state;\n    const { onClickTab } = this;\n    return (\n      <div className=\"challenge__project\">\n        <div className=\"challenge__project__tabs\">\n          <div \n            className={`challenge__project__tab ${currentTab === \"new\" && \"tab--active\"}`}\n            onClick={() => onClickTab(\"new\")}\n          >\n            <FormattedMessage id=\"ID_CHALLENGE_PROJECT_TAB_NEW\" />\n          </div>\n          <div \n            className={`challenge__project__tab ${currentTab === \"popular\" && \"tab--active\"}`}\n            onClick={() => onClickTab(\"popular\")}\n          >\n            <FormattedMessage id=\"ID_CHALLENGE_PROJECT_TAB_POPULAR\" />\n          </div>\n        </div>\n        <div className=\"challenge__project__list\">\n          {projects.map(project => (\n            <ChallengeProject key={project.id} challengeProject={project} />\n          ))}\n        </div>\n      </div>\n    );\n  }\n}\n"]},"metadata":{},"sourceType":"module"}