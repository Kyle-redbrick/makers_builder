{"ast":null,"code":"import _regeneratorRuntime from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _classCallCheck from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";\nimport _possibleConstructorReturn from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";\nimport _inherits from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";\nvar _jsxFileName = \"/Users/jimmy/Documents/Wizschool/wizlab_web2/src/Page/Builder/Component/Home/Component/NewProjectPopup/Container.js\";\nimport React, { Component } from \"react\";\nimport { connect } from \"react-redux\";\nimport { injectIntl } from \"react-intl\";\nimport View from \"./View\";\nimport generatePID from \"../../../../../../Common/Util/PIDGenerator\";\nimport * as request from \"../../../../../../Common/Util/HTTPRequest\";\nimport { PAGETYPE, URL } from \"../../../../../../Common/Util/Constant\";\n\nvar Container =\n/*#__PURE__*/\nfunction (_Component) {\n  _inherits(Container, _Component);\n\n  function Container(props) {\n    var _this;\n\n    _classCallCheck(this, Container);\n\n    _this = _possibleConstructorReturn(this, _getPrototypeOf(Container).call(this, props));\n\n    _this.componentDidMount = function () {\n      _this.setState({\n        projectName: _this.props.intl.formatMessage({\n          id: \"ID_TIP_LAYOUT_NEW_PROJECT_FORMAT\"\n        }, {\n          randomChar: String.fromCharCode(Math.floor(Math.random() * Math.floor(48)) + 48)\n        })\n      });\n    };\n\n    _this.onChangeProjectName = function (e) {\n      _this.setState({\n        projectName: e.target.value\n      });\n    };\n\n    _this.onClickEditorFormat = function (type) {\n      _this.setState({\n        editorFormat: type\n      });\n    };\n\n    _this.onClickMake2DProject = function () {\n      _this.createNewProject();\n    };\n\n    _this.createNewProject =\n    /*#__PURE__*/\n    _asyncToGenerator(\n    /*#__PURE__*/\n    _regeneratorRuntime.mark(function _callee() {\n      var host, type, res, template, emptyTemplate, pageURL;\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              if (!(_this.props.gameDimension === \"3D\")) {\n                _context.next = 5;\n                break;\n              }\n\n              host = window.location.host.includes(\"wizlab\") ? \"wizlab\" : \"redbrick\";\n              window.open(\"\".concat(URL.REDBRICK_3D_STUDIO, \"/?pid=\").concat(generatePID(_this.props.email), \"&from=\").concat(host), \"_blank\");\n\n              _this.props.dismiss();\n\n              return _context.abrupt(\"return\");\n\n            case 5:\n              type = _this.props.gameDimension === \"3D\" ? \"js3d\" : _this.state.editorFormat === \"text\" ? \"js\" : \"wizlabOOBC\";\n              _context.next = 8;\n              return request.getTemplateProjectsByType({\n                type: type\n              });\n\n            case 8:\n              res = _context.sent;\n              _context.next = 11;\n              return res.json();\n\n            case 11:\n              template = _context.sent;\n\n              if (template) {\n                _context.next = 14;\n                break;\n              }\n\n              return _context.abrupt(\"return\");\n\n            case 14:\n              emptyTemplate = template.filter(function (item) {\n                return item.description === \"empty\";\n              })[0];\n\n              if (emptyTemplate) {\n                _context.next = 17;\n                break;\n              }\n\n              return _context.abrupt(\"return\");\n\n            case 17:\n              if (_this.props.email) {\n                _this.createNewProjectFromServer(emptyTemplate.id);\n              } else {\n                pageURL = \"/\".concat(_this.props.gameDimension === \"3D\" ? PAGETYPE.BUILDER3D : PAGETYPE.BUILDER, \"?t=\").concat(emptyTemplate.id);\n                window.history.replaceState({}, \"\", pageURL);\n                window.location.reload();\n              }\n\n            case 18:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee, this);\n    }));\n\n    _this.createNewProjectFromServer =\n    /*#__PURE__*/\n    function () {\n      var _ref2 = _asyncToGenerator(\n      /*#__PURE__*/\n      _regeneratorRuntime.mark(function _callee2(templateId) {\n        var projectName, params, response, project, pageURL;\n        return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n          while (1) {\n            switch (_context2.prev = _context2.next) {\n              case 0:\n                projectName = _this.state.projectName;\n                params = {\n                  pId: generatePID(_this.props.email),\n                  email: _this.props.email,\n                  name: projectName,\n                  templateId: templateId\n                };\n                _context2.prev = 2;\n                _context2.next = 5;\n                return request.postDevelopingProject(params);\n\n              case 5:\n                response = _context2.sent;\n                _context2.next = 8;\n                return response.json();\n\n              case 8:\n                project = _context2.sent;\n\n                if (project) {\n                  pageURL = \"/\".concat(_this.props.gameDimension === \"3D\" ? PAGETYPE.BUILDER3D : PAGETYPE.BUILDER, \"/\").concat(project.pId);\n                  window.history.replaceState({}, \"\", pageURL);\n                  window.location.reload();\n                }\n\n                _context2.next = 15;\n                break;\n\n              case 12:\n                _context2.prev = 12;\n                _context2.t0 = _context2[\"catch\"](2);\n                console.error(_context2.t0);\n\n              case 15:\n              case \"end\":\n                return _context2.stop();\n            }\n          }\n        }, _callee2, this, [[2, 12]]);\n      }));\n\n      return function (_x) {\n        return _ref2.apply(this, arguments);\n      };\n    }();\n\n    _this.state = {\n      editorFormat: \"text\",\n      projectName: \"\"\n    };\n    return _this;\n  }\n\n  _createClass(Container, [{\n    key: \"render\",\n    value: function render() {\n      var _this$state = this.state,\n          editorFormat = _this$state.editorFormat,\n          projectName = _this$state.projectName;\n      var onChangeProjectName = this.onChangeProjectName,\n          onClickEditorFormat = this.onClickEditorFormat,\n          onClickMake2DProject = this.onClickMake2DProject;\n      var gameDimension = this.props.gameDimension;\n      return React.createElement(View, {\n        editorFormat: editorFormat,\n        projectName: projectName,\n        onChangeProjectName: onChangeProjectName,\n        onClickEditorFormat: onClickEditorFormat,\n        onClickMake2DProject: onClickMake2DProject,\n        gameDimension: gameDimension,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 109\n        },\n        __self: this\n      });\n    }\n  }]);\n\n  return Container;\n}(Component);\n\nexport default connect(function (state) {\n  return {\n    email: state.userinfo.email\n  };\n}, {})(injectIntl(Container));","map":{"version":3,"sources":["/Users/jimmy/Documents/Wizschool/wizlab_web2/src/Page/Builder/Component/Home/Component/NewProjectPopup/Container.js"],"names":["React","Component","connect","injectIntl","View","generatePID","request","PAGETYPE","URL","Container","props","componentDidMount","setState","projectName","intl","formatMessage","id","randomChar","String","fromCharCode","Math","floor","random","onChangeProjectName","e","target","value","onClickEditorFormat","type","editorFormat","onClickMake2DProject","createNewProject","gameDimension","host","window","location","includes","open","REDBRICK_3D_STUDIO","email","dismiss","state","getTemplateProjectsByType","res","json","template","emptyTemplate","filter","item","description","createNewProjectFromServer","pageURL","BUILDER3D","BUILDER","history","replaceState","reload","templateId","params","pId","name","postDevelopingProject","response","project","console","error","userinfo"],"mappings":"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","sourcesContent":["import React, { Component } from \"react\";\nimport { connect } from \"react-redux\";\nimport { injectIntl } from \"react-intl\";\nimport View from \"./View\";\nimport generatePID from \"../../../../../../Common/Util/PIDGenerator\";\nimport * as request from \"../../../../../../Common/Util/HTTPRequest\";\nimport { PAGETYPE, URL } from \"../../../../../../Common/Util/Constant\";\n\nclass Container extends Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      editorFormat: \"text\",\n      projectName: \"\"\n    };\n  }\n  componentDidMount = () => {\n    this.setState({\n      projectName: this.props.intl.formatMessage(\n        { id: \"ID_TIP_LAYOUT_NEW_PROJECT_FORMAT\" },\n        {\n          randomChar: String.fromCharCode(\n            Math.floor(Math.random() * Math.floor(48)) + 48\n          )\n        }\n      )\n    });\n  };\n  onChangeProjectName = e => {\n    this.setState({ projectName: e.target.value });\n  };\n\n  onClickEditorFormat = type => {\n    this.setState({ editorFormat: type });\n  };\n  onClickMake2DProject = () => {\n    this.createNewProject();\n  };\n\n  createNewProject = async () => {\n    if (this.props.gameDimension === \"3D\") {\n      const host = window.location.host.includes(\"wizlab\") ? \"wizlab\" : \"redbrick\";\n      window.open(`${URL.REDBRICK_3D_STUDIO}/?pid=${generatePID(this.props.email)}&from=${host}`, \"_blank\")\n      this.props.dismiss();\n      return;\n    }\n    let type =\n      this.props.gameDimension === \"3D\"\n        ? \"js3d\"\n        : this.state.editorFormat === \"text\"\n        ? \"js\"\n        : \"wizlabOOBC\";\n\n    let res = await request.getTemplateProjectsByType({ type });\n    let template = await res.json();\n    if (!template) return;\n    let emptyTemplate = template.filter(\n      item => item.description === \"empty\"\n    )[0];\n    if (!emptyTemplate) return;\n    if (this.props.email) {\n      this.createNewProjectFromServer(emptyTemplate.id);\n    } else {\n      let pageURL = `/${\n        this.props.gameDimension === \"3D\"\n          ? PAGETYPE.BUILDER3D\n          : PAGETYPE.BUILDER\n      }?t=${emptyTemplate.id}`;\n      window.history.replaceState({}, \"\", pageURL);\n      window.location.reload();\n    }\n  };\n\n  createNewProjectFromServer = async templateId => {\n    const { projectName } = this.state;\n    let params = {\n      pId: generatePID(this.props.email),\n      email: this.props.email,\n      name: projectName,\n      templateId\n    };\n    try {\n      const response = await request.postDevelopingProject(params);\n      const project = await response.json();\n      if (project) {\n        let pageURL = `/${\n          this.props.gameDimension === \"3D\"\n            ? PAGETYPE.BUILDER3D\n            : PAGETYPE.BUILDER\n        }/${project.pId}`;\n\n        window.history.replaceState({}, \"\", pageURL);\n        window.location.reload();\n      }\n    } catch (e) {\n      console.error(e);\n    }\n  };\n\n  render() {\n    const { editorFormat, projectName } = this.state;\n    const {\n      onChangeProjectName,\n      onClickEditorFormat,\n      onClickMake2DProject\n    } = this;\n    const { gameDimension } = this.props;\n    return (\n      <View\n        editorFormat={editorFormat}\n        projectName={projectName}\n        onChangeProjectName={onChangeProjectName}\n        onClickEditorFormat={onClickEditorFormat}\n        onClickMake2DProject={onClickMake2DProject}\n        gameDimension={gameDimension}\n      />\n    );\n  }\n}\nexport default connect(\n  state => ({ email: state.userinfo.email }),\n  {}\n)(injectIntl(Container));\n"]},"metadata":{},"sourceType":"module"}