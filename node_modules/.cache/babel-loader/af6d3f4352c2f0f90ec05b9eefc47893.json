{"ast":null,"code":"import _objectSpread from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread\";\nimport _regeneratorRuntime from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _classCallCheck from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";\nimport _assertThisInitialized from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/assertThisInitialized\";\nimport _inherits from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";\nimport _possibleConstructorReturn from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"/Users/jimmy/Documents/Wizschool/wizlab_web2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";\nvar _jsxFileName = \"/Users/jimmy/Documents/Wizschool/wizlab_web2/src/Page/Builder/Component/OCP2BLOCK/Container.js\";\n\nfunction _createSuper(Derived) { var hasNativeReflectConstruct = _isNativeReflectConstruct(); return function _createSuperInternal() { var Super = _getPrototypeOf(Derived), result; if (hasNativeReflectConstruct) { var NewTarget = _getPrototypeOf(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return _possibleConstructorReturn(this, result); }; }\n\nfunction _isNativeReflectConstruct() { if (typeof Reflect === \"undefined\" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === \"function\") return true; try { Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {})); return true; } catch (e) { return false; } }\n\nimport React, { Component } from \"react\";\nimport { withRouter } from \"react-router-dom\";\nimport { connect } from \"react-redux\";\nimport * as userInfoActions from \"../../../../Common/Store/Reducer/UserInfo\";\nimport Videoclass from \"../Videoclass\";\nimport * as request from \"../../../../Common/Util/HTTPRequest\";\nimport * as OcpToken from \"../../../../Common/Util/OcpToken\";\nimport Popup, { showPopUp } from \"../../../../Common/Component/PopUp\";\nimport store from \"../../Store\";\nimport Print from \"../../../../Common/Component/OCPCertification\";\n/* not used component */\n\nvar Container = /*#__PURE__*/function (_Component) {\n  _inherits(Container, _Component);\n\n  var _super = _createSuper(Container);\n\n  function Container(props) {\n    var _this;\n\n    _classCallCheck(this, Container);\n\n    _this = _super.call(this, props);\n    _this.componentDidMount = /*#__PURE__*/_asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee() {\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              _context.prev = 0;\n              _context.next = 3;\n              return _this.getMyOcp();\n\n            case 3:\n              if (_this.state.maxOcpLevel < _this.props.videoclass.level) {\n                _this.handleChangeLevel(_this.state.maxOcpLevel);\n              }\n\n              window.addEventListener(\"storage\", _this.detectStorage);\n              _context.next = 10;\n              break;\n\n            case 7:\n              _context.prev = 7;\n              _context.t0 = _context[\"catch\"](0);\n              console.error(_context.t0);\n\n            case 10:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee, null, [[0, 7]]);\n    }));\n\n    _this.componentDidUpdate = /*#__PURE__*/function () {\n      var _ref2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2(prevProps) {\n        return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n          while (1) {\n            switch (_context2.prev = _context2.next) {\n              case 0:\n                if (!(_this.props.userinfo.email && !prevProps.userinfo.email)) {\n                  _context2.next = 5;\n                  break;\n                }\n\n                _context2.next = 3;\n                return _this.getMyOcp();\n\n              case 3:\n                _context2.next = 8;\n                break;\n\n              case 5:\n                if (!(!_this.props.userinfo.email && prevProps.userinfo.email)) {\n                  _context2.next = 8;\n                  break;\n                }\n\n                _context2.next = 8;\n                return _this.getMyOcp();\n\n              case 8:\n              case \"end\":\n                return _context2.stop();\n            }\n          }\n        }, _callee2);\n      }));\n\n      return function (_x) {\n        return _ref2.apply(this, arguments);\n      };\n    }();\n\n    _this.detectStorage = function (e) {\n      if (e.key === \"ocpId\") {\n        window.location.reload();\n      }\n    };\n\n    _this.handleChangeLevel = function (level) {\n      _this.props.history.replace(\"./\".concat(level));\n\n      window.location.reload();\n    };\n\n    _this.getMyOcp = /*#__PURE__*/_asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee3() {\n      var res, json, currentData;\n      return _regeneratorRuntime.wrap(function _callee3$(_context3) {\n        while (1) {\n          switch (_context3.prev = _context3.next) {\n            case 0:\n              if (!(_this.props.userinfo.email || _this.guest)) {\n                _context3.next = 10;\n                break;\n              }\n\n              _context3.next = 3;\n              return request.getMyOcp2(_objectSpread({}, _this.props.userinfo.email ? {\n                email: _this.props.userinfo.email\n              } : {\n                guestId: _this.guest && _this.guest.id\n              }, {\n                type: _this.type\n              }));\n\n            case 3:\n              res = _context3.sent;\n              _context3.next = 6;\n              return res.json();\n\n            case 6:\n              json = _context3.sent;\n\n              if (!json) {\n                _this.setState({\n                  maxOcpLevel: 1\n                });\n              } else {\n                currentData = json.find(function (element) {\n                  return element.grade === _this.grade;\n                });\n\n                _this.setState({\n                  maxOcpLevel: Number(currentData ? currentData.level : 0) + 1\n                });\n              }\n\n              _context3.next = 11;\n              break;\n\n            case 10:\n              _this.setState({\n                maxOcpLevel: 1\n              });\n\n            case 11:\n            case \"end\":\n              return _context3.stop();\n          }\n        }\n      }, _callee3);\n    }));\n    _this.onEnterEndStage = /*#__PURE__*/_asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee4() {\n      return _regeneratorRuntime.wrap(function _callee4$(_context4) {\n        while (1) {\n          switch (_context4.prev = _context4.next) {\n            case 0:\n              if (!(_this.state.maxOcpLevel < _this.props.videoclass.level + 1)) {\n                _context4.next = 12;\n                break;\n              }\n\n              if (!_this.props.userinfo.email) {\n                _context4.next = 6;\n                break;\n              }\n\n              _context4.next = 4;\n              return request.updateMyOcpLevel2({\n                email: _this.props.userinfo.email,\n                level: _this.props.videoclass.level,\n                grade: _this.grade,\n                type: _this.type\n              });\n\n            case 4:\n              _context4.next = 12;\n              break;\n\n            case 6:\n              if (_this.guest) {\n                _context4.next = 10;\n                break;\n              }\n\n              _context4.next = 9;\n              return OcpToken.addOcpUser(_this.props.userinfo.email, _this.grade);\n\n            case 9:\n              _this.guest = localStorage.getItem(\"ocpId\") && JSON.parse(localStorage.getItem(\"ocpId\"));\n\n            case 10:\n              _context4.next = 12;\n              return request.updateMyOcpLevel2({\n                guestId: _this.guest && _this.guest.id,\n                level: _this.props.videoclass.level,\n                grade: _this.grade,\n                type: _this.type\n              });\n\n            case 12:\n              if (_this.props.videoclass.level === 10) {\n                _this.showPrintPopup();\n              }\n\n            case 13:\n            case \"end\":\n              return _context4.stop();\n          }\n        }\n      }, _callee4);\n    }));\n\n    _this.endStageButtonAction = function () {\n      if (_this.props.videoclass.level < 10) {\n        _this.handleChangeLevel(_this.props.videoclass.level + 1);\n      } else {\n        _this.props.history.push(\"../../../tutorial\");\n      }\n    };\n\n    _this.showPrintPopup = function () {\n      showPopUp( /*#__PURE__*/React.createElement(Popup.TwoButton, {\n        title: \"\\uC778\\uC99D\\uC11C\\uB97C \\uCD9C\\uB825\\uD558\\uC2DC\\uACA0\\uC2B5\\uB2C8\\uAE4C?\",\n        subtitle: \"\\uB098\\uC911\\uC5D0\\uB3C4 \\uCD9C\\uB825\\uAC00\\uB2A5\\uD569\\uB2C8\\uB2E4.\",\n        cancelButtonName: \"\\uC544\\uB2C8\\uC624\",\n        confirmButtonName: \"\\uB124\",\n        confirmAction: function confirmAction() {\n          return _this.handleCertification();\n        },\n        cancelAction: _this.printCallback,\n        __self: _assertThisInitialized(_this),\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 125,\n          columnNumber: 7\n        }\n      }), {\n        store: store,\n        dismissOverlay: true\n      });\n    };\n\n    _this.handleCertification = /*#__PURE__*/_asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee5() {\n      var name, organization, res, guest, callback;\n      return _regeneratorRuntime.wrap(function _callee5$(_context5) {\n        while (1) {\n          switch (_context5.prev = _context5.next) {\n            case 0:\n              if (!_this.props.userinfo.email) {\n                _context5.next = 4;\n                break;\n              }\n\n              if (_this.props.userinfo.organization) {\n                name = _this.props.userinfo.name;\n                organization = _this.props.userinfo.organization;\n              } else {\n                showPopUp( /*#__PURE__*/React.createElement(Popup.OneInput, {\n                  title: \"\\uD559\\uAD50\\uB97C \\uC785\\uB825\\uD574\\uC8FC\\uC138\\uC694\",\n                  buttonName: \"\\uD655\\uC778\",\n                  inputLimit: 10,\n                  buttonAction: function buttonAction(org) {\n                    return callback(org);\n                  },\n                  __self: _assertThisInitialized(_this),\n                  __source: {\n                    fileName: _jsxFileName,\n                    lineNumber: 145,\n                    columnNumber: 11\n                  }\n                }), {\n                  store: store,\n                  dismissOverlay: true\n                });\n              }\n\n              _context5.next = 11;\n              break;\n\n            case 4:\n              _context5.next = 6;\n              return request.getOcpUser2({\n                guestId: _this.guest && _this.guest.id\n              });\n\n            case 6:\n              res = _context5.sent;\n              _context5.next = 9;\n              return res.json();\n\n            case 9:\n              guest = _context5.sent;\n\n              if (guest) {\n                if (!(guest.name && guest.organization)) {\n                  showPopUp( /*#__PURE__*/React.createElement(Popup.TwoInput, {\n                    title: \"\\uD559\\uAD50\\uB97C \\uC785\\uB825\\uD574\\uC8FC\\uC138\\uC694\",\n                    buttonName: \"\\uD655\\uC778\",\n                    inputTitle1: \"\\uC774\\uB984\",\n                    inputTitle2: \"\\uD559\\uAD50\",\n                    inputLimit1: 8,\n                    inputLimit2: 10,\n                    buttonAction: function buttonAction(org, name) {\n                      return callback(org, name);\n                    },\n                    __self: _assertThisInitialized(_this),\n                    __source: {\n                      fileName: _jsxFileName,\n                      lineNumber: 162,\n                      columnNumber: 13\n                    }\n                  }), {\n                    store: store,\n                    dismissOverlay: true\n                  });\n                } else {\n                  name = guest.name;\n                  organization = guest.organization;\n                }\n              }\n\n            case 11:\n              if (name && organization) {\n                showPopUp( /*#__PURE__*/React.createElement(Print, {\n                  organization: organization.substring(0, 10),\n                  grade: _this.grade,\n                  name: name.substring(0, 8),\n                  callback: _this.printCallback,\n                  __self: _assertThisInitialized(_this),\n                  __source: {\n                    fileName: _jsxFileName,\n                    lineNumber: 182,\n                    columnNumber: 9\n                  }\n                }), {\n                  store: store\n                });\n              }\n\n              callback = function callback(org) {\n                var name = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : _this.props.userinfo.name;\n                showPopUp( /*#__PURE__*/React.createElement(Print, {\n                  organization: org,\n                  grade: _this.grade,\n                  name: name,\n                  callback: _this.printCallback,\n                  __self: _assertThisInitialized(_this),\n                  __source: {\n                    fileName: _jsxFileName,\n                    lineNumber: 193,\n                    columnNumber: 9\n                  }\n                }), {\n                  store: store\n                });\n                request.updateOcpUser2({\n                  guestId: _this.guest && _this.guest.id,\n                  email: _this.props.userinfo.email,\n                  name: name,\n                  organization: org\n                });\n\n                _this.props.updateUserInfo();\n              };\n\n            case 13:\n            case \"end\":\n              return _context5.stop();\n          }\n        }\n      }, _callee5);\n    }));\n\n    _this.printCallback = function () {\n      request.updateMyOcpPrint2(_this.props.userinfo.email ? {\n        email: _this.props.userinfo.email,\n        grade: _this.grade\n      } : {\n        guestId: _this.guest && _this.guest.id,\n        grade: _this.grade\n      });\n    };\n\n    var grade = props.match.params.grade;\n    _this.type = _this.props.match.path.split(\"/\")[2];\n    _this.grade = grade;\n    _this.guest = localStorage.getItem(\"ocpId\") && JSON.parse(localStorage.getItem(\"ocpId\"));\n    _this.state = {\n      maxOcpLevel: undefined\n    };\n    return _this;\n  }\n\n  _createClass(Container, [{\n    key: \"componentWillUnmount\",\n    value: function componentWillUnmount() {\n      window.removeEventListener(\"storage\", this.detectStorage);\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _this$props = this.props,\n          zIndex = _this$props.zIndex,\n          showModal = _this$props.showModal,\n          handleSelectTab = _this$props.handleSelectTab,\n          _handleChangeZIndex = _this$props.handleChangeZIndex;\n      var maxOcpLevel = this.state.maxOcpLevel;\n      var endStageButtonId = this.props.videoclass.level < 10 ? \"ID_VIDEOCLASS_ENDSTEP_DEFAULT\" : \"ID_VIDEOCLASS_TO_HOME\";\n      return /*#__PURE__*/React.createElement(Videoclass, {\n        zIndex: zIndex,\n        showModal: showModal,\n        handleSelectTab: handleSelectTab,\n        handleChangeZIndex: function handleChangeZIndex() {\n          _handleChangeZIndex(\"ocp\");\n        },\n        videoclass: this.props.videoclass,\n        maxOcpLevel: maxOcpLevel,\n        onEndStage: this.onEnterEndStage,\n        endStageButtonAction: this.endStageButtonAction,\n        endStageButtonId: endStageButtonId,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 233,\n          columnNumber: 7\n        }\n      });\n    }\n  }]);\n\n  return Container;\n}(Component);\n\nexport default connect(function (state) {\n  return {\n    userinfo: state.userinfo,\n    videoclass: state.project.videoclass\n  };\n}, {\n  updateUserInfo: userInfoActions.updateUserInfo\n})(withRouter(Container));","map":{"version":3,"sources":["/Users/jimmy/Documents/Wizschool/wizlab_web2/src/Page/Builder/Component/OCP2BLOCK/Container.js"],"names":["React","Component","withRouter","connect","userInfoActions","Videoclass","request","OcpToken","Popup","showPopUp","store","Print","Container","props","componentDidMount","getMyOcp","state","maxOcpLevel","videoclass","level","handleChangeLevel","window","addEventListener","detectStorage","console","error","componentDidUpdate","prevProps","userinfo","email","e","key","location","reload","history","replace","guest","getMyOcp2","guestId","id","type","res","json","setState","currentData","find","element","grade","Number","onEnterEndStage","updateMyOcpLevel2","addOcpUser","localStorage","getItem","JSON","parse","showPrintPopup","endStageButtonAction","push","handleCertification","printCallback","dismissOverlay","organization","name","org","callback","getOcpUser2","substring","updateOcpUser2","updateUserInfo","updateMyOcpPrint2","match","params","path","split","undefined","removeEventListener","zIndex","showModal","handleSelectTab","handleChangeZIndex","endStageButtonId","project"],"mappings":"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","sourcesContent":["import React, { Component } from \"react\";\nimport { withRouter } from \"react-router-dom\";\nimport { connect } from \"react-redux\";\nimport * as userInfoActions from \"../../../../Common/Store/Reducer/UserInfo\";\nimport Videoclass from \"../Videoclass\";\nimport * as request from \"../../../../Common/Util/HTTPRequest\";\nimport * as OcpToken from \"../../../../Common/Util/OcpToken\";\nimport Popup, { showPopUp } from \"../../../../Common/Component/PopUp\";\nimport store from \"../../Store\";\nimport Print from \"../../../../Common/Component/OCPCertification\";\n/* not used component */\nclass Container extends Component {\n  constructor(props) {\n    super(props);\n    const { grade } = props.match.params;\n    this.type = this.props.match.path.split(\"/\")[2];\n    this.grade = grade;\n    this.guest =\n      localStorage.getItem(\"ocpId\") &&\n      JSON.parse(localStorage.getItem(\"ocpId\"));\n    this.state = { maxOcpLevel: undefined };\n  }\n\n  componentDidMount = async () => {\n    try {\n      /** check my stage  && set max level */\n      await this.getMyOcp();\n      if (this.state.maxOcpLevel < this.props.videoclass.level) {\n        this.handleChangeLevel(this.state.maxOcpLevel);\n      }\n      window.addEventListener(\"storage\", this.detectStorage);\n    } catch (e) {\n      console.error(e);\n    }\n  };\n\n  componentWillUnmount() {\n    window.removeEventListener(\"storage\", this.detectStorage);\n  }\n  componentDidUpdate = async prevProps => {\n    if (this.props.userinfo.email && !prevProps.userinfo.email) {\n      await this.getMyOcp();\n    } else if (!this.props.userinfo.email && prevProps.userinfo.email) {\n      await this.getMyOcp();\n    }\n  };\n  detectStorage = e => {\n    if (e.key === \"ocpId\") {\n      window.location.reload();\n    }\n  };\n\n  handleChangeLevel = level => {\n    this.props.history.replace(`./${level}`);\n    window.location.reload();\n  };\n\n  getMyOcp = async () => {\n    if (this.props.userinfo.email || this.guest) {\n      let res = await request.getMyOcp2({\n        ...(this.props.userinfo.email\n          ? { email: this.props.userinfo.email }\n          : { guestId: this.guest && this.guest.id }),\n        type: this.type\n      });\n      let json = await res.json();\n      if (!json) {\n        this.setState({\n          maxOcpLevel: 1\n        });\n      } else {\n        let currentData = json.find(element => element.grade === this.grade);\n        this.setState({\n          maxOcpLevel: Number(currentData ? currentData.level : 0) + 1\n        });\n      }\n    } else {\n      this.setState({\n        maxOcpLevel: 1\n      });\n    }\n  };\n  /* end */\n  onEnterEndStage = async () => {\n    // max레벨을 업데이트 해야할때만 request 보냄\n    if (this.state.maxOcpLevel < this.props.videoclass.level + 1) {\n      if (this.props.userinfo.email) {\n        await request.updateMyOcpLevel2({\n          email: this.props.userinfo.email,\n          level: this.props.videoclass.level,\n          grade: this.grade,\n          type: this.type\n        });\n      } else {\n        if (!this.guest) {\n          await OcpToken.addOcpUser(this.props.userinfo.email, this.grade);\n          this.guest =\n            localStorage.getItem(\"ocpId\") &&\n            JSON.parse(localStorage.getItem(\"ocpId\"));\n        }\n        await request.updateMyOcpLevel2({\n          guestId: this.guest && this.guest.id,\n          level: this.props.videoclass.level,\n          grade: this.grade,\n          type: this.type\n        });\n      }\n    }\n\n    if (this.props.videoclass.level === 10) {\n      this.showPrintPopup();\n    }\n  };\n  endStageButtonAction = () => {\n    if (this.props.videoclass.level < 10) {\n      this.handleChangeLevel(this.props.videoclass.level + 1);\n    } else {\n      this.props.history.push(\"../../../tutorial\");\n    }\n  };\n\n  /* print */\n  showPrintPopup = () => {\n    showPopUp(\n      <Popup.TwoButton\n        title=\"인증서를 출력하시겠습니까?\"\n        subtitle=\"나중에도 출력가능합니다.\"\n        cancelButtonName=\"아니오\"\n        confirmButtonName=\"네\"\n        confirmAction={() => this.handleCertification()}\n        cancelAction={this.printCallback}\n      />,\n      { store, dismissOverlay: true }\n    );\n  };\n\n  handleCertification = async () => {\n    let name, organization;\n    if (this.props.userinfo.email) {\n      if (this.props.userinfo.organization) {\n        name = this.props.userinfo.name;\n        organization = this.props.userinfo.organization;\n      } else {\n        showPopUp(\n          <Popup.OneInput\n            title=\"학교를 입력해주세요\"\n            buttonName=\"확인\"\n            inputLimit={10}\n            buttonAction={org => callback(org)}\n          />,\n          { store, dismissOverlay: true }\n        );\n      }\n    } else {\n      const res = await request.getOcpUser2({\n        guestId: this.guest && this.guest.id\n      });\n      const guest = await res.json();\n      if (guest) {\n        if (!(guest.name && guest.organization)) {\n          showPopUp(\n            <Popup.TwoInput\n              title=\"학교를 입력해주세요\"\n              buttonName=\"확인\"\n              inputTitle1=\"이름\"\n              inputTitle2=\"학교\"\n              inputLimit1={8}\n              inputLimit2={10}\n              buttonAction={(org, name) => callback(org, name)}\n            />,\n            { store, dismissOverlay: true }\n          );\n        } else {\n          name = guest.name;\n          organization = guest.organization;\n        }\n      }\n    }\n\n    if (name && organization) {\n      showPopUp(\n        <Print\n          organization={organization.substring(0, 10)}\n          grade={this.grade}\n          name={name.substring(0, 8)}\n          callback={this.printCallback}\n        />,\n        { store }\n      );\n    }\n    const callback = (org, name = this.props.userinfo.name) => {\n      showPopUp(\n        <Print\n          organization={org}\n          grade={this.grade}\n          name={name}\n          callback={this.printCallback}\n        />,\n        { store }\n      );\n\n      request.updateOcpUser2({\n        guestId: this.guest && this.guest.id,\n        email: this.props.userinfo.email,\n        name: name,\n        organization: org\n      });\n      this.props.updateUserInfo();\n    };\n  };\n\n  printCallback = () => {\n    request.updateMyOcpPrint2(\n      this.props.userinfo.email\n        ? { email: this.props.userinfo.email, grade: this.grade }\n        : { guestId: this.guest && this.guest.id, grade: this.grade }\n    );\n  };\n\n  render() {\n    const {\n      zIndex,\n      showModal,\n      handleSelectTab,\n      handleChangeZIndex\n    } = this.props;\n    const { maxOcpLevel } = this.state;\n    const endStageButtonId =\n      this.props.videoclass.level < 10\n        ? \"ID_VIDEOCLASS_ENDSTEP_DEFAULT\"\n        : \"ID_VIDEOCLASS_TO_HOME\";\n    return (\n      <Videoclass\n        zIndex={zIndex}\n        showModal={showModal}\n        handleSelectTab={handleSelectTab}\n        handleChangeZIndex={() => {\n          handleChangeZIndex(\"ocp\");\n        }}\n        videoclass={this.props.videoclass}\n        maxOcpLevel={maxOcpLevel}\n        onEndStage={this.onEnterEndStage}\n        endStageButtonAction={this.endStageButtonAction}\n        endStageButtonId={endStageButtonId}\n      />\n    );\n  }\n}\n\nexport default connect(\n  state => ({\n    userinfo: state.userinfo,\n    videoclass: state.project.videoclass\n  }),\n  { updateUserInfo: userInfoActions.updateUserInfo }\n)(withRouter(Container));\n"]},"metadata":{},"sourceType":"module"}