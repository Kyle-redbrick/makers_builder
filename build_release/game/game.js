var global={},serverData={};function Game(e){var t=e.screenWidth,s=e.screenHeight,a=e.screenMode,o=e.wrapperId,n=e.scenes,i=e.sceneIds,c=e.soundIds,r=e.errorHandler,m=e.preloadHandler,h=e.assets,d=e.wideScreen,g=e.systemVolume,u=e.isFromWizlab;localStorage.setItem("pId",e.pId),this.errorHandler=r,this.gameScenes=[],this.game=new Phaser.Game({width:t,height:s,renderer:Phaser.WEBGL,parent:o,transparent:!0}),this.game.isFromWizlab=u,this.game.didStartRender=!1,this.game.systemVolume=g,this.game.gameVolume=1,this.game.sendGameEvent=function(e){parent.postMessage({type:"gameEvent",event:e},"*")},this.setSocket();for(var k={},p="",l=0;l<i.length;l++){var v=i[l],f=new GameScene({game:this.game,screenMode:a,sceneId:v,spriteData:n[v],soundIds:c,errorHandler:r,assets:h,scenes:n,isFirstScene:0===l,preloadHandler:m,screenWidth:t,screenHeight:s,wideScreen:d,socketManager:this.socketManager});this.gameScenes.push(f),this.game.state.add(v,f);for(var y=n[v],I=0;I<y.spriteIds.length;I++){var G=y.sprites[y.spriteIds[I]];G.type===SpriteType.TEXT&&(k[G.preview.fontFamily]=1,p+=G.preview.textValue)}}window.WebFont&&0<Object.keys(k).length?window.WebFont.load({google:{families:Object.keys(k),text:p},active:function(){this.game.state.start(i[0],!0,!1)}.bind(this),inactive:function(){this.game.state.start(i[0],!0,!1)}.bind(this)}):this.game.state.start(i[0],!0,!1)}Game.prototype.destroy=function(){global={},serverData={},this.game.cache=new Phaser.Cache(this.game),this.game.load.reset(),this.game.load.removeAll(),this.game.destroy()},Game.prototype.onGyroChanged=function(e,t){var s=this.game.state.current;this.game.state.states[s].onGyroChanged(e,t)},Game.prototype.onListeningResult=function(e){var t=this.game.state.current;this.game.state.states[t].onListeningResult(e)},Game.prototype.onShaked=function(){var e=this.game.state.current;this.game.state.states[e].onShaked()},Game.prototype.onFaceDetect=function(e){var t=this.game.state.current;this.game.state.states[t].onFaceDetect(e)},Game.prototype.onSaveGameData=function(){var e=this.game.state.current;this.game.state.states[e].onSaveGameData()},Game.prototype.onResetGameData=function(){Object.keys(serverData).forEach(function(e){delete serverData[e]});var e=this.game.state.current;this.game.state.states[e].onResetGameData()},Game.prototype.onLoadGameData=function(e){Object.keys(serverData).forEach(function(e){delete serverData[e]}),Object.assign(serverData,JSON.parse(e));e=this.game.state.current;this.game.state.states[e].onLoadGameData()},Game.prototype.onUpdateSystemVolume=function(e){this.game.systemVolume=e,this.game.sound.volume=this.game.gameVolume*this.game.systemVolume/100},Game.prototype.onReceiveTFSignal=function(e){var t=this.game.state.current;this.game.state.states[t].sendSignal(e)},Game.prototype.setSocket=function(){this.socketManager={isConnected:function(){return!!this.socket&&this.socket.connected},connect:function(e){this.socket||(this.socket=io(GAME_SOCKET_SERVER),this.socket.roomId=localStorage.getItem("pId"),this.socket.on("connect",function(){this.socket.emit("join",{roomId:this.socket.roomId}),e()}.bind(this)),this.socket.on("message",function(e){this.onReceive&&this.onReceive(e.data)}.bind(this)))},disconnect:function(){this.socket&&(this.socket.disconnect(),this.socket=void 0)},emit:function(e){this.socket&&this.socket.connected&&this.socket.emit("message",{roomId:this.socket.roomId,data:e})},getData:function(t){this.socket&&this.socket.connected&&(this.socket.emit("getData",{roomId:this.socket.roomId}),this.socket.once("getData",function(e){t(e)}))},setData:function(e){this.socket&&this.socket.connected&&this.socket.emit("setData",{roomId:this.socket.roomId,data:e})},joinRoom:function(e){this.socket&&this.socket.connected&&e&&this.socket.emit("join",{roomId:this.socket.roomId+"_"+e})},leaveRoom:function(e){this.socket&&this.socket.connected&&e&&this.socket.emit("leave",{roomId:this.socket.roomId+"_"+e})},emitRoom:function(e,t){this.socket&&this.socket.connected&&e&&this.socket.emit("message",{roomId:this.socket.roomId+"_"+e,data:t})},onReceive:function(){}}};