function WizSprite(e){this.defaultSpeed=100,this.speed=100,this.onKeyListener={},this.onKeyUpListener={},this.onClickListener=void 0,this.onClickUpListener=void 0,this.onScreenClickListener=void 0,this.onScreenClickUpListener=void 0,this.onListeningListener=void 0,this.onFaceDetectListener=void 0,this.signalReceiver={},this.signalQueue=[],this.swipeHandler={},this.errorHandler=e.errorHandler,this.game=e.game,this.gameScene=e.gameScene,this.type=e.type,this.subtype=e.subtype,this.sprite=e.sprite,this.codeData=e.codeData,this.spriteName=e.spriteName,this.originalName=e.originalName,this.spriteId=e.spriteId,this.asset=e.asset,this.socketManager=e.socketManager,this.isCloned=this.spriteName!==this.originalName,this.setAnimations(),this.setBodySize(),this.isCodeRun=this.isCloned,this.saySprite=void 0,this.sayBgSprite=void 0,this.pen=void 0,this.penSize=1,this.penColor="0x000000",this.sayTimer=void 0,this.prevDegreeForVFD=0,this.prevForceForVFD=0,this.sendGameEvent=function(e){this.gameScene.sendGameEvent(Object.assign({spriteId:this.spriteName},e))},setFunctions.call(this)}function setFunctions(){this.cameraFollow=function(){this.game.camera.follow(this.sprite)}.bind(this),this.fixToCamera=function(){this.sprite.fixedToCamera=!0}.bind(this),this.moveForward=function(e){if(void 0!==e){if(!isNaN(e)){var t=this.sprite.angle*Math.PI/180,i=e*Math.cos(t)+this.sprite.x,s=e*Math.sin(t)+this.sprite.y;return this.sendGameEvent({api:"moveForward",steps:e}),new Promise(function(e){this.moveTo(i,s).then(function(){e()})}.bind(this))}this.errorHandler(ErrorType.PARAMETER_INVALID_TYPE,this.getErrorName("moveForward"))}else this.errorHandler(ErrorType.PARAMETER_UNDEFINED,this.getErrorName("moveForward"))}.bind(this),this.moveX=function(e){if(void 0!==e){if(isNaN(e))this.errorHandler(ErrorType.PARAMETER_INVALID_TYPE,this.getErrorName("moveX"));else if(0!==e){if(this.type!==SpriteType.BACKGROUND){var t=this.sprite.x+e,i=this.sprite.y;return this.sendGameEvent({api:"moveX",steps:e}),new Promise(function(e){this.moveTo(t,i).then(function(){e()})}.bind(this))}this.sprite.tilePosition.x+=e}}else this.errorHandler(ErrorType.PARAMETER_UNDEFINED,this.getErrorName("moveX"))}.bind(this),this.moveY=function(e){if(void 0!==e){if(isNaN(e))this.errorHandler(ErrorType.PARAMETER_INVALID_TYPE,this.getErrorName("moveY"));else if(0!==e){if(this.type!==SpriteType.BACKGROUND){var t=this.sprite.x,i=this.sprite.y+e;return this.sendGameEvent({api:"moveY",steps:e}),new Promise(function(e){this.moveTo(t,i).then(function(){e()})}.bind(this))}this.sprite.tilePosition.y+=e}}else this.errorHandler(ErrorType.PARAMETER_UNDEFINED,this.getErrorName("moveY"))}.bind(this),this.turn=function(e){void 0!==e?isNaN(e)?this.errorHandler(ErrorType.PARAMETER_INVALID_TYPE,this.getErrorName("turn")):(this.sprite.angle+=e,this.sendGameEvent({api:"turn",degree:e})):this.errorHandler(ErrorType.PARAMETER_UNDEFINED,this.getErrorName("turn"))}.bind(this),this.turnToSprite=function(e){var t,i;this.sprite.body&&(void 0!==e?(i=this.getSprite(e),t=this.sprite.body.center,i=i.sprite.body.center,i=this.calculateAngle(t,i),this.setDegree(360-i),this.sendGameEvent({api:"turnToSprite",spriteName:e})):this.errorHandler(ErrorType.PARAMETER_UNDEFINED,this.getErrorName("goToSprite")))}.bind(this),this.turnToMousePointer=function(){var e,t;this.sprite.body&&(e=this.sprite.body.center,t={x:this.game.input.activePointer.x,y:this.game.input.activePointer.y},t=this.calculateAngle(e,t),this.setDegree(360-t),this.sendGameEvent({api:"turnToMousePointer"}))}.bind(this),this.setFlipX=function(e){var t;void 0!==e?(t=Math.abs(this.sprite.scale.x),this.sprite.scale.x=t=e?-t:t,this.sendGameEvent({api:"setFlipX",isFlipped:e})):this.errorHandler(ErrorType.PARAMETER_UNDEFINED,this.getErrorName("setFlipX"))}.bind(this),this.setFlipY=function(e){var t;void 0!==e?(t=Math.abs(this.sprite.scale.y),this.sprite.scale.y=t=e?-t:t,this.sendGameEvent({api:"setFlipY",isFlipped:e})):this.errorHandler(ErrorType.PARAMETER_UNDEFINED,this.getErrorName("setFlipY"))}.bind(this),this.getFlipX=function(){return this.sprite.scale.x<0}.bind(this),this.getFlipX=function(){return this.sprite.scale.y<0}.bind(this),this.setHorizontalFlip=function(e){var t;void 0!==e?(t=Math.abs(this.sprite.scale.x),this.sprite.scale.x=t=e?-t:t):this.errorHandler(ErrorType.PARAMETER_UNDEFINED,this.getErrorName("setHorizontalFlip"))}.bind(this),this.setVerticalFlip=function(e){var t;void 0!==e?(t=Math.abs(this.sprite.scale.y),this.sprite.scale.y=t=e?-t:t):this.errorHandler(ErrorType.PARAMETER_UNDEFINED,this.getErrorName("setVerticalFlip"))}.bind(this),this.setDegree=function(e){void 0!==e?isNaN(e)?this.errorHandler(ErrorType.PARAMETER_INVALID_TYPE,this.getErrorName("setDegree")):this.sprite.angle=e:this.errorHandler(ErrorType.PARAMETER_UNDEFINED,this.getErrorName("setDegree"))}.bind(this),this.getDegree=function(){return this.sprite.angle}.bind(this),this.setMoveSpeed=function(e){void 0!==e?isNaN(e)?this.errorHandler(ErrorType.PARAMETER_INVALID_TYPE,this.getErrorName("setMoveSpeed")):(this.speed=e,this.sendGameEvent({api:"setMoveSpeed",speed:e})):this.errorHandler(ErrorType.PARAMETER_UNDEFINED,this.getErrorName("setMoveSpeed"))}.bind(this),this.getMoveSpeed=function(){return this.speed}.bind(this),this.goForward=function(e){var t,i;void 0!==e?isNaN(e)?this.errorHandler(ErrorType.PARAMETER_INVALID_TYPE,this.getErrorName("goForward")):(i=this.sprite.angle*Math.PI/180,t=e*Math.cos(i)+this.sprite.x,i=e*Math.sin(i)+this.sprite.y,this.goTo(t,i)):this.errorHandler(ErrorType.PARAMETER_UNDEFINED,this.getErrorName("goForward"))}.bind(this),this.goX=function(e){var t,i;void 0!==e?isNaN(e)?this.errorHandler(ErrorType.PARAMETER_INVALID_TYPE,this.getErrorName("goX")):(this.type===SpriteType.BACKGROUND?this.sprite.tilePosition.x+=e:(t=this.sprite.x+e,i=this.sprite.y,this.goTo(t,i)),this.sendGameEvent({api:"goX",steps:e})):this.errorHandler(ErrorType.PARAMETER_UNDEFINED,this.getErrorName("goX"))}.bind(this),this.goY=function(e){var t,i;void 0!==e?isNaN(e)?this.errorHandler(ErrorType.PARAMETER_INVALID_TYPE,this.getErrorName("goY")):(this.type===SpriteType.BACKGROUND?this.sprite.tilePosition.y+=e:(t=this.sprite.x,i=this.sprite.y+e,this.goTo(t,i)),this.sendGameEvent({api:"goY",steps:e})):this.errorHandler(ErrorType.PARAMETER_UNDEFINED,this.getErrorName("goY"))}.bind(this),this.goTo=function(e,t){void 0!==e&&void 0!==t?isNaN(e)||isNaN(t)?this.errorHandler(ErrorType.PARAMETER_INVALID_TYPE,this.getErrorName("goTo")):(this.sprite.position.x=e,this.sprite.position.y=t,this.sendGameEvent({api:"goTo",x:e,y:t})):this.errorHandler(ErrorType.PARAMETER_UNDEFINED,this.getErrorName("goTo"))}.bind(this),this.goToSprite=function(e){var t,i;void 0!==e?(i=this.getSprite(e))&&(t=i.sprite.position.x,i=i.sprite.position.y,this.goTo(t,i),this.sendGameEvent({api:"goToSprite",targetSpriteId:e})):this.errorHandler(ErrorType.PARAMETER_UNDEFINED,this.getErrorName("goToSprite"))}.bind(this),this.goToMousePointer=function(){var e=this.game.input.activePointer.x,t=this.game.input.activePointer.y;this.goTo(e,t),this.sendGameEvent({api:"goToMousePointer"})}.bind(this),this.goToRandom=function(){var e=this.getWorldWidth()>this.getWorldHeight(),t=e?this.getRandom(0,1280):this.getRandom(0,720),e=e?this.getRandom(0,720):this.getRandom(0,1280);this.goTo(t,e),this.sendGameEvent({api:"goToRandom"})}.bind(this),this.setX=function(e){var t;void 0!==e?isNaN(e)?this.errorHandler(ErrorType.PARAMETER_INVALID_TYPE,this.getErrorName("setX")):(this.type===SpriteType.BACKGROUND?this.sprite.tilePosition.x+=e:(e=this.sprite.x+e,t=this.sprite.y,this.goTo(e,t)),this.sendGameEvent({api:"setX",x:e})):this.errorHandler(ErrorType.PARAMETER_UNDEFINED,this.getErrorName("setX"))}.bind(this),this.setY=function(e){var t;void 0!==e?isNaN(e)?this.errorHandler(ErrorType.PARAMETER_INVALID_TYPE,this.getErrorName("setY")):(this.type===SpriteType.BACKGROUND?this.sprite.tilePosition.y+=e:(t=this.sprite.x,e=this.sprite.y+e,this.goTo(t,e)),this.sendGameEvent({api:"setY",y:e})):this.errorHandler(ErrorType.PARAMETER_UNDEFINED,this.getErrorName("setY"))}.bind(this),this.getX=function(){return this.sprite.x}.bind(this),this.getY=function(){return this.sprite.y}.bind(this),this.moveTo=function(i,s){if(void 0!==i&&void 0!==s){if(!isNaN(i)&&!isNaN(s)){var r=this.getTimeSec(i,s,this.sprite.position.x,this.sprite.position.y);return this.sendGameEvent({api:"moveTo",x:i,y:s}),new Promise(function(e){var t=this.game.add.tween(this.sprite.position);t.to({x:i,y:s},1e3*r,Phaser.Easing.Linear.None,!0),t.onComplete.addOnce(function(){e()})}.bind(this))}this.errorHandler(ErrorType.PARAMETER_INVALID_TYPE,this.getErrorName("moveTo"))}else this.errorHandler(ErrorType.PARAMETER_UNDEFINED,this.getErrorName("moveTo"))}.bind(this),this.moveToSprite=function(e){if(void 0!==e){var t=this.getSprite(e);if(t){this.sendGameEvent({api:"moveToSprite",spriteName:e});var i=t.sprite.position.x,s=t.sprite.position.y;return new Promise(function(e){this.moveTo(i,s).then(function(){e()})}.bind(this))}}else this.errorHandler(ErrorType.PARAMETER_UNDEFINED,this.getErrorName("moveToSprite"))}.bind(this),this.moveToMousePointer=function(){this.sendGameEvent({api:"moveToMousePointer"});var t=this.game.input.activePointer.x,i=this.game.input.activePointer.y;return new Promise(function(e){this.moveTo(t,i).then(function(){e()})}.bind(this))}.bind(this),this.moveToRandom=function(){this.sendGameEvent({api:"moveToRandom"});var e=this.getWorldWidth()>this.getWorldHeight(),t=e?this.getRandom(0,1280):this.getRandom(0,720),i=e?this.getRandom(0,720):this.getRandom(0,1280);return new Promise(function(e){this.moveTo(t,i).then(function(){e()})}.bind(this))}.bind(this),this.setDraggable=function(e){void 0!==e?(this.sprite.input&&(e?(this.sprite.input.enableDrag(),this.sendGameEvent({api:"setDraggable",enabled:!0})):(this.sprite.input.disableDrag(),this.sendGameEvent({api:"setDraggable",enabled:!1}))),this.sprite._drag=e):this.errorHandler(ErrorType.PARAMETER_UNDEFINED,this.getErrorName("setDraggable"))}.bind(this),this.getDraggable=function(){return this.sprite._drag}.bind(this),this.say=function(e,t){if(void 0!==e){e=String(e),this.stopSay();for(var i="",s=0;s<e.length;s++)i+=e.charAt(s),0!==s&&s%12==0&&(i+="\n");this.sayBgSprite=this.game.add.sprite(0,0,"say_bg"),this.sayBgSprite.visible=!1,this.sayBgSprite.anchor.set(.5,1),this.saySprite=this.game.add.text(0,0,i,{fill:"#555555",font:"32px Arial"}),this.saySprite.anchor.set(.5,.5),this.saySprite.visible=!1,this.sayTimer&&clearTimeout(this.sayTimer),t&&(this.sendGameEvent({api:"say",message:e,sec:t}),this.sayTimer=setTimeout(function(){this.stopSay()}.bind(this),1e3*t))}else this.errorHandler(ErrorType.PARAMETER_UNDEFINED,this.getErrorName("say"))}.bind(this),this.stopSay=function(){this.saySprite&&(this.saySprite.kill(),this.saySprite=void 0),this.sayBgSprite&&(this.sayBgSprite.kill(),this.sayBgSprite=void 0)}.bind(this),this.playAnimation=function(e,t){var i;this.sprite.body&&(this.type!==SpriteType.PLAIN&&this.type!==SpriteType.SPRITE||this.asset.spriteAnimations&&(void 0!==e?(i=this.asset.spriteAnimations)[e]?((i=i[e].bodySize)&&this.sprite.body.setSize(i[0],i[1],i[2],i[3]),this.sprite.animations._anims[e]&&(this.sprite.animations._anims[e].loop=t,this.sprite.animations.play(e),this.sendGameEvent({api:"playAnimation",name:e,isLoop:t}),t||this.sprite.animations._anims[e].onComplete.addOnce(function(){this.sprite.frame=0},this))):this.errorHandler(ErrorType.PARAMETER_NOT_FOUND,this.getErrorName("playAnimation")):this.errorHandler(ErrorType.PARAMETER_UNDEFINED,this.getErrorName("playAnimation"))))}.bind(this),this.stopAnimation=function(){this.sprite.animations.stop(),this.sprite.frame=0}.bind(this),this.getCurrentAnimation=function(){return this.sprite.animations&&this.sprite.animations.currentAnim&&this.sprite.animations.currentAnim.isPlaying?this.sprite.animations.currentAnim.name:""}.bind(this),this.setSize=function(e){var t,i;void 0!==e?isNaN(e)?this.errorHandler(ErrorType.PARAMETER_INVALID_TYPE,this.getErrorName("setSize")):(i=t=e/100,this.sprite.scale.x<0&&(t=e/100*-1),this.sprite.scale.y<0&&(i=e/100*-1),this.sprite.scale.setTo(t,i)):this.errorHandler(ErrorType.PARAMETER_UNDEFINED,this.getErrorName("setSize"))}.bind(this),this.addSize=function(e){void 0!==e?isNaN(e)?this.errorHandler(ErrorType.PARAMETER_INVALID_TYPE,this.getErrorName("addSize")):this.setSize(this.getSize()+e):this.errorHandler(ErrorType.PARAMETER_UNDEFINED,this.getErrorName("addSize"))}.bind(this),this.getSize=function(){return parseInt(Math.abs(100*this.sprite.scale.x))}.bind(this),this.show=function(){this.sprite.alpha=1,this.sprite.inputEnabled=!0,this.sendGameEvent({api:"show"}),this.sprite._drag&&this.setDraggable(!0)}.bind(this),this.hide=function(){this.stopSay(),this.sprite.alpha=0,this.sprite.inputEnabled=!1,this.sendGameEvent({api:"hide"})}.bind(this),this.getX=function(){return this.sprite.position.x}.bind(this),this.bringToTop=function(){this.sprite.bringToTop()}.bind(this),this.getY=function(){return this.sprite.position.y}.bind(this),this.setWidth=function(e){void 0!==e?isNaN(e)?this.errorHandler(ErrorType.PARAMETER_INVALID_TYPE,this.getErrorName("setWidth")):(this.sprite.width=e,this.sendGameEvent({api:"setWidth",width:e})):this.errorHandler(ErrorType.PARAMETER_UNDEFINED,this.getErrorName("setWidth"))}.bind(this),this.setHeight=function(e){void 0!==e?isNaN(e)?this.errorHandler(ErrorType.PARAMETER_INVALID_TYPE,this.getErrorName("setHeight")):(this.sprite.height=e,this.sendGameEvent({api:"setHeight",height:e})):this.errorHandler(ErrorType.PARAMETER_UNDEFINED,this.getErrorName("setHeight"))}.bind(this),this.getWidth=function(){return this.sprite.width}.bind(this),this.getHeight=function(){return this.sprite.height}.bind(this),this.getWorldWidth=function(){return this.game.width}.bind(this),this.getWorldHeight=function(){return this.game.height}.bind(this),this.getMousePointerX=function(){return this.game.input.activePointer.x}.bind(this),this.getMousePointerY=function(){return this.game.input.activePointer.y}.bind(this),this.shake=function(){this.game.camera.shake(.02,200,!1,window.Phaser.Camera.SHAKE_VERTICAL,!0),this.sendGameEvent({api:"shake"})}.bind(this),this.flash=function(){this.game.camera.flash(16777215,200,!1)}.bind(this),this.onSwipe=function(e,t){this.swipeHandler[e]=t}.bind(this),this.onFrame=function(e){this.gameScene.updateFunctions.push(e)}.bind(this),this.onSignal=function(e,t){this.signalReceiver[e]=t,this.sendGameEvent({api:"onSignal",name:e})}.bind(this),this.sendSignal=function(e){void 0!==e?(this.sendGameEvent({api:"sendSignal",name:e}),this.gameScene.sendSignal(e)):this.errorHandler(ErrorType.PARAMETER_UNDEFINED,this.getErrorName("sendSignal"))}.bind(this),this.onOut=function(e){this.sprite.checkWorldBounds=!0,this.sprite.events.onOutOfBounds.add(e,this)}.bind(this),this.onOutStage=function(e){this.sprite.checkWorldBounds=!0,this.sprite.events.onOutOfBounds.add(function(){this.sendGameEvent({api:"onOutStage"}),e()},this)}.bind(this),this.changeScene=function(e){void 0!==e?(this.game.state.states[e]||this.errorHandler(ErrorType.PARAMETER_NOT_FOUND,this.getErrorName("changeScene")),this.stopAllSounds(),this.game.state.start(e,!0,!1),this.sendGameEvent({api:"changeScene",name:e})):this.errorHandler(ErrorType.PARAMETER_UNDEFINED,this.getErrorName("changeScene"))}.bind(this),this.kill=function(){this.stopSay(),this.sprite.kill(),this.sendGameEvent({api:"kill"})}.bind(this),this.revive=function(){this.sprite.revive(),this.sendGameEvent({api:"revive"})}.bind(this),this.clone=function(){return this.sendGameEvent({api:"clone"}),this.gameScene.cloneSprite(this)}.bind(this),this.wait=function(t){if(void 0!==t){if(!isNaN(t))return this.sendGameEvent({api:"wait",secs:t=0===t?.01:t}),new Promise(function(e){setTimeout(function(){e()},1e3*t)});this.errorHandler(ErrorType.PARAMETER_INVALID_TYPE,this.getErrorName("wait"))}else this.errorHandler(ErrorType.PARAMETER_UNDEFINED,this.getErrorName("wait"))}.bind(this),this.onClick=function(e){this.onClickListener=e}.bind(this),this.onClickUp=function(e){this.onClickUpListener=e}.bind(this),this.onTouch=function(e){this.onClickListener=e}.bind(this),this.onTouchUp=function(e){this.onClickUpListener=e}.bind(this),this.onScreenClick=function(e){this.onScreenClickListener=e}.bind(this),this.onScreenClickUp=function(e){this.onScreenClickUpListener=e}.bind(this),this.onKey=function(e,t){void 0===e&&this.errorHandler(ErrorType.PARAMETER_UNDEFINED,this.getErrorName("getRandom")),this.onKeyListener[e]=t}.bind(this),this.onKeyUp=function(e,t){this.onKeyUpListener[e]=t}.bind(this),this.getRandom=function(e,t){if(void 0!==e&&void 0!==t){if(!isNaN(e)&&!isNaN(t))return this.sendGameEvent({api:"getRandom",min:e=e||0,max:t=t||100}),this.game.rnd.integerInRange(e,t);this.errorHandler(ErrorType.PARAMETER_INVALID_TYPE,this.getErrorName("getRandom"))}else this.errorHandler(ErrorType.PARAMETER_UNDEFINED,this.getErrorName("getRandom"))}.bind(this),this.getName=function(){return this.originalName}.bind(this),this.print=function(e){console.log("%c "+e,"background: #555; color: #bada55"),parent.postMessage({message:e,source:"wizlab",type:"chatbot"})},this.input=function(e){return this.sendGameEvent({api:"input",resolved:!1}),new Promise(t=>{onclickInputShow(e,e=>{this.sendGameEvent({api:"input",resolved:!0}),t(e)})})}.bind(this),this.getSprite=function(e){if(void 0!==e)return this.gameScene.getSprite(e);this.errorHandler(ErrorType.PARAMETER_UNDEFINED,this.getErrorName("getSprite"))}.bind(this),this.setCollideScene=function(e){this.sprite.body&&(void 0!==e?(this.sprite.body.collideWorldBounds=e,this.sendGameEvent({api:"setCollideScene",enable:e})):this.errorHandler(ErrorType.PARAMETER_UNDEFINED,this.getErrorName("setCollideScene")))}.bind(this),this.setCollideWorldBounds=function(e){this.sprite.body&&(void 0!==e?this.sprite.body.collideWorldBounds=e:this.errorHandler(ErrorType.PARAMETER_UNDEFINED,this.getErrorName("setCollideWorldBounds")))}.bind(this),this.setCollision=function(e){if(void 0!==e)if(Array.isArray(e))for(var t in e){t=e[t];this.gameScene.addCollision(this.spriteName,t),this.sendGameEvent({api:"setCollision",targetName:t})}else this.gameScene.addCollision(this.spriteName,e),this.sendGameEvent({api:"setCollision",targetName:e});else this.errorHandler(ErrorType.PARAMETER_UNDEFINED,this.getErrorName("setCollision"))}.bind(this),this.setCheckCollision=function(e,t){if(this.sprite.body)if(void 0!==e)if(void 0!==t)switch(e){case"up":this.sprite.body.checkCollision.up=t;break;case"down":this.sprite.body.checkCollision.down=t;break;case"left":this.sprite.body.checkCollision.left=t;break;case"right":this.sprite.body.checkCollision.right=t;break;default:this.errorHandler(ErrorType.PARAMETER_NOT_FOUND,this.getErrorName("setCheckCollision"))}else this.errorHandler(ErrorType.PARAMETER_UNDEFINED,this.getErrorName("setCheckCollision"));else this.errorHandler(ErrorType.PARAMETER_UNDEFINED,this.getErrorName("setCheckCollision"))}.bind(this),this.setCollideSide=function(e,t){if(this.sprite.body)if(void 0!==e)if(void 0!==t)switch(e){case"up":this.sprite.body.checkCollision.up=t;break;case"down":this.sprite.body.checkCollision.down=t;break;case"left":this.sprite.body.checkCollision.left=t;break;case"right":this.sprite.body.checkCollision.right=t;break;default:this.errorHandler(ErrorType.PARAMETER_NOT_FOUND,this.getErrorName("setCollideSide"))}else this.errorHandler(ErrorType.PARAMETER_UNDEFINED,this.getErrorName("setCollideSide"));else this.errorHandler(ErrorType.PARAMETER_UNDEFINED,this.getErrorName("setCollideSide"))}.bind(this),this.onOverlap=function(e,t){if(void 0!==e)if(Array.isArray(e))for(var i in e){i=e[i];this.gameScene.addOverlap(this.spriteName,i,t),this.sendGameEvent({api:"onOverlap",name:i})}else this.gameScene.addOverlap(this.spriteName,e,t),this.sendGameEvent({api:"onOverlap",name:e});else this.errorHandler(ErrorType.PARAMETER_UNDEFINED,this.getErrorName("onOverlap"))}.bind(this),this.onOverlapOnce=function(e,t){if(void 0!==e)if(Array.isArray(e))for(var i in e){i=e[i];this.gameScene.addOverlapOnce(this.spriteName,i,t),this.sendGameEvent({api:"onOverlapOnce",name:i})}else this.gameScene.addOverlapOnce(this.spriteName,e,t),this.sendGameEvent({api:"onOverlapOnce",name:e});else this.errorHandler(ErrorType.PARAMETER_UNDEFINED,this.getErrorName("onOverlapOnce"))}.bind(this),this.setImmovable=function(e){this.sprite.body&&(void 0!==e?this.sprite.body.immovable=e:this.errorHandler(ErrorType.PARAMETER_UNDEFINED,this.getErrorName("setImmovable")))}.bind(this),this.setMovable=function(e){this.sprite.body&&(void 0!==e?(this.sprite.body.immovable=!e,this.sendGameEvent({api:"setMovable",enable:e})):this.errorHandler(ErrorType.PARAMETER_UNDEFINED,this.getErrorName("setMovable")))}.bind(this),this.getMovable=function(){return!this.sprite.body.immovable}.bind(this),this.setMass=function(e){this.sprite.body&&(void 0!==e?isNaN(e)?this.errorHandler(ErrorType.PARAMETER_INVALID_TYPE,this.getErrorName("setMass")):this.sprite.body.mass=e:this.errorHandler(ErrorType.PARAMETER_UNDEFINED,this.getErrorName("setMass")))}.bind(this),this.getMass=function(){return this.sprite.body.mass}.bind(this),this.setGravityX=function(e){this.sprite.body&&(void 0!==e?isNaN(e)?this.errorHandler(ErrorType.PARAMETER_INVALID_TYPE,this.getErrorName("setGravityX")):this.sprite.body&&(this.sprite.body.gravity.x=e):this.errorHandler(ErrorType.PARAMETER_UNDEFINED,this.getErrorName("setGravityX")))}.bind(this),this.setGravityY=function(e){this.sprite.body&&(void 0!==e?isNaN(e)?this.errorHandler(ErrorType.PARAMETER_INVALID_TYPE,this.getErrorName("setGravityY")):this.sprite.body&&(this.sprite.body.gravity.y=e,this.sendGameEvent({api:"setGravityY",value:e})):this.errorHandler(ErrorType.PARAMETER_UNDEFINED,this.getErrorName("setGravityY")))}.bind(this),this.getGravityX=function(){return this.sprite.body?this.sprite.body.gravity.x:0}.bind(this),this.getGravityY=function(){return this.sprite.body?this.sprite.body.gravity.y:0}.bind(this),this.setVelocityX=function(e){this.sprite.body&&(void 0!==e?isNaN(e)?this.errorHandler(ErrorType.PARAMETER_INVALID_TYPE,this.getErrorName("setVelocityX")):this.sprite.body&&(this.sprite.body.velocity.x=e,this.sendGameEvent({api:"setVelocityX",value:e})):this.errorHandler(ErrorType.PARAMETER_UNDEFINED,this.getErrorName("setVelocityX")))}.bind(this),this.setVelocityY=function(e){this.sprite.body&&(void 0!==e?isNaN(e)?this.errorHandler(ErrorType.PARAMETER_INVALID_TYPE,this.getErrorName("setVelocityY")):this.sprite.body&&(this.sprite.body.velocity.y=e,this.sendGameEvent({api:"setVelocityY",value:e})):this.errorHandler(ErrorType.PARAMETER_UNDEFINED,this.getErrorName("setVelocityY")))}.bind(this),this.getVelocityX=function(){return this.sprite.body?this.sprite.body.velocity.x:0}.bind(this),this.getVelocityY=function(){return this.sprite.body?this.sprite.body.velocity.y:0}.bind(this),this.getVelocityX=function(){return this.sprite.body.velocity.x}.bind(this),this.getVelocityY=function(){return this.sprite.body.velocity.y}.bind(this),this.setBounceX=function(e){this.sprite.body&&(void 0!==e?isNaN(e)?this.errorHandler(ErrorType.PARAMETER_INVALID_TYPE,this.getErrorName("setBounceX")):(this.sprite.body.bounce.x=e,this.sendGameEvent({api:"setBounceX",value:e})):this.errorHandler(ErrorType.PARAMETER_UNDEFINED,this.getErrorName("setBounceX")))}.bind(this),this.setBounceY=function(e){this.sprite.body&&(void 0!==e?isNaN(e)?this.errorHandler(ErrorType.PARAMETER_INVALID_TYPE,this.getErrorName("setBounceY")):(this.sprite.body.bounce.y=e,this.sendGameEvent({api:"setBounceY",value:e})):this.errorHandler(ErrorType.PARAMETER_UNDEFINED,this.getErrorName("setBounceY")))}.bind(this),this.getBounceX=function(){return this.sprite.body?this.sprite.body.bounce.x:0}.bind(this),this.getBounceY=function(){return this.sprite.body?this.sprite.body.bounce.y:0}.bind(this),this.setAccelerationX=function(e){this.sprite.body&&(void 0!==e?isNaN(e)?this.errorHandler(ErrorType.PARAMETER_INVALID_TYPE,this.getErrorName("setAccelerationX")):(this.sprite.body.acceleration.x=e,this.sendGameEvent({api:"setAccelerationX",value:e})):this.errorHandler(ErrorType.PARAMETER_UNDEFINED,this.getErrorName("setAccelerationX")))}.bind(this),this.setAccelerationY=function(e){this.sprite.body&&(void 0!==e?isNaN(e)?this.errorHandler(ErrorType.PARAMETER_INVALID_TYPE,this.getErrorName("setAccelerationY")):(this.sprite.body.acceleration.y=e,this.sendGameEvent({api:"setAccelerationY",value:e})):this.errorHandler(ErrorType.PARAMETER_UNDEFINED,this.getErrorName("setAccelerationY")))}.bind(this),this.getAccelerationX=function(){return this.sprite.body.acceleration.x}.bind(this),this.getAccelerationY=function(){return this.sprite.body.acceleration.y}.bind(this),this.playSound=function(e,t){void 0!==e?this.gameScene.hasSound(e)?(this.gameScene.playSound(e,t),this.sendGameEvent({api:"playSound",name:e,isLoop:t})):this.errorHandler(ErrorType.PARAMETER_NOT_FOUND,this.getErrorName("playSound")):this.errorHandler(ErrorType.PARAMETER_UNDEFINED,this.getErrorName("playSound"))}.bind(this),this.restartSound=function(e){void 0!==e?(this.gameScene.hasSound(e)||this.errorHandler(ErrorType.PARAMETER_NOT_FOUND,this.getErrorName("restartSound")),this.gameScene.restartSound(e)):this.errorHandler(ErrorType.PARAMETER_UNDEFINED,this.getErrorName("restartSound"))}.bind(this),this.stopSound=function(e){void 0!==e?(this.gameScene.hasSound(e)||this.errorHandler(ErrorType.PARAMETER_NOT_FOUND,this.getErrorName("stopSound")),this.gameScene.stopSound(e)):this.errorHandler(ErrorType.PARAMETER_UNDEFINED,this.getErrorName("stopSound"))}.bind(this),this.pauseSound=function(e){void 0!==e?(this.gameScene.hasSound(e)||this.errorHandler(ErrorType.PARAMETER_NOT_FOUND,this.getErrorName("pauseSound")),this.gameScene.pauseSound(e),this.sendGameEvent({api:"pauseSound",name:e})):this.errorHandler(ErrorType.PARAMETER_UNDEFINED,this.getErrorName("pauseSound"))}.bind(this),this.resumeSound=function(e){void 0!==e?(this.gameScene.hasSound(e)||this.errorHandler(ErrorType.PARAMETER_NOT_FOUND,this.getErrorName("resumeSound")),this.gameScene.resumeSound(e),this.sendGameEvent({api:"resumeSound",name:e})):this.errorHandler(ErrorType.PARAMETER_UNDEFINED,this.getErrorName("resumeSound"))}.bind(this),this.stopAllSounds=function(){this.game.sound.stopAll()}.bind(this),this.setSoundVolume=function(e){var t,i;void 0!==e?isNaN(e)?this.errorHandler(ErrorType.PARAMETER_INVALID_TYPE,this.getErrorName("setSoundVolume")):(t=this.game.systemVolume||100,i=e,this.game.gameVolume=i=1<(i=e<0?0:e)?1:i,this.game.sound.volume=this.game.gameVolume*t/100):this.errorHandler(ErrorType.PARAMETER_UNDEFINED,this.getErrorName("setSoundVolume"))}.bind(this),this.addSoundVolume=function(e){void 0!==e?isNaN(e)?this.errorHandler(ErrorType.PARAMETER_INVALID_TYPE,this.getErrorName("addSoundVolume")):(e=this.game.gameVolume+e,this.setSoundVolume(e)):this.errorHandler(ErrorType.PARAMETER_UNDEFINED,this.getErrorName("addSoundVolume"))}.bind(this),this.getSoundVolume=function(){return this.game.gameVolume}.bind(this),this.setText=function(e){void 0!==e?this.type===SpriteType.TEXT&&(e=e.toString(),this.sprite.text=e,this.sendGameEvent({api:"setText",text:e})):this.errorHandler(ErrorType.PARAMETER_UNDEFINED,this.getErrorName("setText"))}.bind(this),this.getText=function(){if(this.type===SpriteType.TEXT)return this.sendGameEvent({api:"getText"}),this.sprite.text}.bind(this),this.appendText=function(e){void 0!==e?this.type===SpriteType.TEXT&&(this.sprite.text=this.getText()+e,this.sendGameEvent({api:"appendText",text:e})):this.errorHandler(ErrorType.PARAMETER_UNDEFINED,this.getErrorName("appendText"))}.bind(this),this.clearText=function(){this.type===SpriteType.TEXT&&(this.sprite.text="",this.sendGameEvent({api:"clearText"}))}.bind(this),this.setTextColor=function(e){void 0!==e?(HTML_Colors[e]&&(e=HTML_Colors[e]),this.type===SpriteType.TEXT&&this.sprite.addColor(e,0)):this.errorHandler(ErrorType.PARAMETER_UNDEFINED,this.getErrorName("setTextColor"))}.bind(this),this.setRandomTextColor=function(){var e="#"+Math.floor(16777215*Math.random()).toString(16);this.setTextColor(e)}.bind(this),this.getTextColor=function(){if(this.type===SpriteType.TEXT)return this.sprite.colors[0]||this.sprite.style.fill}.bind(this),this.getYear=function(){return(new Date).getFullYear()}.bind(this),this.getMonth=function(){return(new Date).getMonth()+1}.bind(this),this.getDay=function(){return(new Date).getDate()}.bind(this),this.getHour=function(){return(new Date).getHours()}.bind(this),this.getMin=function(){return(new Date).getMinutes()}.bind(this),this.getSec=function(){return(new Date).getSeconds()}.bind(this),this.startTimer=function(){this.sendGameEvent({api:"startTimer"}),this.gameScene.startTimer()}.bind(this),this.pauseTimer=function(){this.sendGameEvent({api:"pauseTimer"}),this.gameScene.pauseTimer()}.bind(this),this.resumeTimer=function(){this.sendGameEvent({api:"resumeTimer"}),this.gameScene.resumeTimer()}.bind(this),this.resetTimer=function(){this.sendGameEvent({api:"resetTimer"}),this.gameScene.resetTimer()}.bind(this),this.getTimer=function(){return this.sendGameEvent({api:"getTimer"}),this.gameScene.getTimer()}.bind(this),this.isClickedSprite=function(){return this.isClicked}.bind(this),this.isPressedKey=function(e){return!!this.gameScene.pressedKeys[e]}.bind(this),this.isClickedMouse=function(){return this.game.input.activePointer.isDown}.bind(this),this.isOverlapped=function(e){if(void 0!==e)return this.gameScene.isOverlapped(this.sprite,e);this.errorHandler(ErrorType.PARAMETER_UNDEFINED,this.getErrorName("isOverlapped"))}.bind(this),this.onJoystick=function(e){"analog"===this.subtype&&(this.joystickCallback=e)}.bind(this),this.onDpad=function(e){"dpad"===this.subtype&&(this.dpadCallback=e)}.bind(this),this.setVelocityFromDegree=function(e,t,i){var s;this.sprite.body&&(s=e*Math.PI/180,this.game.physics.arcade.velocityFromRotation(s,t*i,this.sprite.body.velocity),e!==this.prevDegreeForVFD&&t!==this.prevForceForVFD&&(this.prevDegreeForVFD=e,this.prevForceForVFD=t,this.sendGameEvent({api:"setVelocityFromDegree",degree:e,force:t,maxSpeed:i})))}.bind(this),this.setAccelerationFromDegree=function(e,t,i){this.sprite.body&&(e=e*Math.PI/180,this.game.physics.arcade.accelerationFromRotation(e,t*i,this.sprite.body.acceleration))}.bind(this),this.startPen=function(){if(this.pen)this.pen.lineStyle(this.penSize,this.penColor,1);else{var e=this.game.add.graphics(0,0);e.inputEnabled=!1,this.gameScene.spriteGroup.add(e),e.z=this.sprite.z-1;for(var t=this.gameScene.spriteGroup.children,i=e.z;i<t.length;i++)t[i].z=t[i].z+1;this.gameScene.spriteGroup.sort("z",Phaser.Group.SORT_ASCENDING),this.pen=e,this.pen.lineStyle(this.penSize,this.penColor,1),this.pen.moveTo(this.sprite.position.x,this.sprite.position.y)}}.bind(this),this.endPen=function(){this.pen&&(this.pen=void 0)}.bind(this),this.setPenColor=function(e){void 0!==e?(e=(e=HTML_Colors[e]?HTML_Colors[e]:e).replace("#","0x"),this.penColor=e,this.pen&&this.pen.lineStyle(this.penSize,this.penColor,1)):this.errorHandler(ErrorType.PARAMETER_UNDEFINED,this.getErrorName("setPenColor"))}.bind(this),this.setRandomPenColor=function(){var e=Object.keys(HTML_Colors),e=e[Math.floor(Math.random()*e.length)];this.setPenColor(HTML_Colors[e])}.bind(this),this.getPenColor=function(){if(this.pen)return String(this.pen.lineColor).replace("0x","#")}.bind(this),this.setPenSize=function(e){void 0!==e?(this.penSize=e,this.pen&&this.pen.lineStyle(this.penSize,this.penColor,1)):this.errorHandler(ErrorType.PARAMETER_UNDEFINED,this.getErrorName("setPenSize"))}.bind(this),this.getPenSize=function(){return this.penSize}.bind(this),this.addPenSize=function(e){void 0!==e?this.setPenSize(this.penSize+e):this.errorHandler(ErrorType.PARAMETER_UNDEFINED,this.getErrorName("addPenSize"))}.bind(this),this.erasePen=function(){for(var e,t=this.gameScene.spriteGroup.children.length-1;0<=t;t--){var i=this.gameScene.spriteGroup.children[t];i.lineAlpha&&(i.clear(),i.destroy(),this.gameScene.spriteGroup.remove(i))}this.pen&&(e=this.pen.lineAlpha,this.pen.clear(),this.pen.destroy(),this.pen=void 0,e&&this.startPen())}.bind(this),this.saveScore=function(e){this.sendMessageToParent({type:"saveScore",data:e}),this.sendGameEvent({api:"saveScore",score:e})}.bind(this),this.showRanking=function(){this.sendMessageToParent({type:"showRanking"}),this.sendGameEvent({api:"showRanking"})}.bind(this),this.showRankingAscending=function(){this.sendMessageToParent({type:"showRankingAscending"})}.bind(this),this.hideRanking=function(){this.sendMessageToParent({type:"hideRanking"})}.bind(this),this.vibrate=function(){this.sendMessageToParent({type:"vibrate"})}.bind(this),this.onGyro=function(e){this.onGyroListener=e,this.sendMessageToParent({type:"onGyro"})}.bind(this),this.startListening=function(){this.sendMessageToParent({type:"startListening"})}.bind(this),this.onListening=function(e){this.onListeningListener=e}.bind(this),this.onShake=function(e){this.sendMessageToParent({type:"onShake"}),this.onShakeListener=e}.bind(this),this.translate=function(e,t,i){fetch(TRANSLATE_URL,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({text:e,lang:t})}).then(function(e){return e.json()}).then(function(e){i(e.text)})},this.speak=function(e){this.sendMessageToParent({type:"speak",data:e})}.bind(this),this.openCamera=function(e){var t,i,s;this.asset&&"component"===this.asset.type&&"camera"===this.asset.subtype&&(t=(this.sprite.x-this.getWidth()/2)/this.getWorldWidth()*100,i=(this.sprite.y-this.getHeight()/2)/this.getWorldHeight()*100,s=this.getWidth()/this.getWorldWidth()*100,this.sendMessageToParent({type:"openCamera",data:{x:t,y:i,width:s,facing:e="back"!==e?"front":e}}))}.bind(this),this.closeCamera=function(){this.asset&&"component"==this.asset.type&&"camera"==this.asset.subtype&&this.sendMessageToParent({type:"closeCamera"})}.bind(this),this.switchCamera=function(){this.asset&&"component"==this.asset.type&&"camera"==this.asset.subtype&&this.sendMessageToParent({type:"switchCamera"})}.bind(this),this.onFaceDetect=function(e){this.asset&&"component"==this.asset.type&&"camera"==this.asset.subtype&&(this.onFaceDetectListener=e)}.bind(this),this.loadGameData=function(e){this.onLoadGameDataListener=e,this.loadTimer&&clearTimeout(this.loadTimer),this.loadTimer=setTimeout(function(){this.sendMessageToParent({type:"loadGameData"})}.bind(this),1e3)}.bind(this),this.saveGameData=function(e){this.onSaveGameDataListener=e,this.saveTimer&&clearTimeout(this.saveTimer),this.saveTimer=setTimeout(function(){this.sendMessageToParent({type:"saveGameData",data:JSON.stringify(serverData)})}.bind(this),1e3)}.bind(this),this.resetGameData=function(e){this.onResetGameDataListener=e,this.sendMessageToParent({type:"resetGameData"})}.bind(this),this.server={data:serverData,load:this.loadGameData,save:this.saveGameData,reset:this.resetGameData},this.socket={connect:function(e){this.socketManager.connect(e)}.bind(this),disconnect:function(){this.socketManager.disconnect()}.bind(this),isConnected:function(){return this.socketManager.isConnected()}.bind(this),emit:function(e){this.socketManager.emit(e)}.bind(this),onReceive:function(e){this.socketManager.onReceive=e}.bind(this),getData:function(e){this.socketManager.getData(e)}.bind(this),setData:function(e){this.socketManager.setData(e)}.bind(this),joinRoom:function(e){this.socketManager.joinRoom(e)}.bind(this),leaveRoom:function(e){this.socketManager.leaveRoom(e)}.bind(this),emitRoom:function(e,t){this.socketManager.emitRoom(e,t)}.bind(this)}}WizSprite.prototype.setAnimations=function(){if((this.type===SpriteType.PLAIN||this.type===SpriteType.SPRITE)&&this.asset.spriteAnimations){var e,t=this.asset.spriteAnimations,i=Object.keys(t);for(e in i){var s=i[e],r=t[s].frameRate,n=t[s].indexes;this.sprite.animations.add(s,n,r,!0)}}},WizSprite.prototype.setBodySize=function(){var e;this.type!==SpriteType.PLAIN&&this.type!==SpriteType.SPRITE||(e=this.asset.bodySize)&&this.sprite.body.setSize(e[0],e[1],e[2],e[3])},WizSprite.prototype.runCode=function(){var e={cameraFollow:this.cameraFollow,fixToCamera:this.fixToCamera,moveForward:this.moveForward,moveX:this.moveX,moveY:this.moveY,turn:this.turn,turnToSprite:this.turnToSprite,turnToMousePointer:this.turnToMousePointer,setHorizontalFlip:this.setHorizontalFlip,setVerticalFlip:this.setVerticalFlip,setFlipX:this.setFlipX,setFlipY:this.setFlipY,getFlipX:this.getFlipX,getFlipY:this.getFlipY,setDegree:this.setDegree,getDegree:this.getDegree,setMoveSpeed:this.setMoveSpeed,getMoveSpeed:this.getMoveSpeed,goForward:this.goForward,goX:this.goX,goY:this.goY,goTo:this.goTo,goToSprite:this.goToSprite,goToMousePointer:this.goToMousePointer,goToRandom:this.goToRandom,setX:this.setX,setY:this.setY,getX:this.getX,getY:this.getY,moveTo:this.moveTo,moveToSprite:this.moveToSprite,moveToMousePointer:this.moveToMousePointer,moveToRandom:this.moveToRandom,setDraggable:this.setDraggable,getDraggable:this.getDraggable,say:this.say,stopSay:this.stopSay,playAnimation:this.playAnimation,stopAnimation:this.stopAnimation,getCurrentAnimation:this.getCurrentAnimation,setSize:this.setSize,addSize:this.addSize,getSize:this.getSize,show:this.show,hide:this.hide,bringToTop:this.bringToTop,getX:this.getX,getY:this.getY,getWidth:this.getWidth,getHeight:this.getHeight,setWidth:this.setWidth,setHeight:this.setHeight,getWorldWidth:this.getWorldWidth,getWorldHeight:this.getWorldHeight,getMousePointerX:this.getMousePointerX,getMousePointerY:this.getMousePointerY,shake:this.shake,flash:this.flash,clone:this.clone,isClickedSprite:this.isClickedSprite,isPressedKey:this.isPressedKey,isClickedMouse:this.isClickedMouse,isOverlapped:this.isOverlapped,onFrame:this.onFrame,onSignal:this.onSignal,sendSignal:this.sendSignal,onSwipe:this.onSwipe,onOut:this.onOut,onOutStage:this.onOutStage,changeScene:this.changeScene,kill:this.kill,revive:this.revive,wait:this.wait,print:this.print,input:this.input,onClick:this.onClick,onClickUp:this.onClickUp,onTouch:this.onTouch,onTouchUp:this.onTouchUp,onScreenClick:this.onScreenClick,onScreenClickUp:this.onScreenClickUp,onKey:this.onKey,onKeyUp:this.onKeyUp,getRandom:this.getRandom,abs:Math.abs,round:Math.round,ceil:Math.ceil,floor:Math.floor,pow:Math.pow,sqrt:Math.sqrt,log:Math.log,getName:this.getName,global:global,server:this.server,socket:this.socket,getSprite:this.getSprite,setCollideWorldBounds:this.setCollideWorldBounds,setCollideScene:this.setCollideWorldBounds,setCollision:this.setCollision,setCheckCollision:this.setCheckCollision,setCollideSide:this.setCollideSide,onOverlap:this.onOverlap,onOverlapOnce:this.onOverlapOnce,setImmovable:this.setImmovable,setMovable:this.setMovable,getMovable:this.getMovable,setMass:this.setMass,getMass:this.getMass,setGravityX:this.setGravityX,setGravityY:this.setGravityY,setVelocityX:this.setVelocityX,setVelocityY:this.setVelocityY,getVelocityX:this.getVelocityX,getVelocityY:this.getVelocityY,setVelocityFromDegree:this.setVelocityFromDegree,setAccelerationFromDegree:this.setAccelerationFromDegree,setBounceX:this.setBounceX,setBounceY:this.setBounceY,setAccelerationX:this.setAccelerationX,setAccelerationY:this.setAccelerationY,getGravityX:this.getGravityX,getGravityY:this.getGravityY,getVelocityX:this.getVelocityX,getVelocityY:this.getVelocityY,getBounceX:this.getBounceX,getBounceY:this.getBounceY,getAccelerationX:this.getAccelerationX,getAccelerationY:this.getAccelerationY,setText:this.setText,appendText:this.appendText,clearText:this.clearText,getText:this.getText,setTextColor:this.setTextColor,setRandomTextColor:this.setRandomTextColor,getTextColor:this.getTextColor,playSound:this.playSound,restartSound:this.restartSound,stopSound:this.stopSound,pauseSound:this.pauseSound,resumeSound:this.resumeSound,stopAllSounds:this.stopAllSounds,setSoundVolume:this.setSoundVolume,addSoundVolume:this.addSoundVolume,getSoundVolume:this.getSoundVolume,getYear:this.getYear,getMonth:this.getMonth,getDay:this.getDay,getHour:this.getHour,getMin:this.getMin,getSec:this.getSec,startTimer:this.startTimer,pauseTimer:this.pauseTimer,resumeTimer:this.resumeTimer,resetTimer:this.resetTimer,getTimer:this.getTimer,onJoystick:this.onJoystick,onDpad:this.onDpad,startPen:this.startPen,endPen:this.endPen,setPenColor:this.setPenColor,setRandomPenColor:this.setRandomPenColor,getPenColor:this.getPenColor,setPenSize:this.setPenSize,addPenSize:this.addPenSize,getPenSize:this.getPenSize,erasePen:this.erasePen,saveScore:this.saveScore,showRanking:this.showRanking,showRankingAscending:this.showRankingAscending,hideRanking:this.hideRanking,vibrate:this.vibrate,onGyro:this.onGyro,startListening:this.startListening,onListening:this.onListening,onShake:this.onShake,speak:this.speak,translate:this.translate,openCamera:this.openCamera,closeCamera:this.closeCamera,switchCamera:this.switchCamera,onFaceDetect:this.onFaceDetect},t=userDefinedFunction[this.gameScene.sceneId][this.originalName];if("function"==typeof t&&t(e),this.isCodeRun=!0,0<this.signalQueue.length){for(var i in this.signalQueue){i=this.signalQueue[i];this.onReceive(i)}this.signalQueue=[]}},WizSprite.prototype.getDistance=function(e,t,i,s){i=e-i,s=t-s;return Math.sqrt(i*i+s*s)},WizSprite.prototype.getTimeSec=function(e,t,i,s){return this.getDistance(e,t,i,s)/this.speed/10},WizSprite.prototype.update=function(){var e;if(this.sayBgSprite&&this.saySprite&&(408/196<this.saySprite.width/this.saySprite.height?(this.sayBgSprite.width=1.2*this.saySprite.width,this.sayBgSprite.height=this.saySprite.width/408*196):(this.sayBgSprite.height=1.2*this.saySprite.height,this.sayBgSprite.width=this.saySprite.height/196*408),this.sayBgSprite.x=this.sprite.x,this.sprite.body?this.sayBgSprite.y=this.sprite.y-this.sprite.body.height/2:this.sayBgSprite.y=this.sprite.y-this.sprite.height/2,this.sprite.body?this.sprite.y+this.sprite.body.height/2<this.gameScene.world.bounds.height/3&&(this.sayBgSprite.y=this.sprite.y+this.sprite.body.height+this.sayBgSprite.height):this.sprite.y+this.sprite.height/2<this.gameScene.world.bounds.height/3&&(this.sayBgSprite.y=this.sprite.y+this.sprite.height+this.sayBgSprite.height),this.sayBgSprite.x<this.sayBgSprite.width/2?this.sayBgSprite.x=this.sayBgSprite.width/2:this.sayBgSprite.x>this.gameScene.world.bounds.width-this.sayBgSprite.width/2&&(this.sayBgSprite.x=this.gameScene.world.bounds.width-this.sayBgSprite.width/2),this.sayBgSprite.y<this.sayBgSprite.height?this.sayBgSprite.y=this.sayBgSprite.height:this.sayBgSprite.y>this.gameScene.world.bounds.height&&(this.sayBgSprite.y=this.gameScene.world.bounds.height),this.saySprite.x=this.sayBgSprite.centerX,this.saySprite.y=this.sayBgSprite.centerY,this.sayBgSprite.visible=!0,this.saySprite.visible=!0),this.joystickCallback&&(this.sprite.pad.stick.isDown?(e=180*this.sprite.pad.stick.rotation/Math.PI,this.joystickCallback(e,this.sprite.pad.stick.force),this.sendGameEvent({api:"onJoystick",degree:e,force:this.sprite.pad.stick.force})):this.joystickCallback(0,0)),this.dpadCallback)if(this.sprite.pad.stick.isDown)switch(this.sprite.pad.stick.direction){case Phaser.LEFT:this.dpadCallback("left");break;case Phaser.RIGHT:this.dpadCallback("right");break;case Phaser.UP:this.dpadCallback("up");break;case Phaser.DOWN:this.dpadCallback("down");break;default:this.dpadCallback("none")}else this.dpadCallback("none");this.pen&&(this.pen.lineStyle(this.penSize,this.penColor,1),this.pen.lineTo(this.sprite.position.x,this.sprite.position.y))},WizSprite.prototype.onKeyRelease=function(e){this.onKeyUpListener[e]&&(this.sendGameEvent({api:"onKeyUp",key:e}),this.onKeyUpListener[e]())},WizSprite.prototype.onKeyDown=function(e){this.onKeyListener[e]&&(this.sendGameEvent({api:"onKey",key:e}),this.onKeyListener[e]())},WizSprite.prototype.onClicked=function(){this.isClicked=!0,this.onClickListener&&(this.onClickListener(),this.sendGameEvent({api:"onClick"}))},WizSprite.prototype.onClickedUp=function(){this.isClicked=!1,this.onClickUpListener&&(this.onClickUpListener(),this.sendGameEvent({api:"onClickUp"}))},WizSprite.prototype.onScreenClicked=function(){this.onScreenClickListener&&(this.onScreenClickListener(),this.sendGameEvent({api:"onScreenClick"}))},WizSprite.prototype.onScreenClickedUp=function(){this.onScreenClickUpListener&&this.onScreenClickUpListener()},WizSprite.prototype.onReceive=function(e){this.isCodeRun?this.signalReceiver[e]&&this.signalReceiver[e]():this.signalQueue.push(e)},WizSprite.prototype.onSlide=function(e){this.swipeHandler[e]&&this.swipeHandler[e]()},WizSprite.prototype.getErrorName=function(e){return{sceneId:this.game.state.current,spriteId:this.spriteName,api:e}},WizSprite.prototype.calculateAngle=function(e,t){var i=e.y-t.y,e=t.x-e.x,e=180*Math.atan2(i,e)/Math.PI;return e<0?360+e:e},WizSprite.prototype.sendMessageToParent=function(e){e=JSON.stringify(e);try{window.app&&window.app.onGameEvent(e),window.webkit&&window.webkit.messageHandlers.onGameEvent.postMessage({payload:e}),parent.postMessage({message:e,source:"wizlab",type:"gameEvent"},"*")}catch(e){console.log(e)}},WizSprite.prototype.onGyroChanged=function(e,t){this.onGyroListener&&this.onGyroListener(e,t)},WizSprite.prototype.onListeningResult=function(e){this.onListeningListener&&this.onListeningListener(e)},WizSprite.prototype.onShaked=function(){this.onShakeListener&&this.onShakeListener()},WizSprite.prototype.onFaceDetected=function(e){this.onFaceDetectListener&&this.onFaceDetectListener(JSON.parse(e))},WizSprite.prototype.onSaveGameData=function(){this.onSaveGameDataListener&&this.onSaveGameDataListener()},WizSprite.prototype.onResetGameData=function(){this.onResetGameDataListener&&(this.server.data=serverData,this.onResetGameDataListener())},WizSprite.prototype.onLoadGameData=function(){this.onLoadGameDataListener&&(this.server.data=serverData,this.onLoadGameDataListener())};