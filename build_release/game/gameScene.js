function GameScene(e){var t=e.game,i=e.screenMode,s=e.sceneId,a=e.spriteData,r=e.soundIds,n=e.errorHandler,o=e.preloadHandler,p=e.assets,h=e.socketManager;this.errorHandler=n,this.preloadHandler=o,this.game=t,this.screenMode=i,this.sceneId=s,this.spriteData=a.sprites,this.spriteDataIds=a.spriteIds,this.soundIds=r,this.assets=p,this.scenes=e.scenes,this.isPreloaded=!e.isFirstScene,this.screenWidth=e.screenWidth,this.screenHeight=e.screenHeight,this.wideScreen=e.wideScreen,this.alphaImage="https://s3.ap-northeast-2.amazonaws.com/wizschool-assets/sprite/alpha.png",this.socketManager=h,this.sendGameEvent=function(e){this.game.sendGameEvent(Object.assign({sceneId:this.sceneId},e))},this.figureDirection=function(){var e,t=this.game.input.activePointer.positionDown,i=this.game.input.activePointer.position,s=i.x-t.x,i=i.y-t.y,t=Math.atan2(i,s)*(180/Math.PI);if(!(Math.sqrt(s*s+i*i)<150)){i=-90;return t<i+30&&i-30<=t&&(e="up"),t<(i=90)+30&&i-30<=t&&(e="down"),i=180,Math.abs(t)<i+30&&Math.abs(t)>=i-30&&(e="left"),e=t<(i=0)+30&&i-30<=t?"right":e}}}GameScene.prototype.preload=function(){if(!this.isPreloaded){this.game.load.onLoadStart.add(this.loadStart,this),this.game.load.onLoadComplete.add(this.loadComplete,this),this.isPreloaded=!0,this.game.load.crossOrigin="anonymous",this.game.load.image("default_bg","https://wizschool-assets.s3.ap-northeast-2.amazonaws.com/background/black_background.png"),this.game.load.image("say_bg","https://wizschool-assets.s3.ap-northeast-2.amazonaws.com/sprite/bubble.png");var e,t={};for(e in this.scenes){var i,s=this.scenes[e],a=s.spriteIds,r=s.sprites;for(i in a){var n,o=a[i],p=r[o].assetId;1!==t[p]&&(t[p]=1,n=this.assets.sprites[r[o].assetId],r[o].type!==SpriteType.TEXT&&(r[o].type===SpriteType.COMPONENT?"analog"===r[o].preview.subtype||"dpad"===r[o].preview.subtype?(this.game.load.image(p+"_alpha",this.alphaImage+"?phaser=1"),this.load.atlas(p,n.spritePath+"?phaser=1",n.spritePath.replace(".png",".json")+"?phaser=1")):"camera"===r[o].preview.subtype?this.game.load.image(p,n.path+"?phaser=1"):this.game.load.image(p,this.alphaImage+"?phaser=1"):n.spriteAnimations?this.game.load.spritesheet(p,n.spritePath+"?phaser=1",n.spriteSize[0],n.spriteSize[1]):this.game.load.image(p,n.path+"?phaser=1")))}}if(this.soundIds)for(var h in this.soundIds){h=this.soundIds[h],h=this.assets.sounds[h];this.game.load.audio(h.defaultName,h.path+"?phaser=1")}this.game.isFromWizlab&&(this.game.sound.volume=this.game.gameVolume*this.game.systemVolume/100,this.game.stage.disableVisibilityChange=this.game.isFromWizlab)}},GameScene.prototype.loadStart=function(){try{hideGameAndShowLoading(),this.loadInterval=setInterval(()=>{updateLoadingProgress(this.game.load.progressFloat)},5)}catch(e){}this.loadStartTime=(new Date).getTime()},GameScene.prototype.loadComplete=function(){this.loadInterval&&(clearInterval(this.loadInterval),this.loadInterval=void 0),console.log((new Date).getTime()-this.loadStartTime)},GameScene.prototype.shutdown=function(){for(var e in this.wizSprites){e=this.wizSprites[e];e.sprite&&e.sprite.pad&&e.sprite.pad.destroy()}},GameScene.prototype.onPause=function(){this.isTimerRunning&&(this.isTimerPausedByGame=!0,this.pauseTimer())},GameScene.prototype.onResume=function(){this.isTimerPausedByGame&&this.resumeTimer()},GameScene.prototype.onUp=function(){if(this.isInputDown){this.isInputDown=!1;var e,t=this.figureDirection();for(e in this.wizSprites){var i=this.wizSprites[e];t&&i.onSlide(t),i.onScreenClickedUp()}}},GameScene.prototype.onDown=function(){for(var e in this.isInputDown=!0,this.wizSprites)this.wizSprites[e].onScreenClicked()},GameScene.prototype.create=function(){var e,t;this.debugMode=!1,this.wizSprites=[],this.overlapData=[],this.overlapOnceDataQueue=[],this.overlapOnceData=[],this.overlapDataQueue=[],this.collisionData=[],this.collisionDataQueue=[],this.sounds={},this.clones={},this.pressedKeys={},this.updateFunctions=[],this.isInputDown=!1,this.timerStartedTime=0,this.timerDuration=0,this.timerPausedTime=0,this.isTimerRunning=!1,this.isTimerPausedByGame=!1,this.xOffset=0,this.yOffset=0,t=this.wideScreen?(e=this.screenWidth,this.screenHeight):(e="HORIZONTAL"===this.screenMode?1280:720,"HORIZONTAL"===this.screenMode?720:1280),this.spriteGroup=this.game.add.group(),this.wideScreen&&("HORIZONTAL"===this.screenMode&&1280!==e?(this.xOffset=(e-1280)/2,this.spriteGroup.position.x=this.xOffset):"VERTICAL"===this.screenMode&&1280!==t&&(this.yOffset=(t-1280)/2,this.spriteGroup.position.y=this.yOffset)),this.game.scale.setGameSize(e,t),this.game.renderer.renderSession.roundPixels=!0,this.game.forceSingleUpdate=!1,this.game.scale.scaleMode=Phaser.ScaleManager.SHOW_ALL,this.game.sound.touchLocked=!1,this.preloadHandler&&(this.preloadHandler(),this.preloadHandler=null),this.game.input.keyboard.addCallbacks(this,this.onKeyDown,this.onKeyRelease,null),this.initSounds(),this.drawDefaultBackground(),this.drawSprites(),this.game.didStartRender&&this.runAllSpriteCode(),this.game.onPause.add(this.onPause,this),this.game.onResume.add(this.onResume,this),this.game.input.onUp.add(this.onUp,this),this.game.input.onDown.add(this.onDown,this)},GameScene.prototype.update=function(){for(var e in 0<this.overlapDataQueue.length&&this.popOverlapDataQueue(),this.overlapData){var t,i,s=this.overlapData[e];this.game.physics.arcade.overlap(s.target1,s.target2,null,null,this)&&(t=s.target1.key,i=s.target2[0].key,this.sendGameEvent({api:"onOverlap",spriteId:t,name:i}),s.callback())}for(var e in 0<this.overlapOnceDataQueue.length&&this.popOverlapOnceDataQueue(),this.overlapOnceData){s=this.overlapOnceData[e];if(this.game.physics.arcade.overlap(s.target1,s.target2,null,null,this)){s.callback(),this.overlapOnceData.splice(e,1);break}}for(var e in 0<this.collisionDataQueue.length&&this.popCollisionDataQueue(),this.collisionData){s=this.collisionData[e];this.game.physics.arcade.collide(s.target1,s.target2)}for(var e in this.updateFunctions)this.updateFunctions[e]();for(var e in this.wizSprites)this.wizSprites[e].update()},GameScene.prototype.render=function(){if(this.game.didStartRender||(this.game.didStartRender=!0,this.firstRender()),this.debugMode)for(var e in this.wizSprites){e=this.wizSprites[e];e.type!==SpriteType.BACKGROUND&&this.game.debug.body(e.sprite)}},GameScene.prototype.firstRender=function(){try{updateLoadingProgress(100),setTimeout(()=>{try{hideLoadingAndShowGame(),this.runAllSpriteCode()}catch(e){try{showGame()}catch(e){this.runAllSpriteCode()}this.runAllSpriteCode()}},500)}catch(e){this.runAllSpriteCode()}},GameScene.prototype.runAllSpriteCode=function(){for(var e in this.wizSprites){e=this.wizSprites[e];e.isCloned||e.runCode()}},GameScene.prototype.initSounds=function(){if(this.soundIds)for(var e in this.soundIds){e=this.soundIds[e],e=this.assets.sounds[e];this.sounds[e.defaultName]=this.game.add.audio(e.defaultName)}},GameScene.prototype.drawDefaultBackground=function(){var e=this.game.add.tileSprite(0,0,this.game.world.bounds.width,this.game.world.bounds.height,"default_bg");this.spriteGroup.add(e)},GameScene.prototype.drawSprites=function(){for(var e in this.wizSprites=[],this.spriteDataIds){var t=this.spriteDataIds[e],e=this.spriteData[t].preview,t=this.spriteData[t].code,t=this.drawSprite(e,t);this.wizSprites.push(t)}},GameScene.prototype.drawSprite=function(e,t,i){var s=e.left,a=e.top,r=e.angle,n=e.scaleX,o=e.scaleY,p=e.opacity,h=e.type,d=e.subtype,c=i?e.originalName:e.name,l=this.spriteData[c].assetId;switch(h){case SpriteType.PLAIN:case SpriteType.SPRITE:case SpriteType.CUSTOM:y=this.game.add.sprite(s,a,l),this.spriteGroup.add(y);break;case SpriteType.COMPONENT:y="camera"===d?this.game.add.sprite(s,a,l):this.game.add.sprite(0,0,l+"_alpha"),"dpad"===d?(y.pad=this.game.plugins.add(Phaser.VirtualJoystick),y.pad.stick=y.pad.addDPad(s,a,200,l),y.pad.stick.scale=n):"analog"===d&&(y.pad=this.game.plugins.add(Phaser.VirtualJoystick),y.pad.stick=y.pad.addStick(s,a,200,l),y.pad.stick.scale=n);break;case SpriteType.BACKGROUND:var u=this.scenes[this.sceneId],m=u.worldWidth||("HORIZONTAL"===this.screenMode?1280:720),g=u.worldHeight||("HORIZONTAL"===this.screenMode?720:1280),S=(S=this.game.cache.getImage(l).width)<m?m:S,f=this.game.cache.getImage(l).height,y=this.game.add.tileSprite(m/2-this.xOffset,g/2-this.yOffset,S,f=f<g?g:f,l);this.game.world.setBounds(0,0,m,g),this.spriteGroup.add(y);break;case SpriteType.TEXT:u=this.spriteData[c].preview,S=u.fontSize+"px "+u.fontFamily,f=u.fontColor,m=u.fontWeight,g=u.fontStyle;(y=this.game.add.text(s,a,u.textValue,{font:S,fill:f,fontWeight:m,fontStyle:g})).fontFamily=u.fontFamily,this.spriteGroup.add(y)}y.angle=r,y.scale.set(n,o),y.alpha=p,y.inputEnabled=1===p,y.anchor.set(.5),this.game.physics.arcade.enable(y),y.events.onInputDown.add(this.onClick,this),y.events.onInputUp.add(this.onClickUp,this);e=e.name;y.key=e;e=new WizSprite({game:this.game,type:h,subtype:d,sprite:y,codeData:t,gameScene:this,spriteName:e,originalName:c,asset:this.assets.sprites[this.spriteData[c].assetId],errorHandler:this.errorHandler,socketManager:this.socketManager});return this.clones[c]||(this.clones[c]=[]),this.clones[c].push(e.sprite),e},GameScene.prototype.cloneSprite=function(e){var t=e.spriteName,i=e.originalName,s=this.spriteData[i].code,a=i+"_clone_"+(new Date).getTime();a+="_"+this.clones[i].length;var r=this.spriteData[i].preview;(r=JSON.parse(JSON.stringify(r))).name=a,r.originalName=i,r.masterName=t,r.angle=e.sprite.angle,r.scaleX=e.sprite.scale.x,r.scaleY=e.sprite.scale.y,r.left=e.sprite.position.x,r.top=e.sprite.position.y;s=this.drawSprite(r,s,!0);return s.sprite.z=e.sprite.z,this.spriteGroup.sort("z",Phaser.Group.SORT_ASCENDING),this.wizSprites.push(s),s},GameScene.prototype.isOverlapped=function(e,t){var i,s=void 0;for(i in this.wizSprites){var a=this.wizSprites[i];a.originalName===t&&(s=this.clones[a.originalName]||[a.sprite])}return!(!e||!s)&&this.game.physics.arcade.overlap(e,s,null,null,this)},GameScene.prototype.popOverlapDataQueue=function(){for(var e=this.overlapDataQueue.length-1;0<=e;e--){var t,i=this.overlapDataQueue[e],s=i.spriteName,a=i.targetSpriteName,i=i.callback,r=void 0,n=void 0;for(t in this.wizSprites){var o=this.wizSprites[t];o.spriteName===s&&(r=o.sprite),o.originalName===a&&(n=this.clones[o.originalName]||[o.sprite])}r&&n&&(this.overlapData.push({target1:r,target2:n,callback:i}),this.overlapDataQueue.splice(e,1))}},GameScene.prototype.popOverlapOnceDataQueue=function(){for(var e=this.overlapOnceDataQueue.length-1;0<=e;e--){var t,i=this.overlapOnceDataQueue[e],s=i.spriteName,a=i.targetSpriteName,i=i.callback,r=void 0,n=void 0;for(t in this.wizSprites){var o=this.wizSprites[t];o.spriteName===s&&(r=o.sprite),o.originalName===a&&(n=this.clones[o.originalName]||[o.sprite])}r&&n&&(this.overlapOnceData.push({target1:r,target2:n,callback:i}),this.overlapOnceDataQueue.splice(e,1))}},GameScene.prototype.popOverlapOnceDataQueue=function(){for(var e=this.overlapOnceDataQueue.length-1;0<=e;e--){var t,i=this.overlapOnceDataQueue[e],s=i.spriteName,a=i.targetSpriteName,i=i.callback,r=void 0,n=void 0;for(t in this.wizSprites){var o=this.wizSprites[t];o.spriteName===s&&(r=o.sprite),o.originalName===a&&(n=this.clones[o.originalName]||[o.sprite])}r&&n&&(this.overlapOnceData.push({target1:r,target2:n,callback:i}),this.overlapOnceDataQueue.splice(e,1))}},GameScene.prototype.popCollisionDataQueue=function(){for(var e=this.collisionDataQueue.length-1;0<=e;e--){var t,i=this.collisionDataQueue[e],s=i.spriteName,a=i.targetSpriteName,r=void 0,n=void 0;for(t in this.wizSprites){var o=this.wizSprites[t];o.spriteName===s&&(r=o.sprite),o.originalName===a&&(n=this.clones[o.originalName]||[o.sprite])}r&&n&&(this.collisionData.push({target1:r,target2:n}),this.collisionDataQueue.splice(e,1))}},GameScene.prototype.addOverlap=function(e,t,i){this.overlapDataQueue.push({spriteName:e,targetSpriteName:t,callback:i})},GameScene.prototype.addOverlapOnce=function(e,t,i){this.overlapOnceDataQueue.push({spriteName:e,targetSpriteName:t,callback:i})},GameScene.prototype.addCollision=function(e,t){this.collisionDataQueue.push({spriteName:e,targetSpriteName:t})},GameScene.prototype.onKeyDown=function(e){var t,i=convertKey(e.key);for(t in this.pressedKeys[i]||(this.pressedKeys[i]=i),this.wizSprites)this.wizSprites[t].onKeyDown(i)},GameScene.prototype.onKeyRelease=function(e){var t,i=convertKey(e.key);for(t in this.pressedKeys[i]&&delete this.pressedKeys[i],this.wizSprites)this.wizSprites[t].onKeyRelease(i)},GameScene.prototype.onClick=function(e){for(var t in this.wizSprites){t=this.wizSprites[t];e.key===t.spriteName&&t.onClicked()}},GameScene.prototype.onClickUp=function(e){for(var t in this.wizSprites){t=this.wizSprites[t];e.key===t.spriteName&&t.onClickedUp()}},GameScene.prototype.getSprite=function(e){for(var t=0;t<this.wizSprites.length;t++)if(this.wizSprites[t].spriteName===e)return this.wizSprites[t]},GameScene.prototype.sendSignal=function(e){for(var t in this.wizSprites)this.wizSprites[t].onReceive(e)},GameScene.prototype.playSound=function(e,t){this.sounds[e]&&(this.sounds[e].loop=t,this.sounds[e].play())},GameScene.prototype.restartSound=function(e){this.sounds[e]&&this.sounds[e].restart()},GameScene.prototype.stopSound=function(e){this.sounds[e]&&this.sounds[e].stop()},GameScene.prototype.pauseSound=function(e){this.sounds[e]&&this.sounds[e].pause()},GameScene.prototype.resumeSound=function(e){this.sounds[e]&&this.sounds[e].resume()},GameScene.prototype.hasSound=function(e){return!!this.sounds[e]},GameScene.prototype.startTimer=function(){this.isTimerRunning=!0,this.timerStartedTime=(new Date).getTime()},GameScene.prototype.pauseTimer=function(){this.timerPausedTime=(new Date).getTime(),this.isTimerRunning=!1},GameScene.prototype.resumeTimer=function(){this.isTimerRunning||(this.timerStartedTime+=(new Date).getTime()-this.timerPausedTime,this.isTimerRunning=!0)},GameScene.prototype.resetTimer=function(){this.isTimerRunning=!1,this.timerDuration=0},GameScene.prototype.getTimer=function(){return this.isTimerRunning&&(this.timerDuration=(new Date).getTime()-this.timerStartedTime,this.timerDuration/=1e3,this.timerDuration=this.timerDuration.toFixed(1)),parseFloat(this.timerDuration)},GameScene.prototype.onGyroChanged=function(e,t){for(var i in this.wizSprites)this.wizSprites[i].onGyroChanged(e,t)},GameScene.prototype.onListeningResult=function(e){for(var t in this.wizSprites)this.wizSprites[t].onListeningResult(e)},GameScene.prototype.onShaked=function(){for(var e in this.wizSprites)this.wizSprites[e].onShaked()},GameScene.prototype.onFaceDetect=function(e){for(var t in this.wizSprites)this.wizSprites[t].onFaceDetected(e)},GameScene.prototype.onSaveGameData=function(){for(var e in this.wizSprites)this.wizSprites[e].onSaveGameData()},GameScene.prototype.onResetGameData=function(){for(var e in this.wizSprites)this.wizSprites[e].onResetGameData()},GameScene.prototype.onLoadGameData=function(){for(var e in this.wizSprites)this.wizSprites[e].onLoadGameData()};