(window.webpackJsonp=window.webpackJsonp||[]).push([[29],{1258:function(e,a,t){"use strict";t.r(a);var n=t(0),c=t.n(n),s=t(21),r=t(43),i=t(2500),l=t(87);a.default=function(e){return c.a.createElement(s.a,{store:r.default},c.a.createElement(l.default,null,c.a.createElement(i.default,e)))}},2500:function(e,a,t){"use strict";t.r(a);var n=t(15),c=t.n(n),s=t(23),r=t(4),i=t(6),l=t(8),o=t(14),u=t(7),m=t(0),k=t.n(m),g=t(21),b=t(2),d=t(11),f=t(319),R=t(2501);function N(e){var a=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var t,n=Object(u.a)(e);if(a){var c=Object(u.a)(this).constructor;t=Reflect.construct(n,arguments,c)}else t=n.apply(this,arguments);return Object(o.a)(this,t)}}var v=function(e){Object(l.a)(t,e);var a=N(t);function t(e){var n;return Object(r.a)(this,t),(n=a.call(this,e)).getSemesterInfo=Object(s.a)(c.a.mark(function e(){var a,t;return c.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,d.getSemester();case 3:return a=e.sent,e.next=6,a.json();case 6:t=e.sent,n.setState({semester:t}),e.next=13;break;case 10:e.prev=10,e.t0=e.catch(0),console.log(e.t0);case 13:case"end":return e.stop()}},e,null,[[0,10]])})),n.handleSelectTab=function(e){n.setState({selectedTab:e},function(){n.getMyRankingInfo(),n.getRankingList()})},n.getMyRankingInfo=Object(s.a)(c.a.mark(function e(){var a,t,s;return c.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a={type:n.state.selectedTab,email:n.props.userinfo.email},e.prev=1,e.next=4,d.getMyRanking(a);case 4:return t=e.sent,e.next=7,t.json();case 7:s=e.sent,n.setState({myRanking:s}),e.next=14;break;case 11:e.prev=11,e.t0=e.catch(1),console.log(e.t0);case 14:case"end":return e.stop()}},e,null,[[1,11]])})),n.getRankingList=Object(s.a)(c.a.mark(function e(){var a,t,s,r,i,l,o,u,m;return c.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=n.state,t=a.currentPage,s=a.pageSize,r=a.searchKey,i={type:n.state.selectedTab},""===r?(i.limit=s,i.offset=(t-1)*s):i.searchKey=r,e.next=5,d.getUserRankings(i);case 5:return l=e.sent,e.next=8,l.json();case 8:o=e.sent,u=o.count,(m=o.rows).sort(function(e,a){return e.rank-a.rank}),n.setState({totalRankingCount:u,totalRankingPage:Math.ceil(u/s),userRankings:m,isSearchedByKey:""!==r});case 12:case"end":return e.stop()}},e)})),n.onClickMoveMyPage=function(){n.props.history.push("/mypage")},n.onClickPageNumber=function(e){n.setState({currentPage:e},function(){n.getRankingList()})},n.handleOnChangeSearchKey=function(e){n.setState({searchKey:e.target.value})},n.handleOnKeyUp=function(e){13===e.keyCode&&n.getRankingList()},n.getPageInfo=function(){for(var e=[],a=n.state.startPage;a<=n.state.totalRankingPage&&(e.push(a),10!==e.length);a++);return{pages:e,currentPage:n.state.currentPage}},n.onClickPageHandler=function(e){var a=n.getPageInfo().pages;"next"===e?a[a.length-1]+1<=n.state.totalRankingPage&&(n.setState({startPage:a[a.length-1]+1}),n.onClickPageNumber(a[a.length-1]+1)):a[0]-n.state.pageSize>0?(n.setState({startPage:a[0]-10}),n.onClickPageNumber(a[0]-10)):(n.setState({startPage:a[0]}),n.onClickPageNumber(a[0]))},n.onClickSubScribe=function(e,a){"subscribe"===e?n.props.subscribe(a.email,function(e){e&&n.subscribeCountManage("plus",a.email)}):"unsubscribe"===e&&n.props.unsubscribe(a.email,function(e){e&&n.subscribeCountManage("minus",a.email)})},n.subscribeCountManage=function(e,a){for(var t=n.state.userRankings,c=0;c<t.length;c++)if(t[c].user.email===a){"plus"===e&&(t[c].user.subscribeCount+=1),"minus"===e&&t[c].user.subscribeCount>0&&(t[c].user.subscribeCount-=1);break}n.setState({userRankings:t})},n.state={semester:void 0,totalRankingCount:0,totalRankingPage:0,userRankings:[],myRanking:void 0,selectedTab:"learn",offset:0,pageSize:10,currentPage:1,startPage:1,searchKey:"",isSearchedByKey:!1},n}return Object(i.a)(t,[{key:"componentDidMount",value:function(){this.getSemesterInfo(),this.getMyRankingInfo(),this.getRankingList()}},{key:"render",value:function(){var e=this.state,a=e.semester,t=e.selectedTab,n=e.userRankings,c=e.myRanking,s=e.isSearchedByKey,r=this.props,i=r.intl,l=r.userinfo,o=r.subscribeInfo,u=this.handleSelectTab,m=this.getPageInfo,g=this.onClickPageNumber,b=this.handleOnChangeSearchKey,d=this.handleOnKeyUp,f=this.getRankingList,N=this.onClickPageHandler,v=this.onClickMoveMyPage,p=this.onClickSubScribe,E=m();return k.a.createElement(R.default,{intl:i,me:l,semester:a,pages:E.pages,currentPage:E.currentPage,selectedTab:t,handleSelectTab:u,userRankings:n,myRanking:c,onClickPageNumber:g,handleOnChangeSearchKey:b,handleOnKeyUp:d,getRankingList:f,isSearchedByKey:s,onClickPageHandler:N,onClickMoveMyPage:v,subscribedEmails:o.emails,onClickSubScribe:p})}}]),t}(m.Component);a.default=Object(g.b)(function(e){return{userinfo:e.userinfo}},{})(Object(b.e)(Object(f.withSubscribe)(v)))},2501:function(e,a,t){"use strict";t.r(a),t.d(a,"default",function(){return M});var n=t(0),c=t.n(n),s=t(304),r=t(2753),i=t.n(r),l=t(2823),o=t.n(l),u=t(2824),m=t.n(u),k=t(2829),g=t.n(k),b=t(180),d=t.n(b),f=t(2820),R=t.n(f),N=t(2821),v=t.n(N),p=t(2822),E=t.n(p),I=t(2826),h=t.n(I),_=t(2825),C=t.n(_),S=t(2827),P=t.n(S),y=t(2828),T=t.n(y),K=(t(3136),t(2));function M(e){var a=e.intl,t=e.semester,n=e.pages,r=e.currentPage,i=e.selectedTab,l=e.handleSelectTab,o=e.userRankings,u=e.myRanking,m=e.onClickPageNumber,k=e.handleOnChangeSearchKey,g=e.handleOnKeyUp,b=e.getRankingList,f=e.isSearchedByKey,R=e.onClickPageHandler,N=e.onClickMoveMyPage,v=e.subscribedEmails,p=e.onClickSubScribe;return c.a.createElement(s.default,null,c.a.createElement("div",{className:"Page--Ranking"},c.a.createElement("div",{className:"RankWrapper"},c.a.createElement("div",{className:"RankTitle"},c.a.createElement(K.a,{id:"ID_RANKING_TITLE"})),c.a.createElement("div",{className:"RankSeason"},t?t.name:""),c.a.createElement("div",{className:"RankSubTitle"},c.a.createElement(K.a,{id:"ID_RANKING_SUBTITLE",values:{count:a.formatNumber(t?t.studentCount:0)}}),c.a.createElement(K.a,{id:"ID_RANKING_SUBTITLE2"})),c.a.createElement("div",{className:"RankTabs"},c.a.createElement("div",{className:"RankTab ".concat("learn"===i&&"RankTabActive"),onClick:function(){return l("learn")}},c.a.createElement("img",{className:"RankTabImg",src:h.a,alt:"tab01"}),c.a.createElement("div",{className:"RankTabTitle"},c.a.createElement(K.a,{id:"ID_RANKING_TAB_LEARN"}))),c.a.createElement("div",{className:"RankTab ".concat("create"===i&&"RankTabActive"),onClick:function(){return l("create")}},c.a.createElement("img",{className:"RankTabImg",src:C.a,alt:"tab02"}),c.a.createElement("div",{className:"RankTabTitle"},c.a.createElement(K.a,{id:"ID_RANKING_TAB_CREATE"}))),c.a.createElement("div",{className:"RankTab ".concat("pop"===i&&"RankTabActive"),onClick:function(){return l("pop")}},c.a.createElement("img",{className:"RankTabImg",src:P.a,alt:"tab03"}),c.a.createElement("div",{className:"RankTabTitle"},c.a.createElement(K.a,{id:"ID_RANKING_TAB_POP"}))),c.a.createElement("div",{className:"RankTab ".concat("view"===i&&"RankTabActive"),onClick:function(){return l("view")}},c.a.createElement("img",{className:"RankTabImg",src:T.a,alt:"tab04"}),c.a.createElement("div",{className:"RankTabTitle"},c.a.createElement(K.a,{id:"ID_RANKING_TAB_VIEW"})))),c.a.createElement("div",{className:"RankLine"}),u?c.a.createElement(A,Object.assign({},u,{isMe:!0,mode:i,onClickMoveMyPage:N,intl:a})):null,c.a.createElement("div",{className:"RankLine"}),c.a.createElement("div",{className:"RankSearchWrapper"},c.a.createElement("div",{className:"RankSearch"},c.a.createElement("input",{type:"text",placeholder:a.formatMessage({id:"ID_RANKING_SEARCH"}),onChange:function(e){k(e)},onKeyUp:g}),c.a.createElement("img",{src:d.a,alt:"search",onClick:b})),c.a.createElement("div",{className:"RankUpdateInfo"},c.a.createElement(K.a,{id:"ID_RANKING_UPDATE_INFO"}))),c.a.createElement("div",{className:"RankUsers"},o.map(function(t,n){return c.a.createElement(A,Object.assign({key:n},t,{isMe:t.user.email===e.me.email,isSubscribed:v.includes(t.user.email),mode:i,intl:a,onClickSubScribe:p}))})),f?null:c.a.createElement("div",{className:"RankPages"},c.a.createElement("div",{className:r>10?"RankPageNav RankPageActive":"RankPageNav",onClick:function(){r>10&&R("prev")}},c.a.createElement(K.a,{id:"ID_RANKING_PREV"})),n.map(function(e,a){return e===r?c.a.createElement("div",{key:a,className:"RankPage RankPageCurrent"},e):c.a.createElement("div",{key:a,className:"RankPage",onClick:function(){m(e)}},e)}),c.a.createElement("div",{className:10===n.length?"RankPageNav RankPageActive":"RankPageNav",onClick:function(){10===n.length&&R("next")}},c.a.createElement(K.a,{id:"ID_RANKING_NEXT"}))))))}var A=function(e){var a,t,n=e.intl,s=e.mode,r=e.rank,l=e.beforeRank,u=e.icon,k=e.name,b=e.subscribeCount,d=e.isMe,f=e.isSubscribed,R=e.point,N=e.user,v=e.onClickMoveMyPage,p=e.onClickSubScribe;switch(s){case"learn":a=n.formatMessage({id:"ID_RANKING_NUMBER_LEARN"}),t=i.a;break;case"create":a=n.formatMessage({id:"ID_RANKING_NUMBER_CREATE"}),t=o.a;break;case"pop":a=n.formatMessage({id:"ID_RANKING_NUMBER_POP"}),t=m.a;break;case"view":a=n.formatMessage({id:"ID_RANKING_NUMBER_VIEW"}),t=g.a}var E="RankItemBefore",I=n.formatNumber(l-r);return d&&(l-r>0?(E+=" RankItemPlus",I="+".concat(I)):l-r<0&&(E+=" RankItemMinus")),c.a.createElement("div",{className:"RankItem ".concat(d&&"RankItemMe")},c.a.createElement("div",{className:"RankItemRank"},c.a.createElement("div",{className:"RankItemRankNumber"},c.a.createElement(O,{rank:r})),d&&c.a.createElement("div",{className:E},I)),c.a.createElement("div",{className:"RankInfo"},c.a.createElement("img",{className:"RankInfoImg",src:u||N.icon,alt:"user icon"}),c.a.createElement("div",{className:"RankInfoDesc"},c.a.createElement("div",{className:"RankInfoName"},k||N.name),c.a.createElement("div",{className:"RankInfoSubscribe"},c.a.createElement(K.a,{id:"ID_RANKING_SUBSCRIBE_COUNT",values:{count:b||N.subscribeCount}})))),c.a.createElement("div",{className:"RankInfoNumberInfo"},c.a.createElement("img",{src:t,alt:"number icon"}),c.a.createElement("div",{className:"RankInfoNumber"},c.a.createElement(K.b,{value:R||0})),c.a.createElement("div",{className:"RankInfoNumberUnit"},a)),d?c.a.createElement("div",{className:"RankInfoMyPage",onClick:v},c.a.createElement(K.a,{id:"ID_RANKING_MYPAGE"})):f?c.a.createElement("div",{className:"RankInfoSubOn",onClick:function(){p("unsubscribe",N)}},c.a.createElement(K.a,{id:"ID_RANKING_SUBSCRIBED"})):c.a.createElement("div",{className:"RankInfoSubOff",onClick:function(){p("subscribe",N)}},c.a.createElement(K.a,{id:"ID_RANKING_SUBSCRIBE"})))},O=function(e){switch(e.rank){case 1:return c.a.createElement("img",{className:"RankImg",src:R.a,alt:"rank"});case 2:return c.a.createElement("img",{className:"RankImg",src:v.a,alt:"rank"});case 3:return c.a.createElement("img",{className:"RankImg",src:E.a,alt:"rank"});default:return c.a.createElement("div",{className:"RankText"},c.a.createElement(K.b,{value:e.rank}))}}},2753:function(e,a,t){e.exports=t.p+"static/media/icon_bits.53fcd51d.svg"},2820:function(e,a,t){e.exports=t.p+"static/media/rank_1.318fbe20.svg"},2821:function(e,a,t){e.exports=t.p+"static/media/rank_2.cc420bfa.svg"},2822:function(e,a,t){e.exports=t.p+"static/media/rank_3.8add8304.svg"},2823:function(e,a,t){e.exports=t.p+"static/media/rank_create_icon.c9f8206d.svg"},2824:function(e,a,t){e.exports=t.p+"static/media/rank_pop_icon.03704b1a.svg"},2825:function(e,a,t){e.exports=t.p+"static/media/rank_tab_create.2db6d2d2.svg"},2826:function(e,a,t){e.exports=t.p+"static/media/rank_tab_learn.06964dbb.svg"},2827:function(e,a,t){e.exports=t.p+"static/media/rank_tab_pop.6e9c1045.svg"},2828:function(e,a,t){e.exports=t.p+"static/media/rank_tap_view.0a3e7bd8.svg"},2829:function(e,a,t){e.exports=t.p+"static/media/rank_view_icon.f9be4666.svg"},3136:function(e,a,t){}}]);
//# sourceMappingURL=29.3dde98da.chunk.js.map